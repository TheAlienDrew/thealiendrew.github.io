{"version":3,"file":"gfx.js","sourceRoot":"","sources":["../../src/gfx/2d/debug.ts","../../src/gfx/2d/surface.ts","../../src/gfx/2d/2d.ts","../../src/gfx/easel.ts","../../src/gfx/debug/tree.ts","../../src/gfx/remotingGfx.ts","../../src/gfx/easelHost.ts","../../src/gfx/window/windowEaselHost.ts","../../src/gfx/test/recorder.ts","../../src/gfx/test/playbackEaselHost.ts","../../src/gfx/test/recordingEaselHost.ts","../../src/gfx/references.ts"],"names":[],"mappings":"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","sourcesContent":["module Shumway.GFX.Canvas2D {\n\timport assert = Shumway.Debug.assert;\n\n\tlet originalSave = CanvasRenderingContext2D.prototype.save;\n\tlet originalClip = CanvasRenderingContext2D.prototype.clip;\n\tlet originalFill = CanvasRenderingContext2D.prototype.fill;\n\tlet originalStroke = CanvasRenderingContext2D.prototype.stroke;\n\tlet originalRestore = CanvasRenderingContext2D.prototype.restore;\n\tlet originalBeginPath = CanvasRenderingContext2D.prototype.beginPath;\n\n\tfunction debugSave() {\n\t\tif (this.stackDepth === undefined) {\n\t\t\tthis.stackDepth = 0;\n\t\t}\n\t\tif (this.clipStack === undefined) {\n\t\t\tthis.clipStack = [0];\n\t\t} else {\n\t\t\tthis.clipStack.push(0);\n\t\t}\n\t\tthis.stackDepth++;\n\t\toriginalSave.call(this);\n\t}\n\n\tfunction debugRestore() {\n\t\tthis.stackDepth--;\n\t\tthis.clipStack.pop();\n\t\toriginalRestore.call(this);\n\t}\n\n\tfunction debugFill() {\n\t\tassert(!this.buildingClippingRegionDepth);\n\t\toriginalFill.apply(this, arguments);\n\t}\n\n\tfunction debugStroke() {\n\t\tassert(debugClipping.value || !this.buildingClippingRegionDepth);\n\t\toriginalStroke.apply(this, arguments);\n\t}\n\n\tfunction debugBeginPath() {\n\t\toriginalBeginPath.call(this);\n\t}\n\n\tfunction debugClip() {\n\t\tif (this.clipStack === undefined) {\n\t\t\tthis.clipStack = [0];\n\t\t}\n\t\tthis.clipStack[this.clipStack.length - 1]++;\n\t\tif (debugClipping.value) {\n\t\t\tthis.strokeStyle = ColorStyle.Pink;\n\t\t\tthis.stroke.apply(this, arguments);\n\t\t} else {\n\t\t\toriginalClip.apply(this, arguments);\n\t\t}\n\t}\n\n\texport function notifyReleaseChanged() {\n\t\tif (release) {\n\t\t\tCanvasRenderingContext2D.prototype.save = originalSave;\n\t\t\tCanvasRenderingContext2D.prototype.clip = originalClip;\n\t\t\tCanvasRenderingContext2D.prototype.fill = originalFill;\n\t\t\tCanvasRenderingContext2D.prototype.stroke = originalStroke;\n\t\t\tCanvasRenderingContext2D.prototype.restore = originalRestore;\n\t\t\tCanvasRenderingContext2D.prototype.beginPath = originalBeginPath;\n\t\t} else {\n\t\t\tCanvasRenderingContext2D.prototype.save = debugSave;\n\t\t\tCanvasRenderingContext2D.prototype.clip = debugClip;\n\t\t\tCanvasRenderingContext2D.prototype.fill = debugFill;\n\t\t\tCanvasRenderingContext2D.prototype.stroke = debugStroke;\n\t\t\tCanvasRenderingContext2D.prototype.restore = debugRestore;\n\t\t\tCanvasRenderingContext2D.prototype.beginPath = debugBeginPath;\n\t\t}\n\t}\n\n\tCanvasRenderingContext2D.prototype.enterBuildingClippingRegion = function () {\n\t\tif (!this.buildingClippingRegionDepth) {\n\t\t\tthis.buildingClippingRegionDepth = 0;\n\t\t}\n\t\tthis.buildingClippingRegionDepth++;\n\t};\n\n\tCanvasRenderingContext2D.prototype.leaveBuildingClippingRegion = function () {\n\t\tthis.buildingClippingRegionDepth--;\n\t};\n}\n","module Shumway.GFX.Canvas2D {\n\timport Rectangle = Shumway.GFX.Geometry.Rectangle;\n\n\timport assert = Shumway.Debug.assert;\n\timport clamp = Shumway.NumberUtilities.clamp;\n\n\tdeclare let registerScratchCanvas: any;\n\n\tlet isFirefox = navigator.userAgent.indexOf('Firefox') != -1;\n\n\t/**\n\t * Scale blur radius for each quality level. The scale constants were gathered\n\t * experimentally.\n\t */\n\tfunction getBlurScale(ratio: number, quality: number) {\n\t\tlet blurScale = ratio / 2; // For some reason we always have to scale by 1/2 first.\n\t\tswitch (quality) {\n\t\t\tcase 0:\n\t\t\t\treturn 0;\n\t\t\tcase 1:\n\t\t\t\treturn blurScale / 2.7;\n\t\t\tcase 2:\n\t\t\t\treturn blurScale / 1.28;\n\t\t\tcase 3:\n\t\t\tdefault:\n\t\t\t\treturn blurScale;\n\t\t}\n\t}\n\n\texport class Filters {\n\t\t/**\n\t\t * Reusable blur filter SVG element.\n\t\t */\n\t\tstatic _svgBlurFilter: Element;\n\n\t\t/**\n\t\t * Reusable dropshadow filter SVG element.\n\t\t */\n\t\tstatic _svgDropshadowFilterBlur: Element;\n\t\tstatic _svgDropshadowFilterFlood: Element;\n\t\tstatic _svgDropshadowFilterOffset: Element;\n\t\tstatic _svgDropshadowMergeNode: Element;\n\n\t\t/**\n\t\t * Reusable colormatrix filter SVG element.\n\t\t */\n\t\tstatic _svgColorMatrixFilter: Element;\n\n\t\tstatic _svgFiltersAreSupported = !!Object.getOwnPropertyDescriptor(CanvasRenderingContext2D.prototype, \"filter\");\n\n\t\t/**\n\t\t * Creates an SVG element and defines filters that are referenced in |canvas.filter| properties. We cannot\n\t\t * inline CSS filters because they don't expose independent blurX and blurY properties.\n\t\t * This only works in Firefox, and you have to set the 'canvas.filters.enabled' equal to |true|.\n\t\t */\n\t\tprivate static _prepareSVGFilters() {\n\t\t\tif (Filters._svgBlurFilter) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n\t\t\tsvg.setAttribute(\"style\", \"display:block;width:0px;height:0px\");\n\t\t\tlet defs = document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\n\n\t\t\t// Blur Filter\n\t\t\tlet blurFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"filter\");\n\t\t\tblurFilter.setAttribute(\"id\", \"svgBlurFilter\");\n\t\t\tlet feGaussianFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feGaussianBlur\");\n\t\t\tfeGaussianFilter.setAttribute(\"stdDeviation\", \"0 0\");\n\t\t\tblurFilter.appendChild(feGaussianFilter);\n\t\t\tdefs.appendChild(blurFilter);\n\t\t\tFilters._svgBlurFilter = feGaussianFilter;\n\n\t\t\t// Drop Shadow Filter\n\t\t\tlet dropShadowFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"filter\");\n\t\t\tdropShadowFilter.setAttribute(\"id\", \"svgDropShadowFilter\");\n\t\t\tfeGaussianFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feGaussianBlur\");\n\t\t\tfeGaussianFilter.setAttribute(\"in\", \"SourceAlpha\");\n\t\t\tfeGaussianFilter.setAttribute(\"stdDeviation\", \"3\");\n\t\t\tdropShadowFilter.appendChild(feGaussianFilter);\n\t\t\tFilters._svgDropshadowFilterBlur = feGaussianFilter;\n\n\t\t\tlet feOffset = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feOffset\");\n\t\t\tfeOffset.setAttribute(\"dx\", \"0\");\n\t\t\tfeOffset.setAttribute(\"dy\", \"0\");\n\t\t\tfeOffset.setAttribute(\"result\", \"offsetblur\");\n\t\t\tdropShadowFilter.appendChild(feOffset);\n\t\t\tFilters._svgDropshadowFilterOffset = feOffset;\n\n\t\t\tlet feFlood = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feFlood\");\n\t\t\tfeFlood.setAttribute(\"flood-color\", \"rgba(0,0,0,1)\");\n\t\t\tdropShadowFilter.appendChild(feFlood);\n\t\t\tFilters._svgDropshadowFilterFlood = feFlood;\n\n\t\t\tlet feComposite = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feComposite\");\n\t\t\tfeComposite.setAttribute(\"in2\", \"offsetblur\");\n\t\t\tfeComposite.setAttribute(\"operator\", \"in\");\n\t\t\tdropShadowFilter.appendChild(feComposite);\n\t\t\tfeComposite = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feComposite\");\n\t\t\tfeComposite.setAttribute(\"in2\", \"SourceAlpha\");\n\t\t\tfeComposite.setAttribute(\"operator\", \"out\");\n\t\t\tfeComposite.setAttribute(\"result\", \"outer\");\n\t\t\tdropShadowFilter.appendChild(feComposite);\n\n\t\t\tlet feMerge = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMerge\");\n\t\t\tlet feMergeNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMergeNode\");\n\t\t\tfeMerge.appendChild(feMergeNode);\n\t\t\tfeMergeNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMergeNode\");\n\t\t\tfeMerge.appendChild(feMergeNode);\n\t\t\tFilters._svgDropshadowMergeNode = feMergeNode;\n\t\t\tdropShadowFilter.appendChild(feMerge);\n\t\t\tdefs.appendChild(dropShadowFilter);\n\n\t\t\tlet colorMatrixFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"filter\");\n\t\t\tcolorMatrixFilter.setAttribute(\"id\", \"svgColorMatrixFilter\");\n\t\t\tlet feColorMatrix = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feColorMatrix\");\n\t\t\t// Color interpolation in linear RGB doesn't seem to match Flash's results.\n\t\t\tfeColorMatrix.setAttribute(\"color-interpolation-filters\", \"sRGB\");\n\t\t\tfeColorMatrix.setAttribute(\"in\", \"SourceGraphic\");\n\t\t\tfeColorMatrix.setAttribute(\"type\", \"matrix\");\n\t\t\tcolorMatrixFilter.appendChild(feColorMatrix);\n\n\t\t\tfeComposite = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feComposite\");\n\t\t\tfeComposite.setAttribute(\"in2\", \"SourceAlpha\");\n\t\t\tfeComposite.setAttribute(\"operator\", \"in\");\n\t\t\tcolorMatrixFilter.appendChild(feComposite);\n\n\t\t\tdefs.appendChild(colorMatrixFilter);\n\t\t\tFilters._svgColorMatrixFilter = feColorMatrix;\n\t\t\tsvg.appendChild(defs);\n\t\t\tdocument.documentElement.appendChild(svg);\n\t\t}\n\n\t\tstatic _applyFilter(ratio: number, context: CanvasRenderingContext2D, filter: Filter) {\n\t\t\tif (!Filters._svgFiltersAreSupported) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tFilters._prepareSVGFilters();\n\t\t\tFilters._removeFilter(context);\n\t\t\tlet scale = ratio;\n\t\t\tif (filter instanceof BlurFilter) {\n\t\t\t\tlet blurFilter = <BlurFilter>filter;\n\t\t\t\tlet blurScale = getBlurScale(ratio, blurFilter.quality);\n\t\t\t\tFilters._svgBlurFilter.setAttribute(\"stdDeviation\",\n\t\t\t\t\tblurFilter.blurX * blurScale + \" \" +\n\t\t\t\t\tblurFilter.blurY * blurScale);\n\t\t\t\tcontext.filter = \"url(#svgBlurFilter)\";\n\t\t\t} else if (filter instanceof DropshadowFilter) {\n\t\t\t\tlet dropshadowFilter = <DropshadowFilter>filter;\n\t\t\t\tlet blurScale = getBlurScale(ratio, dropshadowFilter.quality);\n\t\t\t\tFilters._svgDropshadowFilterBlur.setAttribute(\"stdDeviation\",\n\t\t\t\t\tdropshadowFilter.blurX * blurScale + \" \" +\n\t\t\t\t\tdropshadowFilter.blurY * blurScale\n\t\t\t\t);\n\t\t\t\tFilters._svgDropshadowFilterOffset.setAttribute(\"dx\",\n\t\t\t\t\tString(Math.cos(dropshadowFilter.angle * Math.PI / 180) * dropshadowFilter.distance * scale));\n\t\t\t\tFilters._svgDropshadowFilterOffset.setAttribute(\"dy\",\n\t\t\t\t\tString(Math.sin(dropshadowFilter.angle * Math.PI / 180) * dropshadowFilter.distance * scale));\n\t\t\t\tFilters._svgDropshadowFilterFlood.setAttribute(\"flood-color\",\n\t\t\t\t\tColorUtilities.rgbaToCSSStyle(((dropshadowFilter.color << 8) | Math.round(255 * dropshadowFilter.alpha))));\n\t\t\t\tFilters._svgDropshadowMergeNode.setAttribute(\"in\",\n\t\t\t\t\tdropshadowFilter.knockout ? \"outer\" : \"SourceGraphic\");\n\t\t\t\tcontext.filter = \"url(#svgDropShadowFilter)\";\n\t\t\t} else if (filter instanceof ColorMatrix) {\n\t\t\t\tlet colorMatrix = <ColorMatrix>filter;\n\t\t\t\tFilters._svgColorMatrixFilter.setAttribute(\"values\", colorMatrix.toSVGFilterMatrix());\n\t\t\t\tcontext.filter = \"url(#svgColorMatrixFilter)\";\n\t\t\t}\n\t\t}\n\n\t\tstatic _removeFilter(context: CanvasRenderingContext2D) {\n\t\t\t// For some reason, setting this to the default empty string \"\" does\n\t\t\t// not work, it expects \"none\".\n\t\t\tcontext.filter = \"none\";\n\t\t}\n\n\t\tstatic _applyColorMatrix(context: CanvasRenderingContext2D, colorMatrix: ColorMatrix) {\n\t\t\tif (colorMatrix.isIdentity()) {\n\t\t\t\tcontext.globalAlpha = 1;\n\t\t\t\tcontext.globalColorMatrix = null;\n\t\t\t} else if (colorMatrix.hasOnlyAlphaMultiplier()) {\n\t\t\t\tcontext.globalAlpha = clamp(colorMatrix.alphaMultiplier, 0, 1);\n\t\t\t\tcontext.globalColorMatrix = null;\n\t\t\t} else {\n\t\t\t\tcontext.globalAlpha = 1;\n\t\t\t\tif (Filters._svgFiltersAreSupported) {\n\t\t\t\t\tFilters._applyFilter(1, context, colorMatrix);\n\t\t\t\t\tcontext.globalColorMatrix = null;\n\t\t\t\t} else {\n\t\t\t\t\tcontext.globalColorMatrix = colorMatrix;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (filters && Filters._svgFiltersAreSupported) {\n\t\t// Temporary hack to work around a bug that prevents SVG filters to work for off-screen canvases.\n\t\tif (!('registerScratchCanvas' in window)) {\n\t\t\t(window as any)['registerScratchCanvas'] = function (scratchCanvas: any) {\n\t\t\t\tscratchCanvas.style.display = 'none';\n\t\t\t\tdocument.body.appendChild(scratchCanvas);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Match up FLash blend modes with Canvas blend operations:\n\t *\n\t * See: http://kaourantin.net/2005/09/some-word-on-blend-modes-in-flash.html\n\t */\n\tfunction getCompositeOperation(blendMode: BlendMode): string {\n\t\t// TODO:\n\n\t\t// These Flash blend modes have no canvas equivalent:\n\t\t// - BlendMode.Subtract\n\t\t// - BlendMode.Invert\n\t\t// - BlendMode.Shader\n\t\t// - BlendMode.Add is similar to BlendMode.Screen\n\n\t\t// These blend modes are actually Porter-Duff compositing operators.\n\t\t// The backdrop is the nearest parent with blendMode set to layer.\n\t\t// When there is no LAYER parent, they are ignored (treated as NORMAL).\n\t\t// - BlendMode.Alpha (destination-in)\n\t\t// - BlendMode.Erase (destination-out)\n\t\t// - BlendMode.Layer [defines backdrop]\n\n\t\tlet compositeOp: string = \"source-over\";\n\t\tswitch (blendMode) {\n\t\t\tcase BlendMode.Normal:\n\t\t\tcase BlendMode.Layer:\n\t\t\t\treturn compositeOp;\n\t\t\tcase BlendMode.Multiply:\n\t\t\t\tcompositeOp = \"multiply\";\n\t\t\t\tbreak;\n\t\t\tcase BlendMode.Add:\n\t\t\tcase BlendMode.Screen:\n\t\t\t\tcompositeOp = \"screen\";\n\t\t\t\tbreak;\n\t\t\tcase BlendMode.Lighten:\n\t\t\t\tcompositeOp = \"lighten\";\n\t\t\t\tbreak;\n\t\t\tcase BlendMode.Darken:\n\t\t\t\tcompositeOp = \"darken\";\n\t\t\t\tbreak;\n\t\t\tcase BlendMode.Difference:\n\t\t\t\tcompositeOp = \"difference\";\n\t\t\t\tbreak;\n\t\t\tcase BlendMode.Overlay:\n\t\t\t\tcompositeOp = \"overlay\";\n\t\t\t\tbreak;\n\t\t\tcase BlendMode.HardLight:\n\t\t\t\tcompositeOp = \"hard-light\";\n\t\t\t\tbreak;\n\t\t\tcase BlendMode.Alpha:\n\t\t\t\tcompositeOp = \"destination-in\";\n\t\t\t\tbreak;\n\t\t\tcase BlendMode.Erase:\n\t\t\t\tcompositeOp = \"destination-out\";\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\trelease || Shumway.Debug.somewhatImplemented(\"Blend Mode: \" + BlendMode[blendMode]);\n\t\t}\n\t\treturn compositeOp;\n\t}\n\n\t/**\n\t * Clip target? Some blend modes like destination-in that affect all target pixels are very slow otherwise.\n\t */\n\tfunction blendModeShouldClip(blendMode: BlendMode) {\n\t\tswitch (blendMode) {\n\t\t\tcase BlendMode.Alpha:\n\t\t\t\treturn true;\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t}\n\t}\n\n\texport class Canvas2DSurfaceRegion implements ISurfaceRegion {\n\n\t\t/**\n\t\t * Draw image is really slow if the soruce and destination are the same. We use\n\t\t * a temporary canvas for all such copy operations.\n\t\t */\n\t\tprivate static _copyCanvasContext: CanvasRenderingContext2D;\n\n\t\tconstructor(public surface: Canvas2DSurface,\n\t\t            public region: RegionAllocator.Region,\n\t\t            public w: number,\n\t\t            public h: number) {\n\t\t\t// ...\n\t\t}\n\n\t\tpublic free() {\n\t\t\tthis.surface.free(this)\n\t\t}\n\n\t\tprivate static _ensureCopyCanvasSize(w: number, h: number) {\n\t\t\tlet canvas;\n\t\t\tif (!Canvas2DSurfaceRegion._copyCanvasContext) {\n\t\t\t\tcanvas = document.createElement(\"canvas\");\n\t\t\t\tif (typeof registerScratchCanvas !== \"undefined\") {\n\t\t\t\t\tregisterScratchCanvas(canvas);\n\t\t\t\t}\n\t\t\t\tcanvas.width = IntegerUtilities.nearestPowerOfTwo(w);\n\t\t\t\tcanvas.height = IntegerUtilities.nearestPowerOfTwo(h);\n\t\t\t\tCanvas2DSurfaceRegion._copyCanvasContext = canvas.getContext(\"2d\");\n\t\t\t} else {\n\t\t\t\tcanvas = Canvas2DSurfaceRegion._copyCanvasContext.canvas;\n\t\t\t\tif (canvas.width < w || canvas.height < h) {\n\t\t\t\t\tcanvas.width = IntegerUtilities.nearestPowerOfTwo(w);\n\t\t\t\t\tcanvas.height = IntegerUtilities.nearestPowerOfTwo(h);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpublic draw(source: Canvas2DSurfaceRegion, x: number, y: number, w: number, h: number,\n\t\t            colorMatrix: ColorMatrix, blendMode: BlendMode, filters: Filter [],\n\t\t            devicePixelRatio: number) {\n\t\t\tthis.context.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\tlet sourceContext, copyContext, sx = 0, sy = 0;\n\t\t\t// Handle copying from and to the same canvas.\n\t\t\tif (source.context.canvas === this.context.canvas) {\n\t\t\t\tCanvas2DSurfaceRegion._ensureCopyCanvasSize(w, h);\n\t\t\t\tcopyContext = Canvas2DSurfaceRegion._copyCanvasContext;\n\t\t\t\tcopyContext.clearRect(0, 0, w, h);\n\t\t\t\tcopyContext.drawImage(\n\t\t\t\t\tsource.surface.canvas,\n\t\t\t\t\tsource.region.x, source.region.y, w, h,\n\t\t\t\t\t0, 0, w, h\n\t\t\t\t);\n\t\t\t\tsourceContext = copyContext;\n\t\t\t\tsx = 0;\n\t\t\t\tsy = 0;\n\t\t\t} else {\n\t\t\t\tsourceContext = source.surface.context;\n\t\t\t\tsx = source.region.x;\n\t\t\t\tsy = source.region.y;\n\t\t\t}\n\t\t\tlet canvas = this.context.canvas;\n\t\t\tlet clip = blendModeShouldClip(blendMode);\n\t\t\tif (clip) {\n\t\t\t\tthis.context.save();\n\t\t\t\tthis.context.beginPath();\n\t\t\t\tthis.context.rect(x, y, w, h);\n\t\t\t\tthis.context.clip();\n\t\t\t}\n\t\t\tthis.context.globalAlpha = 1;\n\t\t\tthis.context.globalCompositeOperation = getCompositeOperation(blendMode);\n\n\t\t\tif (filters) {\n\t\t\t\tif (colorMatrix && !colorMatrix.isIdentity()) {\n\t\t\t\t\tfilters = filters.concat(colorMatrix);\n\t\t\t\t}\n\t\t\t\tlet i = 0;\n\t\t\t\tif (filters.length > 1) {\n\t\t\t\t\t// If there are more than one filter defined on this node, we create another temporary\n\t\t\t\t\t// surface and keep drawing back and forth between them till all filters are applied,\n\t\t\t\t\t// except of the last one which gets applied when actually drawing into the target after\n\t\t\t\t\t// this block, to safe a drawImage call.\n\t\t\t\t\tlet dx, dy, _cc, _sx, _sy;\n\t\t\t\t\tif (copyContext) {\n\t\t\t\t\t\t_cc = copyContext;\n\t\t\t\t\t\tcopyContext = sourceContext;\n\t\t\t\t\t\tsourceContext = _cc;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tCanvas2DSurfaceRegion._ensureCopyCanvasSize(w, h);\n\t\t\t\t\t\tcopyContext = Canvas2DSurfaceRegion._copyCanvasContext;\n\t\t\t\t\t\tdx = 0;\n\t\t\t\t\t\tdy = 0;\n\t\t\t\t\t}\n\t\t\t\t\tfor (; i < filters.length - 1; i++) {\n\t\t\t\t\t\tcopyContext.clearRect(0, 0, w, h);\n\t\t\t\t\t\tFilters._applyFilter(devicePixelRatio, copyContext, filters[i]);\n\t\t\t\t\t\tcopyContext.drawImage(sourceContext.canvas, sx, sy, w, h, dx, dy, w, h);\n\t\t\t\t\t\tFilters._removeFilter(copyContext);\n\t\t\t\t\t\t_cc = copyContext;\n\t\t\t\t\t\t_sx = sx;\n\t\t\t\t\t\t_sy = sy;\n\t\t\t\t\t\tcopyContext = sourceContext;\n\t\t\t\t\t\tsourceContext = _cc;\n\t\t\t\t\t\tsx = dx;\n\t\t\t\t\t\tsy = dx;\n\t\t\t\t\t\tdx = _sx;\n\t\t\t\t\t\tdy = _sy;\n\t\t\t\t\t}\n\t\t\t\t\tFilters._removeFilter(sourceContext);\n\t\t\t\t\tFilters._removeFilter(copyContext);\n\t\t\t\t}\n\t\t\t\tFilters._applyFilter(devicePixelRatio, this.context, filters[i]);\n\t\t\t}\n\n\t\t\tthis.context.drawImage(sourceContext.canvas, sx, sy, w, h, x, y, w, h);\n\n\t\t\tthis.context.globalCompositeOperation = getCompositeOperation(BlendMode.Normal);\n\t\t\tFilters._removeFilter(this.context);\n\t\t\tif (clip) {\n\t\t\t\tthis.context.restore();\n\t\t\t}\n\t\t}\n\n\t\tget context(): CanvasRenderingContext2D {\n\t\t\treturn this.surface.context;\n\t\t}\n\n\t\tpublic resetTransform() {\n\t\t\tthis.surface.context.setTransform(1, 0, 0, 1, 0, 0);\n\t\t}\n\n\t\tpublic reset() {\n\t\t\tlet context = this.surface.context;\n\t\t\tcontext.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\tcontext.fillStyle = '#000000';\n\t\t\tcontext.strokeStyle = '#000000';\n\t\t\tcontext.globalAlpha = 1;\n\t\t\tcontext.globalColorMatrix = null;\n\t\t\tcontext.globalCompositeOperation = getCompositeOperation(BlendMode.Normal);\n\t\t}\n\n\t\tpublic fill(fillStyle: any) {\n\t\t\tlet context = this.surface.context, region = this.region;\n\t\t\tcontext.fillStyle = fillStyle;\n\t\t\tcontext.fillRect(region.x, region.y, region.w, region.h);\n\t\t}\n\n\t\tpublic clear(rectangle?: Rectangle) {\n\t\t\tlet context = this.surface.context, region = this.region;\n\t\t\tif (!rectangle) {\n\t\t\t\trectangle = region;\n\t\t\t}\n\t\t\tcontext.clearRect(rectangle.x, rectangle.y, rectangle.w, rectangle.h);\n\t\t}\n\t}\n\n\texport class Canvas2DSurface implements ISurface {\n\t\tw: number;\n\t\th: number;\n\t\tcanvas: HTMLCanvasElement;\n\t\tcontext: CanvasRenderingContext2D;\n\t\tprivate _regionAllocator: RegionAllocator.IRegionAllocator;\n\n\t\tconstructor(canvas: HTMLCanvasElement, regionAllocator?: RegionAllocator.IRegionAllocator) {\n\t\t\tthis.canvas = canvas;\n\t\t\tthis.context = canvas.getContext(\"2d\");\n\t\t\tthis.w = canvas.width;\n\t\t\tthis.h = canvas.height;\n\t\t\tthis._regionAllocator = regionAllocator;\n\t\t}\n\n\t\tallocate(w: number, h: number): Canvas2DSurfaceRegion {\n\t\t\tlet region = this._regionAllocator.allocate(w, h);\n\t\t\tif (region) {\n\t\t\t\treturn new Canvas2DSurfaceRegion(this, region, w, h);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tfree(surfaceRegion: Canvas2DSurfaceRegion) {\n\t\t\tthis._regionAllocator.free(surfaceRegion.region);\n\t\t}\n\t}\n}\n","module Shumway.GFX.Canvas2D {\n\n\timport assert = Shumway.Debug.assert;\n\timport Rectangle = Shumway.GFX.Geometry.Rectangle;\n\timport Point = Shumway.GFX.Geometry.Point;\n\timport Matrix = Shumway.GFX.Geometry.Matrix;\n\timport DirtyRegion = Shumway.GFX.Geometry.DirtyRegion;\n\timport Filter = Shumway.GFX.Filter;\n\timport BlendMode = Shumway.GFX.BlendMode;\n\timport TileCache = Shumway.GFX.Geometry.TileCache;\n\timport Tile = Shumway.GFX.Geometry.Tile;\n\timport OBB = Shumway.GFX.Geometry.OBB;\n\timport clamp = Shumway.NumberUtilities.clamp;\n\timport pow2 = Shumway.NumberUtilities.pow2;\n\timport epsilonEquals = Shumway.NumberUtilities.epsilonEquals;\n\n\timport ISurfaceRegionAllocator = SurfaceRegionAllocator.ISurfaceRegionAllocator;\n\n\tdeclare let registerScratchCanvas: any;\n\n\tlet writer: IndentingWriter = null; // new IndentingWriter(false, dumpLine);\n\n\tlet MIN_CACHE_LEVELS = 5;\n\tlet MAX_CACHE_LEVELS = 3;\n\n\texport class MipMapLevel {\n\t\tconstructor(public surfaceRegion: ISurfaceRegion,\n\t\t            public scale: number) {\n\t\t\t// ...\n\t\t}\n\t}\n\n\texport class MipMap {\n\t\tprivate _node: Node;\n\t\tprivate _size: number;\n\t\tprivate _levels: MipMapLevel [];\n\t\tprivate _renderer: Canvas2DRenderer;\n\t\tprivate _surfaceRegionAllocator: SurfaceRegionAllocator.ISurfaceRegionAllocator;\n\n\t\tconstructor(renderer: Canvas2DRenderer,\n\t\t            node: Node,\n\t\t            surfaceRegionAllocator: SurfaceRegionAllocator.ISurfaceRegionAllocator,\n\t\t            size: number) {\n\t\t\tthis._node = node;\n\t\t\tthis._levels = [];\n\t\t\tthis._surfaceRegionAllocator = surfaceRegionAllocator;\n\t\t\tthis._size = size;\n\t\t\tthis._renderer = renderer;\n\t\t}\n\n\t\tpublic getLevel(matrix: Matrix): MipMapLevel {\n\t\t\tlet matrixScale = Math.max(matrix.getAbsoluteScaleX(), matrix.getAbsoluteScaleY());\n\t\t\tlet level = 0;\n\t\t\tif (matrixScale !== 1) {\n\t\t\t\tlevel = clamp(Math.round(Math.log(matrixScale) / Math.LN2), -MIN_CACHE_LEVELS, MAX_CACHE_LEVELS);\n\t\t\t}\n\t\t\tif (!(this._node.hasFlags(NodeFlags.Scalable))) {\n\t\t\t\tlevel = clamp(level, -MIN_CACHE_LEVELS, 0);\n\t\t\t}\n\t\t\tlet scale = pow2(level);\n\t\t\tlet levelIndex = MIN_CACHE_LEVELS + level;\n\t\t\tlet mipLevel = this._levels[levelIndex];\n\n\t\t\tif (!mipLevel) {\n\t\t\t\tlet bounds = this._node.getBounds();\n\t\t\t\tlet scaledBounds = bounds.clone();\n\t\t\t\tscaledBounds.scale(scale, scale);\n\t\t\t\tscaledBounds.snap();\n\t\t\t\tlet surfaceRegion: Canvas2DSurfaceRegion = <any>this._surfaceRegionAllocator.allocate(scaledBounds.w, scaledBounds.h, null);\n\t\t\t\t// surfaceRegion.fill(ColorStyle.randomStyle());\n\t\t\t\tlet region = surfaceRegion.region;\n\t\t\t\tmipLevel = this._levels[levelIndex] = new MipMapLevel(surfaceRegion, scale);\n\t\t\t\tlet surface = <Canvas2D.Canvas2DSurface>(mipLevel.surfaceRegion.surface);\n\t\t\t\tlet context = surface.context;\n\n//        context.save();\n//        context.beginPath();\n//        context.rect(region.x, region.y, region.w, region.h);\n//        context.clip();\n//        context.setTransform(scale, 0, 0, scale, region.x - scaledBounds.x, region.y - scaledBounds.y);\n\n\t\t\t\tlet state = new RenderState(surfaceRegion);\n\t\t\t\tstate.clip.set(region);\n\t\t\t\tstate.matrix.setElements(scale, 0, 0, scale, region.x - scaledBounds.x, region.y - scaledBounds.y);\n\t\t\t\tstate.flags |= RenderFlags.IgnoreNextRenderWithCache;\n\t\t\t\tthis._renderer.renderNodeWithState(this._node, state);\n\t\t\t\tstate.free();\n\n\t\t\t\t// context.restore();\n\t\t\t}\n\t\t\treturn mipLevel;\n\t\t}\n\t}\n\n\texport const enum FillRule {\n\t\tNonZero,\n\t\tEvenOdd\n\t}\n\n\texport class Canvas2DRendererOptions extends RendererOptions {\n\t\t[key: string]: any;\n\t\t/**\n\t\t * Whether to force snapping matrices to device pixels.\n\t\t */\n\t\tsnapToDevicePixels: boolean = true;\n\n\t\t/**\n\t\t * Whether to force image smoothing when drawing images.\n\t\t */\n\t\timageSmoothing: boolean = true;\n\n\t\t/**\n\t\t * Whether to enable blending.\n\t\t */\n\t\tblending: boolean = true;\n\n\t\t/**\n\t\t * Whether to enable debugging of layers.\n\t\t */\n\t\tdebugLayers: boolean = false;\n\n\t\t/**\n\t\t * Whether to enable masking.\n\t\t */\n\t\tmasking: boolean = true;\n\n\t\t/**\n\t\t * Whether to enable filters.\n\t\t */\n\t\tfilters: boolean = true;\n\n\t\t/**\n\t\t * Whether to cache shapes as images.\n\t\t */\n\t\tcacheShapes: boolean = false;\n\n\t\t/**\n\t\t * Shapes above this size are not cached.\n\t\t */\n\t\tcacheShapesMaxSize: number = 256;\n\n\t\t/**\n\t\t * Number of times a shape is rendered before it's elligible for caching.\n\t\t */\n\t\tcacheShapesThreshold: number = 16;\n\n\t\t/**\n\t\t * Enables alpha layer for the canvas context.\n\t\t */\n\t\talpha: boolean = false;\n\t}\n\n\texport const enum RenderFlags {\n\t\tNone = 0x0000,\n\t\tIgnoreNextLayer = 0x0001,\n\t\tRenderMask = 0x0002,\n\t\tIgnoreMask = 0x0004,\n\t\tPaintStencil = 0x0008,\n\t\tPaintClip = 0x0010,\n\t\tIgnoreRenderable = 0x0020,\n\t\tIgnoreNextRenderWithCache = 0x0040,\n\n\t\tCacheShapes = 0x0100,\n\t\tPaintFlashing = 0x0200,\n\t\tPaintBounds = 0x0400,\n\t\tPaintDirtyRegion = 0x0800,\n\t\tImageSmoothing = 0x1000,\n\t\tPixelSnapping = 0x2000\n\t}\n\n\tlet MAX_VIEWPORT = Rectangle.createMaxI16();\n\n\t/**\n\t * Render state.\n\t */\n\texport class RenderState extends State {\n\n\t\tstatic allocationCount = 0;\n\n\t\tprivate static _dirtyStack: RenderState [] = [];\n\n\t\tclip: Rectangle = Rectangle.createEmpty();\n\t\tclipList: Rectangle [] = [];\n\t\tclipPath: Path2D = null;\n\t\tflags: RenderFlags = RenderFlags.None;\n\t\ttarget: Canvas2DSurfaceRegion = null;\n\t\tmatrix: Matrix = Matrix.createIdentity();\n\t\tcolorMatrix: ColorMatrix = ColorMatrix.createIdentity();\n\n\t\toptions: Canvas2DRendererOptions;\n\n\t\tconstructor(target: Canvas2DSurfaceRegion) {\n\t\t\tsuper();\n\t\t\tRenderState.allocationCount++;\n\t\t\tthis.target = target;\n\t\t}\n\n\t\tset(state: RenderState) {\n\t\t\tthis.clip.set(state.clip);\n\t\t\tthis.clipPath = state.clipPath;\n\t\t\tthis.target = state.target;\n\t\t\tthis.matrix.set(state.matrix);\n\t\t\tthis.colorMatrix.set(state.colorMatrix);\n\t\t\tthis.flags = state.flags;\n\t\t\tArrayUtilities.copyFrom(this.clipList, state.clipList);\n\t\t}\n\n\t\tpublic clone(): RenderState {\n\t\t\tlet state: RenderState = RenderState.allocate();\n\t\t\tif (!state) {\n\t\t\t\tstate = new RenderState(this.target);\n\t\t\t}\n\t\t\tstate.set(this);\n\t\t\treturn state;\n\t\t}\n\n\t\tstatic allocate(): RenderState {\n\t\t\tlet dirtyStack = RenderState._dirtyStack;\n\t\t\tlet state = null;\n\t\t\tif (dirtyStack.length) {\n\t\t\t\tstate = dirtyStack.pop();\n\t\t\t}\n\t\t\treturn state;\n\t\t}\n\n\t\tfree() {\n\t\t\tthis.clipPath = null;\n\t\t\tRenderState._dirtyStack.push(this);\n\t\t}\n\n\t\ttransform(transform: Transform): RenderState {\n\t\t\tlet state = this.clone();\n\t\t\tstate.matrix.preMultiply(transform.getMatrix());\n\t\t\tif (transform.hasColorMatrix()) {\n\t\t\t\tstate.colorMatrix.multiply(transform.getColorMatrix());\n\t\t\t}\n\t\t\treturn state;\n\t\t}\n\n\t\tpublic hasFlags(flags: RenderFlags): boolean {\n\t\t\treturn (this.flags & flags) === flags;\n\t\t}\n\n\t\tpublic removeFlags(flags: RenderFlags) {\n\t\t\tthis.flags &= ~flags;\n\t\t}\n\n\t\tpublic toggleFlags(flags: RenderFlags, on: boolean) {\n\t\t\tif (on) {\n\t\t\t\tthis.flags |= flags;\n\t\t\t} else {\n\t\t\t\tthis.flags &= ~flags;\n\t\t\t}\n\t\t}\n\n\t\tbeginClipPath(transform: Matrix) {\n\t\t\tthis.target.context.save();\n\t\t\tthis.clipPath = new Path2D();\n\t\t}\n\n\t\tapplyClipPath() {\n\t\t\tlet context = this.target.context;\n\t\t\t// Coords in clipPath are defined in global space, so have to reset the current transform, ...\n\t\t\tcontext.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\t// ... apply the clip ...\n\t\t\tcontext.clip(this.clipPath);\n\t\t\t// ... and finally restore the current transform.\n\t\t\tlet matrix = this.matrix;\n\t\t\tcontext.setTransform(matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty);\n\t\t}\n\n\t\tcloseClipPath() {\n\t\t\tthis.target.context.restore();\n\t\t}\n\t}\n\n\t/**\n\t * Stats for each rendered frame.\n\t */\n\texport class FrameInfo {\n\t\tprivate _count: number = 0;\n\t\tprivate _enterTime: number;\n\n\t\tshapes = 0;\n\t\tgroups = 0;\n\t\tculledNodes = 0;\n\n\t\tenter(state: RenderState) {\n\t\t\tShumway.GFX.enterTimeline(\"Frame\", {frame: this._count});\n\t\t\tthis._count++;\n\t\t\tif (!writer) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twriter.enter(\"> Frame: \" + this._count);\n\t\t\tthis._enterTime = performance.now();\n\n\t\t\tthis.shapes = 0;\n\t\t\tthis.groups = 0;\n\t\t\tthis.culledNodes = 0;\n\t\t}\n\n\t\tleave() {\n\t\t\tShumway.GFX.leaveTimeline(\"Frame\");\n\t\t\tif (!writer) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twriter.writeLn(\"Shapes: \" + this.shapes + \", Groups: \" + this.groups + \", Culled Nodes: \" + this.culledNodes);\n\t\t\twriter.writeLn(\"Elapsed: \" + (performance.now() - this._enterTime).toFixed(2));\n\t\t\twriter.writeLn(\"Rectangle: \" + Rectangle.allocationCount + \", Matrix: \" + Matrix.allocationCount + \", State: \" + RenderState.allocationCount);\n\t\t\twriter.leave(\"<\");\n\t\t}\n\t}\n\n\texport class Canvas2DRenderer extends Renderer {\n\t\tprotected _options: Canvas2DRendererOptions;\n\t\tcontext: CanvasRenderingContext2D;\n\n\t\tprivate _target: Canvas2DSurfaceRegion;\n\n\t\tprivate static _initializedCaches: boolean = false;\n\n\t\t/**\n\t\t * Allocates temporary regions for performing image operations.\n\t\t */\n\t\tprivate static _surfaceCache: ISurfaceRegionAllocator;\n\n\t\t/**\n\t\t * Allocates shape cache regions.\n\t\t */\n\t\tprivate static _shapeCache: ISurfaceRegionAllocator;\n\n\t\tprivate _visited: number = 0;\n\n\t\tprivate _frameInfo = new FrameInfo();\n\n\t\tprivate _fontSize: number = 0;\n\n\t\t/**\n\t\t * Stack of rendering layers. Stage video lives at the bottom of this stack.\n\t\t */\n\t\tprivate _layers: HTMLDivElement [] = [];\n\n\t\tconstructor(container: HTMLDivElement | HTMLCanvasElement,\n\t\t            stage: Stage,\n\t\t            options: Canvas2DRendererOptions = new Canvas2DRendererOptions()) {\n\t\t\tsuper(container, stage, options);\n\t\t\tif (container instanceof HTMLCanvasElement) {\n\t\t\t\tlet canvas = container;\n\t\t\t\tthis._viewport = new Rectangle(0, 0, canvas.width, canvas.height);\n\t\t\t\tthis._target = this._createTarget(canvas);\n\t\t\t} else {\n\t\t\t\tthis._addLayer(\"Background Layer\");\n\t\t\t\tlet canvasLayer = this._addLayer(\"Canvas Layer\");\n\t\t\t\tlet canvas = document.createElement(\"canvas\");\n\t\t\t\tcanvasLayer.appendChild(canvas);\n\t\t\t\tthis._viewport = new Rectangle(0, 0, container.scrollWidth, container.scrollHeight);\n\t\t\t\tlet self = this;\n\t\t\t\tstage.addEventListener(NodeEventType.OnStageBoundsChanged, function () {\n\t\t\t\t\tself._onStageBoundsChanged(canvas);\n\t\t\t\t});\n\t\t\t\tthis._onStageBoundsChanged(canvas);\n\t\t\t}\n\n\t\t\tCanvas2DRenderer._prepareSurfaceAllocators();\n\t\t}\n\n\t\tprivate _addLayer(name: string): HTMLDivElement {\n\t\t\tlet div = document.createElement(\"div\");\n\t\t\tdiv.style.position = \"absolute\";\n\t\t\tdiv.style.overflow = \"hidden\";\n\t\t\tdiv.style.width = \"100%\";\n\t\t\tdiv.style.height = \"100%\";\n\t\t\tdiv.style.zIndex = this._layers.length + '';\n\t\t\tthis._container.appendChild(div);\n\t\t\tthis._layers.push(div);\n\t\t\treturn div;\n\t\t}\n\n\t\tprivate get _backgroundVideoLayer(): HTMLDivElement {\n\t\t\treturn this._layers[0];\n\t\t}\n\n\t\tprivate _createTarget(canvas: HTMLCanvasElement) {\n\t\t\treturn new Canvas2DSurfaceRegion(\n\t\t\t\tnew Canvas2DSurface(canvas),\n\t\t\t\tnew RegionAllocator.Region(0, 0, canvas.width, canvas.height),\n\t\t\t\tcanvas.width, canvas.height\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * If the stage bounds have changed, we have to resize all of our layers, canvases and more ...\n\t\t */\n\t\tprivate _onStageBoundsChanged(canvas: HTMLCanvasElement) {\n\t\t\tlet stageBounds = this._stage.getBounds(true);\n\t\t\tstageBounds.snap();\n\n\t\t\tlet ratio = this._devicePixelRatio = window.devicePixelRatio || 1;\n\t\t\tlet w = (stageBounds.w / ratio) + 'px';\n\t\t\tlet h = (stageBounds.h / ratio) + 'px';\n\t\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\t\tlet layer = this._layers[i];\n\t\t\t\tlayer.style.width = w;\n\t\t\t\tlayer.style.height = h;\n\t\t\t}\n\t\t\tcanvas.width = stageBounds.w;\n\t\t\tcanvas.height = stageBounds.h;\n\t\t\tcanvas.style.position = \"absolute\";\n\t\t\tcanvas.style.width = w;\n\t\t\tcanvas.style.height = h;\n\t\t\tthis._target = this._createTarget(canvas);\n\t\t\tthis._fontSize = 10 * this._devicePixelRatio;\n\t\t}\n\n\t\tprivate static _prepareSurfaceAllocators() {\n\t\t\tif (Canvas2DRenderer._initializedCaches) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet minSurfaceSize = 1024;\n\t\t\tCanvas2DRenderer._surfaceCache = new SurfaceRegionAllocator.SimpleAllocator(\n\t\t\t\tfunction (w: number, h: number) {\n\t\t\t\t\tlet canvas = document.createElement(\"canvas\");\n\t\t\t\t\tif (typeof registerScratchCanvas !== \"undefined\") {\n\t\t\t\t\t\tregisterScratchCanvas(canvas);\n\t\t\t\t\t}\n\t\t\t\t\t// Surface caches are at least this size.\n\t\t\t\t\tlet W = Math.max(minSurfaceSize, w);\n\t\t\t\t\tlet H = Math.max(minSurfaceSize, h);\n\t\t\t\t\tcanvas.width = W;\n\t\t\t\t\tcanvas.height = H;\n\t\t\t\t\tlet allocator = null;\n\t\t\t\t\tif (w >= 1024 / 2 || h >= 1024 / 2) {\n\t\t\t\t\t\t// The requested size is very large, so create a single grid allocator\n\t\t\t\t\t\t// with there requested size. This will only hold one image.\n\t\t\t\t\t\tallocator = new RegionAllocator.GridAllocator(W, H, W, H);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tallocator = new RegionAllocator.BucketAllocator(W, H);\n\t\t\t\t\t}\n\t\t\t\t\treturn new Canvas2DSurface(\n\t\t\t\t\t\tcanvas, allocator\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tCanvas2DRenderer._shapeCache = new SurfaceRegionAllocator.SimpleAllocator(\n\t\t\t\tfunction (w: number, h: number) {\n\t\t\t\t\tlet canvas = document.createElement(\"canvas\");\n\t\t\t\t\tif (typeof registerScratchCanvas !== \"undefined\") {\n\t\t\t\t\t\tregisterScratchCanvas(canvas);\n\t\t\t\t\t}\n\t\t\t\t\tlet W = minSurfaceSize, H = minSurfaceSize;\n\t\t\t\t\tcanvas.width = W;\n\t\t\t\t\tcanvas.height = H;\n\t\t\t\t\t// Shape caches can be compact since regions are never freed explicitly.\n\t\t\t\t\t// AMBIGUOUS\n\t\t\t\t\tlet allocator: RegionAllocator.IRegionAllocator /*= allocator*/ = new RegionAllocator.CompactAllocator(W, H);\n\t\t\t\t\treturn new Canvas2DSurface(\n\t\t\t\t\t\tcanvas, allocator\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tCanvas2DRenderer._initializedCaches = true;\n\t\t}\n\n\t\t/**\n\t\t * Main render function.\n\t\t */\n\t\tpublic render() {\n\t\t\tlet stage = this._stage;\n\t\t\tlet target = this._target;\n\t\t\tlet options = this._options;\n\t\t\tlet viewport = this._viewport;\n\n\t\t\t// stage.visit(new TracingNodeVisitor(new IndentingWriter()), null);\n\n\t\t\ttarget.reset();\n\t\t\ttarget.context.save();\n\n\t\t\ttarget.context.beginPath();\n\t\t\ttarget.context.rect(viewport.x, viewport.y, viewport.w, viewport.h);\n\t\t\ttarget.context.clip();\n\n\t\t\tthis._renderStageToTarget(target, stage, viewport);\n\n\t\t\ttarget.reset();\n\n\t\t\tif (options.paintViewport) {\n\t\t\t\ttarget.context.beginPath();\n\t\t\t\ttarget.context.rect(viewport.x, viewport.y, viewport.w, viewport.h);\n\t\t\t\ttarget.context.strokeStyle = \"#FF4981\";\n\t\t\t\ttarget.context.lineWidth = 2;\n\t\t\t\ttarget.context.stroke();\n\t\t\t}\n\n\t\t\ttarget.context.restore();\n\t\t}\n\n\t\tpublic renderNode(node: Node, clip: Rectangle, matrix: Matrix) {\n\t\t\tlet state = new RenderState(this._target);\n\t\t\tstate.clip.set(clip);\n\t\t\tstate.flags = RenderFlags.CacheShapes;\n\t\t\tstate.matrix.set(matrix);\n\t\t\tnode.visit(this, state);\n\t\t\tstate.free();\n\t\t}\n\n\t\tpublic renderNodeWithState(node: Node, state: RenderState) {\n\t\t\tnode.visit(this, state);\n\t\t}\n\n\t\tprivate _renderWithCache(node: Node, state: RenderState): boolean {\n\t\t\tlet matrix = state.matrix;\n\t\t\tlet bounds = node.getBounds();\n\t\t\tif (bounds.isEmpty()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet cacheShapesMaxSize = this._options.cacheShapesMaxSize;\n\t\t\tlet matrixScale = Math.max(matrix.getAbsoluteScaleX(), matrix.getAbsoluteScaleY());\n\n\t\t\tlet renderCount = 100;\n\t\t\tlet paintClip = !!(state.flags & RenderFlags.PaintClip);\n\t\t\tlet paintStencil = !!(state.flags & RenderFlags.PaintStencil);\n\t\t\tlet paintFlashing = !!(state.flags & RenderFlags.PaintFlashing);\n\n\t\t\tif (!state.hasFlags(RenderFlags.CacheShapes)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (paintStencil || paintClip || !state.colorMatrix.isIdentity() ||\n\t\t\t\tnode.hasFlags(NodeFlags.Dynamic)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (renderCount < this._options.cacheShapesThreshold ||\n\t\t\t\tbounds.w * matrixScale > cacheShapesMaxSize ||\n\t\t\t\tbounds.h * matrixScale > cacheShapesMaxSize) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet mipMap: MipMap = node.properties[\"mipMap\"];\n\t\t\tif (!mipMap) {\n\t\t\t\tmipMap = node.properties[\"mipMap\"] = new MipMap(this, node, Canvas2DRenderer._shapeCache, cacheShapesMaxSize);\n\t\t\t}\n\t\t\tlet mipMapLevel = mipMap.getLevel(matrix);\n\t\t\tlet mipMapLevelSurfaceRegion = <Canvas2DSurfaceRegion>(mipMapLevel.surfaceRegion);\n\t\t\tlet region = mipMapLevelSurfaceRegion.region;\n\t\t\tif (mipMapLevel) {\n\t\t\t\tlet context = state.target.context;\n\t\t\t\tcontext.imageSmoothingEnabled = context.mozImageSmoothingEnabled = true;\n\t\t\t\tcontext.setTransform(matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty);\n\t\t\t\tcontext.drawImage(\n\t\t\t\t\tmipMapLevelSurfaceRegion.surface.canvas,\n\t\t\t\t\tregion.x, region.y,\n\t\t\t\t\tregion.w, region.h,\n\t\t\t\t\tbounds.x, bounds.y,\n\t\t\t\t\tbounds.w, bounds.h\n\t\t\t\t);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tprivate _intersectsClipList(node: Node, state: RenderState): boolean {\n\t\t\tlet boundsAABB = node.getBounds(true);\n\t\t\tlet intersects = false;\n\t\t\tstate.matrix.transformRectangleAABB(boundsAABB);\n\t\t\tif (state.clip.intersects(boundsAABB)) {\n\t\t\t\tintersects = true;\n\t\t\t}\n\t\t\tlet list = state.clipList;\n\t\t\tif (intersects && list.length) {\n\t\t\t\tintersects = false;\n\t\t\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\t\t\tif (boundsAABB.intersects(list[i])) {\n\t\t\t\t\t\tintersects = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tboundsAABB.free();\n\t\t\treturn intersects;\n\t\t}\n\n\t\tvisitGroup(node: Group, state: RenderState) {\n\t\t\tthis._frameInfo.groups++;\n\n\t\t\tlet bounds = node.getBounds();\n\n\t\t\tif (node.hasFlags(NodeFlags.IsMask) && !(state.flags & RenderFlags.IgnoreMask)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!node.hasFlags(NodeFlags.Visible)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet ignoreNextLayer = state.flags & RenderFlags.IgnoreNextLayer;\n\t\t\tif (!ignoreNextLayer && (\n\t\t\t\t\t((node.getLayer().blendMode !== BlendMode.Normal || node.getLayer().mask) &&\n\t\t\t\t\t\tthis._options.blending) ||\n\t\t\t\t\t(node.getLayer().filters && this._options.filters))) {\n\t\t\t\tstate = state.clone();\n\t\t\t\tstate.flags |= RenderFlags.IgnoreNextLayer;\n\t\t\t\tstate.clipList = [];\n\t\t\t\tthis._renderLayer(node, state);\n\t\t\t\tstate.free();\n\t\t\t} else {\n\t\t\t\tif (ignoreNextLayer) {\n\t\t\t\t\tstate.removeFlags(RenderFlags.IgnoreNextLayer);\n\t\t\t\t}\n\t\t\t\tif (this._intersectsClipList(node, state)) {\n\t\t\t\t\tlet clips = null;\n\t\t\t\t\tlet children = node.getChildren();\n\t\t\t\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\t\t\t\tlet child = children[i];\n\t\t\t\t\t\tlet transform = child.getTransform();\n\t\t\t\t\t\tlet childState = state.transform(transform);\n\t\t\t\t\t\tchildState.toggleFlags(RenderFlags.ImageSmoothing, child.hasFlags(NodeFlags.ImageSmoothing));\n\t\t\t\t\t\tif (child.clip > 0) {\n\t\t\t\t\t\t\tclips = clips || new Uint8Array(children.length); // MEMORY: Don't allocate here.\n\t\t\t\t\t\t\tclips[child.clip + i]++;\n\t\t\t\t\t\t\tlet clipState = childState.clone();\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t * We can't cull the clip because clips outside of the viewport still need to act\n\t\t\t\t\t\t\t * as clipping masks. For now we just expand the cull bounds, but a better approach\n\t\t\t\t\t\t\t * would be to cull the clipped nodes and skip creating the clipping region\n\t\t\t\t\t\t\t * alltogether. For this we would need to keep track of the bounds of the current\n\t\t\t\t\t\t\t * clipping region.\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t// clipState.clip.set(MAX_VIEWPORT);\n\t\t\t\t\t\t\tclipState.flags |= RenderFlags.PaintClip;\n\t\t\t\t\t\t\tclipState.beginClipPath(transform.getMatrix());\n\t\t\t\t\t\t\tchild.visit(this, clipState);\n\t\t\t\t\t\t\tclipState.applyClipPath();\n\t\t\t\t\t\t\tclipState.free();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tchild.visit(this, childState);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (clips && clips[i] > 0) {\n\t\t\t\t\t\t\twhile (clips[i]--) {\n\t\t\t\t\t\t\t\tstate.closeClipPath();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchildState.free();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._frameInfo.culledNodes++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._renderDebugInfo(node, state);\n\t\t}\n\n\t\tprivate static _debugPoints = Point.createEmptyPoints(4);\n\n\t\t_renderDebugInfo(node: Node, state: RenderState) {\n\t\t\tif (!(state.flags & RenderFlags.PaintBounds)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet context = state.target.context;\n\t\t\tlet bounds = node.getBounds(true);\n\t\t\tlet style = node.properties[\"style\"];\n\t\t\tif (!style) {\n\t\t\t\tstyle = node.properties[\"style\"] = ColorStyle.randomStyle();\n\t\t\t}\n\n\t\t\tcontext.strokeStyle = style;\n\n\t\t\tstate.matrix.transformRectangleAABB(bounds);\n\n\t\t\tcontext.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\tlet drawDetails = false;\n\t\t\tif (drawDetails && bounds.w > 32 && bounds.h > 32) {\n\t\t\t\tcontext.textAlign = \"center\";\n\t\t\t\tcontext.textBaseline = \"middle\";\n\t\t\t\tcontext.font = this._fontSize + \"px Arial\";\n\t\t\t\tlet debugText = \"\" + node.id;\n\t\t\t\tcontext.fillText(debugText, bounds.x + bounds.w / 2, bounds.y + bounds.h / 2);\n\t\t\t}\n\t\t\tbounds.free();\n\n\t\t\tlet matrix = state.matrix;\n\t\t\tbounds = node.getBounds();\n\t\t\tlet p = Canvas2DRenderer._debugPoints;\n\t\t\tstate.matrix.transformRectangle(bounds, p);\n\n\t\t\t// Doing it this way is a lot faster than strokeRect.\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.beginPath();\n\t\t\tcontext.moveTo(p[0].x, p[0].y);\n\t\t\tcontext.lineTo(p[1].x, p[1].y);\n\t\t\tcontext.lineTo(p[2].x, p[2].y);\n\t\t\tcontext.lineTo(p[3].x, p[3].y);\n\t\t\tcontext.lineTo(p[0].x, p[0].y);\n\t\t\tcontext.stroke();\n\t\t}\n\n\t\tvisitStage(node: Stage, state: RenderState) {\n\t\t\tlet context = state.target.context;\n\t\t\tlet bounds = node.getBounds(true);\n\t\t\tstate.matrix.transformRectangleAABB(bounds);\n\t\t\tbounds.intersect(state.clip);\n\t\t\tstate.target.reset();\n\n\t\t\tstate = state.clone();\n\t\t\tif (node.dirtyRegion) {\n\t\t\t\tstate.clipList.length = 0;\n\t\t\t\tnode.dirtyRegion.gatherOptimizedRegions(state.clipList);\n\t\t\t\tcontext.save();\n\t\t\t\tif (state.clipList.length) {\n\t\t\t\t\tcontext.beginPath();\n\t\t\t\t\tfor (let i = 0; i < state.clipList.length; i++) {\n\t\t\t\t\t\tlet clip = state.clipList[i];\n\t\t\t\t\t\tcontext.rect(clip.x, clip.y, clip.w, clip.h);\n\t\t\t\t\t}\n\t\t\t\t\tcontext.clip();\n\t\t\t\t} else {\n\t\t\t\t\tcontext.restore();\n\t\t\t\t\tstate.free();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this._options.clear) {\n\t\t\t\tstate.target.clear(state.clip);\n\t\t\t}\n\n\t\t\t// Fill background\n\t\t\tif (!node.hasFlags(NodeFlags.Transparent) && node.color) {\n\t\t\t\tif (!(state.flags & RenderFlags.IgnoreRenderable)) {\n\t\t\t\t\tthis._container.style.backgroundColor = node.color.toCSSStyle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.visitGroup(node, state);\n\n\t\t\tif (node.dirtyRegion) {\n\t\t\t\tcontext.restore();\n\t\t\t\tstate.target.reset();\n\t\t\t\tcontext.globalAlpha = 0.8;\n\t\t\t\tif (state.hasFlags(RenderFlags.PaintDirtyRegion)) {\n\t\t\t\t\tnode.dirtyRegion.render(state.target.context);\n\t\t\t\t}\n\t\t\t\tnode.dirtyRegion.clear();\n\t\t\t}\n\n\t\t\tstate.free();\n\t\t}\n\n\t\tvisitShape(node: Shape, state: RenderState) {\n\t\t\tif (!this._intersectsClipList(node, state)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet matrix = state.matrix;\n\t\t\tif (state.flags & RenderFlags.PixelSnapping) {\n\t\t\t\tmatrix = matrix.clone();\n\t\t\t\tmatrix.snap();\n\t\t\t}\n\t\t\tlet context = state.target.context;\n\t\t\tFilters._applyColorMatrix(context, state.colorMatrix);\n\t\t\t// Only paint if it is visible.\n\t\t\tif (node.source instanceof RenderableVideo) {\n\t\t\t\tthis.visitRenderableVideo(<RenderableVideo>node.source, state);\n\t\t\t} else if (context.globalAlpha > 0) {\n\t\t\t\tthis.visitRenderable(node.source, state, node.ratio);\n\t\t\t}\n\t\t\tif (state.flags & RenderFlags.PixelSnapping) {\n\t\t\t\tmatrix.free();\n\t\t\t}\n\t\t\tFilters._removeFilter(context);\n\t\t}\n\n\t\t/**\n\t\t * We don't actually draw the video like normal renderables, although we could.\n\t\t * Instead, we add the video element underneeth the canvas at layer zero and set\n\t\t * the appropriate css transform to move it into place.\n\t\t */\n\t\tvisitRenderableVideo(node: RenderableVideo, state: RenderState) {\n\t\t\tif (!node.video || !node.video.videoWidth) {\n\t\t\t\treturn; // video is not ready\n\t\t\t}\n\n\t\t\tlet ratio = this._devicePixelRatio;\n\t\t\tlet matrix = state.matrix.clone();\n\t\t\tmatrix.scale(1 / ratio, 1 / ratio);\n\n\t\t\tlet bounds = node.getBounds();\n\t\t\tlet videoMatrix = Shumway.GFX.Geometry.Matrix.createIdentity();\n\t\t\tvideoMatrix.scale(bounds.w / node.video.videoWidth, bounds.h / node.video.videoHeight);\n\t\t\tmatrix.preMultiply(videoMatrix);\n\t\t\tvideoMatrix.free();\n\n\t\t\tlet cssTransform = matrix.toCSSTransform();\n\t\t\tnode.video.style.transformOrigin = \"0 0\";\n\t\t\tnode.video.style.transform = cssTransform;\n\t\t\tlet videoLayer = this._backgroundVideoLayer;\n\t\t\tif (videoLayer !== node.video.parentElement) {\n\t\t\t\tvideoLayer.appendChild(node.video);\n\t\t\t\tnode.addEventListener(NodeEventType.RemovedFromStage, function removeVideo(node: RenderableVideo) {\n\t\t\t\t\trelease || assert(videoLayer === node.video.parentElement);\n\t\t\t\t\tvideoLayer.removeChild(node.video);\n\t\t\t\t\tnode.removeEventListener(NodeEventType.RemovedFromStage, removeVideo);\n\t\t\t\t});\n\t\t\t}\n\t\t\tmatrix.free();\n\t\t}\n\n\t\tvisitRenderable(node: Renderable, state: RenderState, ratio?: number) {\n\t\t\tlet bounds = node.getBounds();\n\n\t\t\tif (state.flags & RenderFlags.IgnoreRenderable) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (bounds.isEmpty()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (state.hasFlags(RenderFlags.IgnoreNextRenderWithCache)) {\n\t\t\t\tstate.removeFlags(RenderFlags.IgnoreNextRenderWithCache);\n\t\t\t} else {\n\t\t\t\tif (this._renderWithCache(node, state)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet matrix = state.matrix;\n\t\t\tlet context = state.target.context;\n\t\t\tlet paintClip = !!(state.flags & RenderFlags.PaintClip);\n\t\t\tlet paintStencil = !!(state.flags & RenderFlags.PaintStencil);\n\t\t\tlet paintFlashing = !release && !!(state.flags & RenderFlags.PaintFlashing);\n\n\t\t\tcontext.setTransform(matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty);\n\n\t\t\tlet paintStart = 0;\n\t\t\tif (paintFlashing) {\n\t\t\t\tpaintStart = performance.now();\n\t\t\t}\n\n\t\t\tthis._frameInfo.shapes++;\n\n\t\t\tcontext.imageSmoothingEnabled = context.mozImageSmoothingEnabled = state.hasFlags(RenderFlags.ImageSmoothing);\n\n\t\t\tlet renderCount = node.properties[\"renderCount\"] || 0;\n\t\t\tlet cacheShapesMaxSize = this._options.cacheShapesMaxSize;\n\n\t\t\tnode.properties[\"renderCount\"] = ++renderCount;\n\t\t\tnode.render(context, ratio, null, paintClip ? state.clipPath : null, paintStencil);\n\t\t\tif (paintFlashing) {\n\t\t\t\tlet elapsed = performance.now() - paintStart;\n\t\t\t\tcontext.fillStyle = ColorStyle.gradientColor(0.1 / elapsed);\n\t\t\t\tcontext.globalAlpha = 0.3 + 0.1 * Math.random();\n\t\t\t\tcontext.fillRect(bounds.x, bounds.y, bounds.w, bounds.h);\n\t\t\t}\n\t\t}\n\n\t\t_renderLayer(node: Node, state: RenderState) {\n\t\t\tlet layer = node.getLayer();\n\t\t\tlet mask = layer.mask;\n\t\t\tif (!mask) {\n\t\t\t\tlet clip = Rectangle.allocate();\n\t\t\t\tlet target = this._renderToTemporarySurface(node, node.getLayerBounds(!!this._options.filters),\n\t\t\t\t\tstate, clip, state.target.surface);\n\t\t\t\tif (target) {\n\t\t\t\t\tstate.target.draw(target, clip.x, clip.y, clip.w, clip.h, state.colorMatrix,\n\t\t\t\t\t\tthis._options.blending ? layer.blendMode : BlendMode.Normal,\n\t\t\t\t\t\tthis._options.filters ? layer.filters : null, this._devicePixelRatio);\n\t\t\t\t\ttarget.free();\n\t\t\t\t}\n\t\t\t\tclip.free();\n\t\t\t} else {\n\t\t\t\tlet paintStencil = !node.hasFlags(NodeFlags.CacheAsBitmap) || !mask.hasFlags(NodeFlags.CacheAsBitmap);\n\t\t\t\tthis._renderWithMask(node, mask, layer.blendMode, paintStencil, state);\n\t\t\t}\n\t\t}\n\n\t\t_renderWithMask(node: Node, mask: Node, blendMode: BlendMode, stencil: boolean, state: RenderState) {\n\t\t\tlet maskMatrix = mask.getTransform().getConcatenatedMatrix(true);\n\t\t\t// If the mask doesn't have a parent then it's matrix doesn't include the pixel density\n\t\t\t// scaling and we have to factor it in separately.\n\t\t\tif (!mask.parent) {\n\t\t\t\tmaskMatrix = maskMatrix.scale(this._devicePixelRatio, this._devicePixelRatio);\n\t\t\t}\n\n\t\t\tlet aAABB = node.getBounds().clone();\n\t\t\tstate.matrix.transformRectangleAABB(aAABB);\n\t\t\taAABB.snap();\n\t\t\tif (aAABB.isEmpty()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet bAABB = mask.getBounds().clone();\n\t\t\tmaskMatrix.transformRectangleAABB(bAABB);\n\t\t\tbAABB.snap();\n\t\t\tif (bAABB.isEmpty()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet clip = state.clip.clone();\n\t\t\tclip.intersect(aAABB);\n\t\t\tclip.intersect(bAABB);\n\t\t\tclip.snap();\n\n\t\t\t// The masked area is empty, so nothing to do here.\n\t\t\tif (clip.isEmpty()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet aState = state.clone();\n\t\t\taState.clip.set(clip);\n\t\t\tlet a = this._renderToTemporarySurface(node, node.getBounds(), aState, Rectangle.createEmpty(), null);\n\t\t\taState.free();\n\n\t\t\tlet bState = state.clone();\n\t\t\tbState.clip.set(clip);\n\t\t\tbState.matrix = maskMatrix;\n\t\t\tbState.flags |= RenderFlags.IgnoreMask;\n\t\t\tif (stencil) {\n\t\t\t\tbState.flags |= RenderFlags.PaintStencil;\n\t\t\t}\n\t\t\tlet b = this._renderToTemporarySurface(mask, mask.getBounds(), bState, Rectangle.createEmpty(), a.surface);\n\t\t\tbState.free();\n\n\t\t\ta.draw(b, 0, 0, clip.w, clip.h, bState.colorMatrix, BlendMode.Alpha, null,\n\t\t\t\tthis._devicePixelRatio);\n\n\t\t\tlet matrix = state.matrix;\n\t\t\tstate.target.draw(a, clip.x, clip.y, clip.w, clip.h, aState.colorMatrix, blendMode, null,\n\t\t\t\tthis._devicePixelRatio);\n\n\t\t\tb.free();\n\t\t\ta.free();\n\t\t}\n\n\t\tprivate _renderStageToTarget(target: Canvas2DSurfaceRegion,\n\t\t                             node: Node,\n\t\t                             clip: Rectangle) {\n\n\t\t\tRectangle.allocationCount = Matrix.allocationCount = RenderState.allocationCount = 0;\n\n\t\t\tlet state = new RenderState(target);\n\t\t\tstate.clip.set(clip);\n\n\t\t\tif (!this._options.paintRenderable) {\n\t\t\t\tstate.flags |= RenderFlags.IgnoreRenderable;\n\t\t\t}\n\t\t\tif (this._options.paintBounds) {\n\t\t\t\tstate.flags |= RenderFlags.PaintBounds;\n\t\t\t}\n\t\t\tif (this._options.paintDirtyRegion) {\n\t\t\t\tstate.flags |= RenderFlags.PaintDirtyRegion;\n\t\t\t}\n\t\t\tif (this._options.paintFlashing) {\n\t\t\t\tstate.flags |= RenderFlags.PaintFlashing;\n\t\t\t}\n\t\t\tif (this._options.cacheShapes) {\n\t\t\t\tstate.flags |= RenderFlags.CacheShapes;\n\t\t\t}\n\t\t\tif (this._options.imageSmoothing) {\n\t\t\t\tstate.flags |= RenderFlags.ImageSmoothing;\n\t\t\t}\n\t\t\tif (this._options.snapToDevicePixels) {\n\t\t\t\tstate.flags |= RenderFlags.PixelSnapping;\n\t\t\t}\n\n\t\t\tthis._frameInfo.enter(state);\n\n\t\t\tnode.visit(this, state);\n\n\t\t\tthis._frameInfo.leave();\n\t\t}\n\n\t\tprivate _renderToTemporarySurface(node: Node, bounds: Rectangle, state: RenderState, clip: Rectangle,\n\t\t                                  excludeSurface: ISurface): Canvas2DSurfaceRegion {\n\t\t\tlet matrix = state.matrix;\n\t\t\tlet boundsAABB = bounds.clone();\n\t\t\tmatrix.transformRectangleAABB(boundsAABB);\n\t\t\tboundsAABB.snap();\n\n\t\t\tclip.set(boundsAABB);\n\t\t\tclip.intersect(state.clip);\n\t\t\tclip.snap();\n\n\t\t\tif (clip.isEmpty()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tlet target = this._allocateSurface(clip.w, clip.h, excludeSurface);\n\t\t\tlet region = target.region;\n\n\t\t\t// Region bounds may be smaller than the allocated surface region.\n\t\t\tlet surfaceRegionBounds = new Rectangle(region.x, region.y, clip.w, clip.h);\n\n\t\t\ttarget.context.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\ttarget.clear();\n\n\t\t\tmatrix = matrix.clone();\n\n\t\t\tmatrix.translate(\n\t\t\t\tsurfaceRegionBounds.x - clip.x,\n\t\t\t\tsurfaceRegionBounds.y - clip.y\n\t\t\t);\n\n\t\t\t// Clip region bounds so we don't paint outside.\n\t\t\ttarget.context.save();\n\n\t\t\t// We can't do this because we could be clipping some other temporary region in the same\n\t\t\t// context.\n\t\t\t// TODO: but we have to, otherwise we overwrite textures that we might need. This happens in\n\t\t\t// _renderWithMask, which is why we currently force the allocation of a whole second surface\n\t\t\t// to avoid it. So, we need to find a solution here.\n\t\t\t//target.context.beginPath();\n\t\t\t//target.context.rect(surfaceRegionBounds.x, surfaceRegionBounds.y, surfaceRegionBounds.w,\n\t\t\t//                    surfaceRegionBounds.h);\n\t\t\t//target.context.clip();\n\n\t\t\tstate = state.clone();\n\t\t\tstate.target = target;\n\t\t\tstate.matrix = matrix;\n\t\t\tstate.clip.set(surfaceRegionBounds);\n\t\t\tnode.visit(this, state);\n\t\t\tstate.free();\n\t\t\ttarget.context.restore();\n\t\t\treturn target;\n\t\t}\n\n\t\tprivate _allocateSurface(w: number, h: number, excludeSurface: ISurface): Canvas2DSurfaceRegion {\n\t\t\tlet surface = <Canvas2DSurfaceRegion>(Canvas2DRenderer._surfaceCache.allocate(w, h,\n\t\t\t\texcludeSurface));\n\t\t\tif (!release) {\n\t\t\t\tsurface.fill(\"#FF4981\");\n\t\t\t}\n\t\t\t// let color = \"rgba(\" + (Math.random() * 255 | 0) + \", \" + (Math.random() * 255 | 0) + \", \" + (Math.random() * 255 | 0) + \", 1)\"\n\t\t\t// surface.fill(color);\n\t\t\treturn surface;\n\t\t}\n\n\t\tpublic screenShot(bounds: Rectangle, stageContent: boolean, disableHidpi: boolean): ScreenShot {\n\t\t\tif (stageContent) {\n\t\t\t\t// HACK: Weird way to get to the real content, but oh well...\n\t\t\t\tlet contentStage = <Stage>this._stage.content.groupChild.child;\n\t\t\t\tassert(contentStage instanceof Stage);\n\t\t\t\tbounds = contentStage.content.getBounds(true);\n\t\t\t\t// Figure out the device bounds.\n\t\t\t\tcontentStage.content.getTransform().getConcatenatedMatrix().transformRectangleAABB(bounds);\n\t\t\t\t// If it's zoomed in, clip by the viewport.\n\t\t\t\tbounds.intersect(this._viewport);\n\t\t\t}\n\t\t\tif (!bounds) {\n\t\t\t\tbounds = new Rectangle(0, 0, this._target.w, this._target.h);\n\t\t\t}\n\t\t\tlet outputWidth = bounds.w;\n\t\t\tlet outputHeight = bounds.h;\n\t\t\tlet pixelRatio = this._devicePixelRatio;\n\t\t\tif (disableHidpi) {\n\t\t\t\toutputWidth /= pixelRatio;\n\t\t\t\toutputHeight /= pixelRatio;\n\t\t\t\tpixelRatio = 1;\n\t\t\t}\n\t\t\tlet canvas = document.createElement(\"canvas\");\n\t\t\tcanvas.width = outputWidth;\n\t\t\tcanvas.height = outputHeight;\n\t\t\tlet context = canvas.getContext(\"2d\");\n\t\t\tcontext.fillStyle = this._container.style.backgroundColor;\n\t\t\tcontext.fillRect(0, 0, outputWidth, outputHeight);\n\t\t\tcontext.drawImage(this._target.context.canvas, bounds.x, bounds.y, bounds.w, bounds.h, 0, 0, outputWidth, outputHeight);\n\t\t\treturn new ScreenShot(canvas.toDataURL('image/png'), outputWidth, outputHeight, pixelRatio);\n\t\t}\n\t}\n}\n","/**\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.GFX {\n\timport assert = Shumway.Debug.assert;\n\timport Point = Geometry.Point;\n\timport Matrix = Geometry.Matrix;\n\timport Rectangle = Geometry.Rectangle;\n\n\timport Canvas2DRenderer = Shumway.GFX.Canvas2D.Canvas2DRenderer;\n\n\timport DisplayParameters = Shumway.Remoting.DisplayParameters;\n\n\tdeclare let GUI: any;\n\n\texport interface IState {\n\t\tonMouseUp(easel: Easel, event: MouseEvent): void;\n\n\t\tonMouseDown(easel: Easel, event: MouseEvent): void;\n\n\t\tonMouseMove(easel: Easel, event: MouseEvent): void;\n\n\t\tonMouseClick(easel: Easel, event: MouseEvent): void;\n\n\t\tonKeyUp(easel: Easel, event: KeyboardEvent): void;\n\n\t\tonKeyDown(easel: Easel, event: KeyboardEvent): void;\n\n\t\tonKeyPress(easel: Easel, event: KeyboardEvent): void;\n\t}\n\n\texport class UIState implements IState {\n\n\t\tonMouseUp(easel: Easel, event: MouseEvent) {\n\t\t\teasel.state = this;\n\t\t}\n\n\t\tonMouseDown(easel: Easel, event: MouseEvent) {\n\t\t\teasel.state = this;\n\t\t}\n\n\t\tonMouseMove(easel: Easel, event: MouseEvent) {\n\t\t\teasel.state = this;\n\t\t}\n\n\t\tonMouseWheel(easel: Easel, event: any) {\n\t\t\teasel.state = this;\n\t\t}\n\n\t\tonMouseClick(easel: Easel, event: MouseEvent) {\n\t\t\teasel.state = this;\n\t\t}\n\n\t\tonKeyUp(easel: Easel, event: KeyboardEvent) {\n\t\t\teasel.state = this;\n\t\t}\n\n\t\tonKeyDown(easel: Easel, event: KeyboardEvent) {\n\t\t\teasel.state = this;\n\t\t}\n\n\t\tonKeyPress(easel: Easel, event: KeyboardEvent) {\n\t\t\teasel.state = this;\n\t\t}\n\t}\n\n\tclass StartState extends UIState {\n\t\tprivate _keyCodes: boolean [] = [];\n\n\t\tonMouseDown(easel: Easel, event: MouseEvent) {\n\t\t\tif (event.altKey) {\n\t\t\t\teasel.state = new DragState(easel.worldView, easel.getMousePosition(event, null), easel.worldView.getTransform().getMatrix(true));\n\t\t\t} else {\n//        easel.state = new MouseDownState();\n\t\t\t}\n\t\t}\n\n\t\tonMouseClick(easel: Easel, event: MouseEvent) {\n\n\t\t}\n\n\t\tonKeyDown(easel: Easel, event: KeyboardEvent) {\n\t\t\tthis._keyCodes[event.keyCode] = true;\n\t\t}\n\n\t\tonKeyUp(easel: Easel, event: KeyboardEvent) {\n\t\t\tthis._keyCodes[event.keyCode] = false;\n\t\t}\n\t}\n\n\tfunction normalizeWheelSpeed(event: any): number {\n\t\tlet normalized;\n\t\tif (event.wheelDelta) {\n\t\t\tnormalized = (event.wheelDelta % 120 - 0) == -0 ? event.wheelDelta / 120 : event.wheelDelta / 12;\n\t\t} else {\n\t\t\tlet rawAmmount = event.deltaY ? event.deltaY : event.detail;\n\t\t\tnormalized = -(rawAmmount % 3 ? rawAmmount * 10 : rawAmmount / 3);\n\t\t}\n\t\treturn normalized;\n\t}\n\n\tclass PersistentState extends UIState {\n\t\tprivate _keyCodes: boolean [] = [];\n\t\tprivate _paused: boolean = false;\n\t\tprivate _mousePosition: Point = new Point(0, 0);\n\n\t\tonMouseMove(easel: Easel, event: MouseEvent) {\n\t\t\tthis._mousePosition = easel.getMousePosition(event, null);\n\t\t\tthis._update(easel);\n\t\t}\n\n\t\tonMouseDown(easel: Easel, event: MouseEvent) {\n\n\t\t}\n\n\t\tonMouseClick(easel: Easel, event: MouseEvent) {\n\n\t\t}\n\n\t\tonMouseWheel(easel: Easel, event: any) {\n\t\t\tlet ticks = (event.type === 'DOMMouseScroll') ? -event.detail : event.wheelDelta / 40;\n\t\t\tif (event.altKey) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet p = easel.getMousePosition(event, null);\n\t\t\t\tlet m = easel.worldView.getTransform().getMatrix(true);\n\t\t\t\tlet s = 1 + ticks / 1000;\n\t\t\t\tm.translate(-p.x, -p.y);\n\t\t\t\tm.scale(s, s);\n\t\t\t\tm.translate(p.x, p.y);\n\t\t\t\teasel.worldView.getTransform().setMatrix(m);\n\t\t\t}\n\t\t}\n\n\t\tonKeyPress(easel: Easel, event: KeyboardEvent) {\n\t\t\tif (!event.altKey) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet code = event.keyCode || event.which;\n\t\t\tconsole.info(\"onKeyPress Code: \" + code);\n\t\t\tswitch (code) {\n\t\t\t\tcase 248: // O\n\t\t\t\t\tthis._paused = !this._paused;\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 223: // S\n\t\t\t\t\teasel.toggleOption(\"paintRenderable\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 8730: // V\n\t\t\t\t\teasel.toggleOption(\"paintViewport\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 8747: // B\n\t\t\t\t\teasel.toggleOption(\"paintBounds\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 8706: // D\n\t\t\t\t\teasel.toggleOption(\"paintDirtyRegion\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 231: // C\n\t\t\t\t\teasel.toggleOption(\"clear\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 402: // F\n\t\t\t\t\teasel.toggleOption(\"paintFlashing\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis._update(easel);\n\t\t}\n\n\t\tonKeyDown(easel: Easel, event: KeyboardEvent) {\n\t\t\tthis._keyCodes[event.keyCode] = true;\n\t\t\tthis._update(easel);\n\t\t}\n\n\t\tonKeyUp(easel: Easel, event: KeyboardEvent) {\n\t\t\tthis._keyCodes[event.keyCode] = false;\n\t\t\tthis._update(easel);\n\t\t}\n\n\t\tprivate _update(easel: Easel) {\n\t\t\teasel.paused = this._paused;\n\t\t\tif (easel.getOption(\"paintViewport\")) {\n\t\t\t\tlet w = viewportLoupeDiameter.value, h = viewportLoupeDiameter.value;\n\t\t\t\teasel.viewport = new Rectangle(this._mousePosition.x - w / 2, this._mousePosition.y - h / 2, w, h);\n\t\t\t} else {\n\t\t\t\teasel.viewport = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tclass MouseDownState extends UIState {\n\t\tprivate _startTime: number = Date.now();\n\n\t\tonMouseMove(easel: Easel, event: MouseEvent) {\n\t\t\tif (Date.now() - this._startTime < 10) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet node = easel.queryNodeUnderMouse(event);\n\t\t\tif (node) {\n\t\t\t\teasel.state = new DragState(node, easel.getMousePosition(event, null), node.getTransform().getMatrix(true));\n\t\t\t}\n\t\t}\n\n\t\tonMouseUp(easel: Easel, event: MouseEvent) {\n\t\t\teasel.state = new StartState();\n\t\t\teasel.selectNodeUnderMouse(event);\n\t\t}\n\t}\n\n\tclass DragState extends UIState {\n\t\tprivate _startMatrix: Matrix;\n\t\tprivate _startPosition: Point;\n\t\tprivate _target: Node;\n\n\t\tconstructor(target: Node, startPosition: Point, startMatrix: Matrix) {\n\t\t\tsuper();\n\t\t\tthis._target = target;\n\t\t\tthis._startPosition = startPosition;\n\t\t\tthis._startMatrix = startMatrix;\n\t\t}\n\n\t\tonMouseMove(easel: Easel, event: MouseEvent) {\n\t\t\tevent.preventDefault();\n\t\t\tlet p = easel.getMousePosition(event, null);\n\t\t\tp.sub(this._startPosition);\n\t\t\tthis._target.getTransform().setMatrix(this._startMatrix.clone().translate(p.x, p.y));\n\t\t\teasel.state = this;\n\t\t}\n\n\t\tonMouseUp(easel: Easel, event: MouseEvent) {\n\t\t\teasel.state = new StartState();\n\t\t}\n\t}\n\n\texport class Easel {\n\n\t\t/**\n\t\t * Root stage node.\n\t\t */\n\t\tprivate _stage: Stage;\n\n\t\t/**\n\t\t * Node that holds the view transformation. This us used for zooming and panning in the easel.\n\t\t */\n\t\tprivate _worldView: Group;\n\n\t\t/**\n\t\t * Node that holds the rest of the content in the display tree.\n\t\t */\n\t\tprivate _world: Group;\n\n\t\tprivate _options: Canvas2D.Canvas2DRendererOptions;\n\n\t\t/**\n\t\t * Container div element that is managed by this easel. If the dimensions of this element change, then the dimensions of the root\n\t\t * stage also change.\n\t\t */\n\t\tprivate _container: HTMLDivElement;\n\n\t\tprivate _renderer: Renderer;\n\n\t\tprivate _disableHiDPI: boolean;\n\t\tprivate _state: UIState = new StartState();\n\t\tprivate _persistentState: UIState = new PersistentState();\n\n\t\tpublic paused: boolean = false;\n\t\tpublic viewport: Rectangle = null;\n\t\tpublic transparent: boolean;\n\n\t\tprivate _selectedNodes: Node [] = [];\n\n\t\tprivate _isRendering: boolean = false;\n\t\tprivate _rAF: number = undefined;\n\n\t\tprivate _eventListeners: Shumway.MapObject<any []> = Object.create(null);\n\t\tprivate _fps: Shumway.Tools.Mini.FPS;\n\t\tprivate _fullScreen: boolean = false;\n\n\t\tconstructor(container: HTMLDivElement,\n\t\t            disableHiDPI: boolean = false,\n\t\t            backgroundColor: number = undefined) {\n\t\t\trelease || assert(container && container.children.length === 0,\n\t\t\t\t\"Easel container must be empty.\");\n\t\t\tthis._container = container;\n\t\t\tthis._stage = new Stage(512, 512, false);\n\t\t\tthis._worldView = this._stage.content;\n\t\t\tthis._world = new Group();\n\t\t\tthis._worldView.addChild(this._world);\n\t\t\tthis._disableHiDPI = disableHiDPI;\n\n\t\t\t// Create stage container.\n\t\t\tlet stageContainer = document.createElement(\"div\");\n\t\t\tstageContainer.style.position = \"absolute\";\n\t\t\tstageContainer.style.width = \"100%\";\n\t\t\tstageContainer.style.height = \"100%\";\n\t\t\tstageContainer.style.zIndex = \"0\";\n\t\t\tcontainer.appendChild(stageContainer);\n\n\t\t\t// Create hud container, that lives on top of the stage.\n\t\t\tif (hud.value && Shumway.Tools) {\n\t\t\t\tlet hudContainer = document.createElement(\"div\");\n\t\t\t\thudContainer.style.position = \"absolute\";\n\t\t\t\thudContainer.style.width = \"100%\";\n\t\t\t\thudContainer.style.height = \"100%\";\n\t\t\t\thudContainer.style.pointerEvents = \"none\";\n\t\t\t\tlet fpsContainer = document.createElement(\"div\");\n\t\t\t\tfpsContainer.style.position = \"absolute\";\n\t\t\t\tfpsContainer.style.width = \"100%\";\n\t\t\t\tfpsContainer.style.height = \"20px\";\n\t\t\t\tfpsContainer.style.pointerEvents = \"none\";\n\t\t\t\thudContainer.appendChild(fpsContainer);\n\t\t\t\tcontainer.appendChild(hudContainer);\n\t\t\t\tthis._fps = new Shumway.Tools.Mini.FPS(fpsContainer);\n\t\t\t} else {\n\t\t\t\tthis._fps = null;\n\t\t\t}\n\n\t\t\tlet transparent = backgroundColor === 0;\n\t\t\tthis.transparent = transparent;\n\n\t\t\tlet cssBackgroundColor = backgroundColor === undefined ? \"#14171a\" :\n\t\t\t\tbackgroundColor === 0 ? 'transparent' :\n\t\t\t\t\tShumway.ColorUtilities.rgbaToCSSStyle(backgroundColor);\n\n\t\t\tthis._options = new Canvas2D.Canvas2DRendererOptions();\n\t\t\tthis._options.alpha = transparent;\n\n\t\t\tthis._renderer = new Canvas2D.Canvas2DRenderer(stageContainer, this._stage, this._options);\n\t\t\tthis._listenForContainerSizeChanges();\n\t\t\tthis._onMouseUp = this._onMouseUp.bind(this)\n\t\t\tthis._onMouseDown = this._onMouseDown.bind(this);\n\t\t\tthis._onMouseMove = this._onMouseMove.bind(this);\n\n\t\t\tlet self = this;\n\n\t\t\twindow.addEventListener(\"mouseup\", function (event) {\n\t\t\t\tself._state.onMouseUp(self, event);\n\t\t\t\tself._render();\n\t\t\t}, false);\n\n\t\t\twindow.addEventListener(\"mousemove\", function (event) {\n\t\t\t\tself._state.onMouseMove(self, event);\n\t\t\t\tself._persistentState.onMouseMove(self, event);\n\t\t\t}, false);\n\n\t\t\tfunction handleMouseWheel(event: any) {\n\t\t\t\tself._state.onMouseWheel(self, event);\n\t\t\t\tself._persistentState.onMouseWheel(self, event);\n\t\t\t}\n\n\t\t\twindow.addEventListener('DOMMouseScroll', handleMouseWheel);\n\t\t\twindow.addEventListener(\"mousewheel\", handleMouseWheel);\n\n\t\t\tcontainer.addEventListener(\"mousedown\", function (event) {\n\t\t\t\tself._state.onMouseDown(self, event);\n\t\t\t});\n\n\t\t\twindow.addEventListener(\"keydown\", function (event) {\n\t\t\t\tself._state.onKeyDown(self, event);\n\t\t\t\tif (self._state !== self._persistentState) {\n\t\t\t\t\tself._persistentState.onKeyDown(self, event);\n\t\t\t\t}\n\t\t\t}, false);\n\n\t\t\twindow.addEventListener(\"keypress\", function (event) {\n\t\t\t\tself._state.onKeyPress(self, event);\n\t\t\t\tif (self._state !== self._persistentState) {\n\t\t\t\t\tself._persistentState.onKeyPress(self, event);\n\t\t\t\t}\n\t\t\t}, false);\n\n\t\t\twindow.addEventListener(\"keyup\", function (event) {\n\t\t\t\tself._state.onKeyUp(self, event);\n\t\t\t\tif (self._state !== self._persistentState) {\n\t\t\t\t\tself._persistentState.onKeyUp(self, event);\n\t\t\t\t}\n\t\t\t}, false);\n\t\t}\n\n\t\tprivate _listenForContainerSizeChanges() {\n\t\t\tlet pollInterval = 1000;\n\t\t\tlet w = this._containerWidth;\n\t\t\tlet h = this._containerHeight;\n\t\t\tthis._onContainerSizeChanged();\n\t\t\tlet self = this;\n\t\t\tsetInterval(function () {\n\t\t\t\tif (w !== self._containerWidth || h !== self._containerHeight) {\n\t\t\t\t\tself._onContainerSizeChanged();\n\t\t\t\t\tw = self._containerWidth;\n\t\t\t\t\th = self._containerHeight;\n\t\t\t\t}\n\t\t\t}, pollInterval);\n\t\t}\n\n\t\tprivate _onContainerSizeChanged() {\n\t\t\tlet ratio = this.getRatio();\n\t\t\tlet sw = Math.ceil(this._containerWidth * ratio);\n\t\t\tlet sh = Math.ceil(this._containerHeight * ratio);\n\n\t\t\tthis._stage.setBounds(new Rectangle(0, 0, sw, sh));\n\t\t\tthis._stage.content.setBounds(new Rectangle(0, 0, sw, sh));\n\t\t\tthis._worldView.getTransform().setMatrix(new Matrix(ratio, 0, 0, ratio, 0, 0));\n\t\t\tthis._dispatchEvent('resize');\n\t\t}\n\n\t\t/**\n\t\t * Primitive event dispatching features.\n\t\t */\n\t\taddEventListener(type: string, listener: any) {\n\t\t\tif (!this._eventListeners[type]) {\n\t\t\t\tthis._eventListeners[type] = [];\n\t\t\t}\n\t\t\tthis._eventListeners[type].push(listener);\n\t\t}\n\n\t\tprivate _dispatchEvent(type: string) {\n\t\t\tlet listeners = this._eventListeners[type];\n\t\t\tif (!listeners) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (let i = 0; i < listeners.length; i++) {\n\t\t\t\tlisteners[i]();\n\t\t\t}\n\t\t}\n\n\t\tpublic startRendering() {\n\t\t\tif (this._isRendering) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._isRendering = true;\n\n\t\t\tlet self = this;\n\t\t\tthis._rAF = requestAnimationFrame(function tick() {\n\t\t\t\tself.render();\n\t\t\t\tself._rAF = requestAnimationFrame(tick);\n\t\t\t});\n\t\t}\n\n\t\tpublic stopRendering() {\n\t\t\tif (this._isRendering) {\n\t\t\t\tthis._isRendering = false;\n\t\t\t\tcancelAnimationFrame(this._rAF);\n\t\t\t}\n\t\t}\n\n\t\tset state(state: UIState) {\n\t\t\tthis._state = state;\n\t\t}\n\n\t\tset cursor(cursor: string) {\n\t\t\tthis._container.style.cursor = cursor;\n\t\t}\n\n\t\tprivate _render() {\n\t\t\tRenderableVideo.checkForVideoUpdates();\n\t\t\tlet mustRender = (this._stage.readyToRender() || forcePaint.value) && !this.paused;\n\t\t\tlet renderTime = 0;\n\t\t\tif (mustRender) {\n\t\t\t\tlet renderer = this._renderer;\n\t\t\t\tif (this.viewport) {\n\t\t\t\t\trenderer.viewport = this.viewport;\n\t\t\t\t} else {\n\t\t\t\t\trenderer.viewport = this._stage.getBounds();\n\t\t\t\t}\n\t\t\t\tthis._dispatchEvent(\"render\");\n\t\t\t\tenterTimeline(\"Render\");\n\t\t\t\trenderTime = performance.now();\n\t\t\t\trenderer.render();\n\t\t\t\trenderTime = performance.now() - renderTime;\n\t\t\t\tleaveTimeline(\"Render\");\n\n\t\t\t}\n\t\t\tif (this._fps) {\n\t\t\t\tthis._fps.tickAndRender(!mustRender, renderTime);\n\t\t\t}\n\t\t}\n\n\t\tpublic render() {\n\t\t\tthis._render();\n\t\t}\n\n\t\tget world(): Group {\n\t\t\treturn this._world;\n\t\t}\n\n\t\tget worldView(): Group {\n\t\t\treturn this._worldView;\n\t\t}\n\n\t\tget stage(): Stage {\n\t\t\treturn this._stage;\n\t\t}\n\n\t\tget options() {\n\t\t\treturn this._options;\n\t\t}\n\n\t\tgetDisplayParameters(): DisplayParameters {\n\t\t\tlet ratio = this.getRatio();\n\t\t\treturn {\n\t\t\t\tstageWidth: this._containerWidth,\n\t\t\t\tstageHeight: this._containerHeight,\n\t\t\t\tpixelRatio: ratio,\n\t\t\t\tscreenWidth: window.screen ? window.screen.width : 640,\n\t\t\t\tscreenHeight: window.screen ? window.screen.height : 480\n\t\t\t};\n\t\t}\n\n\t\tpublic toggleOption(name: string) {\n\t\t\tlet option = this._options;\n\t\t\toption[name] = !option[name];\n\t\t}\n\n\t\tpublic getOption(name: string) {\n\t\t\treturn this._options[name];\n\t\t}\n\n\t\tpublic getRatio(): number {\n\t\t\tlet devicePixelRatio = window.devicePixelRatio || 1;\n\t\t\tlet backingStoreRatio = 1;\n\t\t\tlet ratio = 1;\n\t\t\tif (devicePixelRatio !== backingStoreRatio &&\n\t\t\t\t!this._disableHiDPI) {\n\t\t\t\tratio = devicePixelRatio / backingStoreRatio;\n\t\t\t}\n\t\t\treturn ratio;\n\t\t}\n\n\t\tprivate get _containerWidth(): number {\n\t\t\treturn this._container.clientWidth;\n\t\t}\n\n\t\tprivate get _containerHeight(): number {\n\t\t\treturn this._container.clientHeight;\n\t\t}\n\n\t\tqueryNodeUnderMouse(event: MouseEvent): Node {\n\t\t\treturn this._world;\n\t\t}\n\n\t\tselectNodeUnderMouse(event: MouseEvent) {\n\t\t\tlet frame = this.queryNodeUnderMouse(event);\n\t\t\tif (frame) {\n\t\t\t\tthis._selectedNodes.push(frame);\n\t\t\t}\n\t\t\tthis._render();\n\t\t}\n\n\t\tgetMousePosition(event: MouseEvent, coordinateSpace: Node): Point {\n\t\t\tlet container = this._container;\n\t\t\tlet bRect = container.getBoundingClientRect();\n\t\t\tlet ratio = this.getRatio();\n\t\t\tlet x = ratio * (event.clientX - bRect.left) * (container.scrollWidth / bRect.width);\n\t\t\tlet y = ratio * (event.clientY - bRect.top) * (container.scrollHeight / bRect.height);\n\t\t\tlet p = new Point(x, y);\n\t\t\tif (!coordinateSpace) {\n\t\t\t\treturn p;\n\t\t\t}\n\t\t\tlet m = Matrix.createIdentity();\n\t\t\tcoordinateSpace.getTransform().getConcatenatedMatrix().inverse(m);\n\t\t\tm.transformPoint(p);\n\t\t\treturn p;\n\t\t}\n\n\t\tgetMouseWorldPosition(event: MouseEvent): Point {\n\t\t\treturn this.getMousePosition(event, this._world);\n\t\t}\n\n\t\tprivate _onMouseDown(event: any) {\n\t\t\t// this._renderers.forEach(renderer => renderer.render());\n\t\t}\n\n\t\tprivate _onMouseUp(event: any) {\n\n\t\t}\n\n\t\tprivate _onMouseMove(event: any) {\n\n\t\t}\n\n\t\tpublic screenShot(bounds: Rectangle, stageContent: boolean, disableHidpi: boolean): ScreenShot {\n\t\t\treturn this._renderer.screenShot(bounds, stageContent, disableHidpi);\n\t\t}\n\t}\n}\n","module Shumway.GFX {\n\n\timport Rectangle = Shumway.GFX.Geometry.Rectangle;\n\timport Point = Shumway.GFX.Geometry.Point;\n\timport Matrix = Shumway.GFX.Geometry.Matrix;\n\timport DirtyRegion = Shumway.GFX.Geometry.DirtyRegion;\n\timport Filter = Shumway.GFX.Filter;\n\timport TileCache = Shumway.GFX.Geometry.TileCache;\n\timport Tile = Shumway.GFX.Geometry.Tile;\n\timport OBB = Shumway.GFX.Geometry.OBB;\n\n\texport const enum Layout {\n\t\tSimple\n\t}\n\n\texport class TreeRendererOptions extends RendererOptions {\n\t\tlayout: Layout = Layout.Simple;\n\t}\n\n\texport class TreeRenderer extends Renderer {\n\t\t_options: TreeRendererOptions;\n\t\t_canvas: HTMLCanvasElement;\n\t\t_context: CanvasRenderingContext2D;\n\t\tlayout: any;\n\n\t\tconstructor(container: HTMLDivElement,\n\t\t            stage: Stage,\n\t\t            options: TreeRendererOptions = new TreeRendererOptions()) {\n\t\t\tsuper(container, stage, options);\n\t\t\tthis._canvas = document.createElement(\"canvas\");\n\t\t\tthis._container.appendChild(this._canvas);\n\t\t\tthis._context = this._canvas.getContext(\"2d\");\n\t\t\tthis._listenForContainerSizeChanges();\n\t\t}\n\n\t\tprivate _listenForContainerSizeChanges() {\n\t\t\tlet pollInterval = 10;\n\t\t\tlet w = this._containerWidth;\n\t\t\tlet h = this._containerHeight;\n\t\t\tthis._onContainerSizeChanged();\n\t\t\tlet self = this;\n\t\t\tsetInterval(function () {\n\t\t\t\tif (w !== self._containerWidth || h !== self._containerHeight) {\n\t\t\t\t\tself._onContainerSizeChanged();\n\t\t\t\t\tw = self._containerWidth;\n\t\t\t\t\th = self._containerHeight;\n\t\t\t\t}\n\t\t\t}, pollInterval);\n\t\t}\n\n\t\tprivate _getRatio(): number {\n\t\t\tlet devicePixelRatio = window.devicePixelRatio || 1;\n\t\t\tlet backingStoreRatio = 1;\n\t\t\tlet ratio = 1;\n\t\t\tif (devicePixelRatio !== backingStoreRatio) {\n\t\t\t\tratio = devicePixelRatio / backingStoreRatio;\n\t\t\t}\n\t\t\treturn ratio;\n\t\t}\n\n\t\tprivate _onContainerSizeChanged() {\n\t\t\tlet ratio = this._getRatio();\n\t\t\tlet w = Math.ceil(this._containerWidth * ratio);\n\t\t\tlet h = Math.ceil(this._containerHeight * ratio);\n\t\t\tlet canvas = this._canvas;\n\t\t\tif (ratio > 0) {\n\t\t\t\tcanvas.width = w * ratio;\n\t\t\t\tcanvas.height = h * ratio;\n\t\t\t\tcanvas.style.width = w + 'px';\n\t\t\t\tcanvas.style.height = h + 'px';\n\t\t\t} else {\n\t\t\t\tcanvas.width = w;\n\t\t\t\tcanvas.height = h;\n\t\t\t}\n\t\t}\n\n\t\tprivate get _containerWidth(): number {\n\t\t\treturn this._container.clientWidth;\n\t\t}\n\n\t\tprivate get _containerHeight(): number {\n\t\t\treturn this._container.clientHeight;\n\t\t}\n\n\t\tpublic render() {\n\t\t\tlet context = this._context;\n\t\t\tcontext.save();\n\n\t\t\tcontext.clearRect(0, 0, this._canvas.width, this._canvas.height);\n\t\t\tcontext.scale(1, 1);\n\t\t\tif (this._options.layout === Layout.Simple) {\n\t\t\t\tthis._renderNodeSimple(this._context, this._stage, Matrix.createIdentity());\n\t\t\t}\n\t\t\tcontext.restore();\n\t\t}\n\n\t\t_renderNodeSimple(context: CanvasRenderingContext2D, root: Node, transform: Matrix) {\n\t\t\tlet self = this;\n\t\t\tcontext.save();\n\t\t\tlet fontHeight = 16;\n\t\t\tcontext.font = fontHeight + \"px Arial\";\n\t\t\tcontext.fillStyle = \"white\";\n\t\t\tlet x = 0, y = 0;\n\t\t\tlet w = 20, h = fontHeight, hPadding = 2, wColPadding = 8;\n\t\t\tlet colX = 0;\n\t\t\tlet maxX = 0;\n\n\t\t\tfunction visit(node: Node) {\n\t\t\t\tlet children = node.getChildren();\n\t\t\t\tif (node.hasFlags(NodeFlags.Dirty)) {\n\t\t\t\t\tcontext.fillStyle = \"red\";\n\t\t\t\t} else {\n\t\t\t\t\tcontext.fillStyle = \"white\";\n\t\t\t\t}\n\n\t\t\t\tlet l = String(node.id);\n\n\t\t\t\tif (node instanceof RenderableText) {\n\t\t\t\t\tl = \"T\" + l;\n\t\t\t\t} else if (node instanceof RenderableShape) {\n\t\t\t\t\tl = \"S\" + l;\n\t\t\t\t} else if (node instanceof RenderableBitmap) {\n\t\t\t\t\tl = \"B\" + l;\n\t\t\t\t} else if (node instanceof RenderableVideo) {\n\t\t\t\t\tl = \"V\" + l;\n\t\t\t\t}\n\n\t\t\t\tif (node instanceof Renderable) {\n\t\t\t\t\tl = l + \" [\" + (<any>node)._parents.length + \"]\";\n\t\t\t\t}\n\n\t\t\t\tlet t = context.measureText(l).width;\n\t\t\t\t// context.fillRect(x, y, t, h);\n\t\t\t\tcontext.fillText(l, x, y);\n\t\t\t\tif (children) {\n\t\t\t\t\tx += t + 4;\n\t\t\t\t\tmaxX = Math.max(maxX, x + w);\n\t\t\t\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\t\t\t\tvisit(children[i]);\n\t\t\t\t\t\tif (i < children.length - 1) {\n\t\t\t\t\t\t\ty += h + hPadding;\n\t\t\t\t\t\t\tif (y > self._canvas.height) {\n\t\t\t\t\t\t\t\tcontext.fillStyle = \"gray\";\n\t\t\t\t\t\t\t\t// context.fillRect(maxX + 4, 0, 2, self._canvas.height);\n\t\t\t\t\t\t\t\tx = x - colX + maxX + wColPadding;\n\t\t\t\t\t\t\t\tcolX = maxX + wColPadding;\n\t\t\t\t\t\t\t\ty = 0;\n\t\t\t\t\t\t\t\tcontext.fillStyle = \"white\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tx -= t + 4;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvisit(root);\n\t\t\tcontext.restore();\n\t\t}\n\t}\n}","/**\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nmodule Shumway.Remoting.GFX {\n\timport BlurFilter = Shumway.GFX.BlurFilter;\n\timport DropshadowFilter = Shumway.GFX.DropshadowFilter;\n\timport NodeFlags = Shumway.GFX.NodeFlags;\n\timport Shape = Shumway.GFX.Shape;\n\timport Group = Shumway.GFX.Group;\n\timport Renderable = Shumway.GFX.Renderable;\n\timport RenderableShape = Shumway.GFX.RenderableShape;\n\timport RenderableMorphShape = Shumway.GFX.RenderableMorphShape;\n\timport RenderableBitmap = Shumway.GFX.RenderableBitmap;\n\timport RenderableVideo = Shumway.GFX.RenderableVideo;\n\timport IVideoPlaybackEventSerializer = Shumway.GFX.IVideoPlaybackEventSerializer;\n\timport RenderableText = Shumway.GFX.RenderableText;\n\timport ColorMatrix = Shumway.GFX.ColorMatrix;\n\timport BlendMode = Shumway.GFX.BlendMode;\n\timport Node = Shumway.GFX.Node;\n\timport ShapeData = Shumway.ShapeData;\n\timport DataBuffer = Shumway.ArrayUtilities.DataBuffer;\n\timport Stage = Shumway.GFX.Stage;\n\timport NodeEventType = Shumway.GFX.NodeEventType;\n\n\timport Point = Shumway.GFX.Geometry.Point;\n\timport Matrix = Shumway.GFX.Geometry.Matrix;\n\timport Rectangle = Shumway.GFX.Geometry.Rectangle;\n\n\timport StageAlignFlags = Shumway.Remoting.StageAlignFlags;\n\timport StageScaleModeId = Shumway.Remoting.StageScaleMode;\n\n\timport IDataInput = Shumway.ArrayUtilities.IDataInput;\n\timport IDataOutput = Shumway.ArrayUtilities.IDataOutput;\n\timport assert = Shumway.Debug.assert;\n\tlet writer: IndentingWriter = null; // new IndentingWriter();\n\n\tdeclare let registerInspectorAsset: any;\n\tdeclare let registerInspectorStage: any;\n\n\texport class GFXChannelSerializer {\n\t\tpublic output: IDataOutput;\n\t\tpublic outputAssets: any [];\n\n\t\tpublic writeMouseEvent(event: MouseEvent, point: Point) {\n\t\t\tlet output = this.output;\n\t\t\toutput.writeInt(MessageTag.MouseEvent);\n\t\t\tlet typeId = Shumway.Remoting.MouseEventNames.indexOf(event.type);\n\t\t\toutput.writeInt(typeId);\n\t\t\toutput.writeFloat(point.x);\n\t\t\toutput.writeFloat(point.y);\n\t\t\toutput.writeInt(event.buttons);\n\t\t\tlet flags =\n\t\t\t\t(event.ctrlKey ? KeyboardEventFlags.CtrlKey : 0) |\n\t\t\t\t(event.altKey ? KeyboardEventFlags.AltKey : 0) |\n\t\t\t\t(event.shiftKey ? KeyboardEventFlags.ShiftKey : 0);\n\t\t\toutput.writeInt(flags);\n\t\t}\n\n\t\tpublic writeKeyboardEvent(event: KeyboardEvent) {\n\t\t\tlet output = this.output;\n\t\t\toutput.writeInt(MessageTag.KeyboardEvent);\n\t\t\tlet typeId = Shumway.Remoting.KeyboardEventNames.indexOf(event.type);\n\t\t\toutput.writeInt(typeId);\n\t\t\toutput.writeInt(event.keyCode);\n\t\t\toutput.writeInt(event.charCode);\n\t\t\toutput.writeInt(event.location);\n\t\t\tlet flags =\n\t\t\t\t(event.ctrlKey ? KeyboardEventFlags.CtrlKey : 0) |\n\t\t\t\t(event.altKey ? KeyboardEventFlags.AltKey : 0) |\n\t\t\t\t(event.shiftKey ? KeyboardEventFlags.ShiftKey : 0);\n\t\t\toutput.writeInt(flags);\n\t\t}\n\n\t\tpublic writeFocusEvent(type: FocusEventType) {\n\t\t\tlet output = this.output;\n\t\t\toutput.writeInt(MessageTag.FocusEvent);\n\t\t\toutput.writeInt(type);\n\t\t}\n\t}\n\n\texport class GFXChannelDeserializerContext implements IVideoPlaybackEventSerializer {\n\t\tstage: Stage;\n\t\t_nodes: Node [];\n\t\tprivate _assets: Renderable [];\n\n\t\t_easelHost: Shumway.GFX.EaselHost;\n\t\tprivate _canvas: HTMLCanvasElement;\n\t\tprivate _context: CanvasRenderingContext2D;\n\n\t\tconstructor(easelHost: Shumway.GFX.EaselHost, root: Group, transparent: boolean) {\n\t\t\tlet stage = this.stage = new Stage(128, 512);\n\t\t\tif (typeof registerInspectorStage !== \"undefined\") {\n\t\t\t\tregisterInspectorStage(stage);\n\t\t\t}\n\n\t\t\tfunction updateStageBounds(node: any) {\n\t\t\t\tlet stageBounds = node.getBounds(true);\n\t\t\t\t// Easel stage is the root stage and is not scaled, our stage is so\n\t\t\t\t// we need to scale down.\n\t\t\t\tlet ratio = easelHost.easel.getRatio();\n\t\t\t\tstageBounds.scale(1 / ratio, 1 / ratio);\n\t\t\t\tstageBounds.snap();\n\t\t\t\tstage.setBounds(stageBounds);\n\t\t\t}\n\n\t\t\tupdateStageBounds(easelHost.stage);\n\t\t\teaselHost.stage.addEventListener(NodeEventType.OnStageBoundsChanged, updateStageBounds);\n\t\t\teaselHost.content = stage.content;\n\t\t\tif (transparent) {\n\t\t\t\tthis.stage.setFlags(NodeFlags.Transparent);\n\t\t\t}\n\t\t\troot.addChild(this.stage);\n\t\t\tthis._nodes = [];\n\t\t\tthis._assets = [];\n\n\t\t\tthis._easelHost = easelHost;\n\t\t\tthis._canvas = document.createElement(\"canvas\");\n\t\t\tthis._context = this._canvas.getContext(\"2d\");\n\t\t}\n\n\t\t_registerAsset(id: number, symbolId: number, asset: Renderable) {\n\t\t\tif (typeof registerInspectorAsset !== \"undefined\") {\n\t\t\t\tregisterInspectorAsset(id, symbolId, asset);\n\t\t\t}\n\t\t\tif (!release && this._assets[id]) {\n\t\t\t\tDebug.warning(\"Asset already exists: \" + id + \". old:\", this._assets[id], \"new: \" + asset);\n\t\t\t}\n\t\t\tthis._assets[id] = asset;\n\t\t}\n\n\t\t_makeNode(id: number): Node {\n\t\t\tif (id === -1) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tlet node = null;\n\t\t\tif (id & IDMask.Asset) {\n\t\t\t\tid &= ~IDMask.Asset;\n\t\t\t\tnode = this._assets[id].wrap();\n\t\t\t} else {\n\t\t\t\tnode = this._nodes[id];\n\t\t\t}\n\t\t\trelease || assert(node, \"Node \" + node + \" of \" + id + \" has not been sent yet.\");\n\t\t\treturn node;\n\t\t}\n\n\t\t_getAsset(id: number): Renderable {\n\t\t\treturn this._assets[id];\n\t\t}\n\n\t\t_getBitmapAsset(id: number): RenderableBitmap {\n\t\t\treturn <RenderableBitmap>this._assets[id];\n\t\t}\n\n\t\t_getVideoAsset(id: number): RenderableVideo {\n\t\t\treturn <RenderableVideo>this._assets[id];\n\t\t}\n\n\t\t_getTextAsset(id: number): RenderableText {\n\t\t\treturn <RenderableText>this._assets[id];\n\t\t}\n\n\t\tregisterFont(syncId: number, data: Uint8Array, resolve: (data: any) => void) {\n\t\t\tShumway.registerCSSFont(syncId, data, !inFirefox);\n\t\t\tif (inFirefox) {\n\t\t\t\tresolve(null);\n\t\t\t} else {\n\t\t\t\twindow.setTimeout(resolve, 400);\n\t\t\t}\n\t\t}\n\n\t\tregisterImage(syncId: number, symbolId: number, imageType: ImageType, data: Uint8Array,\n\t\t              alphaData: Uint8Array, resolve: (data: any) => void) {\n\t\t\tthis._registerAsset(syncId, symbolId, this._decodeImage(imageType, data, alphaData, resolve));\n\t\t}\n\n\t\tregisterVideo(syncId: number) {\n\t\t\tthis._registerAsset(syncId, 0, new RenderableVideo(syncId, this));\n\t\t}\n\n\t\t/**\n\t\t * Creates an Image element to decode JPG|PNG|GIF data passed in as a buffer.\n\t\t *\n\t\t * The resulting image is stored as the drawing source of a new RenderableBitmap, which is\n\t\t * returned.\n\t\t * Once the image is loaded, the RenderableBitmap's bounds are updated and the provided\n\t\t * oncomplete callback is invoked with the image dimensions.\n\t\t */\n\t\t_decodeImage(type: ImageType, data: Uint8Array, alphaData: Uint8Array, oncomplete: (data: any) => void) {\n\t\t\tlet image = new Image();\n\t\t\tlet asset = RenderableBitmap.FromImage(image, -1, -1);\n\t\t\timage.src = URL.createObjectURL(new Blob([data], {type: getMIMETypeForImageType(type)}));\n\t\t\timage.onload = function () {\n\t\t\t\trelease || assert(!asset.parent);\n\t\t\t\tasset.setBounds(new Rectangle(0, 0, image.width, image.height));\n\t\t\t\tif (alphaData) {\n\t\t\t\t\tasset.mask(alphaData);\n\t\t\t\t}\n\t\t\t\tasset.invalidate();\n\t\t\t\toncomplete({width: image.width, height: image.height});\n\t\t\t};\n\t\t\timage.onerror = function () {\n\t\t\t\toncomplete(null);\n\t\t\t};\n\t\t\treturn asset;\n\t\t}\n\n\t\tpublic sendVideoPlaybackEvent(assetId: number, eventType: VideoPlaybackEvent, data: any): void {\n\t\t\tthis._easelHost.sendVideoPlaybackEvent(assetId, eventType, data);\n\t\t}\n\t}\n\n\texport class GFXChannelDeserializer {\n\t\tinput: IDataInput;\n\t\tinputAssets: any[];\n\t\toutput: DataBuffer;\n\t\tcontext: GFXChannelDeserializerContext;\n\n\t\t/**\n\t\t * Used to avoid extra allocation, don't ever leak a reference to this object.\n\t\t */\n\t\tprivate static _temporaryReadMatrix: Matrix = Matrix.createIdentity();\n\n\t\t/**\n\t\t * Used to avoid extra allocation, don't ever leak a reference to this object.\n\t\t */\n\t\tprivate static _temporaryReadRectangle: Rectangle = Rectangle.createEmpty();\n\n\t\t/**\n\t\t * Used to avoid extra allocation, don't ever leak a reference to this object.\n\t\t */\n\t\tprivate static _temporaryReadColorMatrix: ColorMatrix = ColorMatrix.createIdentity();\n\t\tprivate static _temporaryReadColorMatrixIdentity: ColorMatrix = ColorMatrix.createIdentity();\n\n\t\tpublic read() {\n\t\t\tlet tag = 0;\n\t\t\tlet input = this.input;\n\n\t\t\tlet data = {\n\t\t\t\tbytesAvailable: input.bytesAvailable,\n\t\t\t\tupdateGraphics: 0,\n\t\t\t\tupdateBitmapData: 0,\n\t\t\t\tupdateTextContent: 0,\n\t\t\t\tupdateFrame: 0,\n\t\t\t\tupdateStage: 0,\n\t\t\t\tupdateCurrentMouseTarget: 0,\n\t\t\t\tupdateNetStream: 0,\n\t\t\t\tregisterFont: 0,\n\t\t\t\tdrawToBitmap: 0,\n\t\t\t\trequestBitmapData: 0,\n\t\t\t\tdecodeImage: 0\n\t\t\t};\n\t\t\tShumway.GFX.enterTimeline(\"GFXChannelDeserializer.read\", data);\n\t\t\twhile (input.bytesAvailable > 0) {\n\t\t\t\ttag = input.readInt();\n\t\t\t\tswitch (tag) {\n\t\t\t\t\tcase MessageTag.EOF:\n\t\t\t\t\t\tShumway.GFX.leaveTimeline(\"GFXChannelDeserializer.read\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase MessageTag.UpdateGraphics:\n\t\t\t\t\t\tdata.updateGraphics++;\n\t\t\t\t\t\tthis._readUpdateGraphics();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MessageTag.UpdateBitmapData:\n\t\t\t\t\t\tdata.updateBitmapData++;\n\t\t\t\t\t\tthis._readUpdateBitmapData();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MessageTag.UpdateTextContent:\n\t\t\t\t\t\tdata.updateTextContent++;\n\t\t\t\t\t\tthis._readUpdateTextContent();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MessageTag.UpdateFrame:\n\t\t\t\t\t\tdata.updateFrame++;\n\t\t\t\t\t\tthis._readUpdateFrame();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MessageTag.UpdateStage:\n\t\t\t\t\t\tdata.updateStage++;\n\t\t\t\t\t\tthis._readUpdateStage();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MessageTag.UpdateCurrentMouseTarget:\n\t\t\t\t\t\tdata.updateCurrentMouseTarget++;\n\t\t\t\t\t\tthis._readUpdateCurrentMouseTarget();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MessageTag.UpdateNetStream:\n\t\t\t\t\t\tdata.updateNetStream++;\n\t\t\t\t\t\tthis._readUpdateNetStream();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MessageTag.DrawToBitmap:\n\t\t\t\t\t\tdata.drawToBitmap++;\n\t\t\t\t\t\tthis._readDrawToBitmap();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MessageTag.RequestBitmapData:\n\t\t\t\t\t\tdata.requestBitmapData++;\n\t\t\t\t\t\tthis._readRequestBitmapData();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\trelease || assert(false, 'Unknown MessageReader tag: ' + tag);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tShumway.GFX.leaveTimeline(\"GFXChannelDeserializer.read\");\n\t\t}\n\n\t\tprivate _readMatrix(): Matrix {\n\t\t\tlet input = this.input;\n\t\t\tlet matrix = GFXChannelDeserializer._temporaryReadMatrix;\n\t\t\tlet a = 1, b = 0, c = 0, d = 1, tx = 0, ty = 0;\n\t\t\tswitch (input.readInt()) {\n\t\t\t\tcase MatrixEncoding.ScaleAndTranslationOnly:\n\t\t\t\t\ta = input.readFloat();\n\t\t\t\t\td = input.readFloat(); // Fallthrough\n\t\t\t\tcase MatrixEncoding.TranslationOnly:\n\t\t\t\t\ttx = input.readFloat() / 20;\n\t\t\t\t\tty = input.readFloat() / 20;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MatrixEncoding.UniformScaleAndTranslationOnly:\n\t\t\t\t\ta = d = input.readFloat();\n\t\t\t\t\ttx = input.readFloat() / 20;\n\t\t\t\t\tty = input.readFloat() / 20;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MatrixEncoding.All:\n\t\t\t\t\ta = input.readFloat();\n\t\t\t\t\tb = input.readFloat();\n\t\t\t\t\tc = input.readFloat();\n\t\t\t\t\td = input.readFloat();\n\t\t\t\t\ttx = input.readFloat() / 20;\n\t\t\t\t\tty = input.readFloat() / 20;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmatrix.setElements(a, b, c, d, tx, ty);\n\t\t\treturn matrix;\n\t\t}\n\n\t\tprivate _readRectangle(): Rectangle {\n\t\t\tlet input = this.input;\n\t\t\tlet rectangle = GFXChannelDeserializer._temporaryReadRectangle;\n\t\t\trectangle.setElements(\n\t\t\t\tinput.readInt() / 20,\n\t\t\t\tinput.readInt() / 20,\n\t\t\t\tinput.readInt() / 20,\n\t\t\t\tinput.readInt() / 20\n\t\t\t);\n\t\t\treturn rectangle;\n\t\t}\n\n\t\tprivate _readColorMatrix(): ColorMatrix {\n\t\t\tlet input = this.input;\n\t\t\tlet colorMatrix = GFXChannelDeserializer._temporaryReadColorMatrix;\n\t\t\tlet rm = 1, gm = 1, bm = 1, am = 1;\n\t\t\tlet ro = 0, go = 0, bo = 0, ao = 0;\n\t\t\tswitch (input.readInt()) {\n\t\t\t\tcase ColorTransformEncoding.Identity:\n\t\t\t\t\treturn GFXChannelDeserializer._temporaryReadColorMatrixIdentity;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ColorTransformEncoding.AlphaMultiplierOnly:\n\t\t\t\t\tam = input.readFloat();\n\t\t\t\t\tbreak;\n\t\t\t\tcase ColorTransformEncoding.AlphaMultiplierWithOffsets:\n\t\t\t\t\trm = 0;\n\t\t\t\t\tgm = 0;\n\t\t\t\t\tbm = 0;\n\t\t\t\t\tam = input.readFloat();\n\t\t\t\t\tro = input.readInt();\n\t\t\t\t\tgo = input.readInt();\n\t\t\t\t\tbo = input.readInt();\n\t\t\t\t\tao = input.readInt();\n\t\t\t\t\tbreak;\n\t\t\t\tcase ColorTransformEncoding.All:\n\t\t\t\t\trm = input.readFloat();\n\t\t\t\t\tgm = input.readFloat();\n\t\t\t\t\tbm = input.readFloat();\n\t\t\t\t\tam = input.readFloat();\n\t\t\t\t\tro = input.readInt();\n\t\t\t\t\tgo = input.readInt();\n\t\t\t\t\tbo = input.readInt();\n\t\t\t\t\tao = input.readInt();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcolorMatrix.setMultipliersAndOffsets(\n\t\t\t\trm, gm, bm, am,\n\t\t\t\tro, go, bo, ao\n\t\t\t);\n\t\t\treturn colorMatrix;\n\t\t}\n\n\t\tprivate _readAsset(): any {\n\t\t\tlet assetId = this.input.readInt();\n\t\t\tlet asset = this.inputAssets[assetId];\n\t\t\tthis.inputAssets[assetId] = null;\n\t\t\treturn asset;\n\t\t}\n\n\t\tprivate _readUpdateGraphics() {\n\t\t\tlet input = this.input;\n\t\t\tlet context = this.context;\n\t\t\tlet id = input.readInt();\n\t\t\tlet symbolId = input.readInt();\n\t\t\tlet asset = <RenderableShape>context._getAsset(id);\n\t\t\tlet bounds = this._readRectangle();\n\t\t\tlet pathData = ShapeData.FromPlainObject(this._readAsset());\n\t\t\tlet numTextures = input.readInt();\n\t\t\tlet textures = [];\n\t\t\tfor (let i = 0; i < numTextures; i++) {\n\t\t\t\tlet bitmapId = input.readInt();\n\t\t\t\ttextures.push(context._getBitmapAsset(bitmapId));\n\t\t\t}\n\t\t\tif (asset) {\n\t\t\t\tasset.update(pathData, textures, bounds);\n\t\t\t} else {\n\t\t\t\tlet renderable: RenderableShape;\n\t\t\t\tif (pathData.morphCoordinates) {\n\t\t\t\t\trenderable = new RenderableMorphShape(id, pathData, textures, bounds);\n\t\t\t\t} else {\n\t\t\t\t\trenderable = new RenderableShape(id, pathData, textures, bounds);\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < textures.length; i++) {\n\t\t\t\t\ttextures[i] && textures[i].addRenderableParent(renderable);\n\t\t\t\t}\n\t\t\t\tcontext._registerAsset(id, symbolId, renderable);\n\t\t\t}\n\t\t}\n\n\t\tprivate _readUpdateBitmapData() {\n\t\t\tlet input = this.input;\n\t\t\tlet context = this.context;\n\t\t\tlet id = input.readInt();\n\t\t\tlet symbolId = input.readInt();\n\t\t\tlet asset = context._getBitmapAsset(id);\n\t\t\tlet bounds = this._readRectangle();\n\t\t\tlet type: ImageType = input.readInt();\n\t\t\tlet dataBuffer = DataBuffer.FromPlainObject(this._readAsset());\n\t\t\tif (!asset) {\n\t\t\t\tasset = RenderableBitmap.FromDataBuffer(type, dataBuffer, bounds);\n\t\t\t\tcontext._registerAsset(id, symbolId, asset);\n\t\t\t} else {\n\t\t\t\tasset.updateFromDataBuffer(type, dataBuffer);\n\t\t\t}\n\t\t\tif (this.output) {\n\t\t\t\t// TODO: Write image data to output.\n\t\t\t}\n\t\t}\n\n\t\tprivate _readUpdateTextContent() {\n\t\t\tlet input = this.input;\n\t\t\tlet context = this.context;\n\t\t\tlet id = input.readInt();\n\t\t\tlet symbolId = input.readInt();\n\t\t\tlet asset = context._getTextAsset(id);\n\t\t\tlet bounds = this._readRectangle();\n\t\t\tlet matrix = this._readMatrix();\n\t\t\tlet backgroundColor = input.readInt();\n\t\t\tlet borderColor = input.readInt();\n\t\t\tlet autoSize = input.readInt();\n\t\t\tlet wordWrap = input.readBoolean();\n\t\t\tlet scrollV = input.readInt();\n\t\t\tlet scrollH = input.readInt();\n\t\t\tlet plainText = this._readAsset();\n\t\t\tlet textRunData = DataBuffer.FromPlainObject(this._readAsset());\n\t\t\tlet coords = null;\n\t\t\tlet numCoords = input.readInt();\n\t\t\tif (numCoords) {\n\t\t\t\tcoords = new DataBuffer(numCoords * 4);\n\t\t\t\tinput.readBytes(coords, 0, numCoords * 4);\n\t\t\t}\n\t\t\tif (!asset) {\n\t\t\t\tasset = new RenderableText(bounds);\n\t\t\t\tasset.setContent(plainText, textRunData, matrix, coords);\n\t\t\t\tasset.setStyle(backgroundColor, borderColor, scrollV, scrollH);\n\t\t\t\tasset.reflow(autoSize, wordWrap);\n\t\t\t\tcontext._registerAsset(id, symbolId, asset);\n\t\t\t} else {\n\t\t\t\tasset.setBounds(bounds);\n\t\t\t\tasset.setContent(plainText, textRunData, matrix, coords);\n\t\t\t\tasset.setStyle(backgroundColor, borderColor, scrollV, scrollH);\n\t\t\t\tasset.reflow(autoSize, wordWrap);\n\t\t\t}\n\t\t\tif (this.output) {\n\t\t\t\tlet rect = asset.textRect;\n\t\t\t\tthis.output.writeInt(rect.w * 20);\n\t\t\t\tthis.output.writeInt(rect.h * 20);\n\t\t\t\tthis.output.writeInt(rect.x * 20);\n\t\t\t\tlet lines = asset.lines;\n\t\t\t\tlet numLines = lines.length;\n\t\t\t\tthis.output.writeInt(numLines);\n\t\t\t\tfor (let i = 0; i < numLines; i++) {\n\t\t\t\t\tthis._writeLineMetrics(lines[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate _writeLineMetrics(line: Shumway.GFX.TextLine): void {\n\t\t\trelease || assert(this.output);\n\t\t\tthis.output.writeInt(line.x);\n\t\t\tthis.output.writeInt(line.width);\n\t\t\tthis.output.writeInt(line.ascent);\n\t\t\tthis.output.writeInt(line.descent);\n\t\t\tthis.output.writeInt(line.leading);\n\t\t}\n\n\t\tprivate _readUpdateStage() {\n\t\t\tlet context = this.context;\n\t\t\tlet id = this.input.readInt();\n\t\t\tif (!context._nodes[id]) {\n\t\t\t\tcontext._nodes[id] = context.stage.content;\n\t\t\t}\n\t\t\tlet color = this.input.readInt();\n\t\t\tlet bounds = this._readRectangle();\n\t\t\t// TODO: Need to updateContentMatrix on stage here.\n\t\t\tcontext.stage.content.setBounds(bounds);\n\t\t\tcontext.stage.color = Color.FromARGB(color);\n\t\t\tcontext.stage.align = this.input.readInt();\n\t\t\tcontext.stage.scaleMode = this.input.readInt();\n\t\t\tlet displayState = this.input.readInt();\n\t\t\tcontext._easelHost.fullscreen = displayState === 0 || displayState === 1;\n\t\t}\n\n\t\tprivate _readUpdateCurrentMouseTarget() {\n\t\t\tlet context = this.context;\n\t\t\tlet currentMouseTarget = this.input.readInt();\n\t\t\tlet cursor = this.input.readInt();\n\t\t\tcontext._easelHost.cursor = Shumway.UI.toCSSCursor(cursor);\n\t\t}\n\n\t\tprivate _readUpdateNetStream() {\n\t\t\tlet context = this.context;\n\t\t\tlet id = this.input.readInt();\n\t\t\tlet asset = context._getVideoAsset(id);\n\t\t\tlet rectangle = this._readRectangle();\n\t\t\tif (!asset) {\n\t\t\t\tcontext.registerVideo(id);\n\t\t\t\tasset = context._getVideoAsset(id);\n\t\t\t}\n\t\t\tasset.setBounds(rectangle);\n\t\t}\n\n\t\tprivate _readFilters(node: Node) {\n\t\t\tlet input = this.input;\n\t\t\tlet count = input.readInt();\n\t\t\tlet filters = [];\n\t\t\tif (count) {\n\t\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\t\tlet type: FilterType = input.readInt();\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase FilterType.Blur:\n\t\t\t\t\t\t\tfilters.push(new BlurFilter(\n\t\t\t\t\t\t\t\tinput.readFloat(), // blurX\n\t\t\t\t\t\t\t\tinput.readFloat(), // blurY\n\t\t\t\t\t\t\t\tinput.readInt()    // quality\n\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase FilterType.DropShadow:\n\t\t\t\t\t\t\tfilters.push(new DropshadowFilter(\n\t\t\t\t\t\t\t\tinput.readFloat(),   // alpha\n\t\t\t\t\t\t\t\tinput.readFloat(),   // angle\n\t\t\t\t\t\t\t\tinput.readFloat(),   // blurX\n\t\t\t\t\t\t\t\tinput.readFloat(),   // blurY\n\t\t\t\t\t\t\t\tinput.readInt(),     // color\n\t\t\t\t\t\t\t\tinput.readFloat(),   // distance\n\t\t\t\t\t\t\t\tinput.readBoolean(), // hideObject\n\t\t\t\t\t\t\t\tinput.readBoolean(), // inner\n\t\t\t\t\t\t\t\tinput.readBoolean(), // knockout\n\t\t\t\t\t\t\t\tinput.readInt(),     // quality\n\t\t\t\t\t\t\t\tinput.readFloat()    // strength\n\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase FilterType.ColorMatrix:\n\t\t\t\t\t\t\tlet matrix = new Float32Array(20);\n\t\t\t\t\t\t\tmatrix[0] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[4] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[8] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[12] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[16] = input.readFloat() / 255;\n\t\t\t\t\t\t\tmatrix[1] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[5] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[9] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[13] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[17] = input.readFloat() / 255;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tmatrix[2] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[6] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[10] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[14] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[18] = input.readFloat() / 255;\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tmatrix[3] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[7] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[11] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[15] = input.readFloat();\n\t\t\t\t\t\t\tmatrix[19] = input.readFloat() / 255;\n\t\t\t\t\t\t\tfilters.push(new ColorMatrix(matrix));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tShumway.Debug.somewhatImplemented(FilterType[type]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnode.getLayer().filters = filters;\n\t\t\t}\n\t\t}\n\n\t\tprivate _readUpdateFrame() {\n\t\t\tlet input = this.input;\n\t\t\tlet context = this.context;\n\t\t\tlet id = input.readInt();\n\t\t\tlet ratio = 0;\n\t\t\twriter && writer.writeLn(\"Receiving UpdateFrame: \" + id);\n\t\t\tlet node = context._nodes[id];\n\t\t\tif (!node) {\n\t\t\t\tnode = context._nodes[id] = new Group();\n\t\t\t}\n\t\t\tlet hasBits = input.readInt();\n\t\t\tif (hasBits & MessageBits.HasMatrix) {\n\t\t\t\tnode.getTransform().setMatrix(this._readMatrix());\n\t\t\t}\n\t\t\tif (hasBits & MessageBits.HasColorTransform) {\n\t\t\t\tnode.getTransform().setColorMatrix(this._readColorMatrix());\n\t\t\t}\n\t\t\tif (hasBits & MessageBits.HasMask) {\n\t\t\t\tlet maskId = input.readInt();\n\t\t\t\tnode.getLayer().mask = maskId >= 0 ? context._makeNode(maskId) : null;\n\t\t\t}\n\t\t\tif (hasBits & MessageBits.HasClip) {\n\t\t\t\tnode.clip = input.readInt();\n\t\t\t}\n\t\t\tif (hasBits & MessageBits.HasMiscellaneousProperties) {\n\t\t\t\tratio = input.readInt() / 0xffff;\n\t\t\t\trelease || assert(ratio >= 0 && ratio <= 1);\n\t\t\t\tnode.getLayer().blendMode = input.readInt();\n\t\t\t\tthis._readFilters(node);\n\t\t\t\tnode.toggleFlags(NodeFlags.Visible, input.readBoolean());\n\t\t\t\tnode.toggleFlags(NodeFlags.CacheAsBitmap, input.readBoolean());\n\t\t\t\tnode.toggleFlags(NodeFlags.PixelSnapping, !!input.readInt()); // TODO: support `auto`.\n\t\t\t\tnode.toggleFlags(NodeFlags.ImageSmoothing, !!input.readInt());\n\t\t\t}\n\t\t\tif (hasBits & MessageBits.HasChildren) {\n\t\t\t\tlet count = input.readInt();\n\t\t\t\tlet container = <Group>node;\n\t\t\t\tcontainer.clearChildren();\n\t\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\t\tlet childId = input.readInt();\n\t\t\t\t\tlet child = context._makeNode(childId);\n\t\t\t\t\trelease || assert(child, \"Child \" + childId + \" of \" + id + \" has not been sent yet.\");\n\t\t\t\t\tcontainer.addChild(child);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (ratio) {\n\t\t\t\tlet group = <Group>node;\n\t\t\t\tlet child = group.getChildren()[0];\n\t\t\t\tif (child instanceof Shape) {\n\t\t\t\t\tchild.ratio = ratio;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate _readDrawToBitmap() {\n\t\t\tlet input = this.input;\n\t\t\tlet context = this.context;\n\t\t\tlet targetId = input.readInt();\n\t\t\tlet sourceId = input.readInt();\n\t\t\tlet hasBits = input.readInt();\n\t\t\tlet matrix;\n\t\t\tlet colorMatrix;\n\t\t\tlet clipRect;\n\t\t\tif (hasBits & MessageBits.HasMatrix) {\n\t\t\t\tmatrix = this._readMatrix().clone();\n\t\t\t} else {\n\t\t\t\tmatrix = Matrix.createIdentity();\n\t\t\t}\n\t\t\tif (hasBits & MessageBits.HasColorTransform) {\n\t\t\t\tcolorMatrix = this._readColorMatrix();\n\t\t\t}\n\t\t\tif (hasBits & MessageBits.HasClipRect) {\n\t\t\t\tclipRect = this._readRectangle();\n\t\t\t}\n\t\t\tlet blendMode = input.readInt();\n\t\t\tinput.readBoolean(); // Smoothing\n\t\t\tlet target = context._getBitmapAsset(targetId);\n\t\t\tlet source = context._makeNode(sourceId);\n\t\t\tif (!target) {\n\t\t\t\tcontext._registerAsset(targetId, -1, RenderableBitmap.FromNode(source, matrix, colorMatrix, blendMode, clipRect));\n\t\t\t} else {\n\t\t\t\ttarget.drawNode(source, matrix, colorMatrix, blendMode, clipRect);\n\t\t\t}\n\t\t}\n\n\t\tprivate _readRequestBitmapData() {\n\t\t\tlet input = this.input;\n\t\t\tlet output = this.output;\n\t\t\tlet context = this.context;\n\t\t\tlet id = input.readInt();\n\t\t\tlet renderableBitmap = context._getBitmapAsset(id);\n\t\t\trenderableBitmap.readImageData(output);\n\t\t}\n\t}\n}\n","/**\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.GFX {\n\timport Easel = Shumway.GFX.Easel;\n\timport Stage = Shumway.GFX.Stage;\n\timport Point = Shumway.GFX.Geometry.Point;\n\timport Rectangle = Geometry.Rectangle;\n\n\timport DataBuffer = Shumway.ArrayUtilities.DataBuffer;\n\timport VideoControlEvent = Shumway.Remoting.VideoControlEvent;\n\timport VideoPlaybackEvent = Shumway.Remoting.VideoPlaybackEvent;\n\timport DisplayParameters = Shumway.Remoting.DisplayParameters;\n\n\t// Set to -1 to enable events for right button.\n\texport let ContextMenuButton = 2;\n\n\texport class EaselHost {\n\t\tprivate static _mouseEvents = Shumway.Remoting.MouseEventNames;\n\t\tprivate static _keyboardEvents = Shumway.Remoting.KeyboardEventNames;\n\n\t\tprivate _easel: Easel;\n\t\tprivate _group: Group;\n\t\tprivate _context: Shumway.Remoting.GFX.GFXChannelDeserializerContext;\n\t\tprivate _content: Group;\n\t\tprivate _fullscreen: boolean;\n\n\t\tconstructor(easel: Easel) {\n\t\t\tthis._easel = easel;\n\t\t\tlet group = easel.world;\n\t\t\tlet transparent = easel.transparent;\n\t\t\tthis._group = group;\n\t\t\tthis._content = null;\n\t\t\tthis._fullscreen = false;\n\t\t\tthis._context = new Shumway.Remoting.GFX.GFXChannelDeserializerContext(this, this._group, transparent);\n\t\t\tthis._addEventListeners();\n\t\t\tregisterFallbackFont();\n\t\t}\n\n\t\tonSendUpdates(update: DataBuffer, asssets: Array<DataBuffer>) {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tget easel(): Easel {\n\t\t\treturn this._easel;\n\t\t}\n\n\t\tget stage(): Stage {\n\t\t\treturn this._easel.stage;\n\t\t}\n\n\t\tset content(value: Group) {\n\t\t\tthis._content = value;\n\t\t}\n\n\t\tset cursor(cursor: string) {\n\t\t\tthis._easel.cursor = cursor;\n\t\t}\n\n\t\tset fullscreen(value: boolean) {\n\t\t\tif (this._fullscreen !== value) {\n\t\t\t\tthis._fullscreen = value;\n\t\t\t\t// TODO refactor to have a normal two-way communication service/api\n\t\t\t\t// HACK for now\n\t\t\t\tif (typeof ShumwayCom !== 'undefined' && ShumwayCom.setFullscreen) {\n\t\t\t\t\tShumwayCom.setFullscreen(value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate _mouseEventListener(event: MouseEvent) {\n\t\t\tif (event.button === ContextMenuButton) {\n\t\t\t\t// Disable all events for right button -- usually it triggers context menu.\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// let position = this._easel.getMouseWorldPosition(event);\n\t\t\tlet position = this._easel.getMousePosition(event, this._content);\n\t\t\tlet point = new Point(position.x, position.y);\n\n\t\t\tlet buffer = new DataBuffer();\n\t\t\tlet serializer = new Shumway.Remoting.GFX.GFXChannelSerializer();\n\t\t\tserializer.output = buffer;\n\t\t\tserializer.writeMouseEvent(event, point);\n\t\t\tthis.onSendUpdates(buffer, []);\n\t\t}\n\n\t\tprivate _keyboardEventListener(event: KeyboardEvent) {\n\t\t\tlet buffer = new DataBuffer();\n\t\t\tlet serializer = new Shumway.Remoting.GFX.GFXChannelSerializer();\n\t\t\tserializer.output = buffer;\n\t\t\tserializer.writeKeyboardEvent(event);\n\t\t\tthis.onSendUpdates(buffer, []);\n\t\t}\n\n\t\t_addEventListeners() {\n\t\t\tlet mouseEventListener = this._mouseEventListener.bind(this);\n\t\t\tlet keyboardEventListener = this._keyboardEventListener.bind(this);\n\t\t\tlet mouseEvents = EaselHost._mouseEvents;\n\t\t\tfor (let i = 0; i < mouseEvents.length; i++) {\n\t\t\t\twindow.addEventListener(mouseEvents[i], mouseEventListener);\n\t\t\t}\n\t\t\tlet keyboardEvents = EaselHost._keyboardEvents;\n\t\t\tfor (let i = 0; i < keyboardEvents.length; i++) {\n\t\t\t\twindow.addEventListener(keyboardEvents[i], keyboardEventListener);\n\t\t\t}\n\t\t\tthis._addFocusEventListeners();\n\n\t\t\tthis._easel.addEventListener('resize', this._resizeEventListener.bind(this));\n\t\t}\n\n\t\tprivate _sendFocusEvent(type: Shumway.Remoting.FocusEventType) {\n\t\t\tlet buffer = new DataBuffer();\n\t\t\tlet serializer = new Shumway.Remoting.GFX.GFXChannelSerializer();\n\t\t\tserializer.output = buffer;\n\t\t\tserializer.writeFocusEvent(type);\n\t\t\tthis.onSendUpdates(buffer, []);\n\t\t}\n\n\t\tprivate _addFocusEventListeners() {\n\t\t\tlet self = this;\n\t\t\tdocument.addEventListener('visibilitychange', function (event) {\n\t\t\t\tself._sendFocusEvent(document.hidden ?\n\t\t\t\t\tShumway.Remoting.FocusEventType.DocumentHidden :\n\t\t\t\t\tShumway.Remoting.FocusEventType.DocumentVisible);\n\t\t\t});\n\t\t\twindow.addEventListener('focus', function (event) {\n\t\t\t\tself._sendFocusEvent(Shumway.Remoting.FocusEventType.WindowFocus);\n\t\t\t});\n\t\t\twindow.addEventListener('blur', function (event) {\n\t\t\t\tself._sendFocusEvent(Shumway.Remoting.FocusEventType.WindowBlur);\n\t\t\t});\n\t\t}\n\n\t\tprivate _resizeEventListener() {\n\t\t\tthis.onDisplayParameters(this._easel.getDisplayParameters());\n\t\t}\n\n\t\tonDisplayParameters(params: DisplayParameters) {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tprocessUpdates(updates: DataBuffer, assets: Array<DataBuffer>, output: DataBuffer = null) {\n\t\t\tlet deserializer = new Shumway.Remoting.GFX.GFXChannelDeserializer();\n\t\t\tdeserializer.input = updates;\n\t\t\tdeserializer.inputAssets = assets;\n\t\t\tdeserializer.output = output;\n\t\t\tdeserializer.context = this._context;\n\t\t\tdeserializer.read();\n\t\t}\n\n\t\tprocessVideoControl(id: number, eventType: VideoControlEvent, data: any): any {\n\t\t\tlet context = this._context;\n\t\t\tlet asset = context._getVideoAsset(id);\n\t\t\tif (!asset) {\n\t\t\t\tif (eventType !== VideoControlEvent.Init) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\tcontext.registerVideo(id);\n\t\t\t\tasset = context._getVideoAsset(id);\n\t\t\t}\n\t\t\treturn (<RenderableVideo>asset).processControlRequest(eventType, data);\n\t\t}\n\n\t\tprocessRegisterFont(syncId: number, data: Uint8Array, resolve: (data: any) => void) {\n\t\t\tthis._context.registerFont(syncId, data, resolve);\n\t\t}\n\n\t\tprocessRegisterImage(syncId: number, symbolId: number, imageType: ImageType, data: Uint8Array,\n\t\t                     alphaData: Uint8Array, resolve: (data: any) => void) {\n\t\t\tthis._context.registerImage(syncId, symbolId, imageType, data, alphaData, resolve);\n\t\t}\n\n\t\tprocessFSCommand(command: string, args: string) {\n\t\t\tif (typeof ShumwayCom !== 'undefined' && ShumwayCom.environment === ShumwayEnvironment.TEST) {\n\t\t\t\tShumwayCom.processFSCommand(command, args);\n\t\t\t}\n\t\t}\n\n\t\tprocessFrame() {\n\t\t\tif (typeof ShumwayCom !== 'undefined' && ShumwayCom.environment === ShumwayEnvironment.TEST) {\n\t\t\t\tShumwayCom.processFrame();\n\t\t\t}\n\t\t}\n\n\t\tonVideoPlaybackEvent(id: number, eventType: VideoPlaybackEvent, data: any) {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tsendVideoPlaybackEvent(id: number, eventType: VideoPlaybackEvent, data: any) {\n\t\t\tthis.onVideoPlaybackEvent(id, eventType, data);\n\t\t}\n\t}\n}\n","/**\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.GFX.Window {\n\timport Easel = Shumway.GFX.Easel;\n\timport DataBuffer = Shumway.ArrayUtilities.DataBuffer;\n\n\timport CircularBuffer = Shumway.CircularBuffer;\n\n\timport VideoPlaybackEvent = Shumway.Remoting.VideoPlaybackEvent;\n\timport DisplayParameters = Shumway.Remoting.DisplayParameters;\n\n\texport class WindowEaselHost extends EaselHost {\n\t\tprivate _peer: Shumway.Remoting.ITransportPeer;\n\n\t\tpublic constructor(easel: Easel, peer: Shumway.Remoting.ITransportPeer) {\n\t\t\tsuper(easel);\n\t\t\tthis._peer = peer;\n\t\t\tthis._peer.onSyncMessage = function (msg: any) {\n\t\t\t\treturn this._onWindowMessage(msg, false);\n\t\t\t}.bind(this);\n\t\t\tthis._peer.onAsyncMessage = function (msg: any) {\n\t\t\t\tthis._onWindowMessage(msg, true);\n\t\t\t}.bind(this);\n\t\t}\n\n\t\tonSendUpdates(updates: DataBuffer, assets: Array<DataBuffer>) {\n\t\t\tlet bytes = updates.getBytes();\n\t\t\tthis._peer.postAsyncMessage({\n\t\t\t\ttype: 'gfx',\n\t\t\t\tupdates: bytes,\n\t\t\t\tassets: assets\n\t\t\t}, [bytes.buffer]);\n\t\t}\n\n\t\tonDisplayParameters(params: DisplayParameters) {\n\t\t\tthis._peer.postAsyncMessage({\n\t\t\t\ttype: 'displayParameters',\n\t\t\t\tparams: params\n\t\t\t});\n\t\t}\n\n\t\tonVideoPlaybackEvent(id: number, eventType: VideoPlaybackEvent, data: any) {\n\t\t\tthis._peer.postAsyncMessage({\n\t\t\t\ttype: 'videoPlayback',\n\t\t\t\tid: id,\n\t\t\t\teventType: eventType,\n\t\t\t\tdata: data\n\t\t\t});\n\t\t}\n\n\t\tprivate _sendRegisterFontResponse(requestId: number, result: any) {\n\t\t\tthis._peer.postAsyncMessage({\n\t\t\t\ttype: 'registerFontResponse',\n\t\t\t\trequestId: requestId,\n\t\t\t\tresult: result\n\t\t\t});\n\t\t}\n\n\t\tprivate _sendRegisterImageResponse(requestId: number, result: any) {\n\t\t\tthis._peer.postAsyncMessage({\n\t\t\t\ttype: 'registerImageResponse',\n\t\t\t\trequestId: requestId,\n\t\t\t\tresult: result\n\t\t\t});\n\t\t}\n\n\t\t_onWindowMessage(data: any, async: boolean): any {\n\t\t\tlet result;\n\t\t\tif (typeof data === 'object' && data !== null) {\n\t\t\t\tif (data.type === 'player') {\n\t\t\t\t\tlet updates = DataBuffer.FromArrayBuffer(data.updates.buffer);\n\t\t\t\t\tif (async) {\n\t\t\t\t\t\tthis.processUpdates(updates, data.assets);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet output = new DataBuffer();\n\t\t\t\t\t\tthis.processUpdates(updates, data.assets, output);\n\t\t\t\t\t\tresult = output.toPlainObject();\n\t\t\t\t\t}\n\t\t\t\t} else if (data.type === 'frame') {\n\t\t\t\t\tthis.processFrame();\n\t\t\t\t} else if (data.type === 'videoControl') {\n\t\t\t\t\tresult = this.processVideoControl(data.id, data.eventType, data.data);\n\t\t\t\t} else if (data.type === 'registerFont') {\n\t\t\t\t\tthis.processRegisterFont(data.syncId, data.data,\n\t\t\t\t\t\tthis._sendRegisterFontResponse.bind(this, data.requestId));\n\t\t\t\t} else if (data.type === 'registerImage') {\n\t\t\t\t\tthis.processRegisterImage(data.syncId, data.symbolId, data.imageType, data.data, data.alphaData,\n\t\t\t\t\t\tthis._sendRegisterImageResponse.bind(this, data.requestId));\n\t\t\t\t} else if (data.type === 'fscommand') {\n\t\t\t\t\tthis.processFSCommand(data.command, data.args);\n\t\t\t\t} else {\n\t\t\t\t\t// release || Debug.assertUnreachable(\"Unhandled remoting event \" + data.type);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n}\n","/**\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.GFX.Test {\n\timport DataBuffer = Shumway.ArrayUtilities.DataBuffer;\n\timport PlainObjectDataBuffer = Shumway.ArrayUtilities.PlainObjectDataBuffer;\n\n\tenum MovieRecordObjectType {\n\t\tUndefined = 0,\n\t\tNull = 1,\n\t\tTrue = 2,\n\t\tFalse = 3,\n\t\tNumber = 4,\n\t\tString = 5,\n\t\tArray = 6,\n\t\tObject = 7,\n\t\tArrayBuffer = 8,\n\t\tUint8Array = 9,\n\t\tPlainObjectDataBufferLE = 10,\n\t\tPlainObjectDataBufferBE = 11,\n\t\tInt32Array = 12,\n\t}\n\n\tfunction writeUint8Array(buffer: any, data: any) {\n\t\tbuffer.writeInt(data.length);\n\t\tbuffer.writeRawBytes(data);\n\t}\n\n\t// Borrowed from other frame typed arrays does not match current global\n\t// objects, so instanceof does not work.\n\tfunction isInstanceOfTypedArray(obj: any, name: string): boolean {\n\t\treturn ('byteLength' in obj) &&\n\t\t\t('buffer' in obj) &&\n\t\t\t(obj.constructor && obj.constructor.name) === name;\n\t}\n\n\tfunction isInstanceOfArrayBuffer(obj: any): boolean {\n\t\treturn ('byteLength' in obj) &&\n\t\t\t(obj.constructor && obj.constructor.name) === 'ArrayBuffer';\n\t}\n\n\tfunction serializeObj(obj: any) {\n\t\tfunction serialize(item: any) {\n\t\t\tswitch (typeof item) {\n\t\t\t\tcase 'undefined':\n\t\t\t\t\tbuffer.writeByte(MovieRecordObjectType.Undefined);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tbuffer.writeByte(item ? MovieRecordObjectType.True : MovieRecordObjectType.False);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'number':\n\t\t\t\t\tbuffer.writeByte(MovieRecordObjectType.Number);\n\t\t\t\t\tbuffer.writeDouble(item);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'string':\n\t\t\t\t\tbuffer.writeByte(MovieRecordObjectType.String);\n\t\t\t\t\tbuffer.writeUTF(item);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: // 'object'\n\t\t\t\t\tif (item === null) {\n\t\t\t\t\t\tbuffer.writeByte(MovieRecordObjectType.Null);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Array.isArray(item)) {\n\t\t\t\t\t\tbuffer.writeByte(MovieRecordObjectType.Array);\n\t\t\t\t\t\tbuffer.writeInt(item.length);\n\t\t\t\t\t\tfor (let i = 0; i < item.length; i++) {\n\t\t\t\t\t\t\tserialize(item[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isInstanceOfTypedArray(item, 'Uint8Array')) {\n\t\t\t\t\t\tbuffer.writeByte(MovieRecordObjectType.Uint8Array);\n\t\t\t\t\t\twriteUint8Array(buffer, item);\n\t\t\t\t\t} else if (('length' in item) && ('buffer' in item) && ('littleEndian' in item)) {\n\t\t\t\t\t\tbuffer.writeByte(item.littleEndian ?\n\t\t\t\t\t\t\tMovieRecordObjectType.PlainObjectDataBufferLE :\n\t\t\t\t\t\t\tMovieRecordObjectType.PlainObjectDataBufferBE);\n\t\t\t\t\t\twriteUint8Array(buffer, new Uint8Array(item.buffer, 0, item.length));\n\t\t\t\t\t} else if (isInstanceOfArrayBuffer(item)) {\n\t\t\t\t\t\tbuffer.writeByte(MovieRecordObjectType.ArrayBuffer);\n\t\t\t\t\t\twriteUint8Array(buffer, new Uint8Array(item));\n\t\t\t\t\t} else if (isInstanceOfTypedArray(item, 'Int32Array')) {\n\t\t\t\t\t\tbuffer.writeByte(MovieRecordObjectType.Int32Array);\n\t\t\t\t\t\twriteUint8Array(buffer, new Uint8Array(item.buffer, item.byteOffset, item.byteLength));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!isNullOrUndefined(item.buffer) &&\n\t\t\t\t\t\t\tisInstanceOfArrayBuffer(item.buffer) &&\n\t\t\t\t\t\t\t(typeof item.byteOffset === 'number')) {\n\t\t\t\t\t\t\tthrow new Error('Some unsupported TypedArray is used')\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbuffer.writeByte(MovieRecordObjectType.Object);\n\t\t\t\t\t\tfor (let key in item) {\n\t\t\t\t\t\t\tbuffer.writeUTF(key);\n\t\t\t\t\t\t\tserialize(item[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbuffer.writeUTF('');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet buffer = new DataBuffer();\n\t\tserialize(obj);\n\t\treturn buffer.getBytes();\n\t}\n\n\texport const enum MovieRecordType {\n\t\tNone = 0,\n\t\tPlayerCommand = 1,\n\t\tPlayerCommandAsync = 2,\n\t\tFrame = 3,\n\t\tFont = 4,\n\t\tImage = 5,\n\t\tFSCommand = 6\n\t}\n\n\texport class MovieRecorder {\n\t\tprivate _recording: DataBuffer;\n\t\tprivate _recordingStarted: number;\n\t\tprivate _stopped: boolean;\n\t\tprivate _maxRecordingSize: number;\n\n\t\tpublic constructor(maxRecordingSize: number) {\n\t\t\tthis._maxRecordingSize = maxRecordingSize;\n\t\t\tthis._recording = new DataBuffer();\n\t\t\tthis._recordingStarted = 0;\n\t\t\tthis._recording.writeRawBytes(new Uint8Array([0x4D, 0x53, 0x57, 0x46]));\n\t\t\tthis._stopped = false;\n\t\t}\n\n\t\tpublic stop() {\n\t\t\tthis._stopped = true;\n\t\t}\n\n\t\tpublic getRecording(): Blob {\n\t\t\treturn new Blob([this._recording.getBytes()], {type: 'application/octet-stream'});\n\t\t}\n\n\t\tpublic dump() {\n\t\t\tlet parser = new MovieRecordParser(this._recording.getBytes());\n\t\t\tparser.dump();\n\t\t}\n\n\t\tprivate _createRecord(type: MovieRecordType, buffer: DataBuffer) {\n\t\t\tif (this._stopped) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._recording.length + 8 + (buffer ? buffer.length : 0) >= this._maxRecordingSize) {\n\t\t\t\tconsole.error('Recording limit reached');\n\t\t\t\tthis._stopped = true;\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (this._recordingStarted === 0) {\n\t\t\t\tthis._recordingStarted = Date.now();\n\t\t\t\tthis._recording.writeInt(0);\n\t\t\t} else {\n\t\t\t\tthis._recording.writeInt(Date.now() - this._recordingStarted);\n\t\t\t}\n\n\t\t\tthis._recording.writeInt(type);\n\t\t\tif (buffer !== null) {\n\t\t\t\tthis._recording.writeInt(buffer.length);\n\t\t\t\tthis._recording.writeRawBytes(buffer.getBytes());\n\t\t\t} else {\n\t\t\t\tthis._recording.writeInt(0);\n\t\t\t}\n\t\t}\n\n\t\tpublic recordPlayerCommand(async: boolean, updates: Uint8Array, assets: any[]) {\n\t\t\tlet buffer = new DataBuffer();\n\t\t\twriteUint8Array(buffer, updates);\n\n\t\t\tbuffer.writeInt(assets.length);\n\t\t\tassets.forEach(function (a) {\n\t\t\t\tlet data = serializeObj(a);\n\t\t\t\twriteUint8Array(buffer, data);\n\t\t\t});\n\t\t\tthis._createRecord(async ? MovieRecordType.PlayerCommandAsync : MovieRecordType.PlayerCommand, buffer);\n\t\t}\n\n\t\tpublic recordFrame() {\n\t\t\tthis._createRecord(MovieRecordType.Frame, null);\n\t\t}\n\n\t\tpublic recordFont(syncId: number, data: Uint8Array) {\n\t\t\tlet buffer = new DataBuffer();\n\t\t\tbuffer.writeInt(syncId);\n\t\t\twriteUint8Array(buffer, serializeObj(data));\n\t\t\tthis._createRecord(MovieRecordType.Font, buffer);\n\t\t}\n\n\t\tpublic recordImage(syncId: number, symbolId: number, imageType: ImageType,\n\t\t                   data: Uint8Array, alphaData: Uint8Array) {\n\t\t\tlet buffer = new DataBuffer();\n\t\t\tbuffer.writeInt(syncId);\n\t\t\tbuffer.writeInt(symbolId);\n\t\t\tbuffer.writeInt(imageType);\n\t\t\twriteUint8Array(buffer, serializeObj(data));\n\t\t\twriteUint8Array(buffer, serializeObj(alphaData));\n\t\t\tthis._createRecord(MovieRecordType.Image, buffer);\n\t\t}\n\n\t\tpublic recordFSCommand(command: string, args: string) {\n\t\t\tlet buffer = new DataBuffer();\n\t\t\tbuffer.writeUTF(command);\n\t\t\tbuffer.writeUTF(args || '');\n\t\t\tthis._createRecord(MovieRecordType.FSCommand, buffer);\n\t\t}\n\t}\n\n\tfunction readUint8Array(buffer: DataBuffer): Uint8Array {\n\t\tlet data = new DataBuffer();\n\t\tlet length = buffer.readInt();\n\t\tbuffer.readBytes(data, 0, length);\n\t\treturn data.getBytes();\n\t}\n\n\tfunction deserializeObj(source: DataBuffer) {\n\t\tlet buffer = new DataBuffer();\n\t\tlet length = source.readInt();\n\t\tsource.readBytes(buffer, 0, length);\n\t\treturn deserializeObjImpl(buffer);\n\t}\n\n\tfunction deserializeObjImpl(buffer: DataBuffer): any {\n\t\tlet type: MovieRecordObjectType = buffer.readByte();\n\t\tswitch (type) {\n\t\t\tcase MovieRecordObjectType.Undefined:\n\t\t\t\treturn undefined;\n\t\t\tcase MovieRecordObjectType.Null:\n\t\t\t\treturn null;\n\t\t\tcase MovieRecordObjectType.True:\n\t\t\t\treturn true;\n\t\t\tcase MovieRecordObjectType.False:\n\t\t\t\treturn false;\n\t\t\tcase MovieRecordObjectType.Number:\n\t\t\t\treturn buffer.readDouble();\n\t\t\tcase MovieRecordObjectType.String:\n\t\t\t\treturn buffer.readUTF();\n\t\t\tcase MovieRecordObjectType.Array:\n\t\t\t\tlet arr = [];\n\t\t\t\tlet length = buffer.readInt();\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tarr[i] = deserializeObjImpl(buffer);\n\t\t\t\t}\n\t\t\t\treturn arr;\n\t\t\tcase MovieRecordObjectType.Object:\n\t\t\t\tlet obj: any = {};\n\t\t\t\tlet key;\n\t\t\t\twhile ((key = buffer.readUTF())) {\n\t\t\t\t\tobj[key] = deserializeObjImpl(buffer);\n\t\t\t\t}\n\t\t\t\treturn obj;\n\t\t\tcase MovieRecordObjectType.ArrayBuffer:\n\t\t\t\treturn readUint8Array(buffer).buffer;\n\t\t\tcase MovieRecordObjectType.Uint8Array:\n\t\t\t\treturn readUint8Array(buffer);\n\t\t\tcase MovieRecordObjectType.PlainObjectDataBufferBE:\n\t\t\tcase MovieRecordObjectType.PlainObjectDataBufferLE:\n\t\t\t\tlet data = readUint8Array(buffer);\n\t\t\t\treturn new PlainObjectDataBuffer(data.buffer, data.length,\n\t\t\t\t\ttype === MovieRecordObjectType.PlainObjectDataBufferLE);\n\t\t\tcase MovieRecordObjectType.Int32Array:\n\t\t\t\treturn new Int32Array(readUint8Array(buffer).buffer);\n\t\t\tdefault:\n\t\t\t\trelease || Debug.assert(false);\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n\n\texport class MovieRecordParser {\n\t\tprivate _buffer: DataBuffer;\n\n\t\tpublic currentTimestamp: number;\n\t\tpublic currentType: MovieRecordType;\n\t\tpublic currentData: DataBuffer;\n\n\t\tconstructor(data: Uint8Array) {\n\t\t\tthis._buffer = new DataBuffer();\n\t\t\tthis._buffer.writeRawBytes(data);\n\t\t\tthis._buffer.position = 4;\n\t\t}\n\n\t\tpublic readNextRecord(): MovieRecordType {\n\t\t\tif (this._buffer.position >= this._buffer.length) {\n\t\t\t\treturn MovieRecordType.None;\n\t\t\t}\n\t\t\tlet timestamp: number = this._buffer.readInt();\n\t\t\tlet type: MovieRecordType = this._buffer.readInt();\n\t\t\tlet length: number = this._buffer.readInt();\n\t\t\tlet data: DataBuffer = null;\n\n\t\t\tif (length > 0) {\n\t\t\t\tdata = new DataBuffer();\n\t\t\t\tthis._buffer.readBytes(data, 0, length);\n\t\t\t}\n\n\t\t\tthis.currentTimestamp = timestamp;\n\t\t\tthis.currentType = type;\n\t\t\tthis.currentData = data;\n\n\t\t\treturn type;\n\t\t}\n\n\t\tpublic parsePlayerCommand(): any {\n\t\t\tlet updates = readUint8Array(this.currentData);\n\t\t\tlet assetsLength = this.currentData.readInt();\n\t\t\tlet assets = [];\n\t\t\tfor (let i = 0; i < assetsLength; i++) {\n\t\t\t\tassets.push(deserializeObj(this.currentData));\n\t\t\t}\n\t\t\treturn {updates: updates, assets: assets};\n\t\t}\n\n\t\tpublic parseFSCommand(): any {\n\t\t\tlet command = this.currentData.readUTF();\n\t\t\tlet args = this.currentData.readUTF();\n\t\t\treturn {command: command, args: args};\n\t\t}\n\n\t\tpublic parseFont(): any {\n\t\t\tlet syncId = this.currentData.readInt();\n\t\t\tlet data = deserializeObj(this.currentData);\n\t\t\treturn {syncId: syncId, data: data};\n\t\t}\n\n\t\tpublic parseImage(): any {\n\t\t\tlet syncId = this.currentData.readInt();\n\t\t\tlet symbolId = this.currentData.readInt();\n\t\t\tlet imageType = this.currentData.readInt();\n\t\t\tlet data = deserializeObj(this.currentData);\n\t\t\tlet alphaData = deserializeObj(this.currentData);\n\t\t\treturn {syncId: syncId, symbolId: symbolId, imageType: imageType, data: data, alphaData: alphaData};\n\t\t}\n\n\t\tpublic dump() {\n\t\t\tlet type: MovieRecordType;\n\t\t\twhile ((type = this.readNextRecord())) {\n\t\t\t\tconsole.log('record ' + type + ' @' + this.currentTimestamp);\n\t\t\t\tswitch (type) {\n\t\t\t\t\tcase MovieRecordType.PlayerCommand:\n\t\t\t\t\tcase MovieRecordType.PlayerCommandAsync:\n\t\t\t\t\t\tconsole.log(this.parsePlayerCommand());\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MovieRecordType.FSCommand:\n\t\t\t\t\t\tconsole.log(this.parseFSCommand());\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MovieRecordType.Font:\n\t\t\t\t\t\tconsole.log(this.parseFont());\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MovieRecordType.Image:\n\t\t\t\t\t\tconsole.log(this.parseImage());\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","/**\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.GFX.Test {\n\timport Easel = Shumway.GFX.Easel;\n\timport DataBuffer = Shumway.ArrayUtilities.DataBuffer;\n\n\timport CircularBuffer = Shumway.CircularBuffer;\n\n\timport VideoPlaybackEvent = Shumway.Remoting.VideoPlaybackEvent;\n\timport DisplayParameters = Shumway.Remoting.DisplayParameters;\n\n\tlet MINIMAL_TIMER_INTERVAL = 5;\n\n\texport class PlaybackEaselHost extends EaselHost {\n\t\tprivate _parser: MovieRecordParser;\n\t\tprivate _lastTimestamp: number;\n\n\t\tpublic ignoreTimestamps: boolean = false;\n\t\tpublic alwaysRenderFrame: boolean = false;\n\t\tpublic cpuTimeUpdates: number = 0;\n\t\tpublic cpuTimeRendering: number = 0;\n\n\t\tpublic onComplete: () => void = null;\n\n\t\tpublic constructor(easel: Easel) {\n\t\t\tsuper(easel);\n\t\t}\n\n\t\tpublic get cpuTime(): number {\n\t\t\treturn this.cpuTimeUpdates + this.cpuTimeRendering;\n\t\t}\n\n\t\tprivate playUrl(url: string) {\n\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\txhr.open('GET', url, true);\n\t\t\txhr.responseType = 'arraybuffer';\n\t\t\txhr.onload = function () {\n\t\t\t\tthis.playBytes(new Uint8Array(xhr.response));\n\t\t\t}.bind(this);\n\t\t\txhr.send();\n\t\t}\n\n\t\tprivate playBytes(data: Uint8Array) {\n\t\t\tthis._parser = new MovieRecordParser(data);\n\t\t\tthis._lastTimestamp = 0;\n\t\t\tthis._parseNext();\n\t\t}\n\n\t\tonSendUpdates(updates: DataBuffer, assets: Array<DataBuffer>) {\n\t\t\t// Ignoring\n\t\t}\n\n\t\tonDisplayParameters(params: DisplayParameters) {\n\t\t\t// Ignoring\n\t\t}\n\n\t\tonVideoPlaybackEvent(id: number, eventType: VideoPlaybackEvent, data: any) {\n\t\t\t// Ignoring\n\t\t}\n\n\t\tprivate _parseNext() {\n\t\t\tlet type = this._parser.readNextRecord();\n\t\t\tif (type !== MovieRecordType.None) {\n\t\t\t\tlet runRecordBound = this._runRecord.bind(this);\n\t\t\t\tlet interval = this._parser.currentTimestamp - this._lastTimestamp;\n\t\t\t\tthis._lastTimestamp = this._parser.currentTimestamp;\n\t\t\t\tif (interval < MINIMAL_TIMER_INTERVAL) {\n\t\t\t\t\t// Records are too close to each other, running on next script turn.\n\t\t\t\t\tPromise.resolve(undefined).then(runRecordBound);\n\t\t\t\t} else if (this.ignoreTimestamps) {\n\t\t\t\t\tsetTimeout(runRecordBound);\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(runRecordBound, interval);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.onComplete) {\n\t\t\t\t\tthis.onComplete();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate _runRecord() {\n\t\t\tlet data;\n\t\t\tlet start = performance.now();\n\t\t\tswitch (this._parser.currentType) {\n\t\t\t\tcase MovieRecordType.PlayerCommand:\n\t\t\t\tcase MovieRecordType.PlayerCommandAsync:\n\t\t\t\t\tdata = this._parser.parsePlayerCommand();\n\t\t\t\t\tlet async = this._parser.currentType === MovieRecordType.PlayerCommandAsync;\n\t\t\t\t\tlet updates = DataBuffer.FromArrayBuffer(data.updates.buffer);\n\t\t\t\t\tif (async) {\n\t\t\t\t\t\tthis.processUpdates(updates, data.assets);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet output = new DataBuffer();\n\t\t\t\t\t\tthis.processUpdates(updates, data.assets, output);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase MovieRecordType.Frame:\n\t\t\t\t\tthis.processFrame();\n\t\t\t\t\tbreak;\n\t\t\t\tcase MovieRecordType.Font:\n\t\t\t\t\tdata = this._parser.parseFont();\n\t\t\t\t\tthis.processRegisterFont(data.syncId, data.data, function () {\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase MovieRecordType.Image:\n\t\t\t\t\tdata = this._parser.parseImage();\n\t\t\t\t\tthis.processRegisterImage(data.syncId, data.symbolId, data.imageType, data.data,\n\t\t\t\t\t\tdata.alphaData, function () {\n\t\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase MovieRecordType.FSCommand:\n\t\t\t\t\tdata = this._parser.parseFSCommand();\n\t\t\t\t\tthis.processFSCommand(data.command, data.args);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('Invalid movie record type');\n\t\t\t}\n\t\t\tthis.cpuTimeUpdates += performance.now() - start;\n\n\t\t\tif (this._parser.currentType === MovieRecordType.Frame &&\n\t\t\t\tthis.alwaysRenderFrame) {\n\t\t\t\trequestAnimationFrame(this._renderFrameJustAfterRAF.bind(this));\n\t\t\t} else {\n\t\t\t\tthis._parseNext();\n\t\t\t}\n\t\t}\n\n\t\tprivate _renderFrameJustAfterRAF() {\n\t\t\tlet start = performance.now();\n\t\t\tthis.easel.render();\n\t\t\tthis.cpuTimeRendering += performance.now() - start;\n\n\t\t\tthis._parseNext();\n\t\t}\n\t}\n}\n","/**\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.GFX.Test {\n\timport WindowEaselHost = Shumway.GFX.Window.WindowEaselHost;\n\n\texport class RecordingEaselHost extends WindowEaselHost {\n\t\tprivate _recorder: MovieRecorder = null;\n\n\t\tpublic get recorder(): MovieRecorder {\n\t\t\treturn this._recorder;\n\t\t}\n\n\t\tconstructor(easel: Easel, peer: Shumway.Remoting.ITransportPeer, recordingLimit: number = 0) {\n\t\t\tsuper(easel, peer);\n\n\t\t\tthis._recorder = new MovieRecorder(recordingLimit);\n\t\t}\n\n\t\t_onWindowMessage(data: any, async: boolean): any {\n\t\t\trelease || Debug.assert(typeof data === 'object' && data !== null);\n\t\t\tlet type = data.type;\n\t\t\tswitch (type) {\n\t\t\t\tcase 'player':\n\t\t\t\t\tthis._recorder.recordPlayerCommand(async, data.updates, data.assets);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'frame':\n\t\t\t\t\tthis._recorder.recordFrame();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'registerFont':\n\t\t\t\t\tthis._recorder.recordFont(data.syncId, data.data);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'registerImage':\n\t\t\t\t\tthis._recorder.recordImage(data.syncId, data.symbolId, data.imageType,\n\t\t\t\t\t\tdata.data, data.alphaData);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'fscommand':\n\t\t\t\t\tthis._recorder.recordFSCommand(data.command, data.args);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn super._onWindowMessage(data, async);\n\t\t}\n\t}\n}\n","/*\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/// <reference path='2d/debug.ts'/>\n/// <reference path='2d/surface.ts'/>\n/// <reference path='2d/2d.ts'/>\n/// <reference path='easel.ts'/>\n/// <reference path='debug/tree.ts'/>\n\n/// <reference path='remotingGfx.ts' />\n/// <reference path='easelHost.ts' />\n/// <reference path='window/windowEaselHost.ts' />\n/// <reference path='test/recorder.ts' />\n/// <reference path='test/playbackEaselHost.ts' />\n/// <reference path='test/recordingEaselHost.ts' />\n\ninterface WebGLActiveInfo {\n\tlocation: any;\n}\n\ninterface WebGLProgram extends WebGLObject {\n\tuniforms: any;\n\tattributes: any;\n}\n"]}