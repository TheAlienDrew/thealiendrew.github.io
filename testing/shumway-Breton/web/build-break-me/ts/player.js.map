{"version":3,"file":"player.js","sourceRoot":"","sources":["../../src/player/module.ts","../../src/player/settings.ts","../../src/player/frameScheduler.ts","../../src/player/remotingPlayer.ts","../../src/player/player.ts","../../src/player/avmLoader.ts","../../src/player/external.ts","../../src/player/window/windowPlayer.ts","../../src/player/references.ts"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;;;;;;;;;GAcG;AAEH,IAAO,OAAO,CAeb;AAfD,WAAO,OAAO;IAAC,IAAA,MAAM,CAepB;IAfc,WAAA,MAAM;QACT,qBAAc,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QAC5F,cAAO,GAAG,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,CAAC;QAEhD,aAAM,GAAoB,IAAI,CAAC,CAAC,yBAAyB;QAEpE,uBAA8B,IAAY,EAAE,IAAU;YACrD,OAAA,MAAM,IAAI,OAAA,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAC7B,OAAO,IAAI,OAAA,cAAc,IAAI,OAAA,cAAc,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAC/D,CAAC;QAHe,oBAAa,gBAG5B,CAAA;QAED,uBAA8B,IAAY,EAAE,IAAU;YACrD,OAAA,MAAM,IAAI,OAAA,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAC7B,OAAO,IAAI,OAAA,cAAc,IAAI,OAAA,cAAc,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAC/D,CAAC;QAHe,oBAAa,gBAG5B,CAAA;IACF,CAAC,EAfc,MAAM,GAAN,cAAM,KAAN,cAAM,QAepB;AAAD,CAAC,EAfM,OAAO,KAAP,OAAO,QAeb;AC/BD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,OAAO,CAqGb;AArGD,WAAO,OAAO;IAEb,IAAO,SAAS,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC;IAE7C,IAAO,cAAc,GAAG,OAAO,CAAC,QAAQ,CAAC,cAAc,CAAC;IAE7C,qBAAa,GAAG,cAAc,CAAC,QAAQ,CAAC,IAAI,SAAS,CAAC,gBAAgB,CAAC,CAAC,CAAC;IAEzE,0BAAkB,GAAG,QAAA,aAAa,CAAC,QAAQ,CACrD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,EAAE,wBAAwB,EAAE,SAAS,EAAE,IAAI,EAAE,yBAAyB,CAAC,CAChH,CAAC;IAES,0BAAkB,GAAG,QAAA,aAAa,CAAC,QAAQ,CACrD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,EAAE,eAAe,EAAE,SAAS,EAAE,IAAI,EAAE,sBAAsB,CAAC,CACpG,CAAC;IAES,yBAAiB,GAAG,QAAA,aAAa,CAAC,QAAQ,CACpD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,YAAY,EAAE,aAAa,EAAE,SAAS,EAAE,IAAI,EAAE,oCAAoC,CAAC,CAC9G,CAAC;IAES,sBAAc,GAAG,QAAA,aAAa,CAAC,QAAQ,CACjD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,UAAU,EAAE,WAAW,EAAE,QAAQ,EAAE,EAAE,EAAE,iEAAiE,EAAE;QACpI,KAAK,EAAE;YACN,GAAG,EAAE,CAAC;YACN,GAAG,EAAE,GAAG;YACR,IAAI,EAAE,CAAC;SACP;KACD,CAAC,CACF,CAAC;IAES,uBAAe,GAAG,QAAA,aAAa,CAAC,QAAQ,CAClD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,EAAE,YAAY,EAAE,QAAQ,EAAE,CAAC,CAAC,EAAE,gFAAgF,EAAE;QACrJ,KAAK,EAAE;YACN,GAAG,EAAE,CAAC,CAAC;YACP,GAAG,EAAE,GAAG;YACR,IAAI,EAAE,CAAC;SACP;KACD,CAAC,CACF,CAAC;IAES,yBAAiB,GAAG,QAAA,aAAa,CAAC,QAAQ,CACpD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,EAAE,cAAc,EAAE,QAAQ,EAAE,CAAC,EAAE,8BAA8B,EAAE;QAC7F,KAAK,EAAE;YACN,GAAG,EAAE,CAAC;YACN,GAAG,EAAE,GAAG;YACR,IAAI,EAAE,CAAC;SACP;KACD,CAAC,CACF,CAAC;IAES,6BAAqB,GAAG,QAAA,aAAa,CAAC,QAAQ,CACxD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,oBAAoB,EAAE,SAAS,EAAE,KAAK,EAAE,qBAAqB,CAAC,CAChG,CAAC;IAES,iCAAyB,GAAG,QAAA,aAAa,CAAC,QAAQ,CAC5D,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE,uBAAuB,EAAE,QAAQ,EAAE,CAAC,EAAE,+BAA+B,EAAE;QACrG,KAAK,EAAE;YACN,GAAG,EAAE,CAAC;YACN,GAAG,EAAE,EAAE;YACP,IAAI,EAAE,CAAC;SACP;KACD,CAAC,CACF,CAAC;IAES,4BAAoB,GAAG,QAAA,aAAa,CAAC,QAAQ,CACvD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE,yBAAyB,EAAE,SAAS,EAAE,KAAK,EAAE,0DAA0D,CAAC,CACvI,CAAC;IAES,4BAAoB,GAAG,QAAA,aAAa,CAAC,QAAQ,CACvD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE,cAAc,EAAE,SAAS,EAAE,KAAK,EAAE,sCAAsC,CAAC,CACxG,CAAC;IAES,wBAAgB,GAAG,QAAA,aAAa,CAAC,QAAQ,CACnD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE,oBAAoB,EAAE,QAAQ,EAAE,CAAC,EAAE,sBAAsB,EAAE;QACzF,KAAK,EAAE;YACN,GAAG,EAAE,CAAC;YACN,GAAG,EAAE,KAAK;YACV,IAAI,EAAE,CAAC;SACP;KACD,CAAC,CACF,CAAC;IAES,qCAA6B,GAAG,QAAA,aAAa,CAAC,QAAQ,CAChE,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE,sBAAsB,EAAE,QAAQ,EAAE,CAAC,EAAE,8DAA8D,EAAE;QACnI,KAAK,EAAE;YACN,GAAG,EAAE,CAAC;YACN,GAAG,EAAE,GAAG;YACR,IAAI,EAAE,CAAC;SACP;KACD,CAAC,CACF,CAAC;IAES,6BAAqB,GAAG,QAAA,aAAa,CAAC,QAAQ,CACxD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE,mBAAmB,EAAE,QAAQ,EAAE,CAAC,CAAC,EAAE,sBAAsB,EAAE;QACzF,KAAK,EAAE;YACN,GAAG,EAAE,CAAC,CAAC;YACP,GAAG,EAAE,KAAK;YACV,IAAI,EAAE,CAAC;SACP;KACD,CAAC,CACF,CAAC;AACH,CAAC,EArGM,OAAO,KAAP,OAAO,QAqGb;ACrHD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,OAAO,CAmHb;AAnHD,WAAO,OAAO;IACb;QAgBC;YANQ,yBAAoB,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;YAOhD,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;YACrB,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;YACtB,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,oBAAoB,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;YAC9C,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;YACpB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;YAChB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;QACvB,CAAC;QAED,sBAAI,yCAAa;iBAAjB;gBACC,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,IAAI,cAAc,CAAC,iBAAiB,CAAC,CAAC,CAAC;oBAC5D,MAAM,CAAC,KAAK,CAAC;gBACd,CAAC;gBACD,IAAI,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,cAAc,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAChF,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC;gBAC7C,IAAI,gBAAgB,GAAG,WAAW,CAAC,GAAG,EAAE,GAAG,WAAW,CAAC;gBACvD,MAAM,CAAC,gBAAgB,GAAG,cAAc,CAAC,mBAAmB,GAAG,IAAI,CAAC,oBAAoB,CAAC;YAC1F,CAAC;;;WAAA;QAED,sBAAI,uCAAW;iBAAf;gBACC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,oBAAoB,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC,CAAC;YACnE,CAAC;;;WAAA;QAED,sBAAI,oCAAQ;iBAAZ;gBACC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YACrB,CAAC;;;WAAA;QAED,mCAAU,GAAV,UAAW,SAAiB;YAC3B,IAAI,QAAQ,GAAG,IAAI,GAAG,SAAS,CAAC;YAEhC,IAAI,gBAAgB,GAAG,QAAQ,CAAC;YAChC,IAAI,KAAK,GAAG,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC;YAC5C,EAAE,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC;gBACjB,EAAE,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;oBACf,gBAAgB,IAAI,cAAc,CAAC,iBAAiB,CAAC;gBACtD,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;oBACtB,gBAAgB,IAAI,cAAc,CAAC,iBAAiB,CAAC;gBACtD,CAAC;gBACD,IAAI,CAAC,YAAY,IAAI,CAAC,QAAQ,GAAG,gBAAgB,CAAC,CAAC;YACpD,CAAC;YAED,IAAI,CAAC,oBAAoB,IAAI,gBAAgB,CAAC;YAC9C,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACrB,CAAC;QAED,iCAAQ,GAAR;YACC,IAAI,uBAAuB,GAAG,WAAW,CAAC,GAAG,EAAE,GAAG,cAAc,CAAC,mBAAmB,CAAC;YACrF,EAAE,CAAC,CAAC,uBAAuB,GAAG,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC;gBACzD,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;oBACtB,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,oBAAoB,GAAG,uBAAuB,CAAC,CAAC;oBAC3E,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;gBAChC,CAAC;gBACD,IAAI,CAAC,oBAAoB,GAAG,uBAAuB,CAAC;gBACpD,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;YACtB,CAAC;QACF,CAAC;QAED,kCAAS,GAAT;YACC,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;QACvC,CAAC;QAED,gCAAO,GAAP;YACC,IAAI,QAAQ,GAAG,WAAW,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,YAAY,CAAC;YACrD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC/B,IAAI,CAAC,aAAa,IAAI,QAAQ,CAAC;YAC/B,OAAO,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,cAAc,CAAC,iBAAiB,EAAE,CAAC;gBAClE,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;YAC/C,CAAC;QACF,CAAC;QAED,iCAAQ,GAAR;YACC,IAAI,CAAC,aAAa,EAAE,CAAC;QACtB,CAAC;QAED,iCAAQ,GAAR,UAAS,KAAa;YACrB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;gBACvB,MAAM,CAAC;YACR,CAAC;YACD,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACrB,CAAC;QAED,wCAAe,GAAf;YACC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACzB,CAAC;QAED,sCAAa,GAAb;YACC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;gBACvB,MAAM,CAAC;YACR,CAAC;YACD,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;YAChB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;QACvB,CAAC;QA/Gc,gCAAiB,GAAG,EAAE,CAAC;QACvB,gCAAiB,GAAG,CAAC,CAAC;QACtB,kCAAmB,GAAG,CAAC,CAAC;QACxB,gCAAiB,GAAG,GAAG,CAAC;QA6GxC,qBAAC;KAAA,AAjHD,IAiHC;IAjHY,sBAAc,iBAiH1B,CAAA;AACF,CAAC,EAnHM,OAAO,KAAP,OAAO,QAmHb;ACnID;;;;;;;;;;;;;;GAcG;AACH,IAAO,OAAO,CAgqBb;AAhqBD,WAAO,OAAO;IAAC,IAAA,QAAQ,CAgqBtB;IAhqBc,WAAA,QAAQ;QAAC,IAAA,MAAM,CAgqB7B;QAhqBuB,WAAA,MAAM;YAI7B,IAAO,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC;YAWrC,IAAO,SAAS,GAAG,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC;YAC3C,IAAO,aAAa,GAAG,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC;YAKnD,IAAO,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;YAG/B,IAAO,WAAW,GAAG,KAAK,CAAC,EAAE,CAAC,WAAW,CAAC;YAI1C,IAAO,UAAU,GAAG,OAAO,CAAC,cAAc,CAAC,UAAU,CAAC;YACtD,IAAO,MAAM,GAAG,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC;YACrC,IAAO,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC;YAEtC;gBASC;oBAHO,UAAK,mBAAwC;oBAC7C,UAAK,GAAqB,IAAI,CAAC;oBAGrC,IAAI,CAAC,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;oBAC/B,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;gBACxB,CAAC;gBAED,+CAAa,GAAb;oBACC,IAAI,CAAC,KAAK,kBAAiC,CAAC;oBAC5C,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;wBACvC,OAAO,CAAC,MAAM,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;wBACjD,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;wBAC/C,OAAO,CAAC,MAAM,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;oBAClD,CAAC;gBACF,CAAC;gBAED,kDAAgB,GAAhB;oBACC,IAAI,CAAC,KAAK,qBAAoC,CAAC;oBAC/C,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;wBACvC,OAAO,CAAC,MAAM,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;wBACpD,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;wBAC9C,OAAO,CAAC,MAAM,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;oBACrD,CAAC;gBACF,CAAC;gBAED,0CAAQ,GAAR;oBACC,IAAI,CAAC,MAAM,CAAC,QAAQ,aAAyB,CAAC;gBAC/C,CAAC;gBAED;;mBAEG;gBACH,0DAAwB,GAAxB,UAAyB,aAA4B,EAAE,yBAAkC;oBACxF,IAAI,IAAI,GAAG,IAAI,CAAC;oBAChB,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,aAAa,CAAC,KAAK,CAAC,UAAU,aAAa;wBAC1C,EAAE,CAAC,CAAC,aAAa,CAAC,iBAAiB,kBAA+B,CAAC,CAAC,CAAC;4BACpE,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC;4BACrC,sBAAsB;4BACtB,EAAE,CAAC,CAAC,KAAK,IAAI,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC;gCACjC,IAAI,IAAI,GAAG,aAAa,CAAC,IAAI,CAAC,2BAA2B,EAAE,CAAC;gCAC5D,OAAO,CAAC,cAAc,CAAC,UAAU,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;4BAC/C,CAAC;wBACF,CAAC;wBACD,yFAAyF;wBACzF,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC;wBACrC,IAAI,mBAAmB,GAAG,aAAa,CAAC,SAAS,kCAAqC,CAAC;wBACvF,EAAE,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC;4BACzB,EAAE,CAAC,CAAC,yBAAyB,CAAC,CAAC,CAAC;gCAC/B,qFAAqF;gCACrF,aAAa,CAAC,YAAY,kCAAqC,CAAC;4BACjE,CAAC;4BACD,MAAM,kBAAuB;wBAC9B,CAAC;wBACD,6DAA6D;wBAC7D,MAAM,cAAmB;oBAC1B,CAAC,eAAoB,CAAC;gBACvB,CAAC;gBAED,4CAAU,GAAV,UAAW,KAAY;oBACtB,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;wBACrB,MAAM,CAAC;oBACR,CAAC;oBACD,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;oBAC1C,IAAI,UAAU,GAAG,IAAI,CAAC;oBACtB,IAAI,CAAC,MAAM,CAAC,QAAQ,uBAAwB,CAAC;oBAC7C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAChC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;oBAClC,IAAI,CAAC,eAAe,CAAC,IAAI,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,UAAU,GAAG,EAAE,EAAE,KAAK,CAAC,WAAW,GAAG,EAAE,CAAC,CAAC,CAAC;oBACtF,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;oBACrE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;oBAC7E,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,iBAAiB,CAAC,QAAQ,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC;oBACnF,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC;gBACxB,CAAC;gBAED,yDAAuB,GAAvB,UAAwB,KAAY,EAAE,kBAAmD;oBACxF,IAAI,CAAC,MAAM,CAAC,QAAQ,oCAAqC,CAAC;oBAE1D,IAAI,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC;oBACpB,IAAI,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC;oBACvC,IAAI,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;oBAC1B,EAAE,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC;wBACxB,IAAI,YAAY,GAAG,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC;wBAC1D,IAAI,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC;wBAC9C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC;wBAC7C,EAAE,CAAC,CAAC,MAAM,KAAK,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC;4BACjC,IAAI,IAAI,GAAG,kBAAkB,CAAC;4BAC9B,GAAG,CAAC;gCACH,EAAE,CAAC,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC;oCAC9B,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAA2B,IAAK,CAAC,UAAU,CAAC;wCAC5D,kBAAmB,CAAC,aAAa,CAAC,CAAC,CAAC;oCAC1C,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC;oCAC5B,KAAK,CAAC;gCACP,CAAC;gCACD,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC;4BACrB,CAAC,QAAQ,IAAI,IAAI,IAAI,KAAK,KAAK,EAAE;wBAClC,CAAC;oBACF,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC1B,CAAC;oBACD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;gBACpD,CAAC;gBAED,+CAAa,GAAb,UAAc,QAAkB;oBAC/B,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC;wBACxB,MAAM,CAAC;oBACR,CAAC;oBACD,IAAI,QAAQ,GAAG,QAAQ,CAAC,eAAe,EAAE,CAAC;oBAC1C,IAAI,WAAW,GAAG,QAAQ,CAAC,MAAM,CAAC;oBAClC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,EAAE,CAAC,EAAE,EAAE,CAAC;wBACtC,QAAQ,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;oBAClD,CAAC;oBACD,IAAI,CAAC,MAAM,CAAC,QAAQ,0BAA2B,CAAC;oBAChD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;oBACnC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;oBACzB,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,CAAC;oBACnD,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,eAAe,EAAE,CAAC,aAAa,EAAE,CAAC,CAAC;oBAC7D,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;oBAClC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,EAAE,CAAC,EAAE,EAAE,CAAC;wBACtC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC1D,CAAC;oBACD,QAAQ,CAAC,QAAQ,GAAG,KAAK,CAAC;gBAC3B,CAAC;gBAED,gDAAc,GAAd,UAAe,SAAoB,EAAE,MAAc;oBAClD,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;wBACzB,MAAM,CAAC;oBACR,CAAC;oBACD,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,qBAAqB,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC;oBAChE,IAAI,CAAC,MAAM,CAAC,QAAQ,2BAA4B,CAAC;oBACjD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;oBACpC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;oBAC7B,SAAS,CAAC,QAAQ,GAAG,KAAK,CAAC;gBAC5B,CAAC;gBAED,wDAAsB,GAAtB,UAAuB,aAA4B;oBAClD,OAAO,IAAI,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;oBAC/B,IAAI,CAAC,KAAK,GAAG,CAAC,aAAa,CAAC,CAAC;oBAC7B,IAAI,CAAC,aAAa,EAAE,CAAC;oBACrB,IAAI,CAAC,gBAAgB,EAAE,CAAC;gBACzB,CAAC;gBAED,iDAAe,GAAf,UAAgB,UAAsB;oBACrC,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;wBAC1B,MAAM,CAAC;oBACR,CAAC;oBACD,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,sBAAsB,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;oBAClE,IAAI,CAAC,MAAM,CAAC,QAAQ,4BAA6B,CAAC;oBAClD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;oBACrC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACtE,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,iBAAiB,EAAE,CAAC,CAAC;oBACrD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;oBACvC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC,aAAa,EAAE,CAAC,CAAC;oBAC7D,UAAU,CAAC,QAAQ,GAAG,KAAK,CAAC;gBAC7B,CAAC;gBAED,kDAAgB,GAAhB,UAAiB,WAAgC;oBAChD,EAAE,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,KAAK,iBAAiC,CAAC,CAAC,CAAC,CAAC;wBAC3D,MAAM,CAAC;oBACR,CAAC;oBACD,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,uBAAuB,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;oBACpE,IAAI,CAAC,MAAM,CAAC,QAAQ,6BAA8B,CAAC;oBACnD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;oBACtC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;oBACzB,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;oBACzC,IAAI,QAAQ,GAAG,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC;oBAChF,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,MAAM,IAAI,QAAQ,CAAC,CAAC;oBAClD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;oBAClD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;oBAC9C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;oBAC3C,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;oBAC/C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;oBAC1C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;oBAC1C,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;oBACxC,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC,CAAC;oBAC1D,IAAI,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC;oBAChC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;wBACZ,IAAI,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC;wBAC9B,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;wBAChC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,EAAE,CAAC,EAAE,EAAE,CAAC;4BACpC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;wBACjC,CAAC;oBACF,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;oBACzB,CAAC;oBACD,WAAW,CAAC,KAAK,IAAI,eAA+B,CAAA;gBACrD,CAAC;gBAED;;mBAEG;gBACH,0DAAwB,GAAxB,UAAyB,aAA4B;oBACpD,EAAE,CAAC,CAAC,aAAa,CAAC,UAAU,GAAG,CAAC,IAAI,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC;wBAC3D,qFAAqF;wBACrF,sFAAsF;wBACtF,gCAAgC;wBAChC,IAAI,CAAC,GAAG,aAAa,CAAC,OAAO,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;wBAC3D,IAAI,CAAC,GAAG,aAAa,CAAC,OAAO,CAAC,iBAAiB,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;wBAC1E,0FAA0F;wBAC1F,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACf,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;4BACzB,MAAM,CAAC;wBACR,CAAC;wBACD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;4BACjC,uJAAuJ;wBACxJ,CAAC;wBACD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;oBAC7B,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC1B,CAAC;gBACF,CAAC;gBAED,kDAAgB,GAAhB,UAAiB,aAA4B;oBAC5C,eAAe;oBACf,IAAI,CAAC,MAAM,CAAC,QAAQ,uBAAwB,CAAC;oBAC7C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;oBAExC,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,uBAAuB,GAAG,aAAa,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;oBAElF,IAAI,OAAO,GAAG,KAAK,CAAC;oBACpB,IAAI,SAAS,GAAG,aAAa,CAAC,cAAc,qBAAqC,CAAC;oBAClF,IAAI,iBAAiB,GAAG,aAAa,CAAC,cAAc,8BAA6C,CAAC;oBAClG,IAAI,0BAA0B,GAAG,aAAa,CAAC,cAAc,wCAAsD,CAAC;oBAEpH,IAAI,KAAK,GAAU,IAAI,CAAC;oBACxB,EAAE,CAAC,CAAC,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;wBACzE,KAAK,GAAU,aAAa,CAAC;oBAC9B,CAAC;oBAED,2GAA2G;oBAC3G,IAAI,oBAAoB,GAAG,KAAK,CAAC;oBACjC,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,uBAA6B,CAAC,CAAC,CAAC;wBAC7C,oBAAoB,GAAG,aAAa,CAAC,iBAAiB,CACrD;iDACqC;oDACE;mDACD;oDACE,CACxC,CAAC;wBACF,OAAO,GAAG,aAAa,CAAC,cAAc,qBAAmC,CAAC;oBAC3E,CAAC;oBACD,IAAI,MAAM,GAAW,IAAI,CAAC;oBAC1B,EAAE,CAAC,CAAC,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;wBAC5E,MAAM,GAAW,aAAa,CAAC;oBAChC,CAAC;oBAED,yDAAyD;oBACzD,IAAI,OAAO,GAAG,aAAa,CAAC,cAAc,0BAAwC,CAAC;oBAEnF,iBAAiB;oBACjB,IAAI,OAAO,GAAG,CAAC,CAAC;oBAChB,OAAO,IAAI,SAAS,CAAC,CAAC,mBAAuB,CAAC,CAAC,CAAC,CAAC;oBACjD,OAAO,IAAI,iBAAiB,CAAC,CAAC,2BAA+B,CAAC,CAAC,CAAC,CAAC;oBACjE,OAAO,IAAI,OAAO,CAAC,CAAC,kBAAqB,CAAC,CAAC,CAAC,CAAC;oBAC7C,OAAO,IAAI,OAAO,CAAC,CAAC,mBAAqB,CAAC,CAAC,CAAC,CAAC;oBAC7C,OAAO,IAAI,0BAA0B,CAAC,CAAC,qCAAwC,CAAC,CAAC,CAAC,CAAC;oBACnF,OAAO,IAAI,oBAAoB,CAAC,CAAC,qBAAyB,CAAC,CAAC,CAAC,CAAC;oBAC9D,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;oBAE9B,mBAAmB;oBACnB,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;wBACf,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,UAAU,EAAE,CAAC,CAAC;oBAC/C,CAAC;oBACD,EAAE,CAAC,CAAC,iBAAiB,CAAC,CAAC,CAAC;wBACvB,IAAI,CAAC,oBAAoB,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;oBAC1D,CAAC;oBACD,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;wBACb,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACxE,CAAC;oBACD,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;wBACb,IAAI,CAAC,wBAAwB,CAAC,aAAa,CAAC,CAAC;oBAC9C,CAAC;oBACD,EAAE,CAAC,CAAC,0BAA0B,CAAC,CAAC,CAAC;wBAChC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;wBAC3C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC,CAAC;wBACnE,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;wBAC3C,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,SAAS,iBAA4B,CAAC,CAAC;wBAC9E,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;wBACtD,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;4BACZ,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,CAAC;4BACnE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBAChD,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,0FAA0F;4BAC1F,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC;4BAClE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;wBACzB,CAAC;oBACF,CAAC;oBAED,IAAI,QAAQ,GAAG,aAAa,CAAC,YAAY,EAAE,CAAC;oBAC5C,IAAI,WAAW,GAAG,aAAa,CAAC,eAAe,EAAE,CAAC;oBAClD,EAAE,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC;wBAC1B,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;wBACtC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;4BACZ,EAAE,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC;gCACvB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gCACxB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,wBAAe,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;4BAC5D,CAAC;4BAAC,IAAI,CAAC,CAAC;gCACP,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;4BACzB,CAAC;wBACF,CAAC;wBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;4BAClB,EAAE,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC;gCACtB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gCACxB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,wBAAe,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;4BAC3D,CAAC;4BAAC,IAAI,CAAC,CAAC;gCACP,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;4BACzB,CAAC;wBACF,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,8EAA8E;4BAC9E,IAAI,KAAK,GAAG,CAAC,QAAQ,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;4BAC9C,IAAI,QAAQ,GAAG,aAAa,CAAC,SAAS,CAAC;4BACvC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gCACd,KAAK,IAAI,QAAQ,CAAC,MAAM,CAAC;4BAC1B,CAAC;4BACD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;4BAC5B,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gCACd,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,sBAAsB,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;gCAChE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,wBAAe,QAAQ,CAAC,GAAG,CAAC,CAAC;4BACnD,CAAC;4BAAC,IAAI,CAAC,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gCACxB,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,yBAAyB,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;gCACtE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,wBAAe,WAAW,CAAC,GAAG,CAAC,CAAC;4BACtD,CAAC;4BACD,yCAAyC;4BACzC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gCACd,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;oCAC1C,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,2BAA2B,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC;oCAChF,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;oCACtC,4DAA4D;oCAC5D,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,UAAU,IAAI,CAAC,CAAC,CAAC,CAAC;wCACjC,QAAQ,CAAC,CAAC,CAAC,CAAC,cAAc,0BAAwC,CAAC;oCACpE,CAAC;gCACF,CAAC;4BACF,CAAC;wBACF,CAAC;wBACD,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAC7B,CAAC;oBACD,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,uBAA6B,CAAC,CAAC,CAAC;wBAC7C,aAAa,CAAC,iBAAiB,kBAA+B,CAAC;oBAChE,CAAC;gBACF,CAAC;gBAED;;mBAEG;gBACH,kDAAgB,GAAhB,UAAiB,aAA4B;oBAC5C,IAAI,QAAQ,GAAG,aAAa,CAAC,YAAY,EAAE,CAAC;oBAC5C,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;wBACd,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;wBAC7B,MAAM,CAAC;oBACR,CAAC;oBAED,IAAI,WAAW,GAAG,aAAa,CAAC,eAAe,EAAE,CAAC;oBAClD,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;wBACjB,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC;wBACnC,MAAM,CAAC;oBACR,CAAC;oBAED,IAAI,MAAM,GAAW,IAAI,CAAC;oBAC1B,EAAE,CAAC,CAAC,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;wBAC5E,MAAM,GAAW,aAAa,CAAC;wBAC/B,EAAE,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC;4BACvB,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;wBACzC,CAAC;wBACD,MAAM,CAAC;oBACR,CAAC;oBAED,IAAI,KAAK,GAAU,IAAI,CAAC;oBACxB,EAAE,CAAC,CAAC,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;wBACzE,KAAK,GAAU,aAAa,CAAC;wBAC7B,EAAE,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC;4BACtB,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,UAAU,EAAE,KAAK,CAAC,iBAAiB,EAAE,CAAC,CAAC;wBAClE,CAAC;wBACD,MAAM,CAAC;oBACR,CAAC;gBACF,CAAC;gBAED,mDAAiB,GAAjB,UAAkB,UAAoC,EAAE,MAAmC,EACzE,MAAgC,EAChC,cAAgD,EAAE,SAAwB,EAC1E,QAAqC,EAAE,SAA0B;oBAFjE,uBAAA,EAAA,aAAgC;oBAChC,+BAAA,EAAA,qBAAgD;oBAAE,0BAAA,EAAA,gBAAwB;oBAC1E,yBAAA,EAAA,eAAqC;oBAAE,0BAAA,EAAA,iBAA0B;oBAClF,IAAI,CAAC,MAAM,CAAC,QAAQ,wBAAyB,CAAC;oBAC9C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;oBACrC,EAAE,CAAC,CAAC,UAAU,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;wBACtE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,wBAAe,MAAM,CAAC,GAAG,CAAC,CAAC;oBACjD,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBAClC,CAAC;oBAED,IAAI,OAAO,GAAG,CAAC,CAAC;oBAChB,OAAO,IAAI,MAAM,CAAC,CAAC,mBAAuB,CAAC,CAAC,CAAC,CAAC;oBAC9C,OAAO,IAAI,cAAc,CAAC,CAAC,2BAA+B,CAAC,CAAC,CAAC,CAAC;oBAC9D,OAAO,IAAI,QAAQ,CAAC,CAAC,sBAAyB,CAAC,CAAC,CAAC,CAAC;oBAElD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;oBAC9B,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;wBACZ,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;oBAC3B,CAAC;oBACD,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;wBACpB,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,CAAC;oBAC3C,CAAC;oBACD,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;wBACd,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACtD,CAAC;oBACD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC;oBACpD,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;gBACrC,CAAC;gBAEO,8CAAY,GAApB,UAAqB,MAAyB;oBAE7C,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;wBACtC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;4BACtC,IAAI,CAAC,MAAM,CAAC,QAAQ,yBAAgC,CAAC;4BACrD,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC;wBAChD,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,KAAK,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gCAC3B,IAAI,CAAC,MAAM,CAAC,QAAQ,wCAA+C,CAAC;gCACpE,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;4BAClC,CAAC;4BAAC,IAAI,CAAC,CAAC;gCACP,IAAI,CAAC,MAAM,CAAC,QAAQ,iCAAwC,CAAC;gCAC7D,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;4BAC9C,CAAC;4BACD,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC;wBAChD,CAAC;oBACF,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,IAAI,CAAC,MAAM,CAAC,QAAQ,aAAoB,CAAC;wBACzC,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC;oBACxF,CAAC;gBACF,CAAC;gBAEO,iDAAe,GAAvB,UAAwB,MAAc;oBACrC,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;oBACzB,4FAA4F;oBAC5F,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;gBAC1E,CAAC;gBAEO,6CAAW,GAAnB,UAAoB,KAAU;oBAC7B,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;oBAC/C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC/B,CAAC;gBAEO,+CAAa,GAArB,UAAsB,OAAsC;oBAC3D,EAAE,CAAC,CAAC,CAAC,OAAO,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;wBACtC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;wBACxB,MAAM,CAAC;oBACR,CAAC;oBACD,IAAI,GAAG,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;oBACzB,IAAI,KAAK,GAAG,CAAC,CAAC;oBACd,IAAI,eAAe,GAAG,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC;oBAC3D,IAAI,qBAAqB,GAAG,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,gBAAgB,CAAC,OAAO,CAAC;oBACvE,IAAI,eAAe,GAAG,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC;oBAC3D,IAAI,sBAAsB,GAAG,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,iBAAiB,CAAC,OAAO,CAAC;oBACzE,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;wBACzC,EAAE,CAAC,CAAC,eAAe,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;4BACvC,qBAAqB,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;4BAC1C,eAAe,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;4BACpC,sBAAsB,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;4BAC9C,KAAK,EAAE,CAAC;wBACT,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,OAAO,CAAC,KAAK,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;wBAC1D,CAAC;oBACF,CAAC;oBACD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;oBAC5B,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;wBACzC,IAAI,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;wBACxB,EAAE,CAAC,CAAC,eAAe,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;4BACtC,IAAI,UAAU,GAA6B,MAAM,CAAC;4BAClD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAA,UAAU,CAAC,IAAI,CAAC,CAAC;4BACtC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;4BACzC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;4BACzC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;wBAC1C,CAAC;wBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,qBAAqB,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;4BACnD,IAAI,gBAAgB,GAAmC,MAAM,CAAC;4BAC9D,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAA,UAAU,CAAC,UAAU,CAAC,CAAC;4BAC5C,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;4BAC/C,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;4BAC/C,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;4BAC/C,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;4BAC/C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;4BAC7C,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;4BAClD,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC;4BACtD,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;4BACjD,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;4BACpD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;4BAC/C,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;wBACnD,CAAC;wBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,eAAe,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;4BAC7C,IAAI,UAAU,GAA6B,MAAM,CAAC;4BAClD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAA,UAAU,CAAC,UAAU,CAAC,CAAC;4BAC5C,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;4BACzC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ;4BACnC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;4BACzC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;4BACzC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;4BACvC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW;4BACtC,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,aAAa;4BAC9C,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;4BAC3C,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;4BAC9C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;4BACzC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;wBAC7C,CAAC;wBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,sBAAsB,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;4BACpD,IAAI,MAAM,GAAqC,MAAO,CAAC,MAAM,CAAC,KAAK,CAAC;4BACpE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAA,UAAU,CAAC,WAAW,CAAC,CAAC;4BAC7C,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;gCAC7B,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;4BACnC,CAAC;wBACF,CAAC;oBACF,CAAC;gBACF,CAAC;gBAEO,sDAAoB,GAA5B,UAA6B,cAAyC;oBACrE,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;oBACzB,IAAI,EAAE,GAAG,cAAc,CAAC,aAAa,CAAC;oBACtC,IAAI,EAAE,GAAG,cAAc,CAAC,eAAe,CAAC;oBACxC,IAAI,EAAE,GAAG,cAAc,CAAC,cAAc,CAAC;oBACvC,IAAI,EAAE,GAAG,cAAc,CAAC,eAAe,CAAC;oBACxC,IAAI,EAAE,GAAG,cAAc,CAAC,SAAS,CAAC;oBAClC,IAAI,EAAE,GAAG,cAAc,CAAC,WAAW,CAAC;oBACpC,IAAI,EAAE,GAAG,cAAc,CAAC,UAAU,CAAC;oBACnC,IAAI,EAAE,GAAG,cAAc,CAAC,WAAW,CAAC;oBAEpC,IAAI,cAAc,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;oBACrE,IAAI,uBAAuB,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;oBAEjE,EAAE,CAAC,CAAC,cAAc,IAAI,uBAAuB,CAAC,CAAC,CAAC;wBAC/C,EAAE,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;4BACd,MAAM,CAAC,QAAQ,kBAAiC,CAAC;wBAClD,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,MAAM,CAAC,QAAQ,6BAA4C,CAAC;4BAC5D,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;wBACvB,CAAC;oBACF,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,IAAI,uBAAuB,GAAG,EAAE,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;wBAC/D,EAAE,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC;4BAC7B,MAAM,CAAC,QAAQ,oCAAmD,CAAC;4BACnE,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;4BACtB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;4BACpB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;4BACpB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;4BACpB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;wBACrB,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,MAAM,CAAC,QAAQ,aAA4B,CAAC;4BAC5C,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;4BACtB,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;4BACtB,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;4BACtB,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;4BACtB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;4BACpB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;4BACpB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;4BACpB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;wBACrB,CAAC;oBACF,CAAC;gBACF,CAAC;gBAED,wDAAsB,GAAtB,UAAuB,UAAsB;oBAC5C,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,4BAA4B,CAAC,CAAC;oBACvD,IAAI,CAAC,MAAM,CAAC,QAAQ,6BAA8B,CAAC;oBACnD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;gBACtC,CAAC;gBACF,8BAAC;YAAD,CAAC,AArjBD,IAqjBC;YArjBY,8BAAuB,0BAqjBnC,CAAA;YAMD;gBAEC,mCAAoB,GAAoB,EAAU,KAAiB,EAC/C,WAAkB;oBADlB,QAAG,GAAH,GAAG,CAAiB;oBAAU,UAAK,GAAL,KAAK,CAAY;oBAC/C,gBAAW,GAAX,WAAW,CAAO;oBACrC,KAAK;gBACN,CAAC;gBAEM,wCAAI,GAAX;oBACC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,IAAI,GAAG,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC1B,MAAM,CAAC,CAAa,GAAG,CAAC,CAAC,CAAC;wBACzB;4BACC,MAAM,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;wBAC/B;4BACC,MAAM,CAAC,IAAI,CAAC,kBAAkB,EAAE,CAAC;wBAClC;4BACC,MAAM,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;oBAChC,CAAC;oBACD,OAAO,IAAI,MAAM,CAAC,KAAK,EAAE,6BAA6B,GAAG,GAAG,CAAC,CAAC;gBAC/D,CAAC;gBAEO,mDAAe,GAAvB;oBACC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,IAAI,MAAM,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC7B,MAAM,CAAC;wBACN,GAAG,sBAAuB;wBAC1B,IAAI,EAAkB,MAAM;qBACrB,CAAC;gBACV,CAAC;gBAEO,mDAAe,GAAvB;oBACC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,IAAI,MAAM,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC7B,IAAI,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;oBACpD,IAAI,EAAE,GAAG,KAAK,CAAC,SAAS,EAAE,CAAC;oBAC3B,IAAI,EAAE,GAAG,KAAK,CAAC,SAAS,EAAE,CAAC;oBAC3B,IAAI,OAAO,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC9B,IAAI,KAAK,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC5B,MAAM,CAAC;wBACN,GAAG,sBAAuB;wBAC1B,IAAI,EAAE,IAAI;wBACV,KAAK,EAAE,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC;wBAC5C,OAAO,EAAE,CAAC,CAAC,CAAC,KAAK,kBAA6B,CAAC;wBAC/C,MAAM,EAAE,CAAC,CAAC,CAAC,KAAK,iBAA4B,CAAC;wBAC7C,QAAQ,EAAE,CAAC,CAAC,CAAC,KAAK,mBAA8B,CAAC;wBACjD,OAAO,EAAE,OAAO;qBACT,CAAC;gBACV,CAAC;gBAEO,sDAAkB,GAA1B;oBACC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,IAAI,MAAM,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC7B,IAAI,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;oBACvD,IAAI,OAAO,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC9B,IAAI,QAAQ,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC/B,IAAI,QAAQ,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC/B,IAAI,KAAK,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;oBAC5B,MAAM,CAAC;wBACN,GAAG,yBAA0B;wBAC7B,IAAI,EAAE,IAAI;wBACV,OAAO,EAAE,OAAO;wBAChB,QAAQ,EAAE,QAAQ;wBAClB,QAAQ,EAAE,QAAQ;wBAClB,OAAO,EAAE,CAAC,CAAC,CAAC,KAAK,kBAA6B,CAAC;wBAC/C,MAAM,EAAE,CAAC,CAAC,CAAC,KAAK,iBAA4B,CAAC;wBAC7C,QAAQ,EAAE,CAAC,CAAC,CAAC,KAAK,mBAA8B,CAAC;qBAC1C,CAAC;gBACV,CAAC;gBACF,gCAAC;YAAD,CAAC,AApED,IAoEC;YApEY,gCAAyB,4BAoErC,CAAA;QACF,CAAC,EAhqBuB,MAAM,GAAN,eAAM,KAAN,eAAM,QAgqB7B;IAAD,CAAC,EAhqBc,QAAQ,GAAR,gBAAQ,KAAR,gBAAQ,QAgqBtB;AAAD,CAAC,EAhqBM,OAAO,KAAP,OAAO,QAgqBb;AC/qBD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,OAAO,CAixBb;AAjxBD,WAAO,OAAO;IAAC,IAAA,MAAM,CAixBpB;IAjxBc,WAAA,QAAM;QACpB,IAAO,MAAM,GAAG,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC;QACrC,IAAO,mBAAmB,GAAG,OAAO,CAAC,KAAK,CAAC,mBAAmB,CAAC;QAC/D,IAAO,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC;QAKrC,IAAO,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;QAUlC,IAAO,oBAAoB,GAAG,KAAK,CAAC,EAAE,CAAC,oBAAoB,CAAC;QAE5D,IAAO,uBAAuB,GAAG,KAAK,CAAC,EAAE,CAAC,uBAAuB,CAAC;QAoBlE;;;WAGG;QACH;YAKC,wBAAY,GAAoB;gBAJhC,eAAU,GAA0B,EAAE,CAAC;gBAKtC,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;YAChB,CAAC;YAED,oCAAW,GAAX,UAAY,QAA6B;gBACxC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAChC,CAAC;YAED,uCAAc,GAAd,UAAe,QAA6B;gBAC3C,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;gBAC1C,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;oBACZ,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC9B,CAAC;YACF,CAAC;YAED,+BAAM,GAAN,UAAO,OAAmB,EAAE,MAAa;gBACxC,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;YAC5C,CAAC;YAED,qCAAY,GAAZ,UAAa,OAAmB,EAAE,MAAa;gBAC9C,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;YAC5C,CAAC;YAED,8BAAK,GAAL;gBACC,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;YAC5C,CAAC;YAED,qCAAY,GAAZ,UAAa,EAAU,EAAE,SAA4B,EAAE,IAAS;gBAC/D,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;YAC5C,CAAC;YAED,qCAAY,GAAZ,UAAa,MAAc,EAAE,IAAgB;gBAC5C,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;YAC5C,CAAC;YAED,sCAAa,GAAb,UAAc,MAAc,EAAE,QAAgB,EAAE,SAAoB,EACtD,IAAgB,EAAE,SAAqB;gBACpD,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;YAC5C,CAAC;YAED,kCAAS,GAAT,UAAU,OAAe,EAAE,IAAY;gBACtC,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;YAC5C,CAAC;YAEM,uCAAc,GAArB,UAAsB,OAAmB,EAAE,MAAc;gBACxD,IAAI,YAAY,GAAG,IAAI,QAAA,QAAQ,CAAC,MAAM,CAAC,yBAAyB,CAC/D,IAAI,CAAC,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;gBAE5B,IAAI,OAAO,GAAG,YAAY,CAAC,IAAI,EAAE,CAAC;gBAClC,MAAM,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;oBACrB;wBACC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAU,QAAQ;4BACzC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;wBACjC,CAAC,CAAC,CAAC;wBACH,KAAK,CAAC;oBACP;wBACC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAU,QAAQ;4BACzC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;wBAC9B,CAAC,CAAC,CAAC;wBACH,KAAK,CAAC;oBACP;wBACC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAU,QAAQ;4BACzC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;wBAC9B,CAAC,CAAC,CAAC;wBACH,KAAK,CAAC;gBACR,CAAC;YACF,CAAC;YAEM,iDAAwB,GAA/B,UAAgC,iBAAoC;gBACnE,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAU,QAAQ;oBACzC,QAAQ,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,CAAC;gBAC/C,CAAC,CAAC,CAAC;YACJ,CAAC;YAEM,0CAAiB,GAAxB,UAAyB,EAAU,EAAE,SAA6B,EAAE,IAAS;gBAC5E,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAU,QAAQ;oBACzC,QAAQ,CAAC,UAAU,CAAC,EAAE,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;gBAC1C,CAAC,CAAC,CAAC;YACJ,CAAC;YACF,qBAAC;QAAD,CAAC,AApFD,IAoFC;QApFY,uBAAc,iBAoF1B,CAAA;QAED;;;WAGG;QACH;YAOC,4BAAY,MAAc;gBAHlB,yBAAoB,GAA2D,EAAE,CAAC;gBAIzF,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;gBACtB,IAAI,CAAC,wBAAwB,GAAG,IAAI,uBAAuB,EAAE,CAAC;gBAC9D,IAAI,CAAC,qBAAqB,GAAG,IAAI,oBAAoB,EAAE,CAAC;gBACxD,IAAI,CAAC,OAAO,GAAG,IAAI,QAAA,eAAe,EAAE,CAAC;YACtC,CAAC;YAED,uCAAU,GAAV,UAAW,EAAU,EAAE,SAA6B,EAAE,IAAS;gBAC9D,IAAI,QAAQ,GAAG,IAAI,CAAC,oBAAoB,CAAC,EAAE,CAAC,CAAC;gBAC7C,QAAA,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE,mCAAmC,CAAC,CAAC;gBAC5D,QAAQ,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YAC3B,CAAC;YAED,8CAAiB,GAAjB,UAAkB,iBAAoC;gBACrD,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,qBAAqB,CAAC,iBAAiB,CAAC,UAAU,EAAE,iBAAiB,CAAC,WAAW,EAAE,iBAAiB,CAAC,UAAU,CAAC,CAAC;YACtI,CAAC;YAED,uCAAU,GAAV,UAAW,IAAS;gBACnB,IAAI,OAAO,GAAmB,IAAI,CAAC;gBACnC,IAAI,SAAS,GAAG,OAAO,CAAC,IAAI,CAAC;gBAC7B,MAAM,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;oBACnB;wBACC,IAAI,CAAC,OAAO,CAAC,cAAc,GAAG,KAAK,CAAC;wBACpC,KAAK,CAAC;oBACP;wBACC,IAAI,CAAC,OAAO,CAAC,cAAc,GAAG,IAAI,CAAC;wBACnC,KAAK,CAAC;oBACP;wBACC,yFAAyF;wBACzF,4CAA4C;wBAC5C,2GAA2G;wBAC3G,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG,KAAK,CAAC;wBAC/B,KAAK,CAAC;oBACP;wBACC,IAAI,oBAAoB,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC;wBACjF,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC;wBAC7D,oBAAoB,CAAC,2BAA2B,CAAC,aAAa,CAAC,UAAU,CAAC,oBAAoB,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;wBAChH,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG,IAAI,CAAC;wBAC9B,KAAK,CAAC;gBACR,CAAC;YAEF,CAAC;YAED,0CAAa,GAAb,UAAc,IAAS;gBACtB,IAAI,OAAO,GAAsB,IAAI,CAAC;gBACtC,sEAAsE;gBACtE,YAAY;gBACZ,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;gBACzF,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,MAAM,CAAC;gBAC9C,IAAI,CAAC,wBAAwB,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC;YAC9D,CAAC;YAED,uCAAU,GAAV,UAAW,IAAS;gBACnB,IAAI,OAAO,GAA2B,IAAI,CAAC;gBAC3C,IAAI,CAAC,qBAAqB,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;gBACvD,IAAI,MAAM,GAAG,IAAI,CAAC,qBAAqB,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;gBAClE,EAAE,CAAC,CAAC,QAAA,qBAAqB,CAAC,KAAK,CAAC,CAAC,CAAC;oBACjC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,qBAAqB,GAAG,OAAO,CAAC,IAAI,GAAG,WAAW,GAAG,OAAO,CAAC,KAAK,GAAG,YAAY,GAAG,MAAM,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC7J,EAAE,CAAC,CAAC,OAAO,CAAC,IAAI,KAAK,OAAO,IAAI,MAAM,CAAC,CAAC,CAAC;wBACxC,MAAM,CAAC,UAAU,EAAE,CAAC;oBACrB,CAAC;gBACF,CAAC;gBACD,IAAI,CAAC,OAAO,CAAC,kBAAkB,GAAG,IAAI,CAAC,qBAAqB,CAAC,aAAa,CAAC;YAC5E,CAAC;YAED,kDAAqB,GAArB,UAAsB,EAAU,EAAE,QAA4D;gBAC7F,IAAI,CAAC,oBAAoB,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC;YAC1C,CAAC;YACF,yBAAC;QAAD,CAAC,AA3ED,IA2EC;QAED;;;;;WAKG;QACH;YAkGC,gBAAY,GAAoB,EAAE,UAAuB;gBAxFjD,kBAAa,GAAW,CAAC,CAAC;gBAyClC;;mBAEG;gBACK,kBAAa,GAAG,CAAC,CAAC;gBAE1B;;mBAEG;gBACH,mBAAc,GAAG,IAAI,CAAC;gBAEtB;;mBAEG;gBACH,cAAS,GAAG,IAAI,CAAC;gBAEjB;;mBAEG;gBACK,wBAAmB,GAAoC,IAAI,CAAC;gBAEpE;;mBAEG;gBACK,+BAA0B,GAAG,IAAI,CAAC;gBAS1C;;mBAEG;gBACK,aAAQ,GAAW,IAAI,CAAC;gBAEhC;;mBAEG;gBACK,YAAO,GAAW,IAAI,CAAC;gBAE/B;;mBAEG;gBACK,eAAU,GAAW,IAAI,CAAC;gBAka1B,oCAA+B,GAAoF,EAAE,CAAC;gBA/Z7H,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;gBACf,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC;gBAClB,0BAA0B;gBAC1B,OAAO,IAAI,MAAM,CAAC,cAAc,CAAC,IAAI,EAAE,KAAK,EAAE,EAAC,KAAK,EAAE,GAAG,EAAC,CAAC,CAAC;gBAC5D,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;gBACpC,IAAI,CAAC,OAAO,GAAG,IAAI,QAAA,eAAe,EAAE,CAAC;gBACrC,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;gBAC9B,IAAI,CAAC,mBAAmB,GAAG,IAAI,kBAAkB,CAAC,IAAI,CAAC,CAAC;gBACxD,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YACxD,CAAC;YAhGD,sBAAI,gCAAY;qBAAhB;oBACC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC;gBAC3B,CAAC;;;eAAA;YA8DD,sBAAI,sCAAkB;qBAAtB,UAAuB,KAAsC;oBAC5D,EAAE,CAAC,CAAC,IAAI,CAAC,mBAAmB,KAAK,KAAK,CAAC,CAAC,CAAC;wBACxC,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC;oBACxC,CAAC;oBACD,IAAI,CAAC,mBAAmB,GAAG,KAAK,CAAC;gBAClC,CAAC;;;eAAA;YAgCD,sBAAI,yBAAK;gBAHT;;mBAEG;qBACH;oBACC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBACpB,CAAC;;;eAAA;YAED;;eAEG;YACK,6CAA4B,GAApC;gBACC,MAAM,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC;YAC7B,CAAC;YAED;;eAEG;YACK,kDAAiC,GAAzC;gBACC,MAAM,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC;YAC7B,CAAC;YAED,sBAAW,2BAAO;qBAAlB;oBACC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACtB,CAAC;qBAED,UAAmB,KAAa;oBAC/B,IAAI,CAAC,QAAQ,GAAG,KAAK,IAAI,IAAI,CAAC;gBAC/B,CAAC;;;eAJA;YAMD,sBAAW,6BAAS;qBAApB;oBACC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;gBACxB,CAAC;qBAED,UAAqB,KAAa;oBACjC,IAAI,CAAC,UAAU,GAAG,KAAK,IAAI,IAAI,CAAC;gBACjC,CAAC;;;eAJA;YAMD,sBAAW,0BAAM;qBAAjB;oBACC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;gBACrB,CAAC;;;eAAA;YAEM,qBAAI,GAAX,UAAY,GAAW,EAAE,MAAoB;gBAC5C,OAAO,IAAI,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,mBAAmB,CAAC,CAAC;gBACtD,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;gBACnB,IAAI,CAAC,MAAM,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;gBACjD,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;gBAClF,IAAI,UAAU,GAAG,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,iBAAiB,CAAC;gBAC7D,EAAE,CAAC,CAAC,QAAA,oBAAoB,CAAC,KAAK,CAAC,CAAC,CAAC;oBAChC,IAAI,CAAC,eAAe,EAAE,CAAC;oBACvB,UAAU,CAAC,mBAAmB,GAAG,KAAK,CAAC;gBACxC,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,IAAI,CAAC,qBAAqB,EAAE,CAAC;gBAC9B,CAAC;gBACD,IAAI,WAAW,GAAG,QAAA,kBAAkB,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;gBAC9D,IAAI,CAAC,wBAAwB,CAAC,WAAW,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;gBACxD,IAAI,OAAO,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBACzC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;oBACZ,IAAI,SAAS,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;oBAC3D,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;oBAC3C,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,IAAI,GAAG,WAAW,CAAC;gBACnD,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,OAAO,CAAC,CAAC;gBACpE,CAAC;YACF,CAAC;YAEO,oCAAmB,GAA3B;gBACC,IAAI,aAAa,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;gBAC9D,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;oBACtB,IAAI,UAAU,GAAQ,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,CAAC;oBAC9C,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;wBAChC,UAAU,CAAC,mBAAmB,CAAC,CAAC,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;oBACxD,CAAC;oBACA,aAAqB,CAAC,UAAU,GAA6B,UAAU,CAAC;gBAC1E,CAAC;gBACD,MAAM,CAAC,aAAa,CAAC;YACtB,CAAC;YAEO,wCAAuB,GAA/B;gBACC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAC3C,CAAC;YAEM,kCAAiB,GAAxB,UAAyB,aAA0C,EAC1C,KAAc;gBACtC,IAAI,UAAU,GAAG,IAAI,QAAA,QAAQ,CAAC,MAAM,CAAC,uBAAuB,EAAE,CAAC;gBAC/D,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;oBAClE,IAAI,KAAK,GAAwB,aAAa,CAAC;oBAC/C,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;oBAC7B,EAAE,CAAC,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC,CAAC;wBACrC,UAAU,CAAC,uBAAuB,CAAC,KAAK,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;wBACpE,IAAI,CAAC,0BAA0B,GAAG,KAAK,CAAC;oBACzC,CAAC;gBACF,CAAC;gBACD,UAAU,CAAC,sBAAsB,CAAC,aAAa,CAAC,CAAC;gBACjD,UAAU,CAAC,QAAQ,EAAE,CAAC;gBAEtB,SAAA,aAAa,CAAC,iBAAiB,CAAC,CAAC;gBACjC,IAAI,MAAM,CAAC;gBACX,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;oBACX,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,UAAU,CAAC,MAAM,EAAE,UAAU,CAAC,YAAY,CAAC,CAAC;gBACrE,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,UAAU,CAAC,MAAM,EAAE,UAAU,CAAC,YAAY,CAAC,CAAC,KAAK,EAAE,CAAC;gBAC5F,CAAC;gBACD,SAAA,aAAa,CAAC,iBAAiB,CAAC,CAAC;gBAEjC,MAAM,CAAC,MAAM,CAAC;YACf,CAAC;YAEM,kCAAiB,GAAxB,UAAyB,UAAsB;gBAC9C,IAAI,UAAU,GAAG,IAAI,QAAA,QAAQ,CAAC,MAAM,CAAC,uBAAuB,EAAE,CAAC;gBAC/D,UAAU,CAAC,sBAAsB,CAAC,UAAU,CAAC,CAAC;gBAC9C,UAAU,CAAC,QAAQ,EAAE,CAAC;gBACtB,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,UAAU,CAAC,MAAM,EAAE,UAAU,CAAC,YAAY,CAAC,CAAC,KAAK,EAAE,CAAC;YAC1F,CAAC;YAEM,6BAAY,GAAnB,UAAoB,UAAoC,EAAE,MAAmC,EACzE,MAAgC,EAChC,cAAgD,EAAE,SAAwB,EAC1E,QAAqC,EAAE,SAA0B;gBAFjE,uBAAA,EAAA,aAAgC;gBAChC,+BAAA,EAAA,qBAAgD;gBAAE,0BAAA,EAAA,gBAAwB;gBAC1E,yBAAA,EAAA,eAAqC;gBAAE,0BAAA,EAAA,iBAA0B;gBACpF,IAAI,UAAU,GAAG,IAAI,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,uBAAuB,EAAE,CAAC;gBACvE,UAAU,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;gBAEvC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;oBAChE,UAAU,CAAC,eAAe,CAA2B,MAAM,CAAC,CAAC;gBAC9D,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,UAAU,CAAC,sBAAsB,CAA8B,MAAM,CAAC,CAAC;gBACxE,CAAC;gBAED,UAAU,CAAC,iBAAiB,CAAC,UAAU,EAAE,MAAM,EAAE,MAAM,EAAE,cAAc,EAAE,SAAS,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC;gBACzG,UAAU,CAAC,QAAQ,EAAE,CAAC;gBAEtB,SAAA,aAAa,CAAC,aAAa,CAAC,CAAC;gBAC7B,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,UAAU,CAAC,MAAM,EAAE,UAAU,CAAC,YAAY,CAAC,CAAC;gBAC1E,SAAA,aAAa,CAAC,aAAa,CAAC,CAAC;YAC9B,CAAC;YAEM,sCAAqB,GAA5B,UAA6B,EAAU,EAAE,QAA4D;gBACpG,IAAI,CAAC,mBAAmB,CAAC,qBAAqB,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;YAC9D,CAAC;YAEM,mCAAkB,GAAzB,UAA0B,EAAU,EAAE,SAA4B,EAAE,IAAS;gBAC5E,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,EAAE,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;YAC3D,CAAC;YAEM,iCAAgB,GAAvB,UAAwB,OAAe,EAAE,IAAY;gBACpD,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;oBACjB,KAAK,MAAM;wBACV,IAAI,CAAC,eAAe,EAAE,CAAC;wBACvB,KAAK,CAAC;oBACP;wBACC,mBAAmB,CAAC,YAAY,GAAG,OAAO,CAAC,CAAC;gBAC9C,CAAC;gBACD,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YAC3C,CAAC;YAEM,iCAAgB,GAAvB;gBACC,IAAI,CAAC,uBAAuB,EAAE,CAAC;YAChC,CAAC;YAED;;eAEG;YACK,6BAAY,GAApB;gBACC,EAAE,CAAC,CAAC,CAAC,QAAA,oBAAoB,CAAC,KAAK,CAAC,CAAC,CAAC;oBACjC,EAAE,CAAC,CAAC,IAAI,CAAC,4BAA4B,EAAE,CAAC,CAAC,CAAC;wBACzC,MAAM,CAAC;oBACR,CAAC;oBACD,IAAI,iBAAiB,GAAG,WAAW,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,aAAa,CAAC;oBAC/D,EAAE,CAAC,CAAC,iBAAiB,GAAG,CAAC,IAAI,GAAG,QAAA,cAAc,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;wBACvD,MAAM,CAAC;oBACR,CAAC;gBACF,CAAC;gBACD,SAAA,aAAa,CAAC,MAAM,CAAC,CAAC;gBACtB,EAAE,CAAC,CAAC,QAAA,iBAAiB,CAAC,KAAK,CAAC,CAAC,CAAC;oBAC7B,IAAI,CAAC,uBAAuB,EAAE,CAAC;oBAC/B,IAAI,CAAC,aAAa,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;gBACxC,CAAC;gBACD,SAAA,aAAa,CAAC,MAAM,CAAC,CAAC;YACvB,CAAC;YAEO,+BAAc,GAAtB;gBACC,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC3C,aAAa,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YACnC,CAAC;YAEO,kCAAiB,GAAzB;gBACC,IAAI,SAAS,GAAG,QAAA,eAAe,CAAC,KAAK,CAAC;gBACtC,EAAE,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC;oBACnB,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC;gBACnC,CAAC;gBACD,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,SAAS,CAAC,CAAC;YACrC,CAAC;YAEO,gCAAe,GAAvB;gBACC,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;gBAChC,IAAI,IAAI,GAAG,IAAI,CAAC;gBAEhB;oBACC,6CAA6C;oBAC7C,uFAAuF;oBACvF,IAAI,CAAC,aAAa,GAAG,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC;oBAChE,IAAI,CAAC,cAAc,EAAE,CAAC;gBACvB,CAAC;gBAED,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;oBAChC,OAAO,CAAC,IAAI,CAAC,iDAAiD;wBAC7D,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;gBACrC,CAAC;gBACD,IAAI,EAAE,CAAC;YACR,CAAC;YAEO,gCAAe,GAAvB;gBACC,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;gBAC5C,YAAY,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;gBACjC,IAAI,CAAC,mBAAmB,GAAG,KAAK,CAAC;YAClC,CAAC;YAEO,sCAAqB,GAA7B;gBACC,IAAI,IAAI,GAAG,IAAI,CAAC;gBAChB,IAAI,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;gBACvE,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAElC;oBACC,IAAI,UAAU,GAAG,UAAU,CAAC,iBAAiB,CAAC;oBAC9C,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;wBACvB,UAAU,CAAC,eAAe,EAAE,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC;wBACtD,MAAM,CAAC;oBACR,CAAC;oBAED,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC;oBAExB,IAAI,OAAO,GAAG,IAAI,CAAC,iBAAiB,KAAK,SAAS,CAAC,CAAC;wBACnD,IAAI,CAAC,iBAAiB,CAAC,CAAC;wBACxB,UAAU,CAAC,KAAK,CAAC,eAAe,CAAC;oBAElC,KAAK,CAAC,WAAW,GAAG,UAAU,CAAC;oBAC/B,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,IAAI,EAAE,CAAC;oBAEpC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;wBACpF,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,QAAQ,CAAC;oBACzD,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC;oBACnC,CAAC;oBAED,KAAK,CAAC,SAAS,GAAG,UAAU,CAAC,SAAS,CAAC;oBACvC,KAAK,CAAC,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;oBACtC,KAAK,CAAC,cAAc,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;oBACxC,KAAK,CAAC,aAAa,CAAC,QAAA,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;oBAExD,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC;wBAC5B,IAAI,CAAC,mBAAmB,CAAC,iBAAiB,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;oBACpE,CAAC;oBAED,IAAI,CAAC,eAAe,EAAE,CAAC;gBACxB,CAAC;gBAED,eAAe,EAAE,CAAC;YACnB,CAAC;YAEO,+BAAc,GAAtB;gBACC,IAAI,eAAe,GAAG,CAAC,QAAA,oBAAoB,CAAC,KAAK,CAAC;gBAClD,IAAI,cAAc,GAAG,QAAA,oBAAoB,CAAC,KAAK,CAAC;gBAChD,EAAE,CAAC,CAAC,CAAC,cAAc,IAAI,CACrB,CAAC,QAAA,kBAAkB,CAAC,KAAK,IAAI,eAAe;oBAC5C,IAAI,CAAC,iCAAiC,EAAE,CAAC,CAAC,CAAC,CAAC;oBAC7C,MAAM,CAAC;gBACR,CAAC;gBACD,0DAA0D;gBAC1D,IAAI,kBAAkB,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,OAAO,CAAC;gBACtE,kBAAkB,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;gBACxC,iEAAiE;gBACjE,wFAAwF;gBACxF,mCAAmC;gBACnC,IAAI,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC;gBACxD,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC;oBAC1C,WAAW,CAAC,aAAa,EAAE,CAAC;oBAC5B,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC;wBAC1C,MAAM,CAAC;oBACR,CAAC;gBACF,CAAC;gBACD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAA,yBAAyB,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC;oBAC1D,SAAA,aAAa,CAAC,WAAW,CAAC,CAAC;oBAC3B,IAAI,KAAK,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;oBAC9B,kBAAkB,CAAC,sBAAsB,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC;oBACjE,SAAA,OAAO,CAAC,KAAK,CAAC,wBAAwB,EAAE,CAAC,EAAE,WAAW,CAAC,GAAG,EAAE,GAAG,KAAK,CAAC,CAAC;oBACtE,WAAW,CAAC,aAAa,EAAE,CAAC;oBAC5B,SAAA,aAAa,CAAC,WAAW,CAAC,CAAC;gBAC5B,CAAC;gBACD,IAAI,CAAC,aAAa,EAAE,CAAC;gBACrB,EAAE,CAAC,CAAC,QAAA,iBAAiB,CAAC,KAAK,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,GAAG,QAAA,iBAAiB,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;oBACzF,IAAI,CAAC,YAAY,EAAE,CAAC;gBACrB,CAAC;gBACD,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;gBACrB,IAAI,CAAC,YAAY,EAAE,CAAC;gBACpB,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC;YAC1B,CAAC;YAEO,6BAAY,GAApB;gBACC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS;oBAC7B,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,IAAI,GAAG,QAAA,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,GAAG;oBACxG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;YAC1D,CAAC;YAEO,gCAAe,GAAvB;gBACC,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC;gBACxB,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;gBAC1B,IAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC;gBAClC,IAAI,IAAI,GAAG,IAAI,CAAC;gBAEhB,UAAU,CAAC,gBAAgB,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,CAAC,QAAQ,EAAE;oBAChE,IAAI,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC;oBAC1B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;wBACX,MAAM,CAAC;oBACR,CAAC;oBACD,UAAU,CAAC,mBAAmB,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;oBAChF,IAAI,CAAC,eAAe,EAAE,CAAC;gBACxB,CAAC,CAAC,CAAC;gBAEH,UAAU,CAAC,gBAAgB,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE;oBACxD,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;oBAC1B,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;oBAE3B,IAAI,OAAO,GAA0C,EAAE,CAAC;oBACxD,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,UAAU,MAAM,EAAE,GAAG;wBACnD,EAAE,CAAC,CAAC,MAAM,YAAY,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC;4BACtD,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBACtB,CAAC;oBACF,CAAC,CAAC,CAAC;oBAEH,cAAc,MAAsC;wBACnD,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;wBACpC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;wBAChC,IAAI,cAAc,GAAG,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;wBAC/D,MAAM,CAAC,WAAW,CAAC,+BAA+B,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;wBACxE,EAAE,CAAC,CAAC,MAAM,YAAY,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC;4BAClD,cAAc,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;wBACpE,CAAC;wBACD,OAAO,KAAK,CAAC,WAAW,GAAG,CAAC,EAAE,CAAC;4BAC9B,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;wBACxB,CAAC;wBACD,KAAK,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;oBAChC,CAAC;oBAED,IAAI,eAAe,GAAG,CAAC,CAAC;oBAExB;wBACC,IAAI,MAAM,CAAC;wBACX,EAAE,CAAC,CAAC,QAAA,gBAAgB,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;4BAChC,MAAM,GAAG,UAAU,CAAC,aAAa,CAAC,QAAA,gBAAgB,CAAC,KAAK,CAAC,CAAC;4BAC1D,EAAE,CAAC,CAAC,MAAM,YAAY,OAAO,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC;4BAEvD,CAAC;4BAAC,IAAI,CAAC,CAAC;gCACP,MAAM,GAAG,IAAI,CAAC;4BACf,CAAC;wBACF,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,MAAM,GAAG,OAAO,CAAC,eAAe,EAAE,CAAC,CAAC;4BACpC,EAAE,CAAC,CAAC,eAAe,KAAK,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;gCACxC,eAAe,GAAG,CAAC,CAAC;4BACrB,CAAC;4BACD,EAAE,CAAC,CAAC,QAAA,qBAAqB,CAAC,KAAK,IAAI,CAAC;gCACnC,eAAe,GAAG,QAAA,qBAAqB,CAAC,KAAK,CAAC,CAAC,CAAC;gCAChD,eAAe,GAAG,CAAC,CAAC;4BACrB,CAAC;wBACF,CAAC;wBACD,IAAI,MAAM,GAAG,CAAC,CAAC;wBACf,EAAE,CAAC,CAAC,MAAM,IAAI,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;4BAC7B,IAAI,CAAC,MAAM,CAAC,CAAC;4BACb,EAAE,CAAC,CAAC,MAAM,YAAY,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC;gCAClD,MAAM,GAAgC,MAAO,CAAC,SAAS,CAAC;4BACzD,CAAC;wBACF,CAAC;wBACD,EAAE,CAAC,CAAC,QAAA,6BAA6B,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;4BAC7C,MAAM,GAAG,QAAA,6BAA6B,CAAC,KAAK,CAAC;wBAC9C,CAAC;wBACD,UAAU,CAAC,cAAc,EAAE,IAAI,CAAC,iBAAiB,EAAE,GAAG,MAAM,CAAC,CAAC;oBAC/D,CAAC;oBAED,UAAU,CAAC,cAAc,EAAE,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC;gBACtD,CAAC,CAAC,CAAC;YACJ,CAAC;YAED,6BAAY,GAAZ,UAAa,MAAsC,EAAE,IAAgB;gBACpE,OAAO,IAAI,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBACjC,MAAM,CAAC,mBAAmB,GAAG,IAAI,QAAA,cAAc,EAAE,CAAC,CAAC,mDAAmD;gBACtG,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,UAAU,MAAM;oBACvE,MAAM,CAAC,mBAAmB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBAC5C,CAAC,CAAC,CAAC;gBACH,uFAAuF;gBACvF,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;oBACf,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;gBACrB,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,MAAM,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,oBAAoB,EAAE,IAAI,CAAC,CAAC;gBACpE,CAAC;YACF,CAAC;YAED,8BAAa,GAAb,UAAc,MAAsC,EAAE,SAAoB,EAC5D,IAAgB,EAAE,SAAqB;gBACpD,OAAO,IAAI,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBACjC,MAAM,CAAC,mBAAmB,GAAG,IAAI,QAAA,cAAc,EAAE,CAAC,CAAC,mDAAmD;gBACtG,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC,IAAI,CAAC,UAAU,MAAM;oBACzG,MAAM,CAAC,mBAAmB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBAC5C,CAAC,CAAC,CAAC;gBACH,MAAM,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,oBAAoB,EAAE,IAAI,CAAC,CAAC;YACpE,CAAC;YAID,yCAAwB,GAAxB,UAAyB,MAAc,EAAE,QAAiB,EAAE,SAAkB;gBAC7E,EAAE,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;oBAC7B,IAAI,CAAC,+BAA+B,CAAC,IAAI,CAAC;wBACzC,QAAQ,EAAE,OAAO;wBACjB,QAAQ,EAAE,MAAM;wBAChB,QAAQ,EAAE,QAAQ;wBAClB,SAAS,EAAE,SAAS;qBACpB,CAAC,CAAC;oBACH,MAAM,CAAC;gBACR,CAAC;gBACD,IAAI,CAAC;oBACJ,IAAI,GAAG,GAAG,IAAU,MAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;oBACxC,IAAI,CAAC,+BAA+B,CAAC,IAAI,CAAC;wBACzC,QAAQ,EAAE,GAAG,CAAC,QAAQ;wBACtB,QAAQ,EAAE,GAAG,CAAC,QAAQ;wBACtB,QAAQ,EAAE,QAAQ;wBAClB,SAAS,EAAE,SAAS;qBACpB,CAAC,CAAC;gBACJ,CAAC;gBAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACb,CAAC;YACF,CAAC;YAED,yCAAwB,GAAxB,UAAyB,MAAc;gBACtC,IAAI,GAAQ,CAAC;gBACb,IAAI,CAAC;oBACJ,GAAG,GAAG,IAAU,MAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;gBACrC,CAAC;gBAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACZ,MAAM,gBAA6C;gBACpD,CAAC;gBACD,IAAI,MAAM,iBACkC,CAAC;gBAC7C,IAAI,CAAC,+BAA+B,CAAC,IAAI,CAAC,UAAU,KAAK;oBACxD,IAAI,OAAO,CAAC;oBACZ,EAAE,CAAC,CAAC,GAAG,CAAC,QAAQ,KAAK,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,QAAQ,KAAK,GAAG,CAAC,CAAC,CAAC;wBAC/D,OAAO,GAAG,KAAK,CAAC;oBACjB,CAAC;oBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;wBAC3B,OAAO,GAAG,IAAI,CAAC;oBAChB,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,gFAAgF;wBAChF,OAAO,GAAG,GAAG,CAAC,QAAQ,KAAK,QAAQ,IAAI,KAAK,CAAC,QAAQ,KAAK,QAAQ,CAAC;oBACpE,CAAC;oBACD,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;wBACb,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC;8CACsB,CAAC;0CACL,CAAC;wBAC7C,MAAM,CAAC,IAAI,CAAC;oBACb,CAAC;oBACD,MAAM,CAAC,KAAK,CAAC;gBACd,CAAC,EAAE,IAAI,CAAC,CAAC;gBACT,MAAM,CAAC,MAAM,CAAC;YACf,CAAC;YACF,aAAC;QAAD,CAAC,AAvjBD,IAujBC;QAvjBY,eAAM,SAujBlB,CAAA;IACF,CAAC,EAjxBc,MAAM,GAAN,cAAM,KAAN,cAAM,QAixBpB;AAAD,CAAC,EAjxBM,OAAO,KAAP,OAAO,QAixBb;ACjyBD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,OAAO,CAyDb;AAzDD,WAAO,OAAO;IAEb,IAAO,MAAM,GAAG,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC;IAGrC,IAAY,sBAIX;IAJD,WAAY,sBAAsB;QACjC,yEAAW,CAAA;QACX,mFAAgB,CAAA;QAChB,qEAAS,CAAA;IACV,CAAC,EAJW,sBAAsB,GAAtB,8BAAsB,KAAtB,8BAAsB,QAIjC;IAED,8BAAqC,SAAiC;QACrE,IAAI,MAAM,GAAG,IAAI,QAAA,cAAc,EAAoB,CAAC;QACpD,OAAO,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,GAAG,sBAAsB,CAAC,OAAO,CAAC,CAAC,CAAC;QAClE,QAAA,GAAG,CAAC,aAAa,CAAC,uBAAuB,CAAC,CAAC;QAC3C,QAAA,6BAA6B,CAAC,QAAQ,CAAC,IAAI,oBAA6B,CAAC,IAAI,CAAC,UAAU,MAAW;YAClG,IAAI,GAAG,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAC9C,IAAI,GAAG,GAAG,EAAC,GAAG,EAAE,aAAa,EAAE,GAAG,EAAE,GAAG,CAAC,MAAM,EAAC,CAAC;YAChD,IAAI,UAAU,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,IAAI,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC;YACvE,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YAC/B,GAAG,CAAC,UAAU,EAAE,CAAC;YACjB,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;YAClC,QAAA,GAAG,CAAC,aAAa,EAAE,CAAC;YAGpB,qEAAqE;YACrE,8DAA8D;YAC9D,qDAAqD;YACrD,oEAAoE;YACpE,2CAA2C;YAC3C,wBAAwB;YACxB,mGAAmG;YACnG,sEAAsE;YACtE,6CAA6C;YAC7C,0BAA0B;YAC1B,sBAAsB;YACtB,WAAW;YACX,GAAG;YAEH,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,GAAG,sBAAsB,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBACzD,QAAA,GAAG,CAAC,aAAa,CAAC,yBAAyB,CAAC,CAAC;gBAC7C,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC;oBAClB,QAAA,6BAA6B,CAAC,QAAQ,CAAC,IAAI,0BAAmC;oBAC9E,QAAA,6BAA6B,CAAC,QAAQ,CAAC,IAAI,8BAAuC;iBAAC,CAAC,CAAC,IAAI,CAAC,UAAU,OAAO;oBAC3G,IAAI,OAAO,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAC/E,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;oBACb,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;oBACxB,QAAA,GAAG,CAAC,aAAa,EAAE,CAAC;oBACpB,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;gBACrB,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;YACnB,CAAC;YAED,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YACpB,MAAM,CAAC,IAAI,CAAC;QACb,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;QAClB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC;IACvB,CAAC;IA7Ce,4BAAoB,uBA6CnC,CAAA;AACF,CAAC,EAzDM,OAAO,KAAP,OAAO,QAyDb;ACzED;;;;;;;;;;;;;;GAcG;AAEH,IAAO,OAAO,CAqdb;AArdD,WAAO,OAAO;IAAC,IAAA,MAAM,CAqdpB;IArdc,WAAA,MAAM;QACpB;YAAA;YAuCA,CAAC;YApCA,sBAAI,gDAAO;qBAAX;oBACC,MAAM,CAAC,IAAI,CAAC;gBACb,CAAC;;;eAAA;YAED,4CAAM,GAAN,UAAO,QAAoD;gBAC1D,UAAU,CAAC,WAAW,CAAC,EAAC,MAAM,EAAE,MAAM,EAAC,CAAC,CAAC;gBACzC,UAAU,CAAC,mBAAmB,CAAC,UAAU,IAAI;oBAC5C,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC/C,CAAC,CAAC,CAAC;gBACH,IAAI,CAAC,iBAAiB,GAAG,QAAQ,CAAC;YACnC,CAAC;YAED,sDAAgB,GAAhB,UAAiB,YAAoB;gBACpC,IAAI,GAAG,GAAQ,EAAC,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,YAAY,EAAE,MAAM,EAAE,KAAK,EAAC,CAAC;gBAC/E,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YAC7B,CAAC;YAED,wDAAkB,GAAlB,UAAmB,YAAoB;gBACtC,IAAI,GAAG,GAAQ,EAAC,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,YAAY,EAAE,MAAM,EAAE,IAAI,EAAC,CAAC;gBAC9E,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YAC7B,CAAC;YAED,0CAAI,GAAJ,UAAK,UAAkB;gBACtB,IAAI,GAAG,GAAQ,EAAC,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,UAAU,EAAC,CAAC;gBACxD,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YACpC,CAAC;YAED,0CAAI,GAAJ,UAAK,OAAe;gBACnB,IAAI,GAAG,GAAQ,EAAC,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAC,CAAC;gBAClD,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YACpC,CAAC;YAED,2CAAK,GAAL;gBACC,IAAI,GAAG,GAAQ,EAAC,MAAM,EAAE,OAAO,EAAC,CAAC;gBACjC,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YACpC,CAAC;YACF,kCAAC;QAAD,CAAC,AAvCD,IAuCC;QAvCY,kCAA2B,8BAuCvC,CAAA;QAED;YAAA;gBACS,aAAQ,GAAW,IAAI,CAAC;gBACxB,mBAAc,GAAW,CAAC,CAAC,CAAC,kBAAkB;gBAC9C,cAAS,GAAyB,EAAE,CAAC;YAsE9C,CAAC;YApEO,2CAAI,GAAX,UAAY,OAAe;gBAC1B,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;gBACxB,IAAI,OAAO,GAAG,IAAI,CAAC;gBACnB,UAAU,CAAC,mBAAmB,CAAC,UAAU,IAAI;oBAC5C,IAAI,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;oBAChD,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;wBACb,OAAO,CAAC,cAAc,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;oBACvC,CAAC;gBACF,CAAC,CAAC,CAAC;YACJ,CAAC;YAEO,qDAAc,GAAtB,UAAuB,OAA2B,EAAE,IAAS;gBAC5D,IAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;gBAC/B,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;oBACpB,KAAK,MAAM;wBACV,OAAO,CAAC,MAAM,EAAE,CAAC;wBACjB,KAAK,CAAC;oBACP,KAAK,OAAO;wBACX,OAAO,CAAC,OAAO,EAAE,CAAC;wBAClB,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC;wBACjC,OAAO,CAAC,GAAG,CAAC,WAAW,GAAG,SAAS,GAAG,UAAU,CAAC,CAAC;wBAClD,KAAK,CAAC;oBACP,KAAK,OAAO;wBACX,OAAO,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;wBAC/C,KAAK,CAAC;oBACP,KAAK,UAAU;wBACd,OAAO,CAAC,GAAG,CAAC,WAAW,GAAG,SAAS,GAAG,WAAW,GAAG,IAAI,CAAC,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC;wBACpF,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;wBACtB,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,YAAY,UAAU,CAAC,CAAC,CAAC,CAAC;4BACnC,IAAI,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;wBAC7B,CAAC;wBACD,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,UAAU,CAAC,IAAI,EAAE,EAAC,WAAW,EAAE,IAAI,CAAC,MAAM,EAAE,UAAU,EAAE,IAAI,CAAC,KAAK,EAAC,CAAC,CAAC;wBACnG,KAAK,CAAC;gBACR,CAAC;YACF,CAAC;YAEM,oDAAa,GAApB;gBACC,IAAI,SAAS,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;gBACtC,IAAI,OAAO,GAAG,IAAI,CAAC;gBACnB,IAAI,OAAO,GAAG;oBACb,IAAI,EAAE,UAAU,OAAY;wBAC3B,IAAI,IAAI,GAAG,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;wBAC3C,OAAO,CAAC,GAAG,CAAC,WAAW,GAAG,SAAS,GAAG,YAAY,GAAG,IAAI,CAAC,CAAC;wBAC3D,UAAU,CAAC,QAAQ,CAAC;4BACnB,GAAG,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,CAAC,MAAM;4BACjC,QAAQ,EAAE,OAAO,CAAC,QAAQ,EAAE,QAAQ,EAAE,OAAO,CAAC,IAAI;4BAClD,eAAe,EAAE,OAAO,CAAC,eAAe,EAAE,SAAS,EAAE,SAAS;yBAC9D,CAAC,CAAC;oBACJ,CAAC;oBACD,KAAK,EAAE;wBACN,EAAE,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;4BAClC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;wBACjC,CAAC;oBACF,CAAC;iBACD,CAAC;gBACF,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,OAAO,CAAC,CAAC;YAC9C,CAAC;YAED,iDAAU,GAAV,UAAW,GAAW;gBACrB,MAAM,CAAC,IAAU,MAAO,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC;YACvD,CAAC;YAED,iDAAU,GAAV,UAAW,GAAQ,EAAE,MAAW;gBAC/B,UAAU,CAAC,UAAU,CAAC;oBACrB,GAAG,EAAE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC;oBACzB,MAAM,EAAE,MAAM;iBACd,CAAC,CAAC;YACJ,CAAC;YACF,mCAAC;QAAD,CAAC,AAzED,IAyEC;QAzEY,mCAA4B,+BAyExC,CAAA;QAED;YAAA;YAIA,CAAC;YAHA,iDAAY,GAAZ,UAAa,IAAY;gBACxB,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;YAC/B,CAAC;YACF,iCAAC;QAAD,CAAC,AAJD,IAIC;QAJY,iCAA0B,6BAItC,CAAA;QAED;YAAA;YAIA,CAAC;YAHA,oDAAe,GAAf,UAAgB,IAAS;gBACxB,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAClC,CAAC;YACF,iCAAC;QAAD,CAAC,AAJD,IAIC;QAJY,iCAA0B,6BAItC,CAAA;QAED;YAAA;YA8CA,CAAC;YAzCA,iDAAa,GAAb;gBACC,IAAI,OAAO,GAAG,IAAI,CAAC;gBACnB,IAAI,MAAgC,CAAC;gBACrC,MAAM,CAAC;oBACN,IAAI,EAAE,UAAU,OAAY;wBAC3B,IAAI,IAAI,GAAQ,IAAI,CAAC;wBACrB,IAAI,IAAI,GAAG,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;wBAC3C,OAAO,CAAC,GAAG,CAAC,8BAA8B,GAAG,IAAI,GAAG,UAAU,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;wBAC/E,MAAM,GAAG,IAAI,OAAO,CAAC,gBAAgB,CAAC,IAAI,EAAE,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,QAAQ,EAC3E,OAAO,CAAC,IAAI,CAAC,CAAC;wBACf,MAAM,CAAC,WAAW,CACjB,OAAO,CAAC,kBAAkB,EAC1B,UAAU,IAAI,EAAE,QAAQ;4BACvB,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,EAAC,WAAW,EAAE,QAAQ,CAAC,MAAM,EAAE,UAAU,EAAE,QAAQ,CAAC,KAAK,EAAC,CAAC,CAAC;wBACnF,CAAC,EACD,UAAU,CAAC;4BACV,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;wBACjB,CAAC,EACD,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,YAAY,CAAC,CAAC;oBACrB,CAAC;oBACD,KAAK,EAAE;wBACN,MAAM,CAAC,KAAK,EAAE,CAAC;wBACf,MAAM,GAAG,IAAI,CAAC;oBACf,CAAC;iBACD,CAAC;YACH,CAAC;YAED,wCAAI,GAAJ,UAAK,OAAe,EAAE,iBAA6B;gBAA7B,kCAAA,EAAA,qBAA6B;gBAClD,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;gBACxB,IAAI,CAAC,kBAAkB,GAAG,iBAAiB,CAAC;YAC7C,CAAC;YAED,8CAAU,GAAV,UAAW,GAAW;gBACrB,MAAM,CAAC,IAAU,MAAO,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC;YACvD,CAAC;YAED,8CAAU,GAAV,UAAW,GAAW,EAAE,MAAc;gBACrC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,MAAM,IAAI,QAAQ,CAAC,CAAC;YACvD,CAAC;YACF,gCAAC;QAAD,CAAC,AA9CD,IA8CC;QA9CY,gCAAyB,4BA8CrC,CAAA;QAED;YAGC,2CAAmB,OAAgB;gBAClC,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;gBAE3B,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;oBACb,IAAI,CAAC,IAAI,oBAA6B,CAAC;oBACvC,IAAI,CAAC,IAAI,0BAAmC,CAAC;oBAC7C,IAAI,CAAC,IAAI,8BAAuC,CAAC;gBAClD,CAAC;gBAED,UAAU,CAAC,yBAAyB,CAAC,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACjF,CAAC;YAEO,qEAAyB,GAAjC,UAAkC,EAAoB,EAAE,IAAS;gBAChE,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACzC,CAAC;YAEM,gDAAI,GAAX,UAAY,EAAoB;gBAC/B,IAAI,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAC;gBACvC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;oBACb,MAAM,GAAG,IAAI,QAAA,cAAc,EAAO,CAAC;oBACnC,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC;oBAEnC,UAAU,CAAC,kBAAkB,CAAC,EAAE,CAAC,CAAC;gBACnC,CAAC;gBACD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC;YACvB,CAAC;YACF,wCAAC;QAAD,CAAC,AA7BD,IA6BC;QA7BY,wCAAiC,oCA6B7C,CAAA;QAED;YACC,8CAA0B,WAAmB,EACnB,sBAA2D,EAC3D,SAAkB;gBAFlB,gBAAW,GAAX,WAAW,CAAQ;gBACnB,2BAAsB,GAAtB,sBAAsB,CAAqC;gBAC3D,cAAS,GAAT,SAAS,CAAS;YAC5C,CAAC;YAEM,mDAAI,GAAX,UAAY,EAAoB;gBAC/B,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACZ;wBACC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;oBAC3D;wBACC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,sBAAsB,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;oBAC3E;wBACC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,sBAAsB,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;oBACvE;wBACC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,EAAE,aAAa,CAAC,CAAC;oBACzD;wBACC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,kCAAkC,GAAG,EAAE,CAAC,CAAC,CAAC;gBAC5E,CAAC;YACF,CAAC;YAEO,2DAAY,GAApB,UAAqB,IAAS,EAAE,YAAiB;gBAChD,MAAM,CAAC,IAAI,OAAO,CAAC,UAAU,OAAO,EAAE,MAAM;oBAC3C,QAAA,GAAG,CAAC,aAAa,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;oBACrC,IAAI,GAAG,GAAG,IAAI,cAAc,EAAE,CAAC;oBAC/B,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;oBACtB,GAAG,CAAC,YAAY,GAAG,YAAY,CAAC;oBAChC,GAAG,CAAC,MAAM,GAAG;wBACZ,QAAA,GAAG,CAAC,aAAa,EAAE,CAAC;wBACpB,IAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;wBAC5B,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;4BACd,EAAE,CAAC,CAAC,YAAY,KAAK,MAAM,IAAI,GAAG,CAAC,YAAY,KAAK,MAAM,CAAC,CAAC,CAAC;gCAC5D,wDAAwD;gCACxD,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;4BACjC,CAAC;4BACD,OAAO,CAAC,QAAQ,CAAC,CAAC;wBACnB,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,MAAM,CAAC,iBAAiB,GAAG,IAAI,GAAG,IAAI,GAAG,GAAG,CAAC,UAAU,CAAC,CAAC;wBAC1D,CAAC;oBACF,CAAC,CAAC;oBACF,GAAG,CAAC,OAAO,GAAG;wBACb,QAAA,GAAG,CAAC,aAAa,EAAE,CAAC;wBACpB,MAAM,CAAC,2BAA2B,CAAC,CAAC;oBACrC,CAAC,CAAC;oBACF,GAAG,CAAC,IAAI,EAAE,CAAC;gBACZ,CAAC,CAAC,CAAC;YACJ,CAAC;YACF,2CAAC;QAAD,CAAC,AA/CD,IA+CC;QA/CY,2CAAoC,uCA+ChD,CAAA;QAED,oCAAoC,cAAsB,EACtB,cAAuB;YAC1D,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,OAAO,cAAc,KAAK,QAAQ,CAAC,CAAC;YAC5D,qFAAqF;YACrF,uFAAuF;YACvF,2FAA2F;YAC3F,EAAE,CAAC,CAAC,CAAC,OAAO,IAAI,cAAc,CAAC,CAAC,CAAC;gBAChC,QAAA,KAAK,CAAC,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAClD,CAAC;YACD,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC/B,EAAE,CAAC,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;oBACxC,IAAI,UAAU,GAAG,IAAI,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;oBACxE,cAAc,GAAG,UAAU,CAAC,QAAQ,GAAG,GAAG,GAAG,cAAc,CAAC;gBAC7D,CAAC;gBACD,yFAAyF;gBACzF,oCAAoC;gBACpC,EAAE,CAAC,CAAC,CAAC,OAAO,IAAI,cAAc,CAAC,CAAC,CAAC;oBAChC,QAAA,KAAK,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC;gBACtD,CAAC;YACF,CAAC;YACD,MAAM,CAAC,cAAc,CAAC;QACvB,CAAC;QAED;;;;;;WAMG;QACH,sCAAsC,GAAoB,EAAE,GAAQ,EAC9B,qBAA6B,EAC7B,gBAAgC;YACrE,EAAE,CAAC,CAAC,CAAC,GAAG,IAAI,OAAO,GAAG,KAAK,QAAQ,CAAC,CAAC,CAAC;gBACrC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,qBAAqB,EAAE,gBAAgB,EAAE,GAAG,CAAC,CAAC;YACtE,CAAC;YACD,IAAI,EAAE,GAAG,GAAG,CAAC,OAAO,CAAC,CAAC;gBACrB,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBAClB,QAAA,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,OAAO,iBAA4B,CAAC;YAClE,IAAI,OAAO,GAA+B,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;YACjF,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBACpC,EAAE,GAAG,QAAA,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,OAAO,iBAA4B,CAAC;gBACtE,OAAO,GAAiB,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;gBAC/D,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;YACxD,CAAC;YACD,IAAI,eAAe,GAAG,QAAA,eAAe,CAAC,qBAAqB,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC;YAC/E,IAAI,OAAO,GAAG,eAAe,IAAI,eAAe,CAAC,KAAK,IAAI,EAAE,CAAC;YAC7D,IAAI,UAAU,GAAG,QAAA,eAAe,CAAC,qBAAqB,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;YACxE,IAAI,EAAE,GAAG,UAAU,IAAI,UAAU,CAAC,KAAK,IAAI,CAAC,CAAC;YAC7C,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;QAC3C,CAAC;QAED;YAAA;gBACW,sBAAiB,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAwDnD,CAAC;YAtDA,qDAAgB,GAAhB,UAAiB,cAAsB,EACtB,QAAkC;gBAClD,MAAM,CAAC,SAAS,CAAC;YAClB,CAAC;YAED,oDAAe,GAAf,UAAgB,cAAsB,EACtB,QAAkC;gBACjD,MAAM,CAAC,SAAS,CAAC;YAClB,CAAC;YAED,kDAAa,GAAb,UAAc,cAAsB;gBACnC,MAAM,CAAC,KAAK,CAAC;YACd,CAAC;YAED,iDAAY,GAAZ,UAAa,cAAsB,EAAE,UAAkB,EAAE,UAAuB,EACnE,MAA8B,EAAE,YAAoB,EAAE,cAAuB;gBACzF,MAAM,CAAC,SAAgB,CAAC;YACzB,CAAC;YAED,yCAAI,GAAJ,UAAK,cAAsB,EAAE,UAAkB,EAAE,UAAuB,EACnE,MAA8B,EAAE,YAAoB,EAAE,cAAuB;gBACjF,cAAc,GAAG,0BAA0B,CAAC,cAAc,EAAE,KAAK,CAAC,CAAC;gBACnE,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,OAAO,UAAU,KAAK,QAAQ,CAAC,CAAC;gBACxD,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,UAAU,YAAY,WAAW,CAAC,CAAC;gBAC3D,IAAI,IAAI,GAAG,IAAI,CAAC;gBAEhB;oBACC,IAAI,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC;oBACrE,IAAI,WAAW,GAAG,IAAI,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EACrF,MAAM,CAAC,CAAC;oBACT,IAAI,CAAC;wBACJ,MAAM,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;oBACnC,CAAC;oBAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBACZ,OAAO,CAAC,IAAI,CAAC,sEAAsE;4BAClF,UAAU,EAAE,CAAC,CAAC,CAAC;oBACjB,CAAC;oBAED,EAAE,CAAC,CAAC,MAAM,KAAK,OAAO,CAAC,CAAC,CAAC;wBACxB,8DAA8D;wBAC9D,MAAM,CAAC;oBACR,CAAC;oBACD,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,OAAO,YAAY,KAAK,QAAQ,CAAC,CAAC;oBAC1D,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,OAAO,cAAc,KAAK,SAAS,CAAC,CAAC;oBAC7D,IAAI,CAAC,YAAY,CAAC,cAAc,EAAE,UAAU,EAAE,UAAU,EAAE,MAAM,EAAE,YAAY,EAC7E,cAAc,CAAC,CAAC;gBAClB,CAAC;gBAED,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YAClD,CAAC;YAED,iDAAY,GAAZ,UAAa,cAAsB,EAAE,QAAkC,EAAE,OAAiB,EAC7E,MAAe;gBAC3B,QAAA,KAAK,CAAC,mBAAmB,CAAC,6BAA6B,CAAC,CAAC;YAC1D,CAAC;YACF,iCAAC;QAAD,CAAC,AAzDD,IAyDC;QAzDY,iCAA0B,6BAyDtC,CAAA;QAED;YAAsD,oDAA0B;YAAhF;;YA6DA,CAAC;YA3DA,2DAAgB,GAAhB,UAAiB,cAAsB,EACtB,QAAkC;gBAClD,cAAc,GAAG,0BAA0B,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;gBAClE,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBAClC,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;oBACxC,MAAM,uBAA2C;gBAClD,CAAC;gBAED,kBAAkB,UAAkB,EAAE,UAAuB;oBAC5D,IAAI,CAAC;wBACJ,QAAQ,CAAC,aAAa,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;wBAC/C,MAAM,CAAC,IAAI,CAAC;oBACb,CAAC;oBAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBACZ,OAAO,CAAC,GAAG,CAAC,6BAA6B,EAAE,CAAC,CAAC,CAAC;wBAC9C,MAAM,CAAC,CAAC,CAAC;oBACV,CAAC;gBACF,CAAC;gBAED,IAAI,MAAM,GAAG,UAAU,CAAC,yBAAyB,EAAE,CAAC,qBAAqB,CAAC,cAAc,EACvF,QAAQ,CAAC,CAAC;gBACX,EAAE,CAAC,CAAC,MAAM,oBAAyC,CAAC,CAAC,CAAC;oBACrD,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACD,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,GAAG,QAAQ,CAAC;gBAClD,MAAM,iBAAsC;YAC7C,CAAC;YAED,0DAAe,GAAf,UAAgB,cAAsB,EACtB,QAAkC;gBACjD,cAAc,GAAG,0BAA0B,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;gBAClE,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,KAAK,QAAQ,CAAC,CAAC,CAAC;oBACzD,MAAM,uBAAyC;gBAChD,CAAC;gBACD,UAAU,CAAC,yBAAyB,EAAE,CAAC,oBAAoB,CAAC,cAAc,CAAC,CAAC;gBAC5E,OAAO,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;gBAC9C,MAAM,iBAAoC;YAC3C,CAAC;YAED,wDAAa,GAAb,UAAc,cAAsB;gBACnC,MAAM,CAAC,UAAU,CAAC,yBAAyB,EAAE,CAAC,kBAAkB,CAAC,cAAc,CAAC,CAAC;YAClF,CAAC;YAED,uDAAY,GAAZ,UAAa,cAAsB,EAAE,UAAkB,EAAE,UAAuB,EACnE,MAA8B,EAAE,YAAoB,EAAE,cAAuB;gBACzF,IAAI,OAAO,GAAG,UAAU,CAAC,yBAAyB,EAAE,CAAC;gBACrD,OAAO,CAAC,0BAA0B,CAAC,cAAc,EAAE,UAAU,EAAE,UAAU,EAAE,MAAM,EAChF,YAAY,EAAE,cAAc,CAAC,CAAC;YAChC,CAAC;YAED,uDAAY,GAAZ,UAAa,cAAsB,EAAE,QAAkC,EAAE,OAAiB,EAC7E,MAAe;gBAC3B,cAAc,GAAG,0BAA0B,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;gBAClE,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,KAAK,QAAQ,CAAC,CAAC,CAAC;oBACzD,OAAO,CAAC,IAAI,CAAC,iDAAiD,GAAG,cAAc,CAAC,CAAC;oBACjF,MAAM,CAAC;gBACR,CAAC;gBACD,UAAU,CAAC,yBAAyB,EAAE,CAAC,8BAA8B,CAAC,cAAc,EAAE,OAAO,EAC5F,MAAM,CAAC,CAAC;YACV,CAAC;YACF,uCAAC;QAAD,CAAC,AA7DD,CAAsD,0BAA0B,GA6D/E;QA7DY,uCAAgC,mCA6D5C,CAAA;QAED;YAA0D,wDAA0B;YAApF;;YAqCA,CAAC;YApCA,+DAAgB,GAAhB,UAAiB,cAAsB,EACtB,QAAkC;gBAClD,cAAc,GAAG,0BAA0B,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;gBAClE,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBAClC,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;oBAC5C,MAAM,uBAA2C;gBAClD,CAAC;gBACD,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,GAAG,QAAQ,CAAC;gBAClD,MAAM,iBAAsC;YAC7C,CAAC;YAED,8DAAe,GAAf,UAAgB,cAAsB,EACtB,QAAkC;gBACjD,cAAc,GAAG,0BAA0B,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;gBAClE,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,KAAK,QAAQ,CAAC,CAAC,CAAC;oBACzD,MAAM,uBAAyC;gBAChD,CAAC;gBACD,OAAO,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;gBAC9C,MAAM,iBAAoC;YAC3C,CAAC;YAGD,4DAAa,GAAb,UAAc,cAAsB;gBACnC,MAAM,CAAC,cAAc,IAAI,IAAI,CAAC,iBAAiB,CAAC;YACjD,CAAC;YAED,2DAAY,GAAZ,UAAa,cAAsB,EAAE,UAAkB,EAAE,UAAuB,EACnE,MAA8B,EAAE,SAAiB;gBAC7D,IAAI,QAAQ,GAA6B,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;gBAChF,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBAClC,IAAI,CAAC;oBACJ,QAAQ,CAAC,aAAa,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;gBAChD,CAAC;gBAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACZ,QAAA,KAAK,CAAC,OAAO,CAAC,qEAAqE,CAAC,CAAC;gBACtF,CAAC;YACF,CAAC;YACF,2CAAC;QAAD,CAAC,AArCD,CAA0D,0BAA0B,GAqCnF;QArCY,2CAAoC,uCAqChD,CAAA;IACF,CAAC,EArdc,MAAM,GAAN,cAAM,KAAN,cAAM,QAqdpB;AAAD,CAAC,EArdM,OAAO,KAAP,OAAO,QAqdb;ACreD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,OAAO,CAmIb;AAnID,WAAO,OAAO;IAAC,IAAA,MAAM,CAmIpB;IAnIc,WAAA,QAAM;QAAC,IAAA,MAAM,CAmI3B;QAnIqB,WAAA,MAAM;YAE3B,IAAO,UAAU,GAAG,OAAO,CAAC,cAAc,CAAC,UAAU,CAAC;YAItD;gBAAsC,oCAAc;gBAInD,0BAAY,GAAoB,EAAE,IAAqC;oBAAvE,YACC,kBAAM,GAAG,CAAC,SAMV;oBALA,KAAI,CAAC,KAAK,GAAG,IAAI,CAAC;oBAClB,KAAI,CAAC,KAAK,CAAC,cAAc,GAAG,UAAU,GAAQ;wBAC7C,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;oBAC3B,CAAC,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;oBACb,KAAI,CAAC,sBAAsB,GAAG,EAAE,CAAC;;gBAClC,CAAC;gBAED,iCAAM,GAAN,UAAO,OAAmB,EAAE,MAAa;oBACxC,IAAI,KAAK,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC;oBAC/B,IAAI,OAAO,GAAQ;wBAClB,IAAI,EAAE,QAAQ;wBACd,OAAO,EAAE,KAAK;wBACd,MAAM,EAAE,MAAM;wBACd,MAAM,EAAE,SAAS;qBACjB,CAAC;oBACF,IAAI,YAAY,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;oBAClC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;gBACpD,CAAC;gBAED,uCAAY,GAAZ,UAAa,OAAmB,EAAE,MAAa;oBAC9C,IAAI,KAAK,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC;oBAC/B,IAAI,OAAO,GAAQ;wBAClB,IAAI,EAAE,QAAQ;wBACd,OAAO,EAAE,KAAK;wBACd,MAAM,EAAE,MAAM;wBACd,MAAM,EAAE,SAAS;qBACjB,CAAC;oBACF,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;oBACjD,MAAM,CAAC,UAAU,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;gBAC3C,CAAC;gBAED,gCAAK,GAAL;oBACC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC;wBAC3B,IAAI,EAAE,OAAO;qBACb,CAAC,CAAC;gBACJ,CAAC;gBAED,uCAAY,GAAZ,UAAa,EAAU,EAAE,SAA4B,EAAE,IAAS;oBAC/D,IAAI,OAAO,GAAQ;wBAClB,IAAI,EAAE,cAAc;wBACpB,EAAE,EAAE,EAAE;wBACN,SAAS,EAAE,SAAS;wBACpB,IAAI,EAAE,IAAI;wBACV,MAAM,EAAE,SAAS;qBACjB,CAAC;oBACF,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;gBAC5C,CAAC;gBAED,uCAAY,GAAZ,UAAa,MAAc,EAAE,IAAgB;oBAC5C,IAAI,SAAS,GAAG,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC;oBACnD,IAAI,MAAM,GAAG,IAAI,QAAA,cAAc,EAAO,CAAC;oBACvC,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,GAAG,MAAM,CAAC;oBAChD,IAAI,OAAO,GAAG;wBACb,IAAI,EAAE,cAAc;wBACpB,MAAM,EAAE,MAAM;wBACd,IAAI,EAAE,IAAI;wBACV,SAAS,EAAE,SAAS;qBACpB,CAAC;oBACF,2FAA2F;oBAC3F,yFAAyF;oBACzF,mEAAmE;oBACnE,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;oBACpC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC;gBACvB,CAAC;gBAED,wCAAa,GAAb,UAAc,MAAc,EAAE,QAAgB,EAAE,SAAoB,EACtD,IAAgB,EAAE,SAAqB;oBACpD,IAAI,SAAS,GAAG,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC;oBACnD,IAAI,MAAM,GAAG,IAAI,QAAA,cAAc,EAAO,CAAC;oBACvC,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,GAAG,MAAM,CAAC;oBAChD,IAAI,OAAO,GAAG;wBACb,IAAI,EAAE,eAAe;wBACrB,MAAM,EAAE,MAAM;wBACd,QAAQ,EAAE,QAAQ;wBAClB,SAAS,EAAE,SAAS;wBACpB,IAAI,EAAE,IAAI;wBACV,SAAS,EAAE,SAAS;wBACpB,SAAS,EAAE,SAAS;qBACpB,CAAC;oBACF,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;oBACrC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC;gBACvB,CAAC;gBAED,oCAAS,GAAT,UAAU,OAAe,EAAE,IAAY;oBACtC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC;wBAC3B,IAAI,EAAE,WAAW;wBACjB,OAAO,EAAE,OAAO;wBAChB,IAAI,EAAE,IAAI;qBACV,CAAC,CAAC;gBACJ,CAAC;gBAEO,0CAAe,GAAvB,UAAwB,IAAS;oBAChC,EAAE,CAAC,CAAC,OAAO,IAAI,KAAK,QAAQ,IAAI,IAAI,KAAK,IAAI,CAAC,CAAC,CAAC;wBAC/C,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;4BACnB,KAAK,KAAK;gCACT,IAAI,YAAU,GAAG,OAAO,CAAC,cAAc,CAAC,UAAU,CAAC;gCACnD,IAAI,OAAO,GAAG,YAAU,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gCAC9D,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;gCAC1C,KAAK,CAAC;4BACP,KAAK,eAAe;gCACnB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;gCAC3D,KAAK,CAAC;4BACP,KAAK,mBAAmB;gCACvB,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gCAC3C,KAAK,CAAC;4BACP,KAAK,sBAAsB,CAAC;4BAC5B,KAAK,uBAAuB;gCAC3B,IAAI,OAAO,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gCAC1D,OAAO,IAAI,QAAA,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;gCACjC,OAAO,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gCACnD,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gCAC7B,KAAK,CAAC;4BACP,KAAK,SAAS;gCACb,OAAO,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gCAC5C,KAAK,CAAC;wBACR,CAAC;oBACF,CAAC;gBACF,CAAC;gBACF,uBAAC;YAAD,CAAC,AA5HD,CAAsC,SAAA,cAAc,GA4HnD;YA5HY,uBAAgB,mBA4H5B,CAAA;QACF,CAAC,EAnIqB,MAAM,GAAN,eAAM,KAAN,eAAM,QAmI3B;IAAD,CAAC,EAnIc,MAAM,GAAN,cAAM,KAAN,cAAM,QAmIpB;AAAD,CAAC,EAnIM,OAAO,KAAP,OAAO,QAmIb;ACnJD;;;;;;;;;;;;;;GAcG;AAEH,iCAAiC;AACjC,mCAAmC;AACnC,yCAAyC;AACzC,yCAAyC;AACzC,iCAAiC;AACjC,oCAAoC;AACpC,mCAAmC;AAEnC,8CAA8C","sourcesContent":["/*\n * Copyright 2013 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.Player {\n\texport let timelineBuffer = Shumway.Tools ? new Shumway.Tools.Profiler.TimelineBuffer(\"Player\") : null;\n\texport let counter = new Shumway.Metrics.Counter(!release);\n\n\texport let writer: IndentingWriter = null; // new IndentingWriter();\n\n\texport function enterTimeline(name: string, data?: any) {\n\t\twriter && writer.enter(name);\n\t\tprofile && timelineBuffer && timelineBuffer.enter(name, data);\n\t}\n\n\texport function leaveTimeline(name: string, data?: any) {\n\t\twriter && writer.leave(name);\n\t\tprofile && timelineBuffer && timelineBuffer.leave(name, data);\n\t}\n}\n","/*\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway {\n\timport Option = Shumway.Options.Option;\n\timport OptionSet = Shumway.Options.OptionSet;\n\n\timport shumwayOptions = Shumway.Settings.shumwayOptions;\n\n\texport let playerOptions = shumwayOptions.register(new OptionSet(\"Player Options\"));\n\n\texport let frameEnabledOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"enableFrames\", \"Enable Frame Execution\", \"boolean\", true, \"Enable frame execution.\")\n\t);\n\n\texport let timerEnabledOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"enableTimers\", \"Enable Timers\", \"boolean\", true, \"Enable timer events.\")\n\t);\n\n\texport let pumpEnabledOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"enablePump\", \"Enable Pump\", \"boolean\", true, \"Enable display tree serialization.\")\n\t);\n\n\texport let pumpRateOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"pumpRate\", \"Pump Rate\", \"number\", 60, \"Number of times / second that the display list is synchronized.\", {\n\t\t\trange: {\n\t\t\t\tmin: 1,\n\t\t\t\tmax: 120,\n\t\t\t\tstep: 1\n\t\t\t}\n\t\t})\n\t);\n\n\texport let frameRateOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"frameRate\", \"Frame Rate\", \"number\", -1, \"Override a movie's frame rate, set to -1 to use the movies default frame rate.\", {\n\t\t\trange: {\n\t\t\t\tmin: -1,\n\t\t\t\tmax: 120,\n\t\t\t\tstep: 1\n\t\t\t}\n\t\t})\n\t);\n\n\texport let tracePlayerOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"tp\", \"Trace Player\", \"number\", 0, \"Trace player every n frames.\", {\n\t\t\trange: {\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 512,\n\t\t\t\tstep: 1\n\t\t\t}\n\t\t})\n\t);\n\n\texport let traceMouseEventOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"tme\", \"Trace Mouse Events\", \"boolean\", false, \"Trace mouse events.\")\n\t);\n\n\texport let frameRateMultiplierOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"\", \"Frame Rate Multiplier\", \"number\", 1, \"Play frames at a faster rate.\", {\n\t\t\trange: {\n\t\t\t\tmin: 1,\n\t\t\t\tmax: 16,\n\t\t\t\tstep: 1\n\t\t\t}\n\t\t})\n\t);\n\n\texport let dontSkipFramesOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"\", \"Disables Frame Skipping\", \"boolean\", false, \"Play all frames, e.g. no skipping frame during throttle.\")\n\t);\n\n\texport let playAllSymbolsOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"\", \"Play Symbols\", \"boolean\", false, \"Plays all SWF symbols automatically.\")\n\t);\n\n\texport let playSymbolOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"\", \"Play Symbol Number\", \"number\", 0, \"Select symbol by Id.\", {\n\t\t\trange: {\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 20000,\n\t\t\t\tstep: 1\n\t\t\t}\n\t\t})\n\t);\n\n\texport let playSymbolFrameDurationOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"\", \"Play Symbol Duration\", \"number\", 0, \"How many frames to play, 0 for all frames of the movie clip.\", {\n\t\t\trange: {\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 128,\n\t\t\t\tstep: 1\n\t\t\t}\n\t\t})\n\t);\n\n\texport let playSymbolCountOption = playerOptions.register(\n\t\tnew Shumway.Options.Option(\"\", \"Play Symbol Count\", \"number\", -1, \"Select symbol count.\", {\n\t\t\trange: {\n\t\t\t\tmin: -1,\n\t\t\t\tmax: 20000,\n\t\t\t\tstep: 1\n\t\t\t}\n\t\t})\n\t);\n}\n","/**\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway {\n\texport class FrameScheduler {\n\t\tprivate static STATS_TO_REMEMBER = 50;\n\t\tprivate static MAX_DRAWS_TO_SKIP = 2;\n\t\tprivate static INTERVAL_PADDING_MS = 4;\n\t\tprivate static SPEED_ADJUST_RATE = 0.9;\n\n\t\tprivate _drawStats: any [];\n\t\tprivate _drawStatsSum: number;\n\t\tprivate _drawStarted: number;\n\t\tprivate _drawsSkipped: number;\n\t\tprivate _expectedNextFrameAt = performance.now();\n\t\tprivate _onTime: boolean;\n\t\tprivate _trackDelta: boolean;\n\t\tprivate _delta: number;\n\t\tprivate _onTimeDelta: number;\n\n\t\tconstructor() {\n\t\t\tthis._drawStats = [];\n\t\t\tthis._drawStatsSum = 0;\n\t\t\tthis._drawStarted = 0;\n\t\t\tthis._drawsSkipped = 0;\n\t\t\tthis._expectedNextFrameAt = performance.now();\n\t\t\tthis._onTime = true;\n\t\t\tthis._trackDelta = false;\n\t\t\tthis._delta = 0;\n\t\t\tthis._onTimeDelta = 0;\n\t\t}\n\n\t\tget shallSkipDraw(): boolean {\n\t\t\tif (this._drawsSkipped >= FrameScheduler.MAX_DRAWS_TO_SKIP) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tlet averageDraw = this._drawStats.length < FrameScheduler.STATS_TO_REMEMBER ? 0 :\n\t\t\t\tthis._drawStatsSum / this._drawStats.length;\n\t\t\tlet estimatedDrawEnd = performance.now() + averageDraw;\n\t\t\treturn estimatedDrawEnd + FrameScheduler.INTERVAL_PADDING_MS > this._expectedNextFrameAt;\n\t\t}\n\n\t\tget nextFrameIn(): number {\n\t\t\treturn Math.max(0, this._expectedNextFrameAt - performance.now());\n\t\t}\n\n\t\tget isOnTime(): boolean {\n\t\t\treturn this._onTime;\n\t\t}\n\n\t\tstartFrame(frameRate: number) {\n\t\t\tlet interval = 1000 / frameRate;\n\n\t\t\tlet adjustedInterval = interval;\n\t\t\tlet delta = this._onTimeDelta + this._delta;\n\t\t\tif (delta !== 0) {\n\t\t\t\tif (delta < 0) {\n\t\t\t\t\tadjustedInterval *= FrameScheduler.SPEED_ADJUST_RATE;\n\t\t\t\t} else if (delta > 0) {\n\t\t\t\t\tadjustedInterval /= FrameScheduler.SPEED_ADJUST_RATE;\n\t\t\t\t}\n\t\t\t\tthis._onTimeDelta += (interval - adjustedInterval);\n\t\t\t}\n\n\t\t\tthis._expectedNextFrameAt += adjustedInterval;\n\t\t\tthis._onTime = true;\n\t\t}\n\n\t\tendFrame() {\n\t\t\tlet estimatedNextFrameStart = performance.now() + FrameScheduler.INTERVAL_PADDING_MS;\n\t\t\tif (estimatedNextFrameStart > this._expectedNextFrameAt) {\n\t\t\t\tif (this._trackDelta) {\n\t\t\t\t\tthis._onTimeDelta += (this._expectedNextFrameAt - estimatedNextFrameStart);\n\t\t\t\t\tconsole.log(this._onTimeDelta);\n\t\t\t\t}\n\t\t\t\tthis._expectedNextFrameAt = estimatedNextFrameStart;\n\t\t\t\tthis._onTime = false;\n\t\t\t}\n\t\t}\n\n\t\tstartDraw() {\n\t\t\tthis._drawsSkipped = 0;\n\t\t\tthis._drawStarted = performance.now();\n\t\t}\n\n\t\tendDraw() {\n\t\t\tlet drawTime = performance.now() - this._drawStarted;\n\t\t\tthis._drawStats.push(drawTime);\n\t\t\tthis._drawStatsSum += drawTime;\n\t\t\twhile (this._drawStats.length > FrameScheduler.STATS_TO_REMEMBER) {\n\t\t\t\tthis._drawStatsSum -= this._drawStats.shift();\n\t\t\t}\n\t\t}\n\n\t\tskipDraw() {\n\t\t\tthis._drawsSkipped++;\n\t\t}\n\n\t\tsetDelta(value: number) {\n\t\t\tif (!this._trackDelta) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._delta = value;\n\t\t}\n\n\t\tstartTrackDelta() {\n\t\t\tthis._trackDelta = true;\n\t\t}\n\n\t\tendTrackDelta() {\n\t\t\tif (!this._trackDelta) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._trackDelta = false;\n\t\t\tthis._delta = 0;\n\t\t\tthis._onTimeDelta = 0;\n\t\t}\n\t}\n}","/**\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nmodule Shumway.Remoting.Player {\n\timport MessageTag = Shumway.Remoting.MessageTag;\n\timport MessageBits = Shumway.Remoting.MessageBits;\n\n\timport flash = Shumway.AVMX.AS.flash;\n\timport Stage = flash.display.Stage;\n\timport Graphics = flash.display.Graphics;\n\timport NetStream = flash.net.NetStream;\n\timport display = flash.display;\n\timport Bitmap = flash.display.Bitmap;\n\timport BitmapData = flash.display.BitmapData;\n\timport DisplayObject = flash.display.DisplayObject;\n\timport DisplayObjectFlags = flash.display.DisplayObjectFlags;\n\timport DisplayObjectDirtyFlags = flash.display.DisplayObjectDirtyFlags;\n\timport DisplayObjectContainer = flash.display.DisplayObjectContainer;\n\timport BlendMode = flash.display.BlendMode;\n\timport PixelSnapping = flash.display.PixelSnapping;\n\timport VisitorFlags = flash.display.VisitorFlags;\n\timport Video = flash.media.Video;\n\n\timport Point = flash.geom.Point;\n\timport Bounds = Shumway.Bounds;\n\timport KeyboardEventData = flash.ui.KeyboardEventData;\n\timport MouseEventAndPointData = flash.ui.MouseEventAndPointData;\n\timport MouseCursor = flash.ui.MouseCursor;\n\n\timport IDataInput = Shumway.ArrayUtilities.IDataInput;\n\timport IDataOutput = Shumway.ArrayUtilities.IDataOutput;\n\timport DataBuffer = Shumway.ArrayUtilities.DataBuffer;\n\timport assert = Shumway.Debug.assert;\n\timport writer = Shumway.Player.writer;\n\n\texport class PlayerChannelSerializer {\n\t\t/**\n\t\t * Output buffer that the serializer writes to.\n\t\t */\n\t\tpublic output: DataBuffer;\n\t\tpublic outputAssets: any [];\n\t\tpublic phase: RemotingPhase = RemotingPhase.Objects;\n\t\tpublic roots: DisplayObject [] = null;\n\n\t\tconstructor() {\n\t\t\tthis.output = new DataBuffer();\n\t\t\tthis.outputAssets = [];\n\t\t}\n\n\t\tremoteObjects() {\n\t\t\tthis.phase = Remoting.RemotingPhase.Objects;\n\t\t\tlet roots = this.roots;\n\t\t\tfor (let i = 0; i < roots.length; i++) {\n\t\t\t\tShumway.Player.enterTimeline(\"remoting objects\");\n\t\t\t\tthis.writeDirtyDisplayObjects(roots[i], false);\n\t\t\t\tShumway.Player.leaveTimeline(\"remoting objects\");\n\t\t\t}\n\t\t}\n\n\t\tremoteReferences() {\n\t\t\tthis.phase = Remoting.RemotingPhase.References;\n\t\t\tlet roots = this.roots;\n\t\t\tfor (let i = 0; i < roots.length; i++) {\n\t\t\t\tShumway.Player.enterTimeline(\"remoting references\");\n\t\t\t\tthis.writeDirtyDisplayObjects(roots[i], true);\n\t\t\t\tShumway.Player.leaveTimeline(\"remoting references\");\n\t\t\t}\n\t\t}\n\n\t\twriteEOF() {\n\t\t\tthis.output.writeInt(Remoting.MessageTag.EOF);\n\t\t}\n\n\t\t/**\n\t\t * Serializes dirty display objects starting at the specified root |displayObject| node.\n\t\t */\n\t\twriteDirtyDisplayObjects(displayObject: DisplayObject, clearDirtyDescendentsFlag: boolean) {\n\t\t\tlet self = this;\n\t\t\tlet roots = this.roots;\n\t\t\tdisplayObject.visit(function (displayObject) {\n\t\t\t\tif (displayObject._hasAnyDirtyFlags(DisplayObjectDirtyFlags.Dirty)) {\n\t\t\t\t\tself.writeUpdateFrame(displayObject);\n\t\t\t\t\t// Collect more roots?\n\t\t\t\t\tif (roots && displayObject.mask) {\n\t\t\t\t\t\tlet root = displayObject.mask._findFurthestAncestorOrSelf();\n\t\t\t\t\t\tShumway.ArrayUtilities.pushUnique(roots, root)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// TODO: Checking if we need to write assets this way is kinda expensive, do better here.\n\t\t\t\tself.writeDirtyAssets(displayObject);\n\t\t\t\tlet hasDirtyDescendents = displayObject._hasFlags(DisplayObjectFlags.DirtyDescendents);\n\t\t\t\tif (hasDirtyDescendents) {\n\t\t\t\t\tif (clearDirtyDescendentsFlag) {\n\t\t\t\t\t\t// We need this flag to make sure we don't clear the flag in the first remoting pass.\n\t\t\t\t\t\tdisplayObject._removeFlags(DisplayObjectFlags.DirtyDescendents);\n\t\t\t\t\t}\n\t\t\t\t\treturn VisitorFlags.Continue;\n\t\t\t\t}\n\t\t\t\t// We can skip visiting descendents since they are not dirty.\n\t\t\t\treturn VisitorFlags.Skip;\n\t\t\t}, VisitorFlags.None);\n\t\t}\n\n\t\twriteStage(stage: Stage) {\n\t\t\tif (!stage._isDirty) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twriter && writer.writeLn(\"Sending Stage\");\n\t\t\tlet serializer = this;\n\t\t\tthis.output.writeInt(MessageTag.UpdateStage);\n\t\t\tthis.output.writeInt(stage._id);\n\t\t\tthis.output.writeInt(stage.color);\n\t\t\tthis._writeRectangle(new Bounds(0, 0, stage.stageWidth * 20, stage.stageHeight * 20));\n\t\t\tthis.output.writeInt(flash.display.StageAlign.toNumber(stage.align));\n\t\t\tthis.output.writeInt(flash.display.StageScaleMode.toNumber(stage.scaleMode));\n\t\t\tthis.output.writeInt(flash.display.StageDisplayState.toNumber(stage.displayState));\n\t\t\tstage._isDirty = false;\n\t\t}\n\n\t\twriteCurrentMouseTarget(stage: Stage, currentMouseTarget: flash.display.InteractiveObject) {\n\t\t\tthis.output.writeInt(MessageTag.UpdateCurrentMouseTarget);\n\n\t\t\tlet sec = stage.sec;\n\t\t\tlet Mouse = sec.flash.ui.Mouse.axClass;\n\t\t\tlet cursor = Mouse.cursor;\n\t\t\tif (currentMouseTarget) {\n\t\t\t\tlet SimpleButton = sec.flash.display.SimpleButton.axClass;\n\t\t\t\tlet Sprite = sec.flash.display.Sprite.axClass;\n\t\t\t\tthis.output.writeInt(currentMouseTarget._id);\n\t\t\t\tif (cursor === MouseCursor.AUTO) {\n\t\t\t\t\tlet node = currentMouseTarget;\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (SimpleButton.axIsType(node) ||\n\t\t\t\t\t\t\t(Sprite.axIsType(node) && (<flash.display.Sprite>node).buttonMode) &&\n\t\t\t\t\t\t\t(<any>currentMouseTarget).useHandCursor) {\n\t\t\t\t\t\t\tcursor = MouseCursor.BUTTON;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode = node._parent;\n\t\t\t\t\t} while (node && node !== stage);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.output.writeInt(-1);\n\t\t\t}\n\t\t\tthis.output.writeInt(MouseCursor.toNumber(cursor));\n\t\t}\n\n\t\twriteGraphics(graphics: Graphics) {\n\t\t\tif (!graphics._isDirty) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet textures = graphics.getUsedTextures();\n\t\t\tlet numTextures = textures.length;\n\t\t\tfor (let i = 0; i < numTextures; i++) {\n\t\t\t\ttextures[i] && this.writeBitmapData(textures[i]);\n\t\t\t}\n\t\t\tthis.output.writeInt(MessageTag.UpdateGraphics);\n\t\t\tthis.output.writeInt(graphics._id);\n\t\t\tthis.output.writeInt(-1);\n\t\t\tthis._writeRectangle(graphics._getContentBounds());\n\t\t\tthis._writeAsset(graphics.getGraphicsData().toPlainObject());\n\t\t\tthis.output.writeInt(numTextures);\n\t\t\tfor (let i = 0; i < numTextures; i++) {\n\t\t\t\tthis.output.writeInt(textures[i] ? textures[i]._id : -1);\n\t\t\t}\n\t\t\tgraphics._isDirty = false;\n\t\t}\n\n\t\twriteNetStream(netStream: NetStream, bounds: Bounds) {\n\t\t\tif (!netStream._isDirty) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twriter && writer.writeLn(\"Sending NetStream: \" + netStream._id);\n\t\t\tthis.output.writeInt(MessageTag.UpdateNetStream);\n\t\t\tthis.output.writeInt(netStream._id);\n\t\t\tthis._writeRectangle(bounds);\n\t\t\tnetStream._isDirty = false;\n\t\t}\n\n\t\twriteDisplayObjectRoot(displayObject: DisplayObject) {\n\t\t\trelease || assert(!this.roots);\n\t\t\tthis.roots = [displayObject];\n\t\t\tthis.remoteObjects();\n\t\t\tthis.remoteReferences();\n\t\t}\n\n\t\twriteBitmapData(bitmapData: BitmapData) {\n\t\t\tif (!bitmapData._isDirty) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twriter && writer.writeLn(\"Sending BitmapData: \" + bitmapData._id);\n\t\t\tthis.output.writeInt(MessageTag.UpdateBitmapData);\n\t\t\tthis.output.writeInt(bitmapData._id);\n\t\t\tthis.output.writeInt(bitmapData._symbol ? bitmapData._symbol.id : -1);\n\t\t\tthis._writeRectangle(bitmapData._getContentBounds());\n\t\t\tthis.output.writeInt(bitmapData._type);\n\t\t\tthis._writeAsset(bitmapData.getDataBuffer().toPlainObject());\n\t\t\tbitmapData._isDirty = false;\n\t\t}\n\n\t\twriteTextContent(textContent: Shumway.TextContent) {\n\t\t\tif (!(textContent.flags & Shumway.TextContentFlags.Dirty)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twriter && writer.writeLn(\"Sending TextContent: \" + textContent._id);\n\t\t\tthis.output.writeInt(MessageTag.UpdateTextContent);\n\t\t\tthis.output.writeInt(textContent._id);\n\t\t\tthis.output.writeInt(-1);\n\t\t\tthis._writeRectangle(textContent.bounds);\n\t\t\tlet identity = textContent.sec.flash.geom.Matrix.axClass.FROZEN_IDENTITY_MATRIX;\n\t\t\tthis._writeMatrix(textContent.matrix || identity);\n\t\t\tthis.output.writeInt(textContent.backgroundColor);\n\t\t\tthis.output.writeInt(textContent.borderColor);\n\t\t\tthis.output.writeInt(textContent.autoSize);\n\t\t\tthis.output.writeBoolean(textContent.wordWrap);\n\t\t\tthis.output.writeInt(textContent.scrollV);\n\t\t\tthis.output.writeInt(textContent.scrollH);\n\t\t\tthis._writeAsset(textContent.plainText);\n\t\t\tthis._writeAsset(textContent.textRunData.toPlainObject());\n\t\t\tlet coords = textContent.coords;\n\t\t\tif (coords) {\n\t\t\t\tlet numCoords = coords.length;\n\t\t\t\tthis.output.writeInt(numCoords);\n\t\t\t\tfor (let i = 0; i < numCoords; i++) {\n\t\t\t\t\tthis.output.writeInt(coords[i]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.output.writeInt(0);\n\t\t\t}\n\t\t\ttextContent.flags &= ~Shumway.TextContentFlags.Dirty\n\t\t}\n\n\t\t/**\n\t\t * Writes the number of display objects this display object clips.\n\t\t */\n\t\twriteClippedObjectsCount(displayObject: DisplayObject) {\n\t\t\tif (displayObject._clipDepth > 0 && displayObject._parent) {\n\t\t\t\t// Clips in GFX land don't use absolute clip depth numbers. Instead we need to encode\n\t\t\t\t// the number of siblings you want to clip. If children are removed or added, GFX clip\n\t\t\t\t// values need to be recomputed.\n\t\t\t\tlet i = displayObject._parent.getChildIndex(displayObject);\n\t\t\t\tlet j = displayObject._parent.getClipDepthIndex(displayObject._clipDepth);\n\t\t\t\t// An invalid SWF can contain a clipping mask that doesn't clip anything, but pretends to.\n\t\t\t\tif (j - i < 0) {\n\t\t\t\t\tthis.output.writeInt(-1);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfor (let k = i + 1; k <= i; k++) {\n\t\t\t\t\t// assert(displayObject._parent.getChildAt(k)._depth > displayObject._depth && displayObject._parent.getChildAt(k)._depth <= displayObject._clipDepth);\n\t\t\t\t}\n\t\t\t\tthis.output.writeInt(j - i);\n\t\t\t} else {\n\t\t\t\tthis.output.writeInt(-1);\n\t\t\t}\n\t\t}\n\n\t\twriteUpdateFrame(displayObject: DisplayObject) {\n\t\t\t// Write Header\n\t\t\tthis.output.writeInt(MessageTag.UpdateFrame);\n\t\t\tthis.output.writeInt(displayObject._id);\n\n\t\t\twriter && writer.writeLn(\"Sending UpdateFrame: \" + displayObject.debugName(true));\n\n\t\t\tlet hasMask = false;\n\t\t\tlet hasMatrix = displayObject._hasDirtyFlags(DisplayObjectDirtyFlags.DirtyMatrix);\n\t\t\tlet hasColorTransform = displayObject._hasDirtyFlags(DisplayObjectDirtyFlags.DirtyColorTransform);\n\t\t\tlet hasMiscellaneousProperties = displayObject._hasDirtyFlags(DisplayObjectDirtyFlags.DirtyMiscellaneousProperties);\n\n\t\t\tlet video: Video = null;\n\t\t\tif (displayObject.sec.flash.media.Video.axClass.axIsType(displayObject)) {\n\t\t\t\tvideo = <Video>displayObject;\n\t\t\t}\n\n\t\t\t// Check if any children need to be written. These are remoting children, not just display object children.\n\t\t\tlet hasRemotableChildren = false;\n\t\t\tif (this.phase === RemotingPhase.References) {\n\t\t\t\thasRemotableChildren = displayObject._hasAnyDirtyFlags(\n\t\t\t\t\tDisplayObjectDirtyFlags.DirtyChildren |\n\t\t\t\t\tDisplayObjectDirtyFlags.DirtyGraphics |\n\t\t\t\t\tDisplayObjectDirtyFlags.DirtyBitmapData |\n\t\t\t\t\tDisplayObjectDirtyFlags.DirtyNetStream |\n\t\t\t\t\tDisplayObjectDirtyFlags.DirtyTextContent\n\t\t\t\t);\n\t\t\t\thasMask = displayObject._hasDirtyFlags(DisplayObjectDirtyFlags.DirtyMask);\n\t\t\t}\n\t\t\tlet bitmap: Bitmap = null;\n\t\t\tif (displayObject.sec.flash.display.Bitmap.axClass.axIsType(displayObject)) {\n\t\t\t\tbitmap = <Bitmap>displayObject;\n\t\t\t}\n\n\t\t\t// Checks if the computed clip value needs to be written.\n\t\t\tlet hasClip = displayObject._hasDirtyFlags(DisplayObjectDirtyFlags.DirtyClipDepth);\n\n\t\t\t// Write Has Bits\n\t\t\tlet hasBits = 0;\n\t\t\thasBits |= hasMatrix ? MessageBits.HasMatrix : 0;\n\t\t\thasBits |= hasColorTransform ? MessageBits.HasColorTransform : 0;\n\t\t\thasBits |= hasMask ? MessageBits.HasMask : 0;\n\t\t\thasBits |= hasClip ? MessageBits.HasClip : 0;\n\t\t\thasBits |= hasMiscellaneousProperties ? MessageBits.HasMiscellaneousProperties : 0;\n\t\t\thasBits |= hasRemotableChildren ? MessageBits.HasChildren : 0;\n\t\t\tthis.output.writeInt(hasBits);\n\n\t\t\t// Write Properties\n\t\t\tif (hasMatrix) {\n\t\t\t\tthis._writeMatrix(displayObject._getMatrix());\n\t\t\t}\n\t\t\tif (hasColorTransform) {\n\t\t\t\tthis._writeColorTransform(displayObject._colorTransform);\n\t\t\t}\n\t\t\tif (hasMask) {\n\t\t\t\tthis.output.writeInt(displayObject.mask ? displayObject.mask._id : -1);\n\t\t\t}\n\t\t\tif (hasClip) {\n\t\t\t\tthis.writeClippedObjectsCount(displayObject);\n\t\t\t}\n\t\t\tif (hasMiscellaneousProperties) {\n\t\t\t\tthis.output.writeInt(displayObject._ratio);\n\t\t\t\tthis.output.writeInt(BlendMode.toNumber(displayObject._blendMode));\n\t\t\t\tthis._writeFilters(displayObject._filters);\n\t\t\t\tthis.output.writeBoolean(displayObject._hasFlags(DisplayObjectFlags.Visible));\n\t\t\t\tthis.output.writeBoolean(displayObject.cacheAsBitmap);\n\t\t\t\tif (bitmap) {\n\t\t\t\t\tthis.output.writeInt(PixelSnapping.toNumber(bitmap.pixelSnapping));\n\t\t\t\t\tthis.output.writeInt(bitmap.smoothing ? 1 : 0);\n\t\t\t\t} else {\n\t\t\t\t\t// For non-bitmaps, write null-defaults that cause flags not to be set in the GFX backend.\n\t\t\t\t\tthis.output.writeInt(PixelSnapping.toNumber(PixelSnapping.NEVER));\n\t\t\t\t\tthis.output.writeInt(0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet graphics = displayObject._getGraphics();\n\t\t\tlet textContent = displayObject._getTextContent();\n\t\t\tif (hasRemotableChildren) {\n\t\t\t\twriter && writer.enter(\"Children: {\");\n\t\t\t\tif (bitmap) {\n\t\t\t\t\tif (bitmap.bitmapData) {\n\t\t\t\t\t\tthis.output.writeInt(1);\n\t\t\t\t\t\tthis.output.writeInt(IDMask.Asset | bitmap.bitmapData._id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.output.writeInt(0);\n\t\t\t\t\t}\n\t\t\t\t} else if (video) {\n\t\t\t\t\tif (video._netStream) {\n\t\t\t\t\t\tthis.output.writeInt(1);\n\t\t\t\t\t\tthis.output.writeInt(IDMask.Asset | video._netStream._id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.output.writeInt(0);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Check if we have a graphics or text object and write that as a child first.\n\t\t\t\t\tlet count = (graphics || textContent) ? 1 : 0;\n\t\t\t\t\tlet children = displayObject._children;\n\t\t\t\t\tif (children) {\n\t\t\t\t\t\tcount += children.length;\n\t\t\t\t\t}\n\t\t\t\t\tthis.output.writeInt(count);\n\t\t\t\t\tif (graphics) {\n\t\t\t\t\t\twriter && writer.writeLn(\"Reference Graphics: \" + graphics._id);\n\t\t\t\t\t\tthis.output.writeInt(IDMask.Asset | graphics._id);\n\t\t\t\t\t} else if (textContent) {\n\t\t\t\t\t\twriter && writer.writeLn(\"Reference TextContent: \" + textContent._id);\n\t\t\t\t\t\tthis.output.writeInt(IDMask.Asset | textContent._id);\n\t\t\t\t\t}\n\t\t\t\t\t// Write all the display object children.\n\t\t\t\t\tif (children) {\n\t\t\t\t\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\t\t\t\t\twriter && writer.writeLn(\"Reference DisplayObject: \" + children[i].debugName());\n\t\t\t\t\t\t\tthis.output.writeInt(children[i]._id);\n\t\t\t\t\t\t\t// Make sure children with a clip depth are getting visited.\n\t\t\t\t\t\t\tif (children[i]._clipDepth >= 0) {\n\t\t\t\t\t\t\t\tchildren[i]._setDirtyFlags(DisplayObjectDirtyFlags.DirtyClipDepth);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twriter && writer.leave(\"}\");\n\t\t\t}\n\t\t\tif (this.phase === RemotingPhase.References) {\n\t\t\t\tdisplayObject._removeDirtyFlags(DisplayObjectDirtyFlags.Dirty);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Visit remotable child objects that are not otherwise visited.\n\t\t */\n\t\twriteDirtyAssets(displayObject: DisplayObject) {\n\t\t\tlet graphics = displayObject._getGraphics();\n\t\t\tif (graphics) {\n\t\t\t\tthis.writeGraphics(graphics);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet textContent = displayObject._getTextContent();\n\t\t\tif (textContent) {\n\t\t\t\tthis.writeTextContent(textContent);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet bitmap: Bitmap = null;\n\t\t\tif (displayObject.sec.flash.display.Bitmap.axClass.axIsType(displayObject)) {\n\t\t\t\tbitmap = <Bitmap>displayObject;\n\t\t\t\tif (bitmap.bitmapData) {\n\t\t\t\t\tthis.writeBitmapData(bitmap.bitmapData);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet video: Video = null;\n\t\t\tif (displayObject.sec.flash.media.Video.axClass.axIsType(displayObject)) {\n\t\t\t\tvideo = <Video>displayObject;\n\t\t\t\tif (video._netStream) {\n\t\t\t\t\tthis.writeNetStream(video._netStream, video._getContentBounds());\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\twriteDrawToBitmap(bitmapData: flash.display.BitmapData, source: Shumway.Remoting.IRemotable,\n\t\t                  matrix: flash.geom.Matrix = null,\n\t\t                  colorTransform: flash.geom.ColorTransform = null, blendMode: string = null,\n\t\t                  clipRect: flash.geom.Rectangle = null, smoothing: boolean = false) {\n\t\t\tthis.output.writeInt(MessageTag.DrawToBitmap);\n\t\t\tthis.output.writeInt(bitmapData._id);\n\t\t\tif (bitmapData.sec.flash.display.BitmapData.axClass.axIsType(source)) {\n\t\t\t\tthis.output.writeInt(IDMask.Asset | source._id);\n\t\t\t} else {\n\t\t\t\tthis.output.writeInt(source._id);\n\t\t\t}\n\n\t\t\tlet hasBits = 0;\n\t\t\thasBits |= matrix ? MessageBits.HasMatrix : 0;\n\t\t\thasBits |= colorTransform ? MessageBits.HasColorTransform : 0;\n\t\t\thasBits |= clipRect ? MessageBits.HasClipRect : 0;\n\n\t\t\tthis.output.writeInt(hasBits);\n\t\t\tif (matrix) {\n\t\t\t\tthis._writeMatrix(matrix);\n\t\t\t}\n\t\t\tif (colorTransform) {\n\t\t\t\tthis._writeColorTransform(colorTransform);\n\t\t\t}\n\t\t\tif (clipRect) {\n\t\t\t\tthis._writeRectangle(Bounds.FromRectangle(clipRect));\n\t\t\t}\n\t\t\tthis.output.writeInt(BlendMode.toNumber(blendMode));\n\t\t\tthis.output.writeBoolean(smoothing);\n\t\t}\n\n\t\tprivate _writeMatrix(matrix: flash.geom.Matrix) {\n\n\t\t\tif (matrix.b === 0 && matrix.c === 0) {\n\t\t\t\tif (matrix.a === 1 && matrix.d === 1) {\n\t\t\t\t\tthis.output.writeInt(MatrixEncoding.TranslationOnly);\n\t\t\t\t\tthis.output.write2Floats(matrix.tx, matrix.ty);\n\t\t\t\t} else {\n\t\t\t\t\tif (matrix.a === matrix.d) {\n\t\t\t\t\t\tthis.output.writeInt(MatrixEncoding.UniformScaleAndTranslationOnly);\n\t\t\t\t\t\tthis.output.writeFloat(matrix.a);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.output.writeInt(MatrixEncoding.ScaleAndTranslationOnly);\n\t\t\t\t\t\tthis.output.write2Floats(matrix.a, matrix.d);\n\t\t\t\t\t}\n\t\t\t\t\tthis.output.write2Floats(matrix.tx, matrix.ty);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.output.writeInt(MatrixEncoding.All);\n\t\t\t\tthis.output.write6Floats(matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty);\n\t\t\t}\n\t\t}\n\n\t\tprivate _writeRectangle(bounds: Bounds) {\n\t\t\tlet output = this.output;\n\t\t\t// TODO: check if we should write bounds instead. Depends on what's more useful in GFX-land.\n\t\t\toutput.write4Ints(bounds.xMin, bounds.yMin, bounds.width, bounds.height);\n\t\t}\n\n\t\tprivate _writeAsset(asset: any) {\n\t\t\tthis.output.writeInt(this.outputAssets.length);\n\t\t\tthis.outputAssets.push(asset);\n\t\t}\n\n\t\tprivate _writeFilters(filters: flash.filters.BitmapFilter []) {\n\t\t\tif (!filters || filters.length === 0) {\n\t\t\t\tthis.output.writeInt(0);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet sec = filters[0].sec;\n\t\t\tlet count = 0;\n\t\t\tlet blurFilterClass = sec.flash.filters.BlurFilter.axClass;\n\t\t\tlet dropShadowFilterClass = sec.flash.filters.DropShadowFilter.axClass;\n\t\t\tlet glowFilterClass = sec.flash.filters.GlowFilter.axClass;\n\t\t\tlet colorMatrixFilterClass = sec.flash.filters.ColorMatrixFilter.axClass;\n\t\t\tfor (let i = 0; i < filters.length; i++) {\n\t\t\t\tif (blurFilterClass.axIsType(filters[i]) ||\n\t\t\t\t\tdropShadowFilterClass.axIsType(filters[i]) ||\n\t\t\t\t\tglowFilterClass.axIsType(filters[i]) ||\n\t\t\t\t\tcolorMatrixFilterClass.axIsType(filters[i])) {\n\t\t\t\t\tcount++;\n\t\t\t\t} else {\n\t\t\t\t\tShumway.Debug.somewhatImplemented(filters[i].toString());\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.output.writeInt(count);\n\t\t\tfor (let i = 0; i < filters.length; i++) {\n\t\t\t\tlet filter = filters[i];\n\t\t\t\tif (blurFilterClass.axIsType(filter)) {\n\t\t\t\t\tlet blurFilter = <flash.filters.BlurFilter>filter;\n\t\t\t\t\tthis.output.writeInt(FilterType.Blur);\n\t\t\t\t\tthis.output.writeFloat(blurFilter.blurX);\n\t\t\t\t\tthis.output.writeFloat(blurFilter.blurY);\n\t\t\t\t\tthis.output.writeInt(blurFilter.quality);\n\t\t\t\t} else if (dropShadowFilterClass.axIsType(filter)) {\n\t\t\t\t\tlet dropShadowFilter = <flash.filters.DropShadowFilter>filter;\n\t\t\t\t\tthis.output.writeInt(FilterType.DropShadow);\n\t\t\t\t\tthis.output.writeFloat(dropShadowFilter.alpha);\n\t\t\t\t\tthis.output.writeFloat(dropShadowFilter.angle);\n\t\t\t\t\tthis.output.writeFloat(dropShadowFilter.blurX);\n\t\t\t\t\tthis.output.writeFloat(dropShadowFilter.blurY);\n\t\t\t\t\tthis.output.writeInt(dropShadowFilter.color);\n\t\t\t\t\tthis.output.writeFloat(dropShadowFilter.distance);\n\t\t\t\t\tthis.output.writeBoolean(dropShadowFilter.hideObject);\n\t\t\t\t\tthis.output.writeBoolean(dropShadowFilter.inner);\n\t\t\t\t\tthis.output.writeBoolean(dropShadowFilter.knockout);\n\t\t\t\t\tthis.output.writeInt(dropShadowFilter.quality);\n\t\t\t\t\tthis.output.writeFloat(dropShadowFilter.strength);\n\t\t\t\t} else if (glowFilterClass.axIsType(filter)) {\n\t\t\t\t\tlet glowFilter = <flash.filters.GlowFilter>filter;\n\t\t\t\t\tthis.output.writeInt(FilterType.DropShadow);\n\t\t\t\t\tthis.output.writeFloat(glowFilter.alpha);\n\t\t\t\t\tthis.output.writeFloat(0); // angle\n\t\t\t\t\tthis.output.writeFloat(glowFilter.blurX);\n\t\t\t\t\tthis.output.writeFloat(glowFilter.blurY);\n\t\t\t\t\tthis.output.writeInt(glowFilter.color);\n\t\t\t\t\tthis.output.writeFloat(0); // distance\n\t\t\t\t\tthis.output.writeBoolean(false); // hideObject\n\t\t\t\t\tthis.output.writeBoolean(glowFilter.inner);\n\t\t\t\t\tthis.output.writeBoolean(glowFilter.knockout);\n\t\t\t\t\tthis.output.writeInt(glowFilter.quality);\n\t\t\t\t\tthis.output.writeFloat(glowFilter.strength);\n\t\t\t\t} else if (colorMatrixFilterClass.axIsType(filter)) {\n\t\t\t\t\tlet matrix = (<flash.filters.ColorMatrixFilter>filter).matrix.value;\n\t\t\t\t\tthis.output.writeInt(FilterType.ColorMatrix);\n\t\t\t\t\tfor (let j = 0; j < 20; j++) {\n\t\t\t\t\t\tthis.output.writeFloat(matrix[j]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate _writeColorTransform(colorTransform: flash.geom.ColorTransform) {\n\t\t\tlet output = this.output;\n\t\t\tlet rM = colorTransform.redMultiplier;\n\t\t\tlet gM = colorTransform.greenMultiplier;\n\t\t\tlet bM = colorTransform.blueMultiplier;\n\t\t\tlet aM = colorTransform.alphaMultiplier;\n\t\t\tlet rO = colorTransform.redOffset;\n\t\t\tlet gO = colorTransform.greenOffset;\n\t\t\tlet bO = colorTransform.blueOffset;\n\t\t\tlet aO = colorTransform.alphaOffset;\n\n\t\t\tlet identityOffset = rO === gO && gO === bO && bO === aO && aO === 0;\n\t\t\tlet identityColorMultiplier = rM === gM && gM === bM && bM === 1;\n\n\t\t\tif (identityOffset && identityColorMultiplier) {\n\t\t\t\tif (aM === 1) {\n\t\t\t\t\toutput.writeInt(ColorTransformEncoding.Identity);\n\t\t\t\t} else {\n\t\t\t\t\toutput.writeInt(ColorTransformEncoding.AlphaMultiplierOnly);\n\t\t\t\t\toutput.writeFloat(aM);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet zeroNonAlphaMultipliers = rM === 0 && gM === 0 && bM === 0;\n\t\t\t\tif (zeroNonAlphaMultipliers) {\n\t\t\t\t\toutput.writeInt(ColorTransformEncoding.AlphaMultiplierWithOffsets);\n\t\t\t\t\toutput.writeFloat(aM);\n\t\t\t\t\toutput.writeInt(rO);\n\t\t\t\t\toutput.writeInt(gO);\n\t\t\t\t\toutput.writeInt(bO);\n\t\t\t\t\toutput.writeInt(aO);\n\t\t\t\t} else {\n\t\t\t\t\toutput.writeInt(ColorTransformEncoding.All);\n\t\t\t\t\toutput.writeFloat(rM);\n\t\t\t\t\toutput.writeFloat(gM);\n\t\t\t\t\toutput.writeFloat(bM);\n\t\t\t\t\toutput.writeFloat(aM);\n\t\t\t\t\toutput.writeInt(rO);\n\t\t\t\t\toutput.writeInt(gO);\n\t\t\t\t\toutput.writeInt(bO);\n\t\t\t\t\toutput.writeInt(aO);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\twriteRequestBitmapData(bitmapData: BitmapData) {\n\t\t\twriter && writer.writeLn(\"Sending BitmapData Request\");\n\t\t\tthis.output.writeInt(MessageTag.RequestBitmapData);\n\t\t\tthis.output.writeInt(bitmapData._id);\n\t\t}\n\t}\n\n\texport interface FocusEventData {\n\t\ttype: FocusEventType\n\t}\n\n\texport class PlayerChannelDeserializer {\n\n\t\tconstructor(private sec: ISecurityDomain, private input: IDataInput,\n\t\t            private inputAssets: any[]) {\n\t\t\t// ..\n\t\t}\n\n\t\tpublic read(): any {\n\t\t\tlet input = this.input;\n\t\t\tlet tag = input.readInt();\n\t\t\tswitch (<MessageTag>tag) {\n\t\t\t\tcase MessageTag.MouseEvent:\n\t\t\t\t\treturn this._readMouseEvent();\n\t\t\t\tcase MessageTag.KeyboardEvent:\n\t\t\t\t\treturn this._readKeyboardEvent();\n\t\t\t\tcase MessageTag.FocusEvent:\n\t\t\t\t\treturn this._readFocusEvent();\n\t\t\t}\n\t\t\trelease || assert(false, 'Unknown MessageReader tag: ' + tag);\n\t\t}\n\n\t\tprivate _readFocusEvent(): FocusEventData {\n\t\t\tlet input = this.input;\n\t\t\tlet typeId = input.readInt();\n\t\t\treturn {\n\t\t\t\ttag: MessageTag.FocusEvent,\n\t\t\t\ttype: <FocusEventType>typeId\n\t\t\t} as any;\n\t\t}\n\n\t\tprivate _readMouseEvent(): MouseEventAndPointData {\n\t\t\tlet input = this.input;\n\t\t\tlet typeId = input.readInt();\n\t\t\tlet type = Shumway.Remoting.MouseEventNames[typeId];\n\t\t\tlet pX = input.readFloat();\n\t\t\tlet pY = input.readFloat();\n\t\t\tlet buttons = input.readInt();\n\t\t\tlet flags = input.readInt();\n\t\t\treturn {\n\t\t\t\ttag: MessageTag.MouseEvent,\n\t\t\t\ttype: type,\n\t\t\t\tpoint: new this.sec.flash.geom.Point(pX, pY),\n\t\t\t\tctrlKey: !!(flags & KeyboardEventFlags.CtrlKey),\n\t\t\t\taltKey: !!(flags & KeyboardEventFlags.AltKey),\n\t\t\t\tshiftKey: !!(flags & KeyboardEventFlags.ShiftKey),\n\t\t\t\tbuttons: buttons\n\t\t\t} as any;\n\t\t}\n\n\t\tprivate _readKeyboardEvent(): KeyboardEventData {\n\t\t\tlet input = this.input;\n\t\t\tlet typeId = input.readInt();\n\t\t\tlet type = Shumway.Remoting.KeyboardEventNames[typeId];\n\t\t\tlet keyCode = input.readInt();\n\t\t\tlet charCode = input.readInt();\n\t\t\tlet location = input.readInt();\n\t\t\tlet flags = input.readInt();\n\t\t\treturn {\n\t\t\t\ttag: MessageTag.KeyboardEvent,\n\t\t\t\ttype: type,\n\t\t\t\tkeyCode: keyCode,\n\t\t\t\tcharCode: charCode,\n\t\t\t\tlocation: location,\n\t\t\t\tctrlKey: !!(flags & KeyboardEventFlags.CtrlKey),\n\t\t\t\taltKey: !!(flags & KeyboardEventFlags.AltKey),\n\t\t\t\tshiftKey: !!(flags & KeyboardEventFlags.ShiftKey)\n\t\t\t} as any;\n\t\t}\n\t}\n}\n","/**\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.Player {\n\timport assert = Shumway.Debug.assert;\n\timport somewhatImplemented = Shumway.Debug.somewhatImplemented;\n\timport flash = Shumway.AVMX.AS.flash;\n\timport Point = Shumway.AVMX.AS.flash.geom.Point;\n\timport DataBuffer = Shumway.ArrayUtilities.DataBuffer;\n\timport IExternalInterfaceService = Shumway.IExternalInterfaceService;\n\n\timport Event = flash.events.Event;\n\timport BitmapData = flash.display.BitmapData;\n\timport DisplayObject = flash.display.DisplayObject;\n\timport DisplayObjectContainer = flash.display.DisplayObjectContainer;\n\timport EventDispatcher = flash.events.EventDispatcher;\n\timport MovieClip = flash.display.MovieClip;\n\timport Loader = flash.display.Loader;\n\timport VisitorFlags = flash.display.VisitorFlags;\n\n\timport MouseEventAndPointData = Shumway.AVMX.AS.flash.ui.MouseEventAndPointData;\n\timport MouseEventDispatcher = flash.ui.MouseEventDispatcher;\n\timport KeyboardEventData = Shumway.AVMX.AS.flash.ui.KeyboardEventData;\n\timport KeyboardEventDispatcher = flash.ui.KeyboardEventDispatcher;\n\timport FocusEventData = Shumway.Remoting.Player.FocusEventData;\n\n\timport IBitmapDataSerializer = flash.display.IBitmapDataSerializer;\n\timport IAssetResolver = Timeline.IAssetResolver;\n\timport IFSCommandListener = flash.system.IFSCommandListener;\n\timport IVideoElementService = flash.net.IVideoElementService;\n\timport IRootElementService = flash.display.IRootElementService;\n\timport ICrossDomainSWFLoadingWhitelist = flash.system.ICrossDomainSWFLoadingWhitelist;\n\timport CrossDomainSWFLoadingWhitelistResult = flash.system.CrossDomainSWFLoadingWhitelistResult;\n\timport MessageTag = Shumway.Remoting.MessageTag;\n\timport VideoControlEvent = Shumway.Remoting.VideoControlEvent;\n\timport VideoPlaybackEvent = Shumway.Remoting.VideoPlaybackEvent;\n\n\timport DisplayParameters = Shumway.Remoting.DisplayParameters;\n\n\timport FocusEventType = Remoting.FocusEventType;\n\timport IGFXService = Shumway.Remoting.IGFXService;\n\timport IGFXServiceObserver = Shumway.Remoting.IGFXServiceObserver;\n\n\t/**\n\t * Base class implementation of the IGFXServer. The different transports shall\n\t * inherit this class\n\t */\n\texport class GFXServiceBase implements IGFXService {\n\t\t_observers: IGFXServiceObserver[] = [];\n\n\t\tpublic sec: ISecurityDomain;\n\n\t\tconstructor(sec: ISecurityDomain) {\n\t\t\tthis.sec = sec;\n\t\t}\n\n\t\taddObserver(observer: IGFXServiceObserver) {\n\t\t\tthis._observers.push(observer);\n\t\t}\n\n\t\tremoveObserver(observer: IGFXServiceObserver) {\n\t\t\tlet i = this._observers.indexOf(observer);\n\t\t\tif (i >= 0) {\n\t\t\t\tthis._observers.splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\tupdate(updates: DataBuffer, assets: any[]): void {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tupdateAndGet(updates: DataBuffer, assets: any[]): any {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tframe(): void {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tvideoControl(id: number, eventType: VideoControlEvent, data: any): any {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tregisterFont(syncId: number, data: Uint8Array): Promise<any> {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tregisterImage(syncId: number, symbolId: number, imageType: ImageType,\n\t\t              data: Uint8Array, alphaData: Uint8Array): Promise<any> {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tfscommand(command: string, args: string): void {\n\t\t\tthrow new Error('This method is abstract');\n\t\t}\n\n\t\tpublic processUpdates(updates: DataBuffer, assets: any []) {\n\t\t\tlet deserializer = new Remoting.Player.PlayerChannelDeserializer(\n\t\t\t\tthis.sec, updates, assets);\n\n\t\t\tlet message = deserializer.read();\n\t\t\tswitch (message.tag) {\n\t\t\t\tcase MessageTag.KeyboardEvent:\n\t\t\t\t\tthis._observers.forEach(function (observer) {\n\t\t\t\t\t\tobserver.keyboardEvent(message);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase MessageTag.MouseEvent:\n\t\t\t\t\tthis._observers.forEach(function (observer) {\n\t\t\t\t\t\tobserver.mouseEvent(message);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase MessageTag.FocusEvent:\n\t\t\t\t\tthis._observers.forEach(function (observer) {\n\t\t\t\t\t\tobserver.focusEvent(message);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tpublic processDisplayParameters(displayParameters: DisplayParameters) {\n\t\t\tthis._observers.forEach(function (observer) {\n\t\t\t\tobserver.displayParameters(displayParameters);\n\t\t\t});\n\t\t}\n\n\t\tpublic processVideoEvent(id: number, eventType: VideoPlaybackEvent, data: any) {\n\t\t\tthis._observers.forEach(function (observer) {\n\t\t\t\tobserver.videoEvent(id, eventType, data);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Helper class to handle GFXService notifications/events and forward them to\n\t * the Player object.\n\t */\n\tclass GFXServiceObserver implements IGFXServiceObserver {\n\t\tprivate _player: Player;\n\t\tprivate _mouseEventDispatcher: MouseEventDispatcher;\n\t\tprivate _keyboardEventDispatcher: KeyboardEventDispatcher;\n\t\tprivate _videoEventListeners: { (eventType: VideoPlaybackEvent, data: any): void }[] = [];\n\t\tprivate _writer: IndentingWriter;\n\n\t\tconstructor(player: Player) {\n\t\t\tthis._player = player;\n\t\t\tthis._keyboardEventDispatcher = new KeyboardEventDispatcher();\n\t\t\tthis._mouseEventDispatcher = new MouseEventDispatcher();\n\t\t\tthis._writer = new IndentingWriter();\n\t\t}\n\n\t\tvideoEvent(id: number, eventType: VideoPlaybackEvent, data: any) {\n\t\t\tlet listener = this._videoEventListeners[id];\n\t\t\tDebug.assert(listener, 'Video event listener is not found');\n\t\t\tlistener(eventType, data);\n\t\t}\n\n\t\tdisplayParameters(displayParameters: DisplayParameters) {\n\t\t\tthis._player._stage.setStageContainerSize(displayParameters.stageWidth, displayParameters.stageHeight, displayParameters.pixelRatio);\n\t\t}\n\n\t\tfocusEvent(data: any) {\n\t\t\tlet message: FocusEventData = data;\n\t\t\tlet focusType = message.type;\n\t\t\tswitch (focusType) {\n\t\t\t\tcase FocusEventType.DocumentHidden:\n\t\t\t\t\tthis._player._isPageVisible = false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase FocusEventType.DocumentVisible:\n\t\t\t\t\tthis._player._isPageVisible = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase FocusEventType.WindowBlur:\n\t\t\t\t\t// TODO: This is purposely disabled so that applications don't pause when they are out of\n\t\t\t\t\t// focus while the debugging window is open.\n\t\t\t\t\t// EventDispatcher.broadcastEventDispatchQueue.dispatchEvent(Event.getBroadcastInstance(Event.DEACTIVATE));\n\t\t\t\t\tthis._player._hasFocus = false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase FocusEventType.WindowFocus:\n\t\t\t\t\tlet eventDispatcherClass = this._player.sec.flash.events.EventDispatcher.axClass;\n\t\t\t\t\tlet eventClass = this._player.sec.flash.events.Event.axClass;\n\t\t\t\t\teventDispatcherClass.broadcastEventDispatchQueue.dispatchEvent(eventClass.getBroadcastInstance(Event.ACTIVATE));\n\t\t\t\t\tthis._player._hasFocus = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\tkeyboardEvent(data: any) {\n\t\t\tlet message: KeyboardEventData = data;\n\t\t\t// If the stage doesn't have a focus then dispatch events on the stage\n\t\t\t// directly.\n\t\t\tlet target = this._player._stage.focus ? this._player._stage.focus : this._player._stage;\n\t\t\tthis._keyboardEventDispatcher.target = target;\n\t\t\tthis._keyboardEventDispatcher.dispatchKeyboardEvent(message);\n\t\t}\n\n\t\tmouseEvent(data: any) {\n\t\t\tlet message: MouseEventAndPointData = data;\n\t\t\tthis._mouseEventDispatcher.stage = this._player._stage;\n\t\t\tlet target = this._mouseEventDispatcher.handleMouseEvent(message);\n\t\t\tif (traceMouseEventOption.value) {\n\t\t\t\tthis._writer.writeLn(\"Mouse Event: type: \" + message.type + \", point: \" + message.point + \", target: \" + target + (target ? \", name: \" + target._name : \"\"));\n\t\t\t\tif (message.type === \"click\" && target) {\n\t\t\t\t\ttarget.debugTrace();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._player.currentMouseTarget = this._mouseEventDispatcher.currentTarget;\n\t\t}\n\n\t\tregisterEventListener(id: number, listener: (eventType: VideoPlaybackEvent, data: any) => void) {\n\t\t\tthis._videoEventListeners[id] = listener;\n\t\t}\n\t}\n\n\t/**\n\t * Shumway Player\n\t *\n\t * This class brings everything together. Loads the swf, runs the event loop and\n\t * synchronizes the frame tree with the display list.\n\t */\n\texport class Player implements IBitmapDataSerializer, IFSCommandListener, IVideoElementService,\n\t\tIAssetResolver, IRootElementService, ICrossDomainSWFLoadingWhitelist {\n\t\tpublic sec: ISecurityDomain;\n\n\t\t_stage: flash.display.Stage;\n\n\t\tprivate _loader: flash.display.Loader;\n\t\tprivate _loaderInfo: flash.display.LoaderInfo;\n\t\tprivate _frameTimeout: number;\n\t\tprivate _eventLoopIsRunning: boolean;\n\t\tprivate _framesPlayed: number = 0;\n\n\t\tget framesPlayed() {\n\t\t\treturn this._framesPlayed;\n\t\t}\n\n\t\tprivate _writer: IndentingWriter;\n\n\t\tprivate _gfxService: IGFXService;\n\t\tprivate _gfxServiceObserver: GFXServiceObserver;\n\n\t\t/**\n\t\t * If set, overrides SWF file background color.\n\t\t */\n\t\tpublic defaultStageColor: number;\n\n\t\t/**\n\t\t * Movie parameters, such as flashvars.\n\t\t */\n\t\tpublic movieParams: MapObject<string>;\n\n\t\t/**\n\t\t * Initial stage alignment: l|r|t|tr|tl.\n\t\t */\n\t\tpublic stageAlign: string;\n\n\t\t/**\n\t\t * Initial stage scaling: showall|noborder|exactfit|noscale.\n\t\t */\n\t\tpublic stageScale: string;\n\n\t\t/**\n\t\t * Initial display parameters.\n\t\t */\n\t\tpublic displayParameters: DisplayParameters;\n\n\t\t/**\n\t\t * Timestamp of initialization start of the player itself, including iframe creation.\n\t\t */\n\t\tpublic initStartTime: number;\n\n\t\t/**\n\t\t * Time since the last time we've synchronized the display list.\n\t\t */\n\t\tprivate _lastPumpTime = 0;\n\n\t\t/**\n\t\t * Page Visibility API visible state.\n\t\t */\n\t\t_isPageVisible = true;\n\n\t\t/**\n\t\t * Page focus state.\n\t\t */\n\t\t_hasFocus = true;\n\n\t\t/**\n\t\t * Stage current mouse target.\n\t\t */\n\t\tprivate _currentMouseTarget: flash.display.InteractiveObject = null;\n\n\t\t/**\n\t\t * Indicates whether the |currentMouseTarget| has changed since the last time it was synchronized.\n\t\t */\n\t\tprivate _currentMouseTargetIsDirty = true;\n\n\t\tset currentMouseTarget(value: flash.display.InteractiveObject) {\n\t\t\tif (this._currentMouseTarget !== value) {\n\t\t\t\tthis._currentMouseTargetIsDirty = true;\n\t\t\t}\n\t\t\tthis._currentMouseTarget = value;\n\t\t}\n\n\t\t/**\n\t\t * Page URL that hosts SWF.\n\t\t */\n\t\tprivate _pageUrl: string = null;\n\n\t\t/**\n\t\t * SWF URL.\n\t\t */\n\t\tprivate _swfUrl: string = null;\n\n\t\t/**\n\t\t * Loader URL, can be different from SWF URL.\n\t\t */\n\t\tprivate _loaderUrl: string = null;\n\n\t\tconstructor(sec: ISecurityDomain, gfxService: IGFXService) {\n\t\t\tthis.sec = sec;\n\t\t\tsec.player = this;\n\t\t\t// Freeze in debug builds.\n\t\t\trelease || Object.defineProperty(this, 'sec', {value: sec});\n\t\t\trelease || Debug.assert(gfxService);\n\t\t\tthis._writer = new IndentingWriter();\n\t\t\tthis._gfxService = gfxService;\n\t\t\tthis._gfxServiceObserver = new GFXServiceObserver(this);\n\t\t\tthis._gfxService.addObserver(this._gfxServiceObserver);\n\t\t}\n\n\t\t/**\n\t\t * Movie stage object.\n\t\t */\n\t\tget stage() {\n\t\t\treturn this._stage;\n\t\t}\n\n\t\t/**\n\t\t * Whether we can get away with rendering at a lower rate.\n\t\t */\n\t\tprivate _shouldThrottleDownRendering() {\n\t\t\treturn !this._isPageVisible;\n\t\t}\n\n\t\t/**\n\t\t * Whether we can get away with executing frames at a lower rate.\n\t\t */\n\t\tprivate _shouldThrottleDownFrameExecution() {\n\t\t\treturn !this._isPageVisible;\n\t\t}\n\n\t\tpublic get pageUrl(): string {\n\t\t\treturn this._pageUrl;\n\t\t}\n\n\t\tpublic set pageUrl(value: string) {\n\t\t\tthis._pageUrl = value || null;\n\t\t}\n\n\t\tpublic get loaderUrl(): string {\n\t\t\treturn this._loaderUrl;\n\t\t}\n\n\t\tpublic set loaderUrl(value: string) {\n\t\t\tthis._loaderUrl = value || null;\n\t\t}\n\n\t\tpublic get swfUrl(): string {\n\t\t\treturn this._swfUrl;\n\t\t}\n\n\t\tpublic load(url: string, buffer?: ArrayBuffer) {\n\t\t\trelease || assert(!this._loader, \"Can't load twice.\");\n\t\t\tthis._swfUrl = url;\n\t\t\tthis._stage = new this.sec.flash.display.Stage();\n\t\t\tlet loader = this._loader = this.sec.flash.display.Loader.axClass.getRootLoader();\n\t\t\tlet loaderInfo = this._loaderInfo = loader.contentLoaderInfo;\n\t\t\tif (playAllSymbolsOption.value) {\n\t\t\t\tthis._playAllSymbols();\n\t\t\t\tloaderInfo._allowCodeExecution = false;\n\t\t\t} else {\n\t\t\t\tthis._enterRootLoadingLoop();\n\t\t\t}\n\t\t\tlet resolvedURL = FileLoadingService.instance.resolveUrl(url);\n\t\t\tthis.addToSWFLoadingWhitelist(resolvedURL, false, true);\n\t\t\tlet context = this.createLoaderContext();\n\t\t\tif (buffer) {\n\t\t\t\tlet byteArray = new this.sec.flash.utils.ByteArray(buffer);\n\t\t\t\tthis._loader.loadBytes(byteArray, context);\n\t\t\t\tthis._loader.contentLoaderInfo._url = resolvedURL;\n\t\t\t} else {\n\t\t\t\tthis._loader.load(new this.sec.flash.net.URLRequest(url), context);\n\t\t\t}\n\t\t}\n\n\t\tprivate createLoaderContext(): flash.system.LoaderContext {\n\t\t\tlet loaderContext = new this.sec.flash.system.LoaderContext();\n\t\t\tif (this.movieParams) {\n\t\t\t\tlet parameters: any = this.sec.createObject();\n\t\t\t\tfor (let i in this.movieParams) {\n\t\t\t\t\tparameters.axSetPublicProperty(i, this.movieParams[i]);\n\t\t\t\t}\n\t\t\t\t(loaderContext as any).parameters = <Shumway.AVMX.AS.ASObject>parameters;\n\t\t\t}\n\t\t\treturn loaderContext;\n\t\t}\n\n\t\tprivate _pumpDisplayListUpdates(): void {\n\t\t\tthis.syncDisplayObject(this._stage, true);\n\t\t}\n\n\t\tpublic syncDisplayObject(displayObject: flash.display.DisplayObject,\n\t\t                         async: boolean): DataBuffer {\n\t\t\tlet serializer = new Remoting.Player.PlayerChannelSerializer();\n\t\t\tif (this.sec.flash.display.Stage.axClass.axIsType(displayObject)) {\n\t\t\t\tlet stage = <flash.display.Stage>displayObject;\n\t\t\t\tserializer.writeStage(stage);\n\t\t\t\tif (this._currentMouseTargetIsDirty) {\n\t\t\t\t\tserializer.writeCurrentMouseTarget(stage, this._currentMouseTarget);\n\t\t\t\t\tthis._currentMouseTargetIsDirty = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tserializer.writeDisplayObjectRoot(displayObject);\n\t\t\tserializer.writeEOF();\n\n\t\t\tenterTimeline(\"remoting assets\");\n\t\t\tlet output;\n\t\t\tif (async) {\n\t\t\t\tthis._gfxService.update(serializer.output, serializer.outputAssets);\n\t\t\t} else {\n\t\t\t\toutput = this._gfxService.updateAndGet(serializer.output, serializer.outputAssets).clone();\n\t\t\t}\n\t\t\tleaveTimeline(\"remoting assets\");\n\n\t\t\treturn output;\n\t\t}\n\n\t\tpublic requestBitmapData(bitmapData: BitmapData): DataBuffer {\n\t\t\tlet serializer = new Remoting.Player.PlayerChannelSerializer();\n\t\t\tserializer.writeRequestBitmapData(bitmapData);\n\t\t\tserializer.writeEOF();\n\t\t\treturn this._gfxService.updateAndGet(serializer.output, serializer.outputAssets).clone();\n\t\t}\n\n\t\tpublic drawToBitmap(bitmapData: flash.display.BitmapData, source: Shumway.Remoting.IRemotable,\n\t\t                    matrix: flash.geom.Matrix = null,\n\t\t                    colorTransform: flash.geom.ColorTransform = null, blendMode: string = null,\n\t\t                    clipRect: flash.geom.Rectangle = null, smoothing: boolean = false) {\n\t\t\tlet serializer = new Shumway.Remoting.Player.PlayerChannelSerializer();\n\t\t\tserializer.writeBitmapData(bitmapData);\n\n\t\t\tif (this.sec.flash.display.BitmapData.axClass.axIsType(source)) {\n\t\t\t\tserializer.writeBitmapData(<flash.display.BitmapData>source);\n\t\t\t} else {\n\t\t\t\tserializer.writeDisplayObjectRoot(<flash.display.DisplayObject>source);\n\t\t\t}\n\n\t\t\tserializer.writeDrawToBitmap(bitmapData, source, matrix, colorTransform, blendMode, clipRect, smoothing);\n\t\t\tserializer.writeEOF();\n\n\t\t\tenterTimeline(\"sendUpdates\");\n\t\t\tthis._gfxService.updateAndGet(serializer.output, serializer.outputAssets);\n\t\t\tleaveTimeline(\"sendUpdates\");\n\t\t}\n\n\t\tpublic registerEventListener(id: number, listener: (eventType: VideoPlaybackEvent, data: any) => void) {\n\t\t\tthis._gfxServiceObserver.registerEventListener(id, listener);\n\t\t}\n\n\t\tpublic notifyVideoControl(id: number, eventType: VideoControlEvent, data: any): any {\n\t\t\treturn this._gfxService.videoControl(id, eventType, data);\n\t\t}\n\n\t\tpublic executeFSCommand(command: string, args: string) {\n\t\t\tswitch (command) {\n\t\t\t\tcase 'quit':\n\t\t\t\t\tthis._leaveEventLoop();\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tsomewhatImplemented('FSCommand ' + command);\n\t\t\t}\n\t\t\tthis._gfxService.fscommand(command, args);\n\t\t}\n\n\t\tpublic requestRendering(): void {\n\t\t\tthis._pumpDisplayListUpdates();\n\t\t}\n\n\t\t/**\n\t\t * Update the frame container with the latest changes from the display list.\n\t\t */\n\t\tprivate _pumpUpdates() {\n\t\t\tif (!dontSkipFramesOption.value) {\n\t\t\t\tif (this._shouldThrottleDownRendering()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet timeSinceLastPump = performance.now() - this._lastPumpTime;\n\t\t\t\tif (timeSinceLastPump < (1000 / pumpRateOption.value)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tenterTimeline(\"pump\");\n\t\t\tif (pumpEnabledOption.value) {\n\t\t\t\tthis._pumpDisplayListUpdates();\n\t\t\t\tthis._lastPumpTime = performance.now();\n\t\t\t}\n\t\t\tleaveTimeline(\"pump\");\n\t\t}\n\n\t\tprivate _leaveSyncLoop(): void {\n\t\t\trelease || assert(this._frameTimeout > -1);\n\t\t\tclearInterval(this._frameTimeout);\n\t\t}\n\n\t\tprivate _getFrameInterval(): number {\n\t\t\tlet frameRate = frameRateOption.value;\n\t\t\tif (frameRate < 0) {\n\t\t\t\tframeRate = this._stage.frameRate;\n\t\t\t}\n\t\t\treturn Math.floor(1000 / frameRate);\n\t\t}\n\n\t\tprivate _enterEventLoop(): void {\n\t\t\tthis._eventLoopIsRunning = true;\n\t\t\tlet self = this;\n\n\t\t\tfunction tick() {\n\t\t\t\t// TODO: change this to the mode described in\n\t\t\t\t// http://www.craftymind.com/2008/04/18/updated-elastic-racetrack-for-flash-9-and-avm2/\n\t\t\t\tself._frameTimeout = setTimeout(tick, self._getFrameInterval());\n\t\t\t\tself._eventLoopTick();\n\t\t\t}\n\n\t\t\tif (!isNaN(this.initStartTime)) {\n\t\t\t\tconsole.info('Time from init start to main event loop start: ' +\n\t\t\t\t\t(Date.now() - this.initStartTime));\n\t\t\t}\n\t\t\ttick();\n\t\t}\n\n\t\tprivate _leaveEventLoop(): void {\n\t\t\trelease || assert(this._eventLoopIsRunning);\n\t\t\tclearTimeout(this._frameTimeout);\n\t\t\tthis._eventLoopIsRunning = false;\n\t\t}\n\n\t\tprivate _enterRootLoadingLoop(): void {\n\t\t\tlet self = this;\n\t\t\tlet rootLoader = this.sec.flash.display.Loader.axClass.getRootLoader();\n\t\t\trootLoader._setStage(this._stage);\n\n\t\t\tfunction rootLoadingLoop() {\n\t\t\t\tlet loaderInfo = rootLoader.contentLoaderInfo;\n\t\t\t\tif (!loaderInfo._file) {\n\t\t\t\t\tsetTimeout(rootLoadingLoop, self._getFrameInterval());\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet stage = self._stage;\n\n\t\t\t\tlet bgcolor = self.defaultStageColor !== undefined ?\n\t\t\t\t\tself.defaultStageColor :\n\t\t\t\t\tloaderInfo._file.backgroundColor;\n\n\t\t\t\tstage._loaderInfo = loaderInfo;\n\t\t\t\tstage.align = self.stageAlign || '';\n\n\t\t\t\tif (!self.stageScale || flash.display.StageScaleMode.toNumber(self.stageScale) < 0) {\n\t\t\t\t\tstage.scaleMode = flash.display.StageScaleMode.SHOW_ALL;\n\t\t\t\t} else {\n\t\t\t\t\tstage.scaleMode = self.stageScale;\n\t\t\t\t}\n\n\t\t\t\tstage.frameRate = loaderInfo.frameRate;\n\t\t\t\tstage.setStageWidth(loaderInfo.width);\n\t\t\t\tstage.setStageHeight(loaderInfo.height);\n\t\t\t\tstage.setStageColor(ColorUtilities.RGBAToARGB(bgcolor));\n\n\t\t\t\tif (self.displayParameters) {\n\t\t\t\t\tself._gfxServiceObserver.displayParameters(self.displayParameters);\n\t\t\t\t}\n\n\t\t\t\tself._enterEventLoop();\n\t\t\t}\n\n\t\t\trootLoadingLoop();\n\t\t}\n\n\t\tprivate _eventLoopTick(): void {\n\t\t\tlet runFrameScripts = !playAllSymbolsOption.value;\n\t\t\tlet dontSkipFrames = dontSkipFramesOption.value;\n\t\t\tif (!dontSkipFrames && (\n\t\t\t\t\t!frameEnabledOption.value && runFrameScripts ||\n\t\t\t\t\tthis._shouldThrottleDownFrameExecution())) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// The stage is required for frame event cycle processing.\n\t\t\tlet displayObjectClass = this.sec.flash.display.DisplayObject.axClass;\n\t\t\tdisplayObjectClass._stage = this._stage;\n\t\t\t// Until the root SWF is initialized, only process Loader events.\n\t\t\t// Once the root loader's content is created, directly process all events again to avoid\n\t\t\t// further delay in initialization.\n\t\t\tlet loaderClass = this.sec.flash.display.Loader.axClass;\n\t\t\tif (!loaderClass.getRootLoader().content) {\n\t\t\t\tloaderClass.processEvents();\n\t\t\t\tif (!loaderClass.getRootLoader().content) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = 0; i < frameRateMultiplierOption.value; i++) {\n\t\t\t\tenterTimeline(\"eventLoop\");\n\t\t\t\tlet start = performance.now();\n\t\t\t\tdisplayObjectClass.performFrameNavigation(true, runFrameScripts);\n\t\t\t\tcounter.count(\"performFrameNavigation\", 1, performance.now() - start);\n\t\t\t\tloaderClass.processEvents();\n\t\t\t\tleaveTimeline(\"eventLoop\");\n\t\t\t}\n\t\t\tthis._framesPlayed++;\n\t\t\tif (tracePlayerOption.value > 0 && (this._framesPlayed % tracePlayerOption.value === 0)) {\n\t\t\t\tthis._tracePlayer();\n\t\t\t}\n\t\t\tthis._stage.render();\n\t\t\tthis._pumpUpdates();\n\t\t\tthis._gfxService.frame();\n\t\t}\n\n\t\tprivate _tracePlayer(): void {\n\t\t\tthis._writer.writeLn(\"Frame: \" +\n\t\t\t\tString(this._framesPlayed).padLeft(' ', 4) + \": \" + IntegerUtilities.toHEX(this._stage.hashCode()) + \" \" +\n\t\t\t\tString(this._stage.getAncestorCount()).padLeft(' ', 4));\n\t\t}\n\n\t\tprivate _playAllSymbols() {\n\t\t\tlet stage = this._stage;\n\t\t\tlet loader = this._loader;\n\t\t\tlet loaderInfo = this._loaderInfo;\n\t\t\tlet self = this;\n\n\t\t\tloaderInfo.addEventListener(flash.events.ProgressEvent.PROGRESS, function onProgress() {\n\t\t\t\tlet root = loader.content;\n\t\t\t\tif (!root) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tloaderInfo.removeEventListener(flash.events.ProgressEvent.PROGRESS, onProgress);\n\t\t\t\tself._enterEventLoop();\n\t\t\t});\n\n\t\t\tloaderInfo.addEventListener(flash.events.Event.COMPLETE, function onProgress() {\n\t\t\t\tstage.setStageWidth(1024);\n\t\t\t\tstage.setStageHeight(1024);\n\n\t\t\t\tlet symbols: Array<Shumway.Timeline.DisplaySymbol> = [];\n\t\t\t\tloaderInfo._dictionary.forEach(function (symbol, key) {\n\t\t\t\t\tif (symbol instanceof Shumway.Timeline.DisplaySymbol) {\n\t\t\t\t\t\tsymbols.push(symbol);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfunction show(symbol: Shumway.Timeline.DisplaySymbol) {\n\t\t\t\t\tflash.display.DisplayObject.reset();\n\t\t\t\t\tflash.display.MovieClip.reset();\n\t\t\t\t\tlet symbolInstance = symbol.symbolClass.initializeFrom(symbol);\n\t\t\t\t\tsymbol.symbolClass.instanceConstructorNoInitialize.call(symbolInstance);\n\t\t\t\t\tif (symbol instanceof flash.display.BitmapSymbol) {\n\t\t\t\t\t\tsymbolInstance = new this.sec.flash.display.Bitmap(symbolInstance);\n\t\t\t\t\t}\n\t\t\t\t\twhile (stage.numChildren > 0) {\n\t\t\t\t\t\tstage.removeChildAt(0);\n\t\t\t\t\t}\n\t\t\t\t\tstage.addChild(symbolInstance);\n\t\t\t\t}\n\n\t\t\t\tlet nextSymbolIndex = 0;\n\n\t\t\t\tfunction showNextSymbol() {\n\t\t\t\t\tlet symbol;\n\t\t\t\t\tif (playSymbolOption.value > 0) {\n\t\t\t\t\t\tsymbol = loaderInfo.getSymbolById(playSymbolOption.value);\n\t\t\t\t\t\tif (symbol instanceof Shumway.Timeline.DisplaySymbol) {\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsymbol = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsymbol = symbols[nextSymbolIndex++];\n\t\t\t\t\t\tif (nextSymbolIndex === symbols.length) {\n\t\t\t\t\t\t\tnextSymbolIndex = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (playSymbolCountOption.value >= 0 &&\n\t\t\t\t\t\t\tnextSymbolIndex > playSymbolCountOption.value) {\n\t\t\t\t\t\t\tnextSymbolIndex = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet frames = 1;\n\t\t\t\t\tif (symbol && symbol.id > 0) {\n\t\t\t\t\t\tshow(symbol);\n\t\t\t\t\t\tif (symbol instanceof flash.display.SpriteSymbol) {\n\t\t\t\t\t\t\tframes = (<flash.display.SpriteSymbol>symbol).numFrames;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (playSymbolFrameDurationOption.value > 0) {\n\t\t\t\t\t\tframes = playSymbolFrameDurationOption.value;\n\t\t\t\t\t}\n\t\t\t\t\tsetTimeout(showNextSymbol, self._getFrameInterval() * frames);\n\t\t\t\t}\n\n\t\t\t\tsetTimeout(showNextSymbol, self._getFrameInterval());\n\t\t\t});\n\t\t}\n\n\t\tregisterFont(symbol: Timeline.EagerlyResolvedSymbol, data: Uint8Array): void {\n\t\t\trelease || assert(symbol.syncId);\n\t\t\tsymbol.resolveAssetPromise = new PromiseWrapper(); // TODO no need for wrapper here, change to Promise\n\t\t\tthis._gfxService.registerFont(symbol.syncId, data).then(function (result) {\n\t\t\t\tsymbol.resolveAssetPromise.resolve(result);\n\t\t\t});\n\t\t\t// Fonts are immediately available in Firefox, so we can just mark the symbol as ready.\n\t\t\tif (inFirefox) {\n\t\t\t\tsymbol.ready = true;\n\t\t\t} else {\n\t\t\t\tsymbol.resolveAssetPromise.then(symbol.resolveAssetCallback, null);\n\t\t\t}\n\t\t}\n\n\t\tregisterImage(symbol: Timeline.EagerlyResolvedSymbol, imageType: ImageType,\n\t\t              data: Uint8Array, alphaData: Uint8Array): void {\n\t\t\trelease || assert(symbol.syncId);\n\t\t\tsymbol.resolveAssetPromise = new PromiseWrapper(); // TODO no need for wrapper here, change to Promise\n\t\t\tthis._gfxService.registerImage(symbol.syncId, symbol.id, imageType, data, alphaData).then(function (result) {\n\t\t\t\tsymbol.resolveAssetPromise.resolve(result);\n\t\t\t});\n\t\t\tsymbol.resolveAssetPromise.then(symbol.resolveAssetCallback, null);\n\t\t}\n\n\t\tprivate _crossDomainSWFLoadingWhitelist: { protocol: string; hostname: string; insecure: boolean; ownDomain: boolean }[] = [];\n\n\t\taddToSWFLoadingWhitelist(domain: string, insecure: boolean, ownDomain: boolean) {\n\t\t\tif (domain.indexOf('/') < 0) { // anything without path, this includes '*'\n\t\t\t\tthis._crossDomainSWFLoadingWhitelist.push({\n\t\t\t\t\tprotocol: 'http:',\n\t\t\t\t\thostname: domain,\n\t\t\t\t\tinsecure: insecure,\n\t\t\t\t\townDomain: ownDomain\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tlet url = new (<any>window).URL(domain);\n\t\t\t\tthis._crossDomainSWFLoadingWhitelist.push({\n\t\t\t\t\tprotocol: url.protocol,\n\t\t\t\t\thostname: url.hostname,\n\t\t\t\t\tinsecure: insecure,\n\t\t\t\t\townDomain: ownDomain\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t}\n\t\t}\n\n\t\tcheckDomainForSWFLoading(domain: string): CrossDomainSWFLoadingWhitelistResult {\n\t\t\tlet url: any;\n\t\t\ttry {\n\t\t\t\turl = new (<any>window).URL(domain);\n\t\t\t} catch (e) {\n\t\t\t\treturn CrossDomainSWFLoadingWhitelistResult.Failed;\n\t\t\t}\n\t\t\tlet result: CrossDomainSWFLoadingWhitelistResult =\n\t\t\t\tCrossDomainSWFLoadingWhitelistResult.Failed;\n\t\t\tthis._crossDomainSWFLoadingWhitelist.some(function (entry) {\n\t\t\t\tlet success;\n\t\t\t\tif (url.hostname !== entry.hostname && entry.hostname !== '*') {\n\t\t\t\t\tsuccess = false;\n\t\t\t\t} else if (entry.insecure) {\n\t\t\t\t\tsuccess = true;\n\t\t\t\t} else {\n\t\t\t\t\t// The HTTPS SWF has to be more protected than it's whitelisted HTTP equivalent.\n\t\t\t\t\tsuccess = url.protocol === 'https:' || entry.protocol !== 'https:';\n\t\t\t\t}\n\t\t\t\tif (success) {\n\t\t\t\t\tresult = entry.ownDomain ?\n\t\t\t\t\t\tCrossDomainSWFLoadingWhitelistResult.OwnDomain :\n\t\t\t\t\t\tCrossDomainSWFLoadingWhitelistResult.Remote;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}, this);\n\t\t\treturn result;\n\t\t}\n\t}\n}\n","/*\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway {\n\timport BinaryFileReader = Shumway.BinaryFileReader;\n\timport assert = Shumway.Debug.assert;\n\timport AXSecurityDomain = Shumway.AVMX.AXSecurityDomain;\n\n\texport enum AVM2LoadLibrariesFlags {\n\t\tBuiltin = 1,\n\t\tPlayerglobal = 2,\n\t\tShell = 4\n\t}\n\n\texport function createSecurityDomain(libraries: AVM2LoadLibrariesFlags): Promise<AXSecurityDomain> {\n\t\tlet result = new PromiseWrapper<AXSecurityDomain>();\n\t\trelease || assert(!!(libraries & AVM2LoadLibrariesFlags.Builtin));\n\t\tSWF.enterTimeline('Load builtin.abc file');\n\t\tSystemResourcesLoadingService.instance.load(SystemResourceId.BuiltinAbc).then(function (buffer: any) {\n\t\t\tlet sec = new Shumway.AVMX.AXSecurityDomain();\n\t\t\tlet env = {url: 'builtin.abc', app: sec.system};\n\t\t\tlet builtinABC = new Shumway.AVMX.ABCFile(env, new Uint8Array(buffer));\n\t\t\tsec.system.loadABC(builtinABC);\n\t\t\tsec.initialize();\n\t\t\tsec.system.executeABC(builtinABC);\n\t\t\tSWF.leaveTimeline();\n\n\n\t\t\t//// If library is shell.abc, then just go ahead and run it now since\n\t\t\t//// it's not worth doing it lazily given that it is so small.\n\t\t\t//if (!!(libraries & AVM2LoadLibrariesFlags.Shell)) {\n\t\t\t//  let shellABC = new Shumway.AVMX.ABCFile(new Uint8Array(buffer));\n\t\t\t//  sec.system.loadAndExecuteABC(shellABC);\n\t\t\t//  result.resolve(sec);\n\t\t\t//  SystemResourcesLoadingService.instance.load(SystemResourceId.ShellAbc).then(function (buffer) {\n\t\t\t//    let shellABC = new Shumway.AVMX.ABCFile(new Uint8Array(buffer));\n\t\t\t//    sec.system.loadAndExecuteABC(shellABC);\n\t\t\t//    result.resolve(sec);\n\t\t\t//  }, result.reject);\n\t\t\t//  return;\n\t\t\t//}\n\n\t\t\tif (!!(libraries & AVM2LoadLibrariesFlags.Playerglobal)) {\n\t\t\t\tSWF.enterTimeline('Load playerglobal files');\n\t\t\t\treturn Promise.all([\n\t\t\t\t\tSystemResourcesLoadingService.instance.load(SystemResourceId.PlayerglobalAbcs),\n\t\t\t\t\tSystemResourcesLoadingService.instance.load(SystemResourceId.PlayerglobalManifest)]).then(function (results) {\n\t\t\t\t\tlet catalog = new Shumway.AVMX.ABCCatalog(sec.system, new Uint8Array(results[0]),\n\t\t\t\t\t\tresults[1]);\n\t\t\t\t\tsec.addCatalog(catalog);\n\t\t\t\t\tSWF.leaveTimeline();\n\t\t\t\t\tresult.resolve(sec);\n\t\t\t\t}, result.reject);\n\t\t\t}\n\n\t\t\tresult.resolve(sec);\n\t\t\treturn null;\n\t\t}, result.reject);\n\t\treturn result.promise;\n\t}\n}\n","/**\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.Player {\n\texport class ShumwayComExternalInterface implements IExternalInterfaceService {\n\t\tprivate _externalCallback: (functionName: string, args: any[]) => any;\n\n\t\tget enabled() {\n\t\t\treturn true;\n\t\t}\n\n\t\tinitJS(callback: (functionName: string, args: any[]) => any) {\n\t\t\tShumwayCom.externalCom({action: 'init'});\n\t\t\tShumwayCom.setExternalCallback(function (call) {\n\t\t\t\treturn callback(call.functionName, call.args);\n\t\t\t});\n\t\t\tthis._externalCallback = callback;\n\t\t}\n\n\t\tregisterCallback(functionName: string) {\n\t\t\tlet cmd: any = {action: 'register', functionName: functionName, remove: false};\n\t\t\tShumwayCom.externalCom(cmd);\n\t\t}\n\n\t\tunregisterCallback(functionName: string) {\n\t\t\tlet cmd: any = {action: 'register', functionName: functionName, remove: true};\n\t\t\tShumwayCom.externalCom(cmd);\n\t\t}\n\n\t\teval(expression: string): any {\n\t\t\tlet cmd: any = {action: 'eval', expression: expression};\n\t\t\treturn ShumwayCom.externalCom(cmd);\n\t\t}\n\n\t\tcall(request: string): any {\n\t\t\tlet cmd: any = {action: 'call', request: request};\n\t\t\treturn ShumwayCom.externalCom(cmd);\n\t\t}\n\n\t\tgetId(): string {\n\t\t\tlet cmd: any = {action: 'getId'};\n\t\t\treturn ShumwayCom.externalCom(cmd);\n\t\t}\n\t}\n\n\texport class ShumwayComFileLoadingService implements IFileLoadingService {\n\t\tprivate _baseUrl: string = null;\n\t\tprivate _nextSessionId: number = 1; // 0 - is reserved\n\t\tprivate _sessions: FileLoadingSession[] = [];\n\n\t\tpublic init(baseUrl: string): void {\n\t\t\tthis._baseUrl = baseUrl;\n\t\t\tlet service = this;\n\t\t\tShumwayCom.setLoadFileCallback(function (args) {\n\t\t\t\tlet session = service._sessions[args.sessionId];\n\t\t\t\tif (session) {\n\t\t\t\t\tservice._notifySession(session, args);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tprivate _notifySession(session: FileLoadingSession, args: any): void {\n\t\t\tlet sessionId = args.sessionId;\n\t\t\tswitch (args.topic) {\n\t\t\t\tcase \"open\":\n\t\t\t\t\tsession.onopen();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"close\":\n\t\t\t\t\tsession.onclose();\n\t\t\t\t\tthis._sessions[sessionId] = null;\n\t\t\t\t\tconsole.log('Session #' + sessionId + ': closed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"error\":\n\t\t\t\t\tsession.onerror && session.onerror(args.error);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"progress\":\n\t\t\t\t\tconsole.log('Session #' + sessionId + ': loaded ' + args.loaded + '/' + args.total);\n\t\t\t\t\tlet data = args.array;\n\t\t\t\t\tif (!(data instanceof Uint8Array)) {\n\t\t\t\t\t\tdata = new Uint8Array(data);\n\t\t\t\t\t}\n\t\t\t\t\tsession.onprogress && session.onprogress(data, {bytesLoaded: args.loaded, bytesTotal: args.total});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tpublic createSession(): FileLoadingSession {\n\t\t\tlet sessionId = this._nextSessionId++;\n\t\t\tlet service = this;\n\t\t\tlet session = {\n\t\t\t\topen: function (request: any) {\n\t\t\t\t\tlet path = service.resolveUrl(request.url);\n\t\t\t\t\tconsole.log('Session #' + sessionId + ': loading ' + path);\n\t\t\t\t\tShumwayCom.loadFile({\n\t\t\t\t\t\turl: path, method: request.method,\n\t\t\t\t\t\tmimeType: request.mimeType, postData: request.data,\n\t\t\t\t\t\tcheckPolicyFile: request.checkPolicyFile, sessionId: sessionId\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tclose: function () {\n\t\t\t\t\tif (service._sessions[sessionId]) {\n\t\t\t\t\t\tShumwayCom.abortLoad(sessionId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn (this._sessions[sessionId] = session);\n\t\t}\n\n\t\tresolveUrl(url: string): string {\n\t\t\treturn new (<any>window).URL(url, this._baseUrl).href;\n\t\t}\n\n\t\tnavigateTo(url: any, target: any) {\n\t\t\tShumwayCom.navigateTo({\n\t\t\t\turl: this.resolveUrl(url),\n\t\t\t\ttarget: target\n\t\t\t});\n\t\t}\n\t}\n\n\texport class ShumwayComClipboardService implements IClipboardService {\n\t\tsetClipboard(data: string): void {\n\t\t\tShumwayCom.setClipboard(data);\n\t\t}\n\t}\n\n\texport class ShumwayComTelemetryService implements ITelemetryService {\n\t\treportTelemetry(data: any): void {\n\t\t\tShumwayCom.reportTelemetry(data);\n\t\t}\n\t}\n\n\texport class BrowserFileLoadingService implements IFileLoadingService {\n\t\tprivate _baseUrl: string;\n\t\tprivate _fileReadChunkSize: number;\n\n\n\t\tcreateSession() {\n\t\t\tlet service = this;\n\t\t\tlet reader: Shumway.BinaryFileReader;\n\t\t\treturn {\n\t\t\t\topen: function (request: any) {\n\t\t\t\t\tlet self: any = this;\n\t\t\t\t\tlet path = service.resolveUrl(request.url);\n\t\t\t\t\tconsole.log('FileLoadingService: loading ' + path + \", data: \" + request.data);\n\t\t\t\t\treader = new Shumway.BinaryFileReader(path, request.method, request.mimeType,\n\t\t\t\t\t\trequest.data);\n\t\t\t\t\treader.readChunked(\n\t\t\t\t\t\tservice._fileReadChunkSize,\n\t\t\t\t\t\tfunction (data, progress) {\n\t\t\t\t\t\t\tself.onprogress(data, {bytesLoaded: progress.loaded, bytesTotal: progress.total});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\t\tself.onerror(e);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tself.onopen,\n\t\t\t\t\t\tself.onclose,\n\t\t\t\t\t\tself.onhttpstatus);\n\t\t\t\t},\n\t\t\t\tclose: function () {\n\t\t\t\t\treader.abort();\n\t\t\t\t\treader = null;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tinit(baseUrl: string, fileReadChunkSize: number = 0) {\n\t\t\tthis._baseUrl = baseUrl;\n\t\t\tthis._fileReadChunkSize = fileReadChunkSize;\n\t\t}\n\n\t\tresolveUrl(url: string): string {\n\t\t\treturn new (<any>window).URL(url, this._baseUrl).href;\n\t\t}\n\n\t\tnavigateTo(url: string, target: string) {\n\t\t\twindow.open(this.resolveUrl(url), target || '_blank');\n\t\t}\n\t}\n\n\texport class ShumwayComResourcesLoadingService implements ISystemResourcesLoadingService {\n\t\tprivate _pendingPromises: Array<PromiseWrapper<any>>;\n\n\t\tpublic constructor(preload: boolean) {\n\t\t\tthis._pendingPromises = [];\n\n\t\t\tif (preload) {\n\t\t\t\tthis.load(SystemResourceId.BuiltinAbc);\n\t\t\t\tthis.load(SystemResourceId.PlayerglobalAbcs);\n\t\t\t\tthis.load(SystemResourceId.PlayerglobalManifest);\n\t\t\t}\n\n\t\t\tShumwayCom.setSystemResourceCallback(this._onSystemResourceCallback.bind(this));\n\t\t}\n\n\t\tprivate _onSystemResourceCallback(id: SystemResourceId, data: any): void {\n\t\t\tthis._pendingPromises[id].resolve(data);\n\t\t}\n\n\t\tpublic load(id: SystemResourceId): Promise<any> {\n\t\t\tlet result = this._pendingPromises[id];\n\t\t\tif (!result) {\n\t\t\t\tresult = new PromiseWrapper<any>();\n\t\t\t\tthis._pendingPromises[id] = result;\n\n\t\t\t\tShumwayCom.loadSystemResource(id);\n\t\t\t}\n\t\t\treturn result.promise;\n\t\t}\n\t}\n\n\texport class BrowserSystemResourcesLoadingService implements ISystemResourcesLoadingService {\n\t\tpublic constructor(public builtinPath: string,\n\t\t                   public viewerPlayerglobalInfo?: { abcs: string; catalog: string; },\n\t\t                   public shellPath?: string) {\n\t\t}\n\n\t\tpublic load(id: SystemResourceId): Promise<any> {\n\t\t\tswitch (id) {\n\t\t\t\tcase SystemResourceId.BuiltinAbc:\n\t\t\t\t\treturn this._promiseFile(this.builtinPath, 'arraybuffer');\n\t\t\t\tcase SystemResourceId.PlayerglobalAbcs:\n\t\t\t\t\treturn this._promiseFile(this.viewerPlayerglobalInfo.abcs, 'arraybuffer');\n\t\t\t\tcase SystemResourceId.PlayerglobalManifest:\n\t\t\t\t\treturn this._promiseFile(this.viewerPlayerglobalInfo.catalog, 'json');\n\t\t\t\tcase SystemResourceId.ShellAbc:\n\t\t\t\t\treturn this._promiseFile(this.shellPath, 'arraybuffer');\n\t\t\t\tdefault:\n\t\t\t\t\treturn Promise.reject(new Error('Unsupported system resource id: ' + id));\n\t\t\t}\n\t\t}\n\n\t\tprivate _promiseFile(path: any, responseType: any) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tSWF.enterTimeline('Load file', path);\n\t\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\t\txhr.open('GET', path);\n\t\t\t\txhr.responseType = responseType;\n\t\t\t\txhr.onload = function () {\n\t\t\t\t\tSWF.leaveTimeline();\n\t\t\t\t\tlet response = xhr.response;\n\t\t\t\t\tif (response) {\n\t\t\t\t\t\tif (responseType === 'json' && xhr.responseType !== 'json') {\n\t\t\t\t\t\t\t// some browsers (e.g. Safari) have no idea what json is\n\t\t\t\t\t\t\tresponse = JSON.parse(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject('Unable to load ' + path + ': ' + xhr.statusText);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\txhr.onerror = function () {\n\t\t\t\t\tSWF.leaveTimeline();\n\t\t\t\t\treject('Unable to load: xhr error');\n\t\t\t\t};\n\t\t\t\txhr.send();\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction qualifyLocalConnectionName(connectionName: string,\n\t                                    assertNoPrefix: boolean): string {\n\t\trelease || Debug.assert(typeof connectionName === 'string');\n\t\t// Connection names that don't start with \"_\" must be qualified with a domain prefix,\n\t\t// followed by \":\". The prefix is supplied automatically based on the currently running\n\t\t// script. Only for LocalConnection#send is it allowed to already be contained in the name.\n\t\tif (!release && assertNoPrefix) {\n\t\t\tDebug.assert(connectionName.indexOf(':') === -1);\n\t\t}\n\t\tif (connectionName[0] !== '_') {\n\t\t\tif (connectionName.indexOf(':') === -1) {\n\t\t\t\tlet currentURL = new jsGlobal.URL(Shumway.AVMX.getCurrentABC().env.url);\n\t\t\t\tconnectionName = currentURL.hostname + ':' + connectionName;\n\t\t\t}\n\t\t\t// Note: for LocalConnection#send, the name can contain an arbitrary number of \":\" chars,\n\t\t\t// so no validity check is required.\n\t\t\tif (!release && assertNoPrefix) {\n\t\t\t\tDebug.assert(connectionName.split(':').length === 2);\n\t\t\t}\n\t\t}\n\t\treturn connectionName;\n\t}\n\n\t/**\n\t * Creates a proper error object in the given SecurityDomain and fills it with information in\n\t * a way that makes it resemble the given (probably error) object as closely as possible while\n\t * at the same time guaranteeing that no code will be executed as a result of reading\n\t * properties of the object. Additionally, the created object can only be one of the builtin\n\t * Error classes.\n\t */\n\tfunction createErrorFromUnknownObject(sec: ISecurityDomain, obj: any,\n\t                                      defaultErrorClassName: string,\n\t                                      defaultErrorInfo: AVMX.ErrorInfo): AVMX.AXObject {\n\t\tif (!obj || typeof obj !== 'object') {\n\t\t\treturn sec.createError(defaultErrorClassName, defaultErrorInfo, obj);\n\t\t}\n\t\tlet mn = obj.axClass ?\n\t\t\tobj.axClass.name :\n\t\t\tAVMX.Multiname.FromFQNString('Error', AVMX.NamespaceType.Public);\n\t\tlet axClass: AVMX.AXClass = <AVMX.AXClass>sec.system.getProperty(mn, true, true);\n\t\tif (!sec.AXClass.axIsType(axClass)) {\n\t\t\tmn = AVMX.Multiname.FromFQNString('Error', AVMX.NamespaceType.Public);\n\t\t\taxClass = <AVMX.AXClass>sec.system.getProperty(mn, true, true);\n\t\t\trelease || Debug.assert(sec.AXClass.axIsType(axClass));\n\t\t}\n\t\tlet messagePropDesc = ObjectUtilities.getPropertyDescriptor(obj, '$Bgmessage');\n\t\tlet message = messagePropDesc && messagePropDesc.value || '';\n\t\tlet idPropDesc = ObjectUtilities.getPropertyDescriptor(obj, '_errorID');\n\t\tlet id = idPropDesc && idPropDesc.value || 0;\n\t\treturn axClass.axConstruct([message, id]);\n\t}\n\n\texport class BaseLocalConnectionService implements ILocalConnectionService {\n\t\tprotected _localConnections = Object.create(null);\n\n\t\tcreateConnection(connectionName: string,\n\t\t                 receiver: ILocalConnectionReceiver): LocalConnectionConnectResult {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tcloseConnection(connectionName: string,\n\t\t                receiver: ILocalConnectionReceiver): LocalConnectionCloseResult {\n\t\t\treturn undefined;\n\t\t}\n\n\t\thasConnection(connectionName: string): boolean {\n\t\t\treturn false;\n\t\t}\n\n\t\t_sendMessage(connectionName: string, methodName: string, argsBuffer: ArrayBuffer,\n\t\t             sender: ILocalConnectionSender, senderDomain: string, senderIsSecure: boolean) {\n\t\t\treturn undefined as any;\n\t\t}\n\n\t\tsend(connectionName: string, methodName: string, argsBuffer: ArrayBuffer,\n\t\t     sender: ILocalConnectionSender, senderDomain: string, senderIsSecure: boolean): void {\n\t\t\tconnectionName = qualifyLocalConnectionName(connectionName, false);\n\t\t\trelease || Debug.assert(typeof methodName === 'string');\n\t\t\trelease || Debug.assert(argsBuffer instanceof ArrayBuffer);\n\t\t\tlet self = this;\n\n\t\t\tfunction invokeMessageHandler() {\n\t\t\t\tlet status = self.hasConnection(connectionName) ? 'status' : 'error';\n\t\t\t\tlet statusEvent = new sender.sec.flash.events.StatusEvent('status', false, false, null,\n\t\t\t\t\tstatus);\n\t\t\t\ttry {\n\t\t\t\t\tsender.dispatchEvent(statusEvent);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn(\"Exception encountered during statusEvent handling in LocalConnection\" +\n\t\t\t\t\t\t\" sender.\", e);\n\t\t\t\t}\n\n\t\t\t\tif (status === 'error') {\n\t\t\t\t\t// If no receiver is found for the connectionName, we're done.\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\trelease || Debug.assert(typeof senderDomain === 'string');\n\t\t\t\trelease || Debug.assert(typeof senderIsSecure === 'boolean');\n\t\t\t\tself._sendMessage(connectionName, methodName, argsBuffer, sender, senderDomain,\n\t\t\t\t\tsenderIsSecure);\n\t\t\t}\n\n\t\t\tPromise.resolve(true).then(invokeMessageHandler);\n\t\t}\n\n\t\tallowDomains(connectionName: string, receiver: ILocalConnectionReceiver, domains: string[],\n\t\t             secure: boolean) {\n\t\t\tDebug.somewhatImplemented('LocalConnection#allowDomain');\n\t\t}\n\t}\n\n\texport class ShumwayComLocalConnectionService extends BaseLocalConnectionService {\n\n\t\tcreateConnection(connectionName: string,\n\t\t                 receiver: ILocalConnectionReceiver): LocalConnectionConnectResult {\n\t\t\tconnectionName = qualifyLocalConnectionName(connectionName, true);\n\t\t\trelease || Debug.assert(receiver);\n\t\t\tif (this.hasConnection(connectionName)) {\n\t\t\t\treturn LocalConnectionConnectResult.AlreadyTaken;\n\t\t\t}\n\n\t\t\tfunction callback(methodName: string, argsBuffer: ArrayBuffer): any {\n\t\t\t\ttry {\n\t\t\t\t\treceiver.handleMessage(methodName, argsBuffer);\n\t\t\t\t\treturn null;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('error under handleMessage: ', e);\n\t\t\t\t\treturn e;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet result = ShumwayCom.getLocalConnectionService().createLocalConnection(connectionName,\n\t\t\t\tcallback);\n\t\t\tif (result !== LocalConnectionConnectResult.Success) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tthis._localConnections[connectionName] = receiver;\n\t\t\treturn LocalConnectionConnectResult.Success;\n\t\t}\n\n\t\tcloseConnection(connectionName: string,\n\t\t                receiver: ILocalConnectionReceiver): LocalConnectionCloseResult {\n\t\t\tconnectionName = qualifyLocalConnectionName(connectionName, true);\n\t\t\tif (this._localConnections[connectionName] !== receiver) {\n\t\t\t\treturn LocalConnectionCloseResult.NotConnected;\n\t\t\t}\n\t\t\tShumwayCom.getLocalConnectionService().closeLocalConnection(connectionName);\n\t\t\tdelete this._localConnections[connectionName];\n\t\t\treturn LocalConnectionCloseResult.Success;\n\t\t}\n\n\t\thasConnection(connectionName: string): boolean {\n\t\t\treturn ShumwayCom.getLocalConnectionService().hasLocalConnection(connectionName);\n\t\t}\n\n\t\t_sendMessage(connectionName: string, methodName: string, argsBuffer: ArrayBuffer,\n\t\t             sender: ILocalConnectionSender, senderDomain: string, senderIsSecure: boolean) {\n\t\t\tlet service = ShumwayCom.getLocalConnectionService();\n\t\t\tservice.sendLocalConnectionMessage(connectionName, methodName, argsBuffer, sender,\n\t\t\t\tsenderDomain, senderIsSecure);\n\t\t}\n\n\t\tallowDomains(connectionName: string, receiver: ILocalConnectionReceiver, domains: string[],\n\t\t             secure: boolean) {\n\t\t\tconnectionName = qualifyLocalConnectionName(connectionName, true);\n\t\t\tif (this._localConnections[connectionName] !== receiver) {\n\t\t\t\tconsole.warn('Trying to allow domains for invalid connection ' + connectionName);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tShumwayCom.getLocalConnectionService().allowDomainsForLocalConnection(connectionName, domains,\n\t\t\t\tsecure);\n\t\t}\n\t}\n\n\texport class PlayerInternalLocalConnectionService extends BaseLocalConnectionService {\n\t\tcreateConnection(connectionName: string,\n\t\t                 receiver: ILocalConnectionReceiver): LocalConnectionConnectResult {\n\t\t\tconnectionName = qualifyLocalConnectionName(connectionName, true);\n\t\t\trelease || Debug.assert(receiver);\n\t\t\tif (this._localConnections[connectionName]) {\n\t\t\t\treturn LocalConnectionConnectResult.AlreadyTaken;\n\t\t\t}\n\t\t\tthis._localConnections[connectionName] = receiver;\n\t\t\treturn LocalConnectionConnectResult.Success;\n\t\t}\n\n\t\tcloseConnection(connectionName: string,\n\t\t                receiver: ILocalConnectionReceiver): LocalConnectionCloseResult {\n\t\t\tconnectionName = qualifyLocalConnectionName(connectionName, true);\n\t\t\tif (this._localConnections[connectionName] !== receiver) {\n\t\t\t\treturn LocalConnectionCloseResult.NotConnected;\n\t\t\t}\n\t\t\tdelete this._localConnections[connectionName];\n\t\t\treturn LocalConnectionCloseResult.Success;\n\t\t}\n\n\n\t\thasConnection(connectionName: string): boolean {\n\t\t\treturn connectionName in this._localConnections;\n\t\t}\n\n\t\t_sendMessage(connectionName: string, methodName: string, argsBuffer: ArrayBuffer,\n\t\t             sender: ILocalConnectionSender, senderURL: string) {\n\t\t\tlet receiver: ILocalConnectionReceiver = this._localConnections[connectionName];\n\t\t\trelease || Debug.assert(receiver);\n\t\t\ttry {\n\t\t\t\treceiver.handleMessage(methodName, argsBuffer);\n\t\t\t} catch (e) {\n\t\t\t\tDebug.warning('Unexpected error encountered while sending LocalConnection message.');\n\t\t\t}\n\t\t}\n\t}\n}\n","/**\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule Shumway.Player.Window {\n\timport Player = Shumway.Player.Player;\n\timport DataBuffer = Shumway.ArrayUtilities.DataBuffer;\n\n\timport VideoControlEvent = Shumway.Remoting.VideoControlEvent;\n\n\texport class WindowGFXService extends GFXServiceBase {\n\t\tprivate _peer: Shumway.Remoting.ITransportPeer;\n\t\tprivate _assetDecodingRequests: PromiseWrapper<any>[];\n\n\t\tconstructor(sec: ISecurityDomain, peer: Shumway.Remoting.ITransportPeer) {\n\t\t\tsuper(sec);\n\t\t\tthis._peer = peer;\n\t\t\tthis._peer.onAsyncMessage = function (msg: any) {\n\t\t\t\tthis.onWindowMessage(msg);\n\t\t\t}.bind(this);\n\t\t\tthis._assetDecodingRequests = [];\n\t\t}\n\n\t\tupdate(updates: DataBuffer, assets: any[]): void {\n\t\t\tlet bytes = updates.getBytes();\n\t\t\tlet message: any = {\n\t\t\t\ttype: 'player',\n\t\t\t\tupdates: bytes,\n\t\t\t\tassets: assets,\n\t\t\t\tresult: undefined\n\t\t\t};\n\t\t\tlet transferList = [bytes.buffer];\n\t\t\tthis._peer.postAsyncMessage(message, transferList);\n\t\t}\n\n\t\tupdateAndGet(updates: DataBuffer, assets: any[]): any {\n\t\t\tlet bytes = updates.getBytes();\n\t\t\tlet message: any = {\n\t\t\t\ttype: 'player',\n\t\t\t\tupdates: bytes,\n\t\t\t\tassets: assets,\n\t\t\t\tresult: undefined\n\t\t\t};\n\t\t\tlet result = this._peer.sendSyncMessage(message);\n\t\t\treturn DataBuffer.FromPlainObject(result);\n\t\t}\n\n\t\tframe(): void {\n\t\t\tthis._peer.postAsyncMessage({\n\t\t\t\ttype: 'frame'\n\t\t\t});\n\t\t}\n\n\t\tvideoControl(id: number, eventType: VideoControlEvent, data: any): any {\n\t\t\tlet message: any = {\n\t\t\t\ttype: 'videoControl',\n\t\t\t\tid: id,\n\t\t\t\teventType: eventType,\n\t\t\t\tdata: data,\n\t\t\t\tresult: undefined\n\t\t\t};\n\t\t\treturn this._peer.sendSyncMessage(message);\n\t\t}\n\n\t\tregisterFont(syncId: number, data: Uint8Array): Promise<any> {\n\t\t\tlet requestId = this._assetDecodingRequests.length;\n\t\t\tlet result = new PromiseWrapper<any>();\n\t\t\tthis._assetDecodingRequests[requestId] = result;\n\t\t\tlet message = {\n\t\t\t\ttype: 'registerFont',\n\t\t\t\tsyncId: syncId,\n\t\t\t\tdata: data,\n\t\t\t\trequestId: requestId\n\t\t\t};\n\t\t\t// Unfortunately we have to make this message synchronously since scripts in the same frame\n\t\t\t// might rely on it being available in the gfx backend when requesting text measurements.\n\t\t\t// Just another disadvantage of not doing our our own text shaping.\n\t\t\tthis._peer.sendSyncMessage(message);\n\t\t\treturn result.promise;\n\t\t}\n\n\t\tregisterImage(syncId: number, symbolId: number, imageType: ImageType,\n\t\t              data: Uint8Array, alphaData: Uint8Array): Promise<any> {\n\t\t\tlet requestId = this._assetDecodingRequests.length;\n\t\t\tlet result = new PromiseWrapper<any>();\n\t\t\tthis._assetDecodingRequests[requestId] = result;\n\t\t\tlet message = {\n\t\t\t\ttype: 'registerImage',\n\t\t\t\tsyncId: syncId,\n\t\t\t\tsymbolId: symbolId,\n\t\t\t\timageType: imageType,\n\t\t\t\tdata: data,\n\t\t\t\talphaData: alphaData,\n\t\t\t\trequestId: requestId\n\t\t\t};\n\t\t\tthis._peer.postAsyncMessage(message);\n\t\t\treturn result.promise;\n\t\t}\n\n\t\tfscommand(command: string, args: string): void {\n\t\t\tthis._peer.postAsyncMessage({\n\t\t\t\ttype: 'fscommand',\n\t\t\t\tcommand: command,\n\t\t\t\targs: args\n\t\t\t});\n\t\t}\n\n\t\tprivate onWindowMessage(data: any) {\n\t\t\tif (typeof data === 'object' && data !== null) {\n\t\t\t\tswitch (data.type) {\n\t\t\t\t\tcase 'gfx':\n\t\t\t\t\t\tlet DataBuffer = Shumway.ArrayUtilities.DataBuffer;\n\t\t\t\t\t\tlet updates = DataBuffer.FromArrayBuffer(data.updates.buffer);\n\t\t\t\t\t\tthis.processUpdates(updates, data.assets);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'videoPlayback':\n\t\t\t\t\t\tthis.processVideoEvent(data.id, data.eventType, data.data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'displayParameters':\n\t\t\t\t\t\tthis.processDisplayParameters(data.params);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'registerFontResponse':\n\t\t\t\t\tcase 'registerImageResponse':\n\t\t\t\t\t\tlet request = this._assetDecodingRequests[data.requestId];\n\t\t\t\t\t\trelease || Debug.assert(request);\n\t\t\t\t\t\tdelete this._assetDecodingRequests[data.requestId];\n\t\t\t\t\t\trequest.resolve(data.result);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'options':\n\t\t\t\t\t\tShumway.Settings.setSettings(data.settings);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\n * Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n///<reference path='module.ts' />\n///<reference path='settings.ts' />\n///<reference path='frameScheduler.ts' />\n///<reference path='remotingPlayer.ts' />\n///<reference path='player.ts' />\n///<reference path='avmLoader.ts' />\n///<reference path='external.ts' />\n\n///<reference path='window/windowPlayer.ts' />\n"]}