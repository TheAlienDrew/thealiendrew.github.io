{"version":3,"file":"rtmp.js","sourceRoot":"","sources":["../../src/rtmp/external.ts","../../src/rtmp/rtmp.ts","../../src/rtmp/transport.ts","../../src/rtmp/transport-browser.ts","../../src/rtmp/mp4iso.ts","../../src/rtmp/mp4mux.ts","../../src/rtmp/flvparser.ts","../../src/rtmp/references.ts"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;;;;;;;;;GAcG;AAEH,IAAO,MAAM,CA2HZ;AA3HD,WAAO,MAAM;IAAC,IAAA,OAAO,CA2HpB;IA3Ha,WAAA,OAAO;QACpB;YAYC,8BAAmB,IAAY,EAAE,IAAY,EAAE,MAAW;gBACzD,IAAI,CAAC,OAAO,GAAG,UAAU,CAAC,gBAAgB,CAAC,EAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,MAAM,CAAC,kBAAkB,EAAC,CAAC,CAAC;YACtG,CAAC;YAbD,sBAAkB,mCAAW;qBAA7B;oBACC,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO,UAAU,KAAK,WAAW,IAAI,UAAU,CAAC,gBAAgB,CAAC,CAAC;gBAC7E,CAAC;;;eAAA;YAaD,sBAAI,wCAAM;qBAAV;oBACC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;gBACrB,CAAC;qBAED,UAAW,QAAoB;oBAC9B,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC;gBACvD,CAAC;;;eAJA;YAMD,sBAAI,wCAAM;qBAAV;oBACC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;gBACrB,CAAC;qBAED,UAAW,QAA4C;oBACtD,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC;gBACvD,CAAC;;;eAJA;YAMD,sBAAI,yCAAO;qBAAX;oBACC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACtB,CAAC;qBAED,UAAY,QAAoB;oBAC/B,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,CAAC;gBACzD,CAAC;;;eAJA;YAMD,sBAAI,yCAAO;qBAAX;oBACC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACtB,CAAC;qBAED,UAAY,QAA0B;oBACrC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,CAAC;gBACzD,CAAC;;;eAJA;YAMD,sBAAI,yCAAO;qBAAX;oBACC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACtB,CAAC;qBAED,UAAY,QAAoB;oBAC/B,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,CAAC;gBACzD,CAAC;;;eAJA;YAMD,mCAAI,GAAJ,UAAK,MAAmB,EAAE,MAAc,EAAE,KAAa;gBACtD,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;YACjD,CAAC;YAED,oCAAK,GAAL;gBACC,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;YACtB,CAAC;YACF,2BAAC;QAAD,CAAC,AA/DD,IA+DC;QA/DY,4BAAoB,uBA+DhC,CAAA;QAED;YAyCC;gBACC,IAAI,CAAC,IAAI,GAAG,UAAU,CAAC,aAAa,EAAE,CAAC;YACxC,CAAC;YA1CD,sBAAkB,gCAAW;qBAA7B;oBACC,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO,UAAU,KAAK,WAAW,IAAI,UAAU,CAAC,aAAa,CAAC,CAAC;gBAC1E,CAAC;;;eAAA;YAMD,sBAAI,qCAAM;qBAAV;oBACC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;gBACzB,CAAC;;;eAAA;YAED,sBAAI,uCAAQ;qBAAZ;oBACC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;gBAC3B,CAAC;;;eAAA;YAED,sBAAI,2CAAY;qBAAhB;oBACC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC;gBAC/B,CAAC;qBAED,UAAiB,IAAY;oBAC5B,IAAI,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBAC/B,CAAC;;;eAJA;YAMD,sBAAI,qCAAM;qBAAV;oBACC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;gBACrB,CAAC;qBAED,UAAW,QAAoB;oBAC9B,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC;gBACpD,CAAC;;;eAJA;YAMD,sBAAI,sCAAO;qBAAX;oBACC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;gBACrB,CAAC;qBAED,UAAY,QAAoB;oBAC/B,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,CAAC;gBACtD,CAAC;;;eAJA;YAUD,gCAAI,GAAJ,UAAK,MAAc,EAAE,IAAY,EAAE,KAAqB;gBAArB,sBAAA,EAAA,YAAqB;gBACvD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;YACrC,CAAC;YAED,4CAAgB,GAAhB,UAAiB,MAAc,EAAE,KAAa;gBAC7C,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;YAC3C,CAAC;YAED,gCAAI,GAAJ,UAAK,IAAU;gBACd,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACtB,CAAC;YACF,wBAAC;QAAD,CAAC,AAxDD,IAwDC;QAxDY,yBAAiB,oBAwD7B,CAAA;IACF,CAAC,EA3Ha,OAAO,GAAP,cAAO,KAAP,cAAO,QA2HpB;AAAD,CAAC,EA3HM,MAAM,KAAN,MAAM,QA2HZ;AC3ID;;;;;;;;;;;;;;GAcG;AAEH,IAAO,MAAM,CAyoBZ;AAzoBD,WAAO,MAAM;IACZ,IAAI,0BAA0B,GAAG,OAAO,CAAC;IACzC,IAAI,gBAAgB,GAAG,IAAI,CAAC;IAC5B,IAAI,gBAAgB,GAAG,CAAC,CAAC;IAEzB,IAAI,iCAAiC,GAAG,CAAC,CAAC;IAC1C,IAAI,gCAAgC,GAAG,CAAC,CAAC;IACzC,IAAI,cAAc,GAAG,CAAC,CAAC;IACvB,IAAI,uBAAuB,GAAG,CAAC,CAAC;IAChC,IAAI,0BAA0B,GAAG,CAAC,CAAC;IACnC,IAAI,6BAA6B,GAAG,CAAC,CAAC;IAEtC,IAAI,uBAAuB,GAAG,CAAC,CAAC;IAChC,IAAI,mBAAmB,GAAG,CAAC,CAAC;IAC5B,IAAI,mBAAmB,GAAG,KAAK,CAAC;IAChC,IAAI,qBAAqB,GAAG,EAAE,CAAC;IAY/B;QAmBC,uBAAmB,EAAU;YAFtB,cAAS,GAA6C,IAAI,CAAC;YAGjE,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;YACb,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;YAEtB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC;YACvB,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;YACpB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;YACpB,IAAI,CAAC,mBAAmB,GAAG,KAAK,CAAC;YACjC,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;YAEzB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC;YACvB,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;YACpB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QACrB,CAAC;QAED,iCAAS,GAAT,UAAU,OAAgB;YACzB,EAAE,CAAC,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;gBAC7B,IAAI,CAAC,MAAM,GAAG,IAAI,UAAU,CAAC,GAAG,CAAC,CAAC;gBAClC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;YACvB,CAAC;YACD,EAAE,CAAC,CAAC,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;gBAC7B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;gBACnB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;YACvB,CAAC;QACF,CAAC;QAED,6BAAK,GAAL;YACC,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;gBACjB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;YACvB,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC;gBACtC,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;gBAChC,IAAI,CAAC,SAAS,CAAC;oBACd,SAAS,EAAE,IAAI,CAAC,aAAa;oBAC7B,QAAQ,EAAE,IAAI,CAAC,YAAY;oBAC3B,eAAe,EAAE,IAAI,CAAC,EAAE;oBACxB,MAAM,EAAE,IAAI,CAAC,UAAU;oBACvB,IAAI,EAAE,IAAI;oBACV,UAAU,EAAE,KAAK;oBACjB,SAAS,EAAE,IAAI;iBACf,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;QAED,6BAAK,GAAL,UAAM,IAAgB,EAAE,UAAmB,EAAE,SAAkB;YAC9D,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;gBACrB,MAAM,CAAC;YACR,CAAC;YACD,EAAE,CAAC,CAAC,CAAC,UAAU,IAAI,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;gBAC/C,IAAI,CAAC,SAAS,CAAC;oBACd,SAAS,EAAE,IAAI,CAAC,aAAa;oBAC7B,QAAQ,EAAE,IAAI,CAAC,YAAY;oBAC3B,eAAe,EAAE,IAAI,CAAC,EAAE;oBACxB,MAAM,EAAE,IAAI,CAAC,UAAU;oBACvB,IAAI,EAAE,IAAI;oBACV,UAAU,EAAE,UAAU;oBACtB,SAAS,EAAE,SAAS;iBACpB,CAAC,CAAC;gBACH,MAAM,CAAC;YACR,CAAC;YAED,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;gBAChB,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;gBACtB,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;oBAC1C,IAAI,CAAC,MAAM,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC/C,CAAC;YACF,CAAC;YAED,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;YACzC,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,MAAM,CAAC;YACjC,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;gBACf,IAAI,CAAC,SAAS,CAAC;oBACd,SAAS,EAAE,IAAI,CAAC,aAAa;oBAC7B,QAAQ,EAAE,IAAI,CAAC,YAAY;oBAC3B,eAAe,EAAE,IAAI,CAAC,EAAE;oBACxB,MAAM,EAAE,IAAI,CAAC,UAAU;oBACvB,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,YAAY,CAAC;oBAChD,UAAU,EAAE,IAAI;oBAChB,SAAS,EAAE,IAAI;iBACf,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;QACF,oBAAC;IAAD,CAAC,AAvGD,IAuGC;IAvGY,oBAAa,gBAuGzB,CAAA;IAcD;QA0BC;YATO,yBAAoB,GAAyD,IAAI,CAAC;YAClF,UAAK,GAAe,IAAI,CAAC;YACzB,WAAM,GAA+B,UAAU,IAAI;YAC1D,CAAC,CAAC;YACK,YAAO,GAAe;YAC7B,CAAC,CAAC;YACK,cAAS,GAAe,IAAI,CAAC;YAInC,IAAI,CAAC,KAAK,GAAG,eAAe,CAAC;YAC7B,IAAI,CAAC,MAAM,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;YACnC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;YACtB,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC;YACrB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;YACvB,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC;YACzB,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC;YAC3B,IAAI,CAAC,kBAAkB,GAAG,CAAC,CAAC;YAC5B,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;QACtB,CAAC;QAEM,6BAAI,GAAX,UAAY,IAAgB;YAC3B,IAAI,aAAa,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC;YACpD,EAAE,CAAC,CAAC,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;gBACxC,IAAI,eAAe,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;gBAC7C,OAAO,aAAa,GAAG,eAAe,EAAE,CAAC;oBACxC,eAAe,IAAI,CAAC,CAAC;gBACtB,CAAC;gBACD,EAAE,CAAC,CAAC,eAAe,GAAG,0BAA0B,CAAC,CAAC,CAAC;oBAClD,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;gBAC/B,CAAC;gBACD,IAAI,SAAS,GAAG,IAAI,UAAU,CAAC,eAAe,CAAC,CAAC;gBAChD,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAC3B,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;YACzB,CAAC;YAED,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;gBAClE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;YAC1B,CAAC;YACD,IAAI,CAAC,YAAY,GAAG,aAAa,CAAC;YAElC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,MAAM,CAAC;YAClC,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB;gBACzB,CAAC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC;gBACpE,IAAI,CAAC,QAAQ,EAAE,CAAC;YACjB,CAAC;YAED,OAAO,IAAI,CAAC,YAAY,GAAG,CAAC,EAAE,CAAC;gBAC9B,iGAAiG;gBACjG,IAAI,OAAO,GAAG,CAAC,CAAC;gBAChB,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;oBACpB,KAAK,eAAe;wBACnB,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC;4BAC3B,MAAM,CAAC;wBACR,CAAC;wBACD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;wBACpC,OAAO,GAAG,CAAC,CAAC;wBACZ,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,KAAK,gBAAgB,CAAC,CAAC,CAAC;4BAC7C,IAAI,CAAC,KAAK,CAAC,gCAAgC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC;wBACnE,CAAC;wBACD,IAAI,CAAC,KAAK,GAAG,kBAAkB,CAAC;wBAChC,KAAK,CAAC;oBACP,KAAK,kBAAkB;wBACtB,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,gBAAgB,CAAC,CAAC,CAAC;4BAC1C,MAAM,CAAC;wBACR,CAAC;wBACD,OAAO,GAAG,gBAAgB,CAAC;wBAE3B,IAAI,SAAS,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;wBACnD,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,SAAS,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC;wBAC3C,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,SAAS,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC;wBAC3C,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,SAAS,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC;wBAC1C,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,SAAS,GAAG,IAAI,CAAC;wBAClC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC,CAAC;wBACvD,IAAI,CAAC,KAAK,GAAG,UAAU,CAAC;wBACxB,KAAK,CAAC;oBACP,KAAK,UAAU;wBACd,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,gBAAgB,CAAC,CAAC,CAAC;4BAC1C,MAAM,CAAC;wBACR,CAAC;wBACD,OAAO,GAAG,gBAAgB,CAAC;wBAE3B,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,gBAAgB,EAAE,CAAC,EAAE,EAAE,CAAC;4BAC3C,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gCAC3C,IAAI,CAAC,KAAK,CAAC,4BAA4B,GAAG,CAAC,CAAC,CAAC;4BAC9C,CAAC;wBACF,CAAC;wBACD,IAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC;wBAC9B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC;wBACtC,IAAI,CAAC,WAAW,EAAE,CAAC;wBACnB,KAAK,CAAC;oBACP,KAAK,gBAAgB;wBACpB,OAAO,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;wBACnC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;4BACd,MAAM,CAAC;wBACR,CAAC;wBACD,KAAK,CAAC;oBACP;wBACC,MAAM,CAAC;gBACT,CAAC;gBACD,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC,CAAC;gBACrE,IAAI,CAAC,YAAY,IAAI,OAAO,CAAC;YAC9B,CAAC;QACF,CAAC;QAEO,oCAAW,GAAnB;YACC,IAAI,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,uBAAuB,CAAC,CAAC;YAClE,aAAa,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YAC9B,aAAa,CAAC,SAAS,GAAG,UAAU,CAAM;gBACzC,EAAE,CAAC,CAAC,CAAC,CAAC,QAAQ,KAAK,CAAC,CAAC,CAAC,CAAC;oBACtB,MAAM,CAAC;gBACR,CAAC;gBACD,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,mBAAmB,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC;gBACvD,IAAI,aAAqB,CAAC;gBAC1B,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;oBAClB,KAAK,iCAAiC;wBACrC,IAAI,YAAY,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;4BACvD,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;wBAC9B,EAAE,CAAC,CAAC,YAAY,IAAI,CAAC,IAAI,YAAY,IAAI,UAAU,CAAC,CAAC,CAAC;4BACrD,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;wBACnC,CAAC;wBACD,KAAK,CAAC;oBACP,KAAK,gCAAgC;wBACpC,IAAI,aAAa,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;4BACxD,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;wBAC9B,EAAE,CAAC,CAAC,mBAAmB,IAAI,aAAa;4BACvC,aAAa,IAAI,mBAAmB,CAAC,CAAC,CAAC;4BACvC,IAAI,WAAW,GAAG,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC;4BACtD,WAAW,CAAC,KAAK,EAAE,CAAC;wBACrB,CAAC;wBACD,KAAK,CAAC;oBACP,KAAK,cAAc;wBAClB,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;4BAChB,IAAI,CAAC,KAAK,EAAE,CAAC;wBACd,CAAC;wBACD,KAAK,CAAC;oBACP,KAAK,uBAAuB;wBAC3B,EAAE,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC;4BAC/B,IAAI,CAAC,oBAAoB,CAAC;gCACzB,IAAI,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gCAClC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;6BACxB,CAAC,CAAC;wBACJ,CAAC;wBACD,KAAK,CAAC;oBACP,KAAK,0BAA0B;wBAC9B,aAAa,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;4BACpD,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;wBAC9B,EAAE,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC;4BACvB,KAAK,CAAC;wBACP,CAAC;wBACD,IAAI,CAAC,iBAAiB,GAAG,aAAa,CAAC;wBACvC,KAAK,CAAC;oBACP,KAAK,6BAA6B;wBACjC,aAAa,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;4BACpD,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;wBAC9B,IAAI,SAAS,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;wBAC1B,EAAE,CAAC,CAAC,aAAa,GAAG,CAAC,IAAI,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC;4BACxC,KAAK,CAAC;wBACP,CAAC;wBACD,EAAE,CAAC,CAAC,SAAS,KAAK,CAAC;4BAClB,CAAC,SAAS,KAAK,CAAC,IAAI,IAAI,CAAC,kBAAkB,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;4BACrD,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC;wBAC7D,CAAC;wBAED,EAAE,CAAC,CAAC,aAAa,KAAK,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;4BAC1C,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;4BACnC,IAAI,OAAO,GAAG,IAAI,UAAU,CAAC,CAAC,CAAC,aAAa,KAAK,EAAE,CAAC,GAAG,IAAI;gCAC1D,CAAC,aAAa,KAAK,EAAE,CAAC,GAAG,IAAI;gCAC7B,CAAC,aAAa,KAAK,CAAC,CAAC,GAAG,IAAI;gCAC5B,aAAa,GAAG,IAAI,CAAC,CAAC,CAAC;4BACxB,IAAI,CAAC,YAAY,CAAC,uBAAuB,EAAE;gCAC1C,MAAM,EAAE,0BAA0B;gCAClC,QAAQ,EAAE,CAAC;gCACX,IAAI,EAAE,OAAO;6BACb,CAAC,CAAC;4BACH,EAAE,CAAC,CAAC,SAAS,KAAK,CAAC,CAAC,CAAC,CAAC;gCACrB,IAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC;4BACrC,CAAC;wBACF,CAAC;wBACD,KAAK,CAAC;gBACR,CAAC;YACF,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAEb,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;gBACpB,IAAI,CAAC,SAAS,EAAE,CAAC;YAClB,CAAC;QACF,CAAC;QAEM,qCAAY,GAAnB,UAAoB,SAAiB;YACpC,EAAE,CAAC,CAAC,SAAS,GAAG,CAAC,IAAI,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC;gBAC7C,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC;YACvC,CAAC;YACD,IAAI,CAAC,YAAY,CAAC,uBAAuB,EAAE;gBAC1C,QAAQ,EAAE,CAAC;gBACX,MAAM,EAAE,iCAAiC;gBACzC,IAAI,EAAE,IAAI,UAAU,CAAC,CAAC,CAAC,SAAS,KAAK,EAAE,CAAC,GAAG,IAAI;oBAC9C,CAAC,SAAS,KAAK,EAAE,CAAC,GAAG,IAAI;oBACzB,CAAC,SAAS,KAAK,CAAC,CAAC,GAAG,IAAI;oBACxB,SAAS,GAAG,IAAI,CAAC,CAAC;aACnB,CAAC,CAAC;YACH,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC5B,CAAC;QAEM,6BAAI,GAAX,UAAY,aAAqB,EAAE,OAAqB;YACvD,EAAE,CAAC,CAAC,aAAa,GAAG,mBAAmB;gBACtC,aAAa,GAAG,mBAAmB,CAAC,CAAC,CAAC;gBACtC,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;YAC1C,CAAC;YACD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;QAClD,CAAC;QAEM,+CAAsB,GAA7B,UAA8B,IAAY,EAAE,IAAgB;YAC3D,IAAI,SAAS,GAAG,IAAI,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;YAChD,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;YAClC,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC;YAC3B,SAAS,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YAEvB,IAAI,CAAC,YAAY,CAAC,uBAAuB,EAAE;gBAC1C,MAAM,EAAE,uBAAuB;gBAC/B,QAAQ,EAAE,CAAC;gBACX,IAAI,EAAE,SAAS;aACf,CAAC,CAAC;QACJ,CAAC;QAEO,iCAAQ,GAAhB;YACC,IAAI,OAAO,GAAG,IAAI,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,KAAK,EAAE,CAAC,GAAG,IAAI;gBAC/D,CAAC,IAAI,CAAC,aAAa,KAAK,EAAE,CAAC,GAAG,IAAI;gBAClC,CAAC,IAAI,CAAC,aAAa,KAAK,CAAC,CAAC,GAAG,IAAI;gBACjC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,CAAC,CAAC;YAC7B,IAAI,CAAC,YAAY,CAAC,uBAAuB,EAAE;gBAC1C,MAAM,EAAE,cAAc;gBACtB,QAAQ,EAAE,CAAC;gBACX,IAAI,EAAE,OAAO;aACb,CAAC,CAAC;QACJ,CAAC;QAEO,qCAAY,GAApB,UAAqB,aAAqB,EAAE,OAAqB;YAChE,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC;YACxB,IAAI,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC;YAChC,IAAI,WAAW,GAAG,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC;YAEtD,IAAI,SAAS,GAAG,CAAC,WAAW,IAAI,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,CAAC;YAClG,IAAI,cAAc,GAAG,CAAC,SAAS,GAAG,WAAW,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;YAEjE,IAAI,MAAM,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,SAAS,GAAG,qBAAqB,CAAC,CAAC;YACpE,IAAI,iBAAiB,CAAC;YACtB,EAAE,CAAC,CAAC,aAAa,GAAG,EAAE,CAAC,CAAC,CAAC;gBACxB,iBAAiB,GAAG,CAAC,CAAC;gBACtB,MAAM,CAAC,CAAC,CAAC,GAAG,aAAa,CAAC;YAC3B,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,aAAa,GAAG,GAAG,CAAC,CAAC,CAAC;gBAChC,iBAAiB,GAAG,CAAC,CAAC;gBACtB,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;gBACd,MAAM,CAAC,CAAC,CAAC,GAAG,aAAa,GAAG,EAAE,CAAC;YAChC,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,iBAAiB,GAAG,CAAC,CAAC;gBACtB,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;gBACd,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,aAAa,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;gBAC/C,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,aAAa,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC;YACzC,CAAC;YAED,IAAI,QAAQ,GAAG,iBAAiB,CAAC;YACjC,IAAI,eAAe,GAAG,CAAC,CAAC;YACxB,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,KAAK,WAAW,CAAC,YAAY,IAAI,cAAc,GAAG,CAAC,CAAC,CAAC,CAAC;gBACzE,eAAe;gBACf,EAAE,CAAC,CAAC,CAAC,SAAS,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;oBACpC,eAAe,GAAG,SAAS,CAAC;oBAC5B,MAAM,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;gBACvE,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,SAAS,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC;oBAC5C,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,CAAC,SAAS,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;oBAC/C,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,SAAS,GAAG,IAAI,CAAC;gBACzC,CAAC;gBACD,QAAQ,IAAI,CAAC,CAAC;gBACd,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,aAAa,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC;gBAClD,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,aAAa,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;gBACjD,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,aAAa,GAAG,IAAI,CAAC;gBAC1C,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,CAAC;gBACpC,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC,gBAAgB;gBAC9D,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;gBACpD,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC;gBACrD,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC;YACtD,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,aAAa,KAAK,WAAW,CAAC,UAAU;gBAClD,OAAO,CAAC,MAAM,KAAK,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;gBAC5C,eAAe;gBACf,MAAM,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC;gBAClB,EAAE,CAAC,CAAC,CAAC,cAAc,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;oBACzC,eAAe,GAAG,cAAc,CAAC;oBACjC,MAAM,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;gBACvE,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC;oBACjD,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,CAAC,cAAc,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;oBACpD,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,cAAc,GAAG,IAAI,CAAC;gBAC9C,CAAC;gBACD,QAAQ,IAAI,CAAC,CAAC;gBACd,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,aAAa,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC;gBAClD,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,aAAa,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;gBACjD,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,aAAa,GAAG,IAAI,CAAC;gBAC1C,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,CAAC;YACrC,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,cAAc,KAAK,CAAC,CAAC,CAAC,CAAC;gBACjC,eAAe;gBACf,MAAM,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC;gBAClB,EAAE,CAAC,CAAC,CAAC,cAAc,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;oBACzC,eAAe,GAAG,cAAc,CAAC;oBACjC,MAAM,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;gBACvE,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC;oBACjD,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,CAAC,cAAc,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;oBACpD,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,cAAc,GAAG,IAAI,CAAC;gBAC9C,CAAC;gBACD,QAAQ,IAAI,CAAC,CAAC;YACf,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,eAAe;gBACf,MAAM,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC;YACnB,CAAC;YACD,EAAE,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC;gBACrB,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,eAAe,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC;gBACrD,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,eAAe,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC;gBACrD,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,eAAe,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC;gBACpD,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,eAAe,GAAG,IAAI,CAAC;YAC7C,CAAC;YAED,WAAW,CAAC,aAAa,GAAG,SAAS,CAAC;YACtC,WAAW,CAAC,YAAY,GAAG,OAAO,CAAC,QAAQ,CAAC;YAC5C,WAAW,CAAC,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC;YACxC,WAAW,CAAC,UAAU,GAAG,aAAa,CAAC;YAEvC,IAAI,IAAI,GAAG,CAAC,CAAC;YACb,OAAO,IAAI,GAAG,aAAa,EAAE,CAAC;gBAC7B,IAAI,kBAAkB,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,GAAG,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;gBACxE,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,GAAG,kBAAkB,CAAC,EAAE,QAAQ,CAAC,CAAC;gBACrE,IAAI,IAAI,kBAAkB,CAAC;gBAE3B,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,QAAQ,GAAG,kBAAkB,CAAC,CAAC,CAAC;gBAE/D,gCAAgC;gBAChC,MAAM,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC;gBAClB,QAAQ,GAAG,iBAAiB,CAAC;YAC9B,CAAC;YAED,MAAM,CAAC,SAAS,CAAC;QAClB,CAAC;QAEO,wCAAe,GAAvB,UAAwB,EAAU;YACjC,IAAI,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC;YACxC,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBAClB,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,GAAG,WAAW,GAAG,IAAI,aAAa,CAAC,EAAE,CAAC,CAAC;gBAC5D,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;gBAC5B,WAAW,CAAC,SAAS,GAAG,UAAU,OAAY;oBAC7C,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;wBACpB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;oBACzB,CAAC;gBACF,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACd,CAAC;YACD,MAAM,CAAC,WAAW,CAAC;QACpB,CAAC;QAEO,0CAAiB,GAAzB;YACC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC3B,MAAM,CAAC,CAAC,CAAC;YACV,CAAC;YACD,IAAI,SAAS,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;YAC1C,IAAI,mBAAmB,GAAG,CAAC,CAAC;YAC5B,IAAI,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;YAC1C,EAAE,CAAC,CAAC,aAAa,KAAK,CAAC,CAAC,CAAC,CAAC;gBACzB,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC;oBAC3B,MAAM,CAAC,CAAC,CAAC;gBACV,CAAC;gBACD,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;gBACpC,mBAAmB,GAAG,CAAC,CAAC;YACzB,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,aAAa,KAAK,CAAC,CAAC,CAAC,CAAC;gBAChC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC;oBAC3B,MAAM,CAAC,CAAC,CAAC;gBACV,CAAC;gBACD,aAAa,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;gBAC5D,mBAAmB,GAAG,CAAC,CAAC;YACzB,CAAC;YACD,IAAI,eAAe,GAAG,SAAS,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,SAAS,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACjE,SAAS,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACzB,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,mBAAmB,GAAG,eAAe,CAAC,CAAC,CAAC;gBAC/D,MAAM,CAAC,CAAC,CAAC;YACV,CAAC;YACD,IAAI,mBAAmB,GAAG,SAAS,KAAK,CAAC;gBACzC,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,KAAK,IAAI;gBACzC,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,KAAK,IAAI;gBAC7C,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACtD,IAAI,oBAAoB,GAAG,mBAAmB,GAAG,eAAe;gBAC/D,mBAAmB,CAAC;YACrB,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,oBAAoB,CAAC,CAAC,CAAC;gBAC9C,MAAM,CAAC,CAAC,CAAC;YACV,CAAC;YACD,IAAI,WAAW,GAAG,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC;YAEtD,IAAI,cAAsB,CAAC;YAC3B,EAAE,CAAC,CAAC,SAAS,KAAK,CAAC,CAAC,CAAC,CAAC;gBACrB,cAAc,GAAG,WAAW,CAAC,aAAa,CAAC;YAC5C,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,cAAc,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,IAAI,EAAE,CAAC;oBACxD,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;oBAC3C,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,CAAC;YACvC,CAAC;YACD,EAAE,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC;gBACzB,IAAI,sBAAsB,GAAG,mBAAmB,GAAG,eAAe,CAAC;gBACnE,cAAc,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,sBAAsB,CAAC,IAAI,EAAE,CAAC;oBAC3D,CAAC,IAAI,CAAC,MAAM,CAAC,sBAAsB,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;oBAC/C,CAAC,IAAI,CAAC,MAAM,CAAC,sBAAsB,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;oBAC9C,IAAI,CAAC,MAAM,CAAC,sBAAsB,GAAG,CAAC,CAAC,CAAC;YAC1C,CAAC;YACD,EAAE,CAAC,CAAC,SAAS,KAAK,CAAC,IAAI,SAAS,KAAK,CAAC,CAAC,CAAC,CAAC;gBACxC,cAAc,GAAG,CAAC,WAAW,CAAC,aAAa,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC;YACnE,CAAC;YACD,IAAI,aAAa,GAAW,WAAW,CAAC,UAAU,CAAC;YACnD,IAAI,aAAa,GAAG,WAAW,CAAC,UAAU,CAAC;YAC3C,IAAI,eAAe,GAAG,WAAW,CAAC,YAAY,CAAC;YAC/C,EAAE,CAAC,CAAC,SAAS,KAAK,CAAC,IAAI,SAAS,KAAK,CAAC,CAAC,CAAC,CAAC;gBACxC,aAAa,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;oBAC3D,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;oBAC3C,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,CAAC;gBACtC,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,CAAC;YACtD,CAAC;YACD,EAAE,CAAC,CAAC,SAAS,KAAK,CAAC,CAAC,CAAC,CAAC;gBACrB,gBAAgB;gBAChB,eAAe,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,EAAE,CAAC,IAAI,EAAE,CAAC;oBAC9D,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;oBAC5C,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;oBAC3C,IAAI,CAAC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC,CAAC;YACvC,CAAC;YAED,IAAI,IAAI,EAAE,UAAU,EAAE,UAAU,CAAC;YACjC,EAAE,CAAC,CAAC,SAAS,KAAK,CAAC,IAAI,WAAW,CAAC,eAAe,CAAC,CAAC,CAAC;gBACpD,UAAU,GAAG,KAAK,CAAC;gBACnB,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,eAAe,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;gBACjE,UAAU,GAAG,WAAW,CAAC,eAAe,GAAG,IAAI,CAAC;YACjD,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,UAAU,GAAG,IAAI,CAAC;gBAClB,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;gBACnD,UAAU,GAAG,aAAa,GAAG,IAAI,CAAC;YACnC,CAAC;YACD,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,oBAAoB,GAAG,IAAI,CAAC,CAAC,CAAC;gBACrD,MAAM,CAAC,CAAC,CAAC;YACV,CAAC;YACD,OAAO,IAAI,CAAC,CAAC,UAAU,IAAI,UAAU,CAAC,IAAI,sCAAsC;gBAChF,OAAO,CAAC,GAAG,CAAC,qBAAqB,GAAG,aAAa,GAAG,IAAI;oBACvD,MAAM,GAAG,UAAU,GAAG,GAAG,GAAG,CAAC,CAAC,UAAU,CAAC,GAAG,SAAS,GAAG,aAAa,CAAC,CAAC;YACxE,WAAW,CAAC,aAAa,GAAG,cAAc,CAAC;YAC3C,WAAW,CAAC,UAAU,GAAG,aAAa,CAAC;YACvC,WAAW,CAAC,UAAU,GAAG,aAAa,CAAC;YACvC,WAAW,CAAC,YAAY,GAAG,eAAe,CAAC;YAC3C,WAAW,CAAC,mBAAmB,GAAG,CAAC,UAAU,CAAC;YAC9C,WAAW,CAAC,eAAe,GAAG,UAAU,CAAC;YACzC,WAAW,CAAC,KAAK,CAChB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,oBAAoB,EAAE,oBAAoB,GAAG,IAAI,CAAC,EACvE,UAAU,EAAE,CAAC,UAAU,CAAC,CAAC;YAE1B,MAAM,CAAC,oBAAoB,GAAG,IAAI,CAAC;QACpC,CAAC;QAEM,8BAAK,GAAZ;YACC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAC7B,IAAI,CAAC,MAAM,CAAC,IAAI,UAAU,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK;YAEtD,IAAI,CAAC,UAAU,GAAG,IAAI,UAAU,CAAC,gBAAgB,CAAC,CAAC;YACnD,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YACvB,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YACvB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,gBAAgB,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC3C,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;YAChD,CAAC;YACD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK;YACnC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC7B,CAAC;QAEM,6BAAI,GAAX,UAAY,KAAU;YACrB,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;gBACX,OAAO,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;YAClC,CAAC;YACD,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QAC1B,CAAC;QAEO,8BAAK,GAAb,UAAc,OAAY;YACzB,OAAO,CAAC,KAAK,CAAC,UAAU,GAAG,OAAO,CAAC,CAAC;YACpC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;YACtB,IAAI,CAAC,OAAO,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;QAC1B,CAAC;QACF,qBAAC;IAAD,CAAC,AAxfD,IAwfC;IAxfY,qBAAc,iBAwf1B,CAAA;AACF,CAAC,EAzoBM,MAAM,KAAN,MAAM,QAyoBZ;ACzpBD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,MAAM,CAuWZ;AAvWD,WAAO,MAAM;IACZ,IAAO,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC;IAErC,IAAI,kBAAkB,GAAG,CAAC,CAAC;IAE3B,IAAI,sBAAsB,GAAG,CAAC,CAAC;IAC/B,IAAI,sBAAsB,GAAG,CAAC,CAAC;IAC/B,IAAI,iBAAiB,GAAG,CAAC,CAAC;IAE1B,IAAI,uBAAuB,GAAG,EAAE,CAAC;IACjC,IAAI,uBAAuB,GAAG,EAAE,CAAC;IAEjC,IAAI,6BAA6B,GAAG,CAAC,CAAC;IACtC,IAAI,+BAA+B,GAAG,CAAC,CAAC;IACxC,IAAI,gCAAgC,GAAG,CAAC,CAAC;IA4BzC;QAUC;YACC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QACpB,CAAC;QAED,+BAAO,GAAP,UAAQ,UAAe,EAAE,IAAU;YAClC,MAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;QAC1D,CAAC;QAED,oCAAY,GAAZ,UAAa,UAAe,EAAE,IAAU;YACvC,IAAI,OAAO,GAAG,IAAI,OAAA,cAAc,EAAE,CAAC;YACnC,IAAI,SAAS,GAAG,IAAI,CAAC;YACrB,OAAO,CAAC,SAAS,GAAG;gBACnB,IAAI,EAAE,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;gBACrC,EAAE,CAAC,cAAc,GAAG,kBAAkB,CAAC;gBACvC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;gBAC1B,EAAE,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;gBACvC,EAAE,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;gBAC3B,EAAE,CAAC,WAAW,CAAC,IAAI,IAAI,IAAI,CAAC,CAAC;gBAC7B,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;gBAC1C,OAAO,CAAC,IAAI,CAAC,sBAAsB,EAAE;oBACpC,QAAQ,EAAE,iBAAiB;oBAC3B,MAAM,EAAE,kBAAkB,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC,uBAAuB;oBAC9E,IAAI,EAAE,IAAI,UAAU,CAAQ,EAAG,CAAC,OAAO,EAAE,CAAC,EAAS,EAAG,CAAC,MAAM,CAAC;iBAC9D,CAAC,CAAC;YACJ,CAAC,CAAC;YACF,OAAO,CAAC,SAAS,GAAG,UAAU,OAA8B;gBAC3D,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,2BAA2B,GAAG,OAAO,CAAC,MAAM;oBAClE,aAAa,GAAG,OAAO,CAAC,QAAQ;oBAChC,QAAQ,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;gBAErC,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,KAAK,CAAC,CAAC,CAAC,CAAC;oBAC5B,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;oBACpD,MAAM,CAAC;gBACR,CAAC;gBAED,EAAE,CAAC,CAAC,OAAO,CAAC,MAAM,KAAK,uBAAuB;oBAC7C,OAAO,CAAC,MAAM,KAAK,uBAAuB,CAAC,CAAC,CAAC;oBAC7C,IAAI,EAAE,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;oBACrC,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;oBAC/B,EAAE,CAAC,QAAQ,GAAG,CAAC,CAAC;oBAChB,EAAE,CAAC,cAAc,GAAG,OAAO,CAAC,MAAM,KAAK,uBAAuB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACvE,IAAI,WAAW,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;oBAClC,EAAE,CAAC,CAAC,WAAW,KAAK,SAAS,CAAC,CAAC,CAAC;wBAC/B,EAAE,CAAC,cAAc,GAAG,CAAC,CAAC;wBACtB,WAAW,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;oBAC/B,CAAC;oBACD,IAAI,aAAa,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;oBACpC,EAAE,CAAC,CAAC,WAAW,KAAK,SAAS,IAAI,WAAW,KAAK,QAAQ,CAAC,CAAC,CAAC;wBAC3D,IAAI,OAAO,GAAG,WAAW,KAAK,QAAQ,CAAC;wBACvC,EAAE,CAAC,CAAC,aAAa,KAAK,sBAAsB,CAAC,CAAC,CAAC;4BAC9C,IAAI,YAAU,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;4BACjC,IAAI,WAAW,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;4BAClC,EAAE,CAAC,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC;gCAC3B,SAAS,CAAC,WAAW,CAAC;oCACrB,UAAU,EAAE,YAAU;oCACtB,WAAW,EAAE,WAAW;oCACxB,OAAO,EAAE,OAAO;iCAChB,CAAC,CAAC;4BACJ,CAAC;wBACF,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,IAAI,aAAa,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;4BACpC,IAAI,QAAQ,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;4BAC/B,EAAE,CAAC,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC,CAAC;gCAC/B,IAAI,MAAM,GAAG,IAAI,SAAS,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;gCAChD,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC;gCACtC,SAAS,CAAC,eAAe,CAAC;oCACzB,aAAa,EAAE,aAAa;oCAC5B,aAAa,EAAE,aAAa;oCAC5B,QAAQ,EAAE,QAAQ;oCAClB,MAAM,EAAE,MAAM;oCACd,OAAO,EAAE,OAAO;iCAChB,CAAC,CAAC;4BACJ,CAAC;wBACF,CAAC;oBACF,CAAC;oBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,WAAW,KAAK,WAAW,IAAI,WAAW,KAAK,UAAU,CAAC,CAAC,CAAC;wBACtE,8BAA8B;wBAC9B,SAAS,CAAC,qBAAqB,CAAC,QAAQ,EAAE,aAAa,EAAE,IAAI,EAC5D,EAAC,IAAI,EAAE,2BAA2B,EAAE,KAAK,EAAE,OAAO,EAAC,CAAC,CAAC;oBACvD,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,IAAI,aAAa,GAAG,EAAE,CAAC,UAAU,EAAE,CAAC;wBACpC,IAAI,QAAQ,GAAG,EAAE,CAAC,QAAQ,GAAG,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;wBACrE,EAAE,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC;4BAC1B,SAAS,CAAC,UAAU,CAAC;gCACpB,WAAW,EAAE,WAAW;gCACxB,aAAa,EAAE,aAAa;gCAC5B,aAAa,EAAE,aAAa;gCAC5B,QAAQ,EAAE,QAAQ;6BAClB,CAAC,CAAC;wBACJ,CAAC;oBACF,CAAC;oBACD,MAAM,CAAC;gBACR,CAAC;gBACD,qBAAqB;YACtB,CAAC,CAAC;YACF,OAAO,CAAC,oBAAoB,GAAG,UAAU,CAAoC;gBAC5E,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,WAAW,GAAG,CAAC,CAAC,IAAI,GAAG,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,CAAC;gBAC/E,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,+BAA+B,CAAC,CAAC,CAAC;oBAChD,OAAO,CAAC,sBAAsB,CAAC,gCAAgC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC;gBAC1E,CAAC;gBACD,EAAE,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;oBACvB,SAAS,CAAC,OAAO,CAAC,EAAC,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,IAAI,EAAC,CAAC,CAAC;gBACjD,CAAC;YACF,CAAC,CAAC;YAEF,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,CAAC;QACjC,CAAC;QAED,4BAAI,GAAJ,UAAK,aAAqB,EAAE,aAAqB,EAAE,aAAkB,EAAE,IAAS;YAC/E,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;YAE3B,IAAI,EAAE,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;YACrC,EAAE,CAAC,cAAc,GAAG,kBAAkB,CAAC;YACvC,EAAE,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;YAC9B,EAAE,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;YAC9B,EAAE,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;YAC9B,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YACrB,OAAO,CAAC,IAAI,CAAC,sBAAsB,EAAE;gBACpC,QAAQ,EAAE,iBAAiB;gBAC3B,MAAM,EAAE,kBAAkB,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC,uBAAuB;gBAC9E,IAAI,EAAE,IAAI,UAAU,CAAQ,EAAG,CAAC,OAAO,EAAE,CAAC,EAAS,EAAG,CAAC,MAAM,CAAC;aAC9D,CAAC,CAAC;QACJ,CAAC;QAED,oCAAY,GAAZ,UAAa,aAAqB,EAAE,aAAkB;YACrD,IAAI,CAAC,qBAAqB,CAAC,cAAc,EAAE,aAAa,EAAE,aAAa,CAAC,CAAC;QAC1E,CAAC;QAED,6CAAqB,GAArB,UAAsB,WAAmB,EAAE,aAAqB,EAAE,aAAkB,EAAE,QAAc;YACnG,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;YAE3B,IAAI,EAAE,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;YACrC,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM;YACvB,EAAE,CAAC,cAAc,GAAG,CAAC,CAAC,CAAC,sBAAsB;YAC7C,EAAE,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;YAC5B,EAAE,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;YAC9B,EAAE,CAAC,WAAW,CAAC,aAAa,IAAI,IAAI,CAAC,CAAC;YACtC,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC1B,EAAE,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;YAC1B,CAAC;YACD,OAAO,CAAC,IAAI,CAAC,sBAAsB,EAAE;gBACpC,QAAQ,EAAE,iBAAiB;gBAC3B,MAAM,EAAE,uBAAuB;gBAC/B,IAAI,EAAE,IAAI,UAAU,CAAQ,EAAG,CAAC,OAAO,EAAE,CAAC,EAAS,EAAG,CAAC,MAAM,CAAC;aAC9D,CAAC,CAAC;YAEH;;;;;;;;;;;eAWG;QACJ,CAAC;QAED,kCAAU,GAAV,UAAW,QAAgB,EAAE,EAAU;YACtC,IAAI,CAAC,OAAO,CAAC,sBAAsB,CAAC,6BAA6B,EAAE,IAAI,UAAU,CAAC;gBACjF,CAAC,QAAQ,IAAI,EAAE,CAAC,GAAG,IAAI;gBACvB,CAAC,QAAQ,IAAI,EAAE,CAAC,GAAG,IAAI;gBACvB,CAAC,QAAQ,IAAI,CAAC,CAAC,GAAG,IAAI;gBACtB,QAAQ,GAAG,IAAI;gBACf,CAAC,EAAE,IAAI,EAAE,CAAC,GAAG,IAAI;gBACjB,CAAC,EAAE,IAAI,EAAE,CAAC,GAAG,IAAI;gBACjB,CAAC,EAAE,IAAI,CAAC,CAAC,GAAG,IAAI;gBAChB,EAAE,GAAG,IAAI;aACT,CAAC,CAAC,CAAC;QACL,CAAC;QAED,oCAAY,GAAZ,UAAa,QAAgB,EAAE,IAAgB;YAC9C,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE;gBACpB,QAAQ,EAAE,QAAQ;gBAClB,MAAM,EAAE,kBAAkB,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC,uBAAuB;gBAC9E,IAAI,EAAE,IAAI;aACV,CAAC,CAAC;QACJ,CAAC;QACF,oBAAC;IAAD,CAAC,AA7LD,IA6LC;IA7LY,oBAAa,gBA6LzB,CAAA;IAED,IAAI,qBAAqB,GAAG,GAAG,CAAC,CAAC,KAAK;IAgBtC;QAQC,mBAAY,SAAc,EAAE,QAAa;YACxC,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;YAC3B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QAC1B,CAAC;QAEM,wBAAI,GAAX,UAAY,IAAY,EAAE,KAAc,EAAE,QAAiB,EAAE,KAAe;YAC3E,IAAI,EAAE,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;YACrC,EAAE,CAAC,cAAc,GAAG,kBAAkB,CAAC;YACvC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YACvB,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;YAClB,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YACrB,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YACrB,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC1B,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;YACvB,CAAC;YACD,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC1B,EAAE,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;YAC1B,CAAC;YACD,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC1B,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;YACvB,CAAC;YACD,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,UAAU,CAAQ,EAAG,CAAC,OAAO,EAAE,CAAC,EAAS,EAAG,CAAC,MAAM,CAAC,CAAC,CAAC;YACrG,oDAAoD;YACpD,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,EAAE,qBAAqB,CAAC,CAAC;QACjE,CAAC;QAED,yBAAK,GAAL,UAAM,OAA8B;YACnC,MAAM,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;gBACxB,KAAK,CAAC,CAAC;gBACP,KAAK,CAAC;oBACL,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;wBACjB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;oBACtB,CAAC;oBACD,KAAK,CAAC;gBACP,KAAK,EAAE,CAAC;gBACR,KAAK,EAAE;oBACN,IAAI,IAAI,GAAG,EAAE,CAAC;oBACd,IAAI,EAAE,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;oBACrC,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;oBAC/B,EAAE,CAAC,QAAQ,GAAG,CAAC,CAAC;oBAChB,EAAE,CAAC,cAAc,GAAG,CAAC,CAAC;oBACtB,OAAO,EAAE,CAAC,QAAQ,GAAG,EAAE,CAAC,MAAM,EAAE,CAAC;wBAChC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,CAAC;oBAC5B,CAAC;oBACD,EAAE,CAAC,CAAC,OAAO,CAAC,MAAM,KAAK,EAAE,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;wBAChD,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;oBACrC,CAAC;oBACD,EAAE,CAAC,CAAC,OAAO,CAAC,MAAM,KAAK,EAAE,IAAI,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;wBAC9C,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;oBACnC,CAAC;oBACD,KAAK,CAAC;YACR,CAAC;QACF,CAAC;QACF,gBAAC;IAAD,CAAC,AA7DD,IA6DC;IASD,+BAAsC,CAAS;QAC9C,0CAA0C;QAC1C,oDAAoD;QACpD,IAAI,sBAAsB,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAC5C,EAAE,CAAC,CAAC,sBAAsB,GAAG,CAAC,CAAC,CAAC,CAAC;YAChC,MAAM,CAAC,IAAI,CAAC,CAAC,cAAc;QAC5B,CAAC;QACD,EAAE,CAAC,CAAC,CAAC,CAAC,sBAAsB,GAAG,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,IAAI,CAAC,CAAC,gCAAgC;QAC9C,CAAC;QACD,IAAI,QAAQ,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,sBAAsB,CAAC,CAAC,iBAAiB,EAAE,CAAC;QAC1E,EAAE,CAAC,CAAC,QAAQ,KAAK,MAAM,IAAI,QAAQ,KAAK,OAAO,IAAI,QAAQ,KAAK,OAAO;YACtE,QAAQ,KAAK,OAAO,IAAI,QAAQ,KAAK,QAAQ,IAAI,QAAQ,KAAK,OAAO,CAAC,CAAC,CAAC;YACxE,MAAM,CAAC,IAAI,CAAC;QACb,CAAC;QACD,IAAI,IAAI,EAAE,IAAI,CAAC;QACf,IAAI,gBAAgB,GAAG,sBAAsB,GAAG,CAAC,CAAC;QAClD,EAAE,CAAC,CAAC,CAAC,CAAC,sBAAsB,GAAG,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;YAC3C,WAAW;YACX,gBAAgB,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,sBAAsB,GAAG,CAAC,CAAC,CAAC;YAC9D,EAAE,CAAC,CAAC,gBAAgB,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC1B,MAAM,CAAC,SAAS,CAAC,CAAC,0BAA0B;YAC7C,CAAC;YACD,IAAI,aAAa,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,sBAAsB,GAAG,CAAC,CAAC,CAAC;YAC/D,EAAE,CAAC,CAAC,aAAa,IAAI,CAAC,IAAI,aAAa,GAAG,gBAAgB,CAAC,CAAC,CAAC;gBAC5D,IAAI,GAAG,CAAC,CAAC,SAAS,CAAC,sBAAsB,GAAG,CAAC,EAAE,aAAa,CAAC,CAAC;gBAC9D,IAAI,GAAG,CAAC,CAAC,CAAC,SAAS,CAAC,aAAa,GAAG,CAAC,EAAE,gBAAgB,CAAC,CAAC;YAC1D,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,IAAI,GAAG,CAAC,CAAC,SAAS,CAAC,sBAAsB,GAAG,CAAC,EAAE,gBAAgB,CAAC,CAAC;YAClE,CAAC;QACF,CAAC;QACD,IAAI,GAAG,GAAG,CAAC,CAAC,SAAS,CAAC,gBAAgB,GAAG,CAAC,CAAC,CAAC;QAC5C,MAAM,CAAC;YACN,QAAQ,EAAE,QAAQ;YAClB,IAAI,EAAE,IAAI;YACV,IAAI,EAAE,IAAI;YACV,GAAG,EAAE,GAAG;SACR,CAAC;IACH,CAAC;IAtCe,4BAAqB,wBAsCpC,CAAA;AAEF,CAAC,EAvWM,MAAM,KAAN,MAAM,QAuWZ;ACvXD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,MAAM,CAiNZ;AAjND,WAAO,MAAM;IAAC,IAAA,OAAO,CAiNpB;IAjNa,WAAA,OAAO;QACpB,IAAI,iBAAiB,GAAG,IAAI,CAAC;QAC7B,IAAI,kBAAkB,GAAG,IAAI,CAAC;QAE9B;YAAmC,iCAAa;YAK/C,uBAAY,kBAAuB;gBAAnC,YACC,iBAAO,SASP;gBAPA,EAAE,CAAC,CAAC,OAAO,kBAAkB,KAAK,QAAQ,CAAC,CAAC,CAAC;oBAC5C,kBAAkB,GAAG,EAAC,IAAI,EAAE,kBAAkB,EAAC,CAAC;gBACjD,CAAC;gBAED,KAAI,CAAC,IAAI,GAAG,kBAAkB,CAAC,IAAI,IAAI,WAAW,CAAC;gBACnD,KAAI,CAAC,IAAI,GAAG,kBAAkB,CAAC,IAAI,IAAI,iBAAiB,CAAC;gBACzD,KAAI,CAAC,GAAG,GAAG,CAAC,CAAC,kBAAkB,CAAC,GAAG,IAAI,KAAK,CAAC;;YAC9C,CAAC;YAED,+BAAO,GAAP,UAAQ,UAAe,EAAE,IAAU;gBAClC,IAAI,SAAS,GAAG,OAAO,SAAS,KAAK,WAAW;oBACzC,SAAU,CAAC,YAAY,CAAC;gBAE/B,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;oBAChB,MAAM,IAAI,KAAK,CAAC,uDAAuD;wBACtE,6EAA6E,CAAC,CAAC;gBACjF,CAAC;gBAED,IAAI,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;gBAElD,IAAI,UAAU,GAAsB,EAAE,EAAE,WAAW,GAAG,KAAK,CAAC;gBAC5D,IAAI,MAAM,GAAQ,OAAO,QAAA,oBAAoB,KAAK,WAAW,IAAI,QAAA,oBAAoB,CAAC,WAAW,CAAC,CAAC;oBAClG,IAAI,QAAA,oBAAoB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE;wBAC9C,kBAAkB,EAAE,IAAI,CAAC,GAAG;wBAC5B,UAAU,EAAE,aAAa;qBACzB,CAAC,CAAC,CAAC;oBACJ,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,EAAC,kBAAkB,EAAE,IAAI,CAAC,GAAG,EAAE,UAAU,EAAE,aAAa,EAAC,CAAC,CAAC;gBAGjG,IAAI,QAAQ,GAAG,UAAU,IAAgB;oBACxC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;gBACnE,CAAC,CAAC;gBAEF,MAAM,CAAC,MAAM,GAAG,UAAU,CAAM;oBAC/B,OAAO,CAAC,MAAM,GAAG,UAAU,IAAI;wBAC9B,IAAI,GAAG,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;wBAC/B,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;wBACrB,EAAE,CAAC,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;4BAC3B,MAAM,CAAC;wBACR,CAAC;wBACD,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC;wBACvD,EAAE,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACnB,UAAU,CAAC,KAAK,EAAE,CAAC;wBACpB,CAAC;oBACF,CAAC,CAAC;oBACF,OAAO,CAAC,OAAO,GAAG;wBACjB,MAAM,CAAC,KAAK,EAAE,CAAC;oBAChB,CAAC,CAAC;oBACF,OAAO,CAAC,KAAK,EAAE,CAAC;gBACjB,CAAC,CAAC;gBACF,MAAM,CAAC,OAAO,GAAG,UAAU,CAAM;oBAChC,UAAU,CAAC,KAAK,EAAE,CAAC;oBACnB,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;oBAC1C,OAAO,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;wBAC9B,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;wBACjE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;4BAC9B,KAAK,CAAC;wBACP,CAAC;wBACD,UAAU,CAAC,KAAK,EAAE,CAAC;oBACpB,CAAC;gBACF,CAAC,CAAC;gBACF,MAAM,CAAC,OAAO,GAAG,UAAU,CAAM;oBAChC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;gBAC3B,CAAC,CAAC;gBACF,MAAM,CAAC,OAAO,GAAG,UAAU,CAAM;oBAChC,WAAW,GAAG,IAAI,CAAC;oBACnB,OAAO,CAAC,KAAK,CAAC,gBAAgB,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;gBAC1C,CAAC,CAAC;gBACF,MAAM,CAAC,MAAM,GAAG,UAAU,CAAM;oBAC/B,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,GAAG,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;oBAC3D,OAAO,CAAC,IAAI,CAAC,IAAI,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACtC,CAAC,CAAC;YACH,CAAC;YACF,oBAAC;QAAD,CAAC,AAjFD,CAAmC,OAAA,aAAa,GAiF/C;QAjFY,qBAAa,gBAiFzB,CAAA;QAGD;;;;;;WAMG;QACH;YAAoC,kCAAa;YAOhD,wBAAY,kBAAuB;gBAAnC,YACC,iBAAO,SAaP;gBAXA,IAAI,IAAI,GAAG,kBAAkB,CAAC,IAAI,IAAI,WAAW,CAAC;gBAClD,IAAI,GAAG,GAAG,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,KAAK,GAAG,IAAI,CAAC;gBACrE,EAAE,CAAC,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC,CAAC;oBAC7B,GAAG,IAAI,GAAG,GAAG,kBAAkB,CAAC,IAAI,CAAC;gBACtC,CAAC;gBACD,KAAI,CAAC,OAAO,GAAG,GAAG,CAAC;gBAEnB,KAAI,CAAC,OAAO,GAAG,KAAK,CAAC;gBACrB,KAAI,CAAC,SAAS,GAAG,IAAI,CAAC;gBACtB,KAAI,CAAC,SAAS,GAAG,CAAC,CAAC;gBACnB,KAAI,CAAC,IAAI,GAAG,EAAE,CAAC;;YAChB,CAAC;YAED,gCAAO,GAAP,UAAQ,UAAe,EAAE,IAAU;gBAClC,IAAI,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;gBAClD,OAAO,CAAC,MAAM,GAAG,UAAU,IAAS;oBACnC,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;oBACxD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;gBACtC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACb,OAAO,CAAC,OAAO,GAAG;oBACjB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gBACrB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAGb,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,aAAa,EAAE,IAAI,EAAE,UAAU,IAAS,EAAE,MAAW;oBACxE,EAAE,CAAC,CAAC,MAAM,KAAK,GAAG,CAAC,CAAC,CAAC;wBACpB,MAAM,IAAI,KAAK,CAAC,uBAAuB,GAAG,MAAM,CAAC,CAAC;oBACnD,CAAC;oBAED,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,SAAS,EAAE,IAAI,EAAE,UAAU,IAAS,EAAE,MAAW;wBACpE,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS;wBAC9E,OAAO,CAAC,GAAG,CAAC,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC;wBAE7C,IAAI,CAAC,IAAI,EAAE,CAAC;wBACZ,OAAO,CAAC,KAAK,EAAE,CAAC;oBACjB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;gBACf,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACf,CAAC;YAED,6BAAI,GAAJ;gBACC,IAAI,YAAY,GAAG,UAAU,IAAS,EAAE,MAAc;oBACrD,EAAE,CAAC,CAAC,MAAM,KAAK,GAAG,CAAC,CAAC,CAAC;wBACpB,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;oBACxC,CAAC;oBAED,IAAI,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;oBACnB,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;wBACrB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;oBACrC,CAAC;oBACD,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,GAAG,EAAE,CAAC,CAAC;gBAC7C,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAEb,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;oBAClB,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,UAAU,EAAE,IAAI,EAAE;wBACrC,aAAa;oBACd,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC;gBACR,CAAC;gBAED,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;oBAC1B,IAAI,MAAgB,CAAC;oBACrB,EAAE,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC;wBACxB,IAAI,QAAM,GAAG,CAAC,CAAC;wBACf,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAa;4BACxC,QAAM,IAAI,CAAC,CAAC,MAAM,CAAC;wBACpB,CAAC,CAAC,CAAC;wBACH,IAAI,KAAG,GAAG,CAAC,CAAC;wBACZ,MAAI,GAAG,IAAI,UAAU,CAAC,QAAM,CAAC,CAAC;wBAC9B,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAa;4BACxC,MAAI,CAAC,GAAG,CAAC,CAAC,EAAE,KAAG,CAAC,CAAC;4BACjB,KAAG,IAAI,CAAC,CAAC,MAAM,CAAC;wBACjB,CAAC,CAAC,CAAC;wBACH,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;oBACtB,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,MAAI,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;oBAC1B,CAAC;oBACD,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,QAAQ,GAAG,IAAI,CAAC,SAAS,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,EACvE,MAAI,EAAE,YAAY,CAAC,CAAC;gBACtB,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,QAAQ,GAAG,IAAI,CAAC,SAAS,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,EACvE,IAAI,EAAE,YAAY,CAAC,CAAC;gBACtB,CAAC;YACF,CAAC;YACF,qBAAC;QAAD,CAAC,AA7FD,CAAoC,OAAA,aAAa,GA6FhD;QA7FY,sBAAc,iBA6F1B,CAAA;QAED,IAAI,aAAa,GAAG,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAExC,cAAc,IAAS,EAAE,IAAS,EAAE,MAAW;YAC9C,IAAI,IAAI,CAAC,IAAI,GAAG,aAAa,CAAC,CAAC;YAE/B,IAAI,GAAG,GAAQ,OAAO,QAAA,iBAAiB,KAAK,WAAW,IAAI,QAAA,iBAAiB,CAAC,WAAW,CAAC,CAAC;gBACzF,IAAI,QAAA,iBAAiB,EAAE,CAAC,CAAC,CAAC,IAAU,cAAe,CAAC,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,CAAC;YACxE,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;YAC7B,GAAG,CAAC,YAAY,GAAG,aAAa,CAAC;YACjC,GAAG,CAAC,gBAAgB,CAAC,cAAc,EAAE,mBAAmB,CAAC,CAAC;YAC1D,GAAG,CAAC,MAAM,GAAG,UAAU,CAAM;gBAC5B,MAAM,CAAC,IAAI,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;YAClD,CAAC,CAAC;YACF,GAAG,CAAC,OAAO,GAAG,UAAU,CAAM;gBAC7B,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;gBACrB,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;YAC/B,CAAC,CAAC;YACF,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChB,CAAC;IACF,CAAC,EAjNa,OAAO,GAAP,cAAO,KAAP,cAAO,QAiNpB;AAAD,CAAC,EAjNM,MAAM,KAAN,MAAM,QAiNZ;ACjOD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,MAAM,CAm6BZ;AAn6BD,WAAO,MAAM;IAAC,IAAA,GAAG,CAm6BhB;IAn6Ba,WAAA,GAAG;QAAC,IAAA,GAAG,CAm6BpB;QAn6BiB,WAAA,GAAG;YACpB,IAAO,UAAU,GAAG,OAAO,CAAC,eAAe,CAAC,UAAU,CAAC;YAEvD,IAAI,UAAU,GAAG,CAAC,aAAa,CAAC;YAChC,iCAAiC;YACjC,IAAI,oBAAoB,GAAa,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;YACvE,IAAI,gBAAgB,GAAa,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAE3C,sBAAyB,IAAS;gBAAE,cAAc;qBAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;oBAAd,6BAAc;;gBACjD,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YACjD,CAAC;YAED,oBAAoB,IAAgB,EAAE,MAAc,EAAE,KAAa;gBAClE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,IAAI,EAAE,CAAC,GAAG,GAAG,CAAC;gBACnC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,IAAI,EAAE,CAAC,GAAG,GAAG,CAAC;gBACvC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,IAAI,CAAC,CAAC,GAAG,GAAG,CAAC;gBACtC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,GAAG,CAAC;YAChC,CAAC;YAED,qBAAqB,CAAS;gBAC7B,MAAM,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;oBACvD,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAC3C,CAAC;YAED,oBAAoB,CAAS;gBAC5B,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;YACtC,CAAC;YAED,2BAA2B,CAAS;gBACnC,MAAM,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC;YAC1B,CAAC;YAED,0BAA0B,CAAS;gBAClC,MAAM,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;YAC7B,CAAC;YAED,yBAAyB,CAAS;gBACjC,MAAM,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;YACxB,CAAC;YAED,oBAAoB,CAAS;gBAC5B,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;YACtG,CAAC;YAED;gBAOC,aAAmB,OAAe,EAAE,YAAyB;oBAC5D,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;oBACvB,EAAE,CAAC,CAAC,OAAO,KAAK,MAAM,CAAC,CAAC,CAAC;wBACxB,IAAI,CAAC,QAAQ,GAAG,YAAY,CAAC;oBAC9B,CAAC;gBACF,CAAC;gBAED;;;mBAGG;gBACI,oBAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;oBACrB,IAAI,IAAI,GAAG,CAAC,CAAC;oBACb,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;wBACnB,IAAI,IAAI,EAAE,CAAC;oBACZ,CAAC;oBACD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;oBACjB,MAAM,CAAC,IAAI,CAAC;gBACb,CAAC;gBAED;;;mBAGG;gBACI,mBAAK,GAAZ,UAAa,IAAgB;oBAC5B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;oBACzC,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;oBAC7D,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;wBACpB,MAAM,CAAC,CAAC,CAAC;oBACV,CAAC;oBACD,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;oBACzC,MAAM,CAAC,EAAE,CAAC;gBACX,CAAC;gBAEM,0BAAY,GAAnB;oBACC,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;oBAC1B,IAAI,IAAI,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;oBAChC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBACjB,MAAM,CAAC,IAAI,CAAC;gBACb,CAAC;gBACF,UAAC;YAAD,CAAC,AAhDD,IAgDC;YAhDY,OAAG,MAgDf,CAAA;YAED;gBAA6B,2BAAG;gBAI/B,iBAAY,OAAe,EAAE,OAAmB,EAAE,KAAiB;oBAAtC,wBAAA,EAAA,WAAmB;oBAAE,sBAAA,EAAA,SAAiB;oBAAnE,YACC,kBAAM,OAAO,CAAC,SAGd;oBAFA,KAAI,CAAC,OAAO,GAAG,OAAO,CAAC;oBACvB,KAAI,CAAC,KAAK,GAAG,KAAK,CAAC;;gBACpB,CAAC;gBAEM,wBAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACrC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,uBAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC;oBAC1E,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;gBACnB,CAAC;gBACF,cAAC;YAAD,CAAC,AApBD,CAA6B,GAAG,GAoB/B;YApBY,WAAO,UAoBnB,CAAA;YAED;gBAAiC,+BAAG;gBAKnC,qBAAY,UAAkB,EAAE,YAAoB,EAAE,gBAA0B;oBAAhF,YACC,kBAAM,OAAO,CAAC,SAId;oBAHA,KAAI,CAAC,UAAU,GAAG,UAAU,CAAC;oBAC7B,KAAI,CAAC,YAAY,GAAG,YAAY,CAAC;oBACjC,KAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;;gBAC1C,CAAC;gBAEM,4BAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;oBAC1E,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,2BAAK,GAAZ,UAAa,IAAgB;oBAA7B,iBAUC;oBATA,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;oBACrE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;oBAC9D,MAAM,IAAI,CAAC,CAAC;oBACZ,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,UAAC,KAAa;wBAC3C,UAAU,CAAC,IAAI,EAAE,KAAI,CAAC,MAAM,GAAG,MAAM,EAAE,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC;wBAC3D,MAAM,IAAI,CAAC,CAAC;oBACb,CAAC,EAAE,IAAI,CAAC,CAAC;oBACT,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,kBAAC;YAAD,CAAC,AA5BD,CAAiC,GAAG,GA4BnC;YA5BY,eAAW,cA4BvB,CAAA;YAED;gBAAqC,mCAAG;gBAGvC,yBAAY,IAAY,EAAE,QAAe;oBAAzC,YACC,kBAAM,IAAI,CAAC,SAEX;oBADA,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;;gBAC1B,CAAC;gBAEM,gCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,CAAC;oBAChC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,KAAK;wBAC3B,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;4BACZ,MAAM,CAAC,CAAC,qBAAqB;wBAC9B,CAAC;wBACD,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;oBACrC,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,+BAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,KAAK;wBAC3B,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;4BACZ,MAAM,CAAC,CAAC,qBAAqB;wBAC9B,CAAC;wBACD,MAAM,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBAC7B,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,sBAAC;YAAD,CAAC,AA7BD,CAAqC,GAAG,GA6BvC;YA7BY,mBAAe,kBA6B3B,CAAA;YAED;gBAA8B,4BAAe;gBAC5C,kBAAmB,MAAsB,EACtB,MAAa,EACb,UAA2B,EAC3B,QAAa;oBAHhC,YAIC,kBAAM,MAAM,EAAE,YAAY,CAAM,CAAC,MAAM,CAAC,EAAE,MAAM,EAAE,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC,SAC1E;oBALkB,YAAM,GAAN,MAAM,CAAgB;oBACtB,YAAM,GAAN,MAAM,CAAO;oBACb,gBAAU,GAAV,UAAU,CAAiB;oBAC3B,cAAQ,GAAR,QAAQ,CAAK;;gBAEhC,CAAC;gBACF,eAAC;YAAD,CAAC,AAPD,CAA8B,eAAe,GAO5C;YAPY,YAAQ,WAOpB,CAAA;YAED;gBAAoC,kCAAO;gBAC1C,wBAAmB,SAAiB,EACjB,QAAgB,EAChB,WAAmB,EACnB,IAAkB,EAClB,MAAoB,EACpB,MAAuC,EACvC,YAAiC,EACjC,gBAAqC;oBAJrC,qBAAA,EAAA,UAAkB;oBAClB,uBAAA,EAAA,YAAoB;oBACpB,uBAAA,EAAA,6BAAuC;oBACvC,6BAAA,EAAA,yBAAiC;oBACjC,iCAAA,EAAA,6BAAqC;oBAPxD,YAQC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBATkB,eAAS,GAAT,SAAS,CAAQ;oBACjB,cAAQ,GAAR,QAAQ,CAAQ;oBAChB,iBAAW,GAAX,WAAW,CAAQ;oBACnB,UAAI,GAAJ,IAAI,CAAc;oBAClB,YAAM,GAAN,MAAM,CAAc;oBACpB,YAAM,GAAN,MAAM,CAAiC;oBACvC,kBAAY,GAAZ,YAAY,CAAqB;oBACjC,sBAAgB,GAAhB,gBAAgB,CAAqB;;gBAExD,CAAC;gBAEM,+BAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;oBACpE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,8BAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,iBAAiB;oBACjB,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;oBACtE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;oBAC3D,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAC3D,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;oBACrE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC;oBAC/E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC9C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;oBAC/C,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC1E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC1C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC9C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC9C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;oBAC/C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;oBAC/C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;oBAC/C,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;oBACzD,MAAM,IAAI,CAAC,CAAC;oBACZ,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,qBAAC;YAAD,CAAC,AAnDD,CAAoC,OAAO,GAmD1C;YAnDY,kBAAc,iBAmD1B,CAAA;YAED,IAAkB,gBAIjB;YAJD,WAAkB,gBAAgB;gBACjC,yEAAwB,CAAA;gBACxB,2EAAyB,CAAA;gBACzB,+EAA2B,CAAA;YAC5B,CAAC,EAJiB,gBAAgB,GAAhB,oBAAgB,KAAhB,oBAAgB,QAIjC;YAED;gBAAoC,kCAAO;gBAC1C,wBAAY,KAAa,EACN,OAAe,EACf,QAAgB,EAChB,KAAa,EACb,MAAc,EACd,MAAc,EACd,cAA0B,EAC1B,KAAiB,EACjB,MAAuC,EACvC,YAAiC,EACjC,gBAAqC;oBAJrC,+BAAA,EAAA,kBAA0B;oBAC1B,sBAAA,EAAA,SAAiB;oBACjB,uBAAA,EAAA,6BAAuC;oBACvC,6BAAA,EAAA,yBAAiC;oBACjC,iCAAA,EAAA,6BAAqC;oBAVxD,YAWC,kBAAM,MAAM,EAAE,CAAC,EAAE,KAAK,CAAC,SACvB;oBAXkB,aAAO,GAAP,OAAO,CAAQ;oBACf,cAAQ,GAAR,QAAQ,CAAQ;oBAChB,WAAK,GAAL,KAAK,CAAQ;oBACb,YAAM,GAAN,MAAM,CAAQ;oBACd,YAAM,GAAN,MAAM,CAAQ;oBACd,oBAAc,GAAd,cAAc,CAAY;oBAC1B,WAAK,GAAL,KAAK,CAAY;oBACjB,YAAM,GAAN,MAAM,CAAiC;oBACvC,kBAAY,GAAZ,YAAY,CAAqB;oBACjC,sBAAgB,GAAhB,gBAAgB,CAAqB;;gBAExD,CAAC;gBAEM,+BAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;oBAC3D,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,8BAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,iBAAiB;oBACjB,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;oBACtE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;oBACzD,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;oBAC/C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAC3D,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC1C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC9C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC;oBACrF,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC;oBAChF,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC1E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC9E,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;oBACtE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;oBAC3E,MAAM,IAAI,CAAC,CAAC;oBACZ,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,qBAAC;YAAD,CAAC,AAjDD,CAAoC,OAAO,GAiD1C;YAjDY,kBAAc,iBAiD1B,CAAA;YAED;gBAAoC,kCAAO;gBAC1C,wBAAmB,SAAiB,EACjB,QAAgB,EAChB,QAAwB,EACxB,YAAiC,EACjC,gBAAqC;oBAFrC,yBAAA,EAAA,gBAAwB;oBACxB,6BAAA,EAAA,yBAAiC;oBACjC,iCAAA,EAAA,6BAAqC;oBAJxD,YAKC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBANkB,eAAS,GAAT,SAAS,CAAQ;oBACjB,cAAQ,GAAR,QAAQ,CAAQ;oBAChB,cAAQ,GAAR,QAAQ,CAAgB;oBACxB,kBAAY,GAAZ,YAAY,CAAqB;oBACjC,sBAAgB,GAAhB,gBAAgB,CAAqB;;gBAExD,CAAC;gBAEM,+BAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;oBAC1C,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,8BAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,iBAAiB;oBACjB,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;oBACtE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;oBAC9E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;oBAC3D,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAC3D,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;oBAC7E,MAAM,CAAC,MAAM,GAAG,EAAE,CAAC;gBACpB,CAAC;gBACF,qBAAC;YAAD,CAAC,AAxBD,CAAoC,OAAO,GAwB1C;YAxBY,kBAAc,iBAwB1B,CAAA;YAED;gBAAgC,8BAAO;gBAGtC,oBAAmB,WAAmB,EACnB,IAAY;oBAD/B,YAEC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SAEnB;oBAJkB,iBAAW,GAAX,WAAW,CAAQ;oBACnB,UAAI,GAAJ,IAAI,CAAQ;oBAE9B,KAAI,CAAC,YAAY,GAAG,UAAU,CAAC,KAAI,CAAC,IAAI,CAAC,CAAC;;gBAC3C,CAAC;gBAEM,2BAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;oBAC3E,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,0BAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC1C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;oBAC1E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC9C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;oBAC/C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;oBAC/C,MAAM,IAAI,EAAE,CAAC;oBACb,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC;oBAClD,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBAC1D,MAAM,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;oBACvC,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,iBAAC;YAAD,CAAC,AA3BD,CAAgC,OAAO,GA2BtC;YA3BY,cAAU,aA2BtB,CAAA;YAED;gBAAyC,uCAAO;gBAC/C,6BAAmB,OAAqB;oBAArB,wBAAA,EAAA,aAAqB;oBAAxC,YACC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBAFkB,aAAO,GAAP,OAAO,CAAc;;gBAExC,CAAC;gBAEM,oCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACrC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,mCAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,eAAe,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;oBAC5E,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;gBACnB,CAAC;gBACF,0BAAC;YAAD,CAAC,AAfD,CAAyC,OAAO,GAe/C;YAfY,uBAAmB,sBAe/B,CAAA;YAED;gBAAyC,uCAAO;gBAC/C,6BAAmB,YAAwB,EACxB,OAAoC;oBADpC,6BAAA,EAAA,gBAAwB;oBACxB,wBAAA,EAAA,0BAAoC;oBADvD,YAEC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBAHkB,kBAAY,GAAZ,YAAY,CAAY;oBACxB,aAAO,GAAP,OAAO,CAA6B;;gBAEvD,CAAC;gBAEM,oCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACrC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,mCAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,YAAY,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;oBACpF,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;oBACtF,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;gBACnB,CAAC;gBACF,0BAAC;YAAD,CAAC,AAjBD,CAAyC,OAAO,GAiB/C;YAjBY,uBAAmB,sBAiB/B,CAAA;YAEU,sCAAkC,GAAG,QAAQ,CAAC;YAEzD;gBAAqC,mCAAO;gBAG3C,yBAAY,KAAa,EACN,QAAuB;oBAAvB,yBAAA,EAAA,eAAuB;oBAD1C,YAEC,kBAAM,MAAM,EAAE,CAAC,EAAE,KAAK,CAAC,SAIvB;oBALkB,cAAQ,GAAR,QAAQ,CAAe;oBAEzC,EAAE,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,IAAA,kCAAkC,CAAC,CAAC,CAAC,CAAC;wBACnD,KAAI,CAAC,gBAAgB,GAAG,UAAU,CAAC,QAAQ,CAAC,CAAC;oBAC9C,CAAC;;gBACF,CAAC;gBAEM,gCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,CAAC;oBAChC,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;wBAC3B,IAAI,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC;oBAC1C,CAAC;oBACD,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,+BAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;wBAC3B,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC;wBACtD,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;wBAC9D,MAAM,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC;oBACxC,CAAC;oBACD,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,sBAAC;YAAD,CAAC,AA5BD,CAAqC,OAAO,GA4B3C;YA5BY,mBAAe,kBA4B3B,CAAA;YAED;gBAAsC,oCAAO;gBAC5C,0BAAmB,OAAc;oBAAjC,YACC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBAFkB,aAAO,GAAP,OAAO,CAAO;;gBAEjC,CAAC;gBAEM,iCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACpC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAC,KAAK;wBAC1B,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;oBACrC,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,gCAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;oBAC5D,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAC,KAAK;wBAC1B,MAAM,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBAC7B,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,uBAAC;YAAD,CAAC,AArBD,CAAsC,OAAO,GAqB5C;YArBY,oBAAgB,mBAqB5B,CAAA;YAED;gBAAwC,sCAAe;gBACtD,4BAAmB,aAAkB;oBAArC,YACC,kBAAM,MAAM,EAAE,CAAC,aAAa,CAAC,CAAC,SAC9B;oBAFkB,mBAAa,GAAb,aAAa,CAAK;;gBAErC,CAAC;gBACF,yBAAC;YAAD,CAAC,AAJD,CAAwC,eAAe,GAItD;YAJY,sBAAkB,qBAI9B,CAAA;YAED;gBAA0C,wCAAO;gBAChD,8BAAmB,OAAc;oBAAjC,YACC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBAFkB,aAAO,GAAP,OAAO,CAAO;;gBAEjC,CAAC;gBAEM,qCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,CAAC;oBAChC,IAAI,IAAI,CAAC,CAAC;oBACV,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAC,KAAK;wBAC1B,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;oBACrC,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,oCAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;oBAC5D,MAAM,IAAI,CAAC,CAAC;oBACZ,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAC,KAAK;wBAC1B,MAAM,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBAC7B,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,2BAAC;YAAD,CAAC,AAvBD,CAA0C,OAAO,GAuBhD;YAvBY,wBAAoB,uBAuBhC,CAAA;YAED;gBAAoC,kCAAe;gBAClD,wBAAmB,kBAAwC,EACxC,YAAiB,EACjB,aAAkB,EAClB,WAAgB,EAAE,YAAY;oBAC9B,WAAgB;oBAJnC,YAKC,kBAAM,MAAM,EAAE,CAAC,kBAAkB,EAAE,YAAY,EAAE,aAAa,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC,SAC1F;oBANkB,wBAAkB,GAAlB,kBAAkB,CAAsB;oBACxC,kBAAY,GAAZ,YAAY,CAAK;oBACjB,mBAAa,GAAb,aAAa,CAAK;oBAClB,iBAAW,GAAX,WAAW,CAAK;oBAChB,iBAAW,GAAX,WAAW,CAAK;;gBAEnC,CAAC;gBACF,qBAAC;YAAD,CAAC,AARD,CAAoC,eAAe,GAQlD;YARY,kBAAc,iBAQ1B,CAAA;YAED;gBAAyC,uCAAe;gBACvD,6BAAmB,MAAW,EAAE,0CAA0C;oBACvD,IAAwB,EACxB,WAA2B;oBAF9C,YAGC,kBAAM,MAAM,EAAE,CAAC,MAAM,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC,SAC1C;oBAJkB,YAAM,GAAN,MAAM,CAAK;oBACX,UAAI,GAAJ,IAAI,CAAoB;oBACxB,iBAAW,GAAX,WAAW,CAAgB;;gBAE9C,CAAC;gBACF,0BAAC;YAAD,CAAC,AAND,CAAyC,eAAe,GAMvD;YANY,uBAAmB,sBAM/B,CAAA;YAED;gBAA8B,4BAAe;gBAC5C,kBAAmB,MAAsB,EACtB,OAAmB,EACnB,IAAyB;oBAF5C,YAGC,kBAAM,MAAM,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC,SACtC;oBAJkB,YAAM,GAAN,MAAM,CAAgB;oBACtB,aAAO,GAAP,OAAO,CAAY;oBACnB,UAAI,GAAJ,IAAI,CAAqB;;gBAE5C,CAAC;gBACF,eAAC;YAAD,CAAC,AAND,CAA8B,eAAe,GAM5C;YANY,YAAQ,WAMpB,CAAA;YAED;gBAA8B,4BAAe;gBAC5C,kBAAmB,MAAsB,EACtB,KAAU;oBAD7B,YAEC,kBAAM,MAAM,EAAE,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,SAC9B;oBAHkB,YAAM,GAAN,MAAM,CAAgB;oBACtB,WAAK,GAAL,KAAK,CAAK;;gBAE7B,CAAC;gBACF,eAAC;YAAD,CAAC,AALD,CAA8B,eAAe,GAK5C;YALY,YAAQ,WAKpB,CAAA;YAED;gBAAqC,mCAAO;gBAC3C,yBAAmB,OAAe,EACf,6BAAqC,EACrC,qBAA6B,EAC7B,iBAAyB,EACzB,kBAA0B;oBAJ7C,YAKC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBANkB,aAAO,GAAP,OAAO,CAAQ;oBACf,mCAA6B,GAA7B,6BAA6B,CAAQ;oBACrC,2BAAqB,GAArB,qBAAqB,CAAQ;oBAC7B,uBAAiB,GAAjB,iBAAiB,CAAQ;oBACzB,wBAAkB,GAAlB,kBAAkB,CAAQ;;gBAE7C,CAAC;gBAEM,gCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,EAAE,CAAC;oBACtC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,+BAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;oBACrD,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,6BAA6B,CAAC,CAAC;oBAC/E,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC;oBACvE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;oBACpE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;oBACrE,MAAM,CAAC,MAAM,GAAG,EAAE,CAAC;gBACpB,CAAC;gBACF,sBAAC;YAAD,CAAC,AAvBD,CAAqC,OAAO,GAuB3C;YAvBY,mBAAe,kBAuB3B,CAAA;YAED;gBAAqC,mCAAe;gBACnD,yBAAmB,MAAW,EACX,YAA+B,EAC/B,MAAW;oBAF9B,YAGC,kBAAM,MAAM,EAAE,YAAY,CAAM,CAAC,MAAM,CAAC,EAAE,YAAY,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,SAClE;oBAJkB,YAAM,GAAN,MAAM,CAAK;oBACX,kBAAY,GAAZ,YAAY,CAAmB;oBAC/B,YAAM,GAAN,MAAM,CAAK;;gBAE9B,CAAC;gBACF,sBAAC;YAAD,CAAC,AAND,CAAqC,eAAe,GAMnD;YANY,mBAAe,kBAM3B,CAAA;YAED;gBAA6B,2BAAO;gBACnC,iBAAmB,OAAY,EACZ,UAAiB;oBADpC,YAEC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBAHkB,aAAO,GAAP,OAAO,CAAK;oBACZ,gBAAU,GAAV,UAAU,CAAO;;gBAEpC,CAAC;gBAEM,wBAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,CAAC;oBAChC,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;oBAC3C,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAC,GAAG;wBAC3B,IAAI,IAAI,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;oBACnC,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,uBAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBACnC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAC,GAAG;wBAC3B,MAAM,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBAC3B,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,cAAC;YAAD,CAAC,AAvBD,CAA6B,OAAO,GAuBnC;YAvBY,WAAO,UAuBnB,CAAA;YAED;gBAA4C,0CAAO;gBAClD,gCAAmB,cAAsB;oBAAzC,YACC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBAFkB,oBAAc,GAAd,cAAc,CAAQ;;gBAEzC,CAAC;gBAEM,uCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACrC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,sCAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;oBAC5D,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;gBACnB,CAAC;gBACF,6BAAC;YAAD,CAAC,AAfD,CAA4C,OAAO,GAelD;YAfY,0BAAsB,yBAelC,CAAA;YAED,IAAkB,kBAMjB;YAND,WAAkB,kBAAkB;gBACnC,mGAAmC,CAAA;gBACnC,mHAA2C,CAAA;gBAC3C,iHAA0C,CAAA;gBAC1C,0GAAuC,CAAA;gBACvC,4GAAuC,CAAA;YACxC,CAAC,EANiB,kBAAkB,GAAlB,sBAAkB,KAAlB,sBAAkB,QAMnC;YAED;gBAA4C,0CAAO;gBAClD,gCAAY,KAAa,EACN,OAAe,EACf,cAAsB,EACtB,sBAA8B,EAC9B,qBAA6B,EAC7B,iBAAyB,EACzB,kBAA0B;oBAN7C,YAOC,kBAAM,MAAM,EAAE,CAAC,EAAE,KAAK,CAAC,SACvB;oBAPkB,aAAO,GAAP,OAAO,CAAQ;oBACf,oBAAc,GAAd,cAAc,CAAQ;oBACtB,4BAAsB,GAAtB,sBAAsB,CAAQ;oBAC9B,2BAAqB,GAArB,qBAAqB,CAAQ;oBAC7B,uBAAiB,GAAjB,iBAAiB,CAAQ;oBACzB,wBAAkB,GAAlB,kBAAkB,CAAQ;;gBAE7C,CAAC;gBAEM,uCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACpC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,mCAA8C,CAAC,CAAC,CAAC,CAAC;wBAC7D,IAAI,IAAI,CAAC,CAAC;oBACX,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,2CAAsD,CAAC,CAAC,CAAC,CAAC;wBACrE,IAAI,IAAI,CAAC,CAAC;oBACX,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,0CAAqD,CAAC,CAAC,CAAC,CAAC;wBACpE,IAAI,IAAI,CAAC,CAAC;oBACX,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,uCAAiD,CAAC,CAAC,CAAC,CAAC;wBAChE,IAAI,IAAI,CAAC,CAAC;oBACX,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,wCAAkD,CAAC,CAAC,CAAC,CAAC;wBACjE,IAAI,IAAI,CAAC,CAAC;oBACX,CAAC;oBACD,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,sCAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;oBACrD,MAAM,IAAI,CAAC,CAAC;oBACZ,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,mCAA8C,CAAC,CAAC,CAAC,CAAC;wBAC7D,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;wBAC1C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;wBAChE,MAAM,IAAI,CAAC,CAAC;oBACb,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,2CAAsD,CAAC,CAAC,CAAC,CAAC;wBACrE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,sBAAsB,CAAC,CAAC;wBACpE,MAAM,IAAI,CAAC,CAAC;oBACb,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,0CAAqD,CAAC,CAAC,CAAC,CAAC;wBACpE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC;wBACnE,MAAM,IAAI,CAAC,CAAC;oBACb,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,uCAAiD,CAAC,CAAC,CAAC,CAAC;wBAChE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;wBAC/D,MAAM,IAAI,CAAC,CAAC;oBACb,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,wCAAkD,CAAC,CAAC,CAAC,CAAC;wBACjE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;wBAChE,MAAM,IAAI,CAAC,CAAC;oBACb,CAAC;oBACD,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,6BAAC;YAAD,CAAC,AA5DD,CAA4C,OAAO,GA4DlD;YA5DY,0BAAsB,yBA4DlC,CAAA;YAED;gBAAyD,uDAAO;gBAC/D,6CAAmB,mBAA2B;oBAA9C,YACC,kBAAM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,SACnB;oBAFkB,yBAAmB,GAAnB,mBAAmB,CAAQ;;gBAE9C,CAAC;gBAEM,oDAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACrC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,mDAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;oBACjE,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;gBACnB,CAAC;gBACF,0CAAC;YAAD,CAAC,AAfD,CAAyD,OAAO,GAe/D;YAfY,uCAAmC,sCAe/C,CAAA;YAED;gBAAsC,oCAAe;gBACpD,0BAAmB,MAA8B,EAC9B,UAA+C,EAAE,kBAAkB;oBACnE,GAAgB;oBAFnC,YAGC,kBAAM,MAAM,EAAE,CAAC,MAAM,EAAE,UAAU,EAAE,GAAG,CAAC,CAAC,SACxC;oBAJkB,YAAM,GAAN,MAAM,CAAwB;oBAC9B,gBAAU,GAAV,UAAU,CAAqC;oBAC/C,SAAG,GAAH,GAAG,CAAa;;gBAEnC,CAAC;gBACF,uBAAC;YAAD,CAAC,AAND,CAAsC,eAAe,GAMpD;YANY,oBAAgB,mBAM5B,CAAA;YAED,IAAkB,WAUjB;YAVD,WAAkB,WAAW;gBAC5B,2EAA4B,CAAA;gBAC5B,wFAAmC,CAAA;gBACnC,0FAAoC,CAAA;gBACpC,kGAAwC,CAAA;gBACxC,gGAAuC,CAAA;gBACvC,+FAAuC,CAAA;gBACvC,4FAAsC,CAAA;gBACtC,6EAA+B,CAAA;gBAC/B,yGAA6C,CAAA;YAC9C,CAAC,EAViB,WAAW,GAAX,eAAW,KAAX,eAAW,QAU5B;YAED,IAAkB,aAOjB;YAPD,WAAkB,aAAa;gBAC9B,+EAA8B,CAAA;gBAC9B,6FAAqC,CAAA;gBACrC,yFAAkC,CAAA;gBAClC,iFAA8B,CAAA;gBAC9B,oFAA+B,CAAA;gBAC/B,wGAAyC,CAAA;YAC1C,CAAC,EAPiB,aAAa,GAAb,iBAAa,KAAb,iBAAa,QAO9B;YASD;gBAAiC,+BAAO;gBACvC,qBAAY,KAAa,EACN,OAAyB,EACzB,UAAmB,EACnB,gBAAyB;oBAH5C,YAIC,kBAAM,MAAM,EAAE,CAAC,EAAE,KAAK,CAAC,SACvB;oBAJkB,aAAO,GAAP,OAAO,CAAkB;oBACzB,gBAAU,GAAV,UAAU,CAAS;oBACnB,sBAAgB,GAAhB,gBAAgB,CAAS;;gBAE5C,CAAC;gBAEM,4BAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACpC,IAAI,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;oBACvC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,8BAAoC,CAAC,CAAC,CAAC,CAAC;wBACnD,IAAI,IAAI,CAAC,CAAC;oBACX,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,qCAA2C,CAAC,CAAC,CAAC,CAAC;wBAC1D,IAAI,IAAI,CAAC,CAAC;oBACX,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,oCAAwC,CAAC,CAAC,CAAC,CAAC;wBACvD,IAAI,IAAI,CAAC,GAAG,YAAY,CAAC;oBAC1B,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,gCAAoC,CAAC,CAAC,CAAC,CAAC;wBACnD,IAAI,IAAI,CAAC,GAAG,YAAY,CAAC;oBAC1B,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,kCAAqC,CAAC,CAAC,CAAC,CAAC;wBACpD,IAAI,IAAI,CAAC,GAAG,YAAY,CAAC;oBAC1B,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,4CAA+C,CAAC,CAAC,CAAC,CAAC;wBAC9D,IAAI,IAAI,CAAC,GAAG,YAAY,CAAC;oBAC1B,CAAC;oBACD,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,2BAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,IAAI,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;oBACvC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;oBACvB,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,YAAY,CAAC,CAAC;oBACrD,MAAM,IAAI,CAAC,CAAC;oBACZ,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,8BAAoC,CAAC,CAAC,CAAC,CAAC;wBACnD,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;wBACxD,MAAM,IAAI,CAAC,CAAC;oBACb,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,qCAA2C,CAAC,CAAC,CAAC,CAAC;wBAC1D,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;wBAC9D,MAAM,IAAI,CAAC,CAAC;oBACb,CAAC;oBACD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,EAAE,CAAC,EAAE,EAAE,CAAC;wBACvC,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;wBAC7B,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,oCAAwC,CAAC,CAAC,CAAC,CAAC;4BACvD,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;4BACxD,MAAM,IAAI,CAAC,CAAC;wBACb,CAAC;wBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,gCAAoC,CAAC,CAAC,CAAC,CAAC;4BACnD,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;4BACpD,MAAM,IAAI,CAAC,CAAC;wBACb,CAAC;wBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,kCAAqC,CAAC,CAAC,CAAC,CAAC;4BACpD,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC;4BACrD,MAAM,IAAI,CAAC,CAAC;wBACb,CAAC;wBACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,4CAA+C,CAAC,CAAC,CAAC,CAAC;4BAC9D,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,MAAM,CAAC,qBAAqB,CAAC,CAAC;4BACrE,MAAM,IAAI,CAAC,CAAC;wBACb,CAAC;oBACF,CAAC;oBACD,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,kBAAC;YAAD,CAAC,AApED,CAAiC,OAAO,GAoEvC;YApEY,eAAW,cAoEvB,CAAA;YAED;gBAAsC,oCAAe;gBACpD,0BAAmB,MAA8B,EAC9B,KAAyB;oBAD5C,YAEC,kBAAM,MAAM,EAAE,YAAY,CAAM,CAAC,MAAM,CAAC,EAAE,KAAK,CAAC,CAAC,SACjD;oBAHkB,YAAM,GAAN,MAAM,CAAwB;oBAC9B,WAAK,GAAL,KAAK,CAAoB;;gBAE5C,CAAC;gBACF,uBAAC;YAAD,CAAC,AALD,CAAsC,eAAe,GAKpD;YALY,oBAAgB,mBAK5B,CAAA;YAED;gBAAkC,gCAAG;gBACpC,sBAAmB,MAAoB;oBAAvC,YACC,kBAAM,MAAM,CAAC,SACb;oBAFkB,YAAM,GAAN,MAAM,CAAc;;gBAEvC,CAAC;gBAEM,6BAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,CAAC;oBAChC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,KAAK;wBACzB,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC;oBACtB,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,4BAAK,GAAZ,UAAa,IAAgB;oBAA7B,iBAOC;oBANA,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,KAAK;wBACzB,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,KAAI,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC;wBACtC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC;oBACxB,CAAC,EAAE,IAAI,CAAC,CAAC;oBACT,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,mBAAC;YAAD,CAAC,AArBD,CAAkC,GAAG,GAqBpC;YArBY,gBAAY,eAqBxB,CAAA;YAGD;gBAAiC,+BAAG;gBACnC,qBAAY,MAAc,EACP,kBAA0B;oBAD7C,YAEC,kBAAM,MAAM,CAAC,SACb;oBAFkB,wBAAkB,GAAlB,kBAAkB,CAAQ;;gBAE7C,CAAC;gBAEM,4BAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACrC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,2BAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC1C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;oBACpE,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;gBACnB,CAAC;gBACF,kBAAC;YAAD,CAAC,AAjBD,CAAiC,GAAG,GAiBnC;YAjBY,eAAW,cAiBvB,CAAA;YAED;gBAAsC,oCAAW;gBAChD,0BAAY,UAAkB,EAClB,kBAA0B,EACnB,YAAwB,EACxB,UAAuB,EACvB,UAA0B,EAC1B,UAAwB;oBAHxB,6BAAA,EAAA,gBAAwB;oBACxB,2BAAA,EAAA,eAAuB;oBACvB,2BAAA,EAAA,kBAA0B;oBAC1B,2BAAA,EAAA,iBAAwB;oBAL3C,YAMC,kBAAM,UAAU,EAAE,kBAAkB,CAAC,SACrC;oBALkB,kBAAY,GAAZ,YAAY,CAAY;oBACxB,gBAAU,GAAV,UAAU,CAAa;oBACvB,gBAAU,GAAV,UAAU,CAAgB;oBAC1B,gBAAU,GAAV,UAAU,CAAc;;gBAE3C,CAAC;gBAEM,iCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,EAAE,CAAC;oBACrC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAC,GAAG;wBAC9C,IAAI,IAAI,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;oBACnC,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,gCAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC1C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC9C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,YAAY,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;oBACxF,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;oBAC/C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE,CAAC,CAAC,CAAC;oBACrE,MAAM,IAAI,EAAE,CAAC;oBACb,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAC,GAAG;wBAC9C,MAAM,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBAC3B,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,uBAAC;YAAD,CAAC,AA/BD,CAAsC,WAAW,GA+BhD;YA/BY,oBAAgB,mBA+B5B,CAAA;YAEU,qCAAiC,GAAG,MAAM,CAAC;YAEtD;gBAAsC,oCAAW;gBAChD,0BAAY,UAAkB,EAClB,kBAA0B,EACnB,KAAa,EACb,MAAc,EACd,cAA2B,EAC3B,eAA4B,EAC5B,cAA2B,EAC3B,UAAsB,EACtB,KAAiD,EACjD,UAAwB;oBALxB,+BAAA,EAAA,mBAA2B;oBAC3B,gCAAA,EAAA,oBAA4B;oBAC5B,+BAAA,EAAA,mBAA2B;oBAC3B,2BAAA,EAAA,cAAsB;oBACtB,sBAAA,EAAA,QAAgB,qCAAiC;oBACjD,2BAAA,EAAA,iBAAwB;oBAT3C,YAUC,kBAAM,UAAU,EAAE,kBAAkB,CAAC,SAIrC;oBAZkB,WAAK,GAAL,KAAK,CAAQ;oBACb,YAAM,GAAN,MAAM,CAAQ;oBACd,oBAAc,GAAd,cAAc,CAAa;oBAC3B,qBAAe,GAAf,eAAe,CAAa;oBAC5B,oBAAc,GAAd,cAAc,CAAa;oBAC3B,gBAAU,GAAV,UAAU,CAAY;oBACtB,WAAK,GAAL,KAAK,CAA4C;oBACjD,gBAAU,GAAV,UAAU,CAAc;oBAE1C,EAAE,CAAC,CAAC,cAAc,CAAC,MAAM,GAAG,EAAE,CAAC,CAAC,CAAC;wBAChC,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;oBAC5C,CAAC;;gBACF,CAAC;gBAEM,iCAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC;oBAC/D,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAC,GAAG;wBAC9C,IAAI,IAAI,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;oBACnC,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;gBAC3B,CAAC;gBAEM,gCAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC1C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC9C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC9C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;oBAC/C,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,KAAK,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;oBACzE,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC;oBACpF,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC;oBACnF,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC1C,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE,CAAC,CAAC,CAAC;oBACpE,MAAM,IAAI,CAAC,CAAC,CAAC,eAAe;oBAC5B,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC;oBACxD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;wBAC7B,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACrH,CAAC;oBACD,MAAM,IAAI,EAAE,CAAC;oBACb,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,KAAK,IAAI,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC;oBACpE,MAAM,IAAI,CAAC,CAAC;oBACZ,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAC,GAAG;wBAC9C,MAAM,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBAC3B,CAAC,CAAC,CAAC;oBACH,MAAM,CAAC,MAAM,CAAC;gBACf,CAAC;gBACF,uBAAC;YAAD,CAAC,AAnDD,CAAsC,WAAW,GAmDhD;YAnDY,oBAAgB,mBAmD5B,CAAA;YAED;gBAA4B,0BAAG;gBAG9B,gBAAY,IAAY,EAAE,IAAgB;oBAA1C,YACC,kBAAM,IAAI,CAAC,SAEX;oBADA,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC;;gBAClB,CAAC;gBAEM,uBAAM,GAAb,UAAc,MAAc;oBAC3B,IAAI,CAAC,IAAI,GAAG,iBAAM,MAAM,YAAC,MAAM,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;oBACpD,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClB,CAAC;gBAEM,sBAAK,GAAZ,UAAa,IAAgB;oBAC5B,IAAI,MAAM,GAAG,iBAAM,KAAK,YAAC,IAAI,CAAC,CAAC;oBAC/B,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC;oBAC1C,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;gBAClC,CAAC;gBACF,aAAC;YAAD,CAAC,AAlBD,CAA4B,GAAG,GAkB9B;YAlBY,UAAM,SAkBlB,CAAA;QACF,CAAC,EAn6BiB,GAAG,GAAH,OAAG,KAAH,OAAG,QAm6BpB;IAAD,CAAC,EAn6Ba,GAAG,GAAH,UAAG,KAAH,UAAG,QAm6BhB;AAAD,CAAC,EAn6BM,MAAM,KAAN,MAAM,QAm6BZ;ACn7BD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,MAAM,CAupBZ;AAvpBD,WAAO,MAAM;IAAC,IAAA,GAAG,CAupBhB;IAvpBa,WAAA,GAAG;QAChB,aAAa,CAAS;YACrB,IAAI,GAAG,GAAG,CAAC,CAAC,MAAM,IAAI,CAAC,CAAC;YACxB,IAAI,GAAG,GAAG,IAAI,UAAU,CAAC,GAAG,CAAC,CAAC;YAC9B,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC9B,GAAG,CAAC,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;YAC3C,CAAC;YACD,MAAM,CAAC,GAAG,CAAC;QACZ,CAAC;QAED,IAAI,UAAU,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;QAC7C,IAAI,YAAY,GAAG,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,eAAe,EAAE,cAAc,EAAE,aAAa,EAAE,aAAa,EAAE,cAAc,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,UAAU,CAAC,CAAC;QACtK,IAAI,kBAAkB,GAAG,CAAC,CAAC;QAC3B,IAAI,kBAAkB,GAAG,EAAE,CAAC;QAE5B,IAAK,eAGJ;QAHD,WAAK,eAAe;YACnB,yDAAU,CAAA;YACV,mDAAO,CAAA;QACR,CAAC,EAHI,eAAe,KAAf,eAAe,QAGnB;QAaD,wBAAwB,IAAgB;YACvC,IAAI,CAAC,GAAG,CAAC,CAAC;YACV,IAAI,UAAU,GAAG,eAAe,CAAC,GAAG,CAAC;YACrC,IAAI,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;YACpB,IAAI,OAAO,GAAG,KAAK,IAAI,CAAC,CAAC;YACzB,IAAI,WAAW,GAAG,CAAC,KAAK,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;YACnC,IAAI,UAAU,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,KAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAC3C,IAAI,QAAQ,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACzC,IAAI,OAAe,CAAC;YACpB,CAAC,EAAE,CAAC;YACJ,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;gBACjB,KAAK,kBAAkB;oBACtB,IAAI,IAAI,GAAG,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;oBACrB,UAAU,GAAoB,IAAI,CAAC;oBACnC,OAAO,GAAG,IAAI,CAAC,CAAC,iEAAiE;oBACjF,KAAK,CAAC;gBACP,KAAK,kBAAkB;oBACtB,IAAI,OAAO,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,aAAa;oBACnD,IAAI,KAAK,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,+BAA+B;oBACnE,OAAO,GAAG,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;wBACrD,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;oBAC5B,KAAK,CAAC;YACR,CAAC;YACD,MAAM,CAAC;gBACN,gBAAgB,EAAE,YAAY,CAAC,OAAO,CAAC;gBACvC,OAAO,EAAE,OAAO;gBAChB,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACtB,IAAI,EAAE,UAAU,CAAC,WAAW,CAAC;gBAC7B,IAAI,EAAE,UAAU;gBAChB,QAAQ,EAAE,QAAQ;gBAClB,OAAO,EAAE,OAAO;gBAChB,UAAU,EAAE,UAAU;aACtB,CAAC;QACH,CAAC;QAED,IAAI,WAAW,GAAG,CAAC,IAAI,EAAE,MAAM,EAAE,UAAU,EAAE,QAAQ,EAAE,KAAK,EAAE,WAAW,EAAE,SAAS,EAAE,KAAK,CAAC,CAAC;QAC7F,IAAI,kBAAkB,GAAG,CAAC,CAAC;QAC3B,IAAI,kBAAkB,GAAG,CAAC,CAAC;QAE3B,IAAK,cAMJ;QAND,WAAK,cAAc;YAClB,iDAAO,CAAA;YACP,qDAAS,CAAA;YACT,+DAAc,CAAA;YACd,6DAAa,CAAA;YACb,mDAAQ,CAAA;QACT,CAAC,EANI,cAAc,KAAd,cAAc,QAMlB;QAED,IAAK,eAIJ;QAJD,WAAK,eAAe;YACnB,yDAAU,CAAA;YACV,qDAAQ,CAAA;YACR,mDAAO,CAAA;QACR,CAAC,EAJI,eAAe,KAAf,eAAe,QAInB;QAaD,wBAAwB,IAAgB;YACvC,IAAI,CAAC,GAAG,CAAC,CAAC;YACV,IAAI,SAAS,GAAG,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;YAC7B,IAAI,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;YAC3B,CAAC,EAAE,CAAC;YACJ,IAAI,MAAM,GAAQ;gBACjB,SAAS,EAAkB,SAAS;gBACpC,OAAO,EAAE,OAAO;gBAChB,gBAAgB,EAAE,WAAW,CAAC,OAAO,CAAC;aACtC,CAAC;YACF,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;gBACjB,KAAK,kBAAkB;oBACtB,IAAI,IAAI,GAAG,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;oBACrB,MAAM,CAAC,UAAU,GAAoB,IAAI,CAAC;oBAC1C,MAAM,CAAC,eAAe,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;oBAC3F,CAAC,IAAI,CAAC,CAAC;oBACP,KAAK,CAAC;gBACP,KAAK,kBAAkB;oBACtB,MAAM,CAAC,UAAU,GAAG,eAAe,CAAC,IAAI,CAAC;oBACzC,MAAM,CAAC,gBAAgB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,CAAC;oBAC9C,MAAM,CAAC,cAAc,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;oBACrC,MAAM,CAAC,eAAe,GAAG,CAAC,CAAC;oBAC3B,CAAC,EAAE,CAAC;oBACJ,KAAK,CAAC;YACR,CAAC;YACD,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;YAC/B,MAAM,CAAC,MAAM,CAAC;QACf,CAAC;QAED,IAAI,YAAY,GAAG,CAAC,CAAC;QACrB,IAAI,YAAY,GAAG,CAAC,CAAC;QACrB,IAAI,oBAAoB,GAAG,GAAG,CAAC;QAC/B,IAAI,kBAAkB,GAAG,KAAK,CAAC;QA8B/B,IAAK,WAIJ;QAJD,WAAK,WAAW;YACf,2EAAuB,CAAA;YACvB,qEAAoB,CAAA;YACpB,6DAAgB,CAAA;QACjB,CAAC,EAJI,WAAW,KAAX,WAAW,QAIf;QAWD;YAmBC,gBAAmB,QAAqB;gBAAxC,iBAyBC;gBAjCD,gBAAW,GAA+B,UAAU,MAAgB;oBACnE,EAAE;gBACH,CAAC,CAAC;gBAEF,WAAM,GAAwB,UAAU,IAAI;oBAC3C,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;gBAC7C,CAAC,CAAC;gBAGD,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;gBAEzB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,UAAC,CAAC,EAAE,KAAK;oBACpD,IAAI,KAAK,GAAG;wBACX,OAAO,EAAE,KAAK,GAAG,CAAC;wBAClB,SAAS,EAAE,CAAC;wBACZ,cAAc,EAAE,CAAC;wBACjB,gBAAgB,EAAE,CAAC;wBACnB,kBAAkB,EAAE,EAAS;qBAC7B,CAAC;oBACF,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,YAAY,KAAK,KAAK,CAAC,CAAC,CAAC;wBAC1C,KAAI,CAAC,eAAe,GAAG,KAAK,CAAC;oBAC9B,CAAC;oBACD,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,YAAY,KAAK,KAAK,CAAC,CAAC,CAAC;wBAC1C,KAAI,CAAC,eAAe,GAAG,KAAK,CAAC;oBAC9B,CAAC;oBACD,MAAM,CAAC,KAAK,CAAC;gBACd,CAAC,EAAE,IAAI,CAAC,CAAC;gBAET,IAAI,CAAC,sBAAsB,EAAE,CAAC;gBAE9B,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;gBACjB,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;gBACxB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;YACrB,CAAC;YAEM,2BAAU,GAAjB,UAAkB,IAAY,EAAE,IAAgB,EAAE,SAAiB;gBAClE,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,KAAK,WAAW,CAAC,mBAAmB,CAAC,CAAC,CAAC;oBACpD,IAAI,CAAC,kBAAkB,EAAE,CAAC;gBAC3B,CAAC;gBAED,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;oBACd,KAAK,YAAY,CAAE,QAAQ;wBAC1B,IAAI,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC;wBACtC,IAAI,WAAW,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC;wBACvC,EAAE,CAAC,CAAC,CAAC,UAAU,IAAI,UAAU,CAAC,SAAS,CAAC,OAAO,KAAK,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;4BACzE,MAAM,IAAI,KAAK,CAAC,iCAAiC,GAAG,WAAW,CAAC,gBAAgB,CAAC,CAAC;wBACnF,CAAC;wBACD,MAAM,CAAC,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;4BAC7B;gCACC,MAAM,IAAI,KAAK,CAAC,2BAA2B,GAAG,WAAW,CAAC,gBAAgB,CAAC,CAAC;4BAC7E,KAAK,kBAAkB;gCACtB,KAAK,CAAC,CAAC,kBAAkB;4BAC1B,KAAK,kBAAkB;gCACtB,EAAE,CAAC,CAAC,WAAW,CAAC,UAAU,KAAK,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC;oCACvD,UAAU,CAAC,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;oCACrD,MAAM,CAAC;gCACR,CAAC;gCACD,KAAK,CAAC;wBACR,CAAC;wBACD,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,WAAW,EAAE,SAAS,EAAE,SAAS,EAAE,OAAO,EAAE,UAAU,CAAC,OAAO,EAAC,CAAC,CAAC;wBAClG,KAAK,CAAC;oBACP,KAAK,YAAY;wBAChB,IAAI,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC;wBACtC,IAAI,WAAW,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC;wBACvC,EAAE,CAAC,CAAC,CAAC,UAAU,IAAI,UAAU,CAAC,SAAS,CAAC,OAAO,KAAK,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;4BACzE,MAAM,IAAI,KAAK,CAAC,iCAAiC,GAAG,WAAW,CAAC,gBAAgB,CAAC,CAAC;wBACnF,CAAC;wBACD,MAAM,CAAC,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;4BAC7B;gCACC,MAAM,IAAI,KAAK,CAAC,2BAA2B,GAAG,WAAW,CAAC,gBAAgB,CAAC,CAAC;4BAC7E,KAAK,kBAAkB;gCACtB,KAAK,CAAC,CAAC,YAAY;4BACpB,KAAK,kBAAkB;gCACtB,EAAE,CAAC,CAAC,WAAW,CAAC,UAAU,KAAK,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC;oCACvD,UAAU,CAAC,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;oCACrD,MAAM,CAAC;gCACR,CAAC;gCACD,KAAK,CAAC;wBACR,CAAC;wBACD,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,WAAW,EAAE,SAAS,EAAE,SAAS,EAAE,OAAO,EAAE,UAAU,CAAC,OAAO,EAAC,CAAC,CAAC;wBAClG,KAAK,CAAC;oBACP;wBACC,MAAM,IAAI,KAAK,CAAC,uBAAuB,GAAG,IAAI,CAAC,CAAC;gBAClD,CAAC;gBAED,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,KAAK,WAAW,CAAC,gBAAgB,CAAC,CAAC,CAAC;oBACjD,IAAI,CAAC,kBAAkB,EAAE,CAAC;gBAC3B,CAAC;gBACD,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,IAAI,oBAAoB;oBACpD,IAAI,CAAC,KAAK,KAAK,WAAW,CAAC,YAAY,CAAC,CAAC,CAAC;oBAC1C,IAAI,CAAC,MAAM,EAAE,CAAC;gBACf,CAAC;YACF,CAAC;YAEM,sBAAK,GAAZ;gBACC,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;oBACnC,IAAI,CAAC,MAAM,EAAE,CAAC;gBACf,CAAC;YACF,CAAC;YAEO,uCAAsB,GAA9B;gBACC,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAC,EAAE;oBAC3B,OAAA,EAAE,CAAC,SAAS,CAAC,OAAO,KAAK,kBAAkB,IAAI,EAAE,CAAC,SAAS,CAAC,OAAO,KAAK,kBAAkB;gBAA1F,CAA0F,CAAC,CAAC,CAAC,CAAC;oBAC/F,IAAI,CAAC,KAAK,GAAG,WAAW,CAAC,gBAAgB,CAAC;gBAC3C,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,IAAI,CAAC,KAAK,GAAG,WAAW,CAAC,mBAAmB,CAAC;gBAC9C,CAAC;YACF,CAAC;YAEO,mCAAkB,GAA1B;gBACC,IAAI,2BAA2B,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,UAAC,EAAE;oBAC3D,MAAM,CAAC,CAAC,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;wBAC9B,KAAK,kBAAkB,CAAC;wBACxB,KAAK,kBAAkB;4BACtB,MAAM,CAAC,EAAE,CAAC,kBAAkB,CAAC,MAAM,GAAG,CAAC,CAAC;wBACzC;4BACC,MAAM,CAAC,IAAI,CAAC;oBACd,CAAC;gBACF,CAAC,CAAC,CAAC;gBACH,EAAE,CAAC,CAAC,CAAC,2BAA2B,CAAC,CAAC,CAAC;oBAClC,MAAM,CAAC,CAAC,gCAAgC;gBACzC,CAAC;gBAED,IAAI,MAAM,GAAa,CAAC,MAAM,CAAC,CAAC;gBAChC,IAAI,uBAAuB,GAAG,CAAC,EAAE,uBAAuB,GAAG,CAAC,CAAC;gBAC7D,IAAI,KAAK,GAAmB,EAAE,CAAC;gBAC/B,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;oBAClD,IAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;oBACrC,IAAI,SAAS,GAAG,UAAU,CAAC,SAAS,CAAC;oBACrC,IAAI,WAAW,SAAiB,CAAC;oBACjC,MAAM,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;wBAC3B,KAAK,kBAAkB;4BACtB,IAAI,mBAAmB,GAAG,UAAU,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;4BAC3D,WAAW,GAAG,IAAI,IAAA,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE,uBAAuB,EAAE,SAAS,CAAC,QAAQ,EAAE,SAAS,CAAC,UAAU,EAAE,SAAS,CAAC,UAAU,CAAC,CAAC;4BAExI,IAAI,QAAQ,GAAG,IAAI,UAAU,CAAC,EAAE,GAAG,mBAAmB,CAAC,MAAM,CAAC,CAAC;4BAC/D,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;4BACzC,QAAQ,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,mBAAmB,CAAC,MAAM,CAAC;4BAC9C,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAC,CAAC;4BACvC,QAAQ,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,mBAAmB,CAAC,MAAM,CAAC;4BAC/C,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,oCAAoC,CAAC,EAAE,EAAE,CAAC,CAAC;4BAC5D,QAAQ,CAAC,EAAE,CAAC,GAAG,mBAAmB,CAAC,MAAM,CAAC;4BAC1C,QAAQ,CAAC,GAAG,CAAC,mBAAmB,EAAE,EAAE,CAAC,CAAC;4BACtC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE,EAAE,GAAG,mBAAmB,CAAC,MAAM,CAAC,CAAC;4BAC5C,WAAY,CAAC,UAAU,GAAG;gCAChD,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,QAAQ,CAAC;6BAChC,CAAC;4BACF,IAAI,UAAU,GAAG,CAAC,mBAAmB,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,UAAU;4BAC1D,qBAAqB;4BACrB,UAAU,CAAC,aAAa,GAAG,UAAU,GAAG,UAAU,CAAC;4BACnD,KAAK,CAAC;wBACP,KAAK,kBAAkB;4BACtB,WAAW,GAAG,IAAI,IAAA,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE,uBAAuB,EAAE,SAAS,CAAC,QAAQ,EAAE,SAAS,CAAC,UAAU,EAAE,SAAS,CAAC,UAAU,CAAC,CAAC;4BACxI,UAAU,CAAC,aAAa,GAAG,KAAK,CAAC;4BACjC,KAAK,CAAC;wBACP,KAAK,kBAAkB;4BACtB,IAAI,IAAI,GAAG,UAAU,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;4BAC5C,WAAW,GAAG,IAAI,IAAA,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE,uBAAuB,EAAE,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,MAAM,CAAC,CAAC;4BACpF,WAAY,CAAC,UAAU,GAAG;gCAChD,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC;6BAC5B,CAAC;4BACF,IAAI,YAAY,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BAC9D,8DAA8D;4BAC9D,UAAU,CAAC,aAAa,GAAG,OAAO,GAAG,CAAC,SAAS,GAAG,YAAY,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;4BACvF,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;4BACpC,KAAK,CAAC;wBACP,KAAK,kBAAkB;4BACtB,WAAW,GAAG,IAAI,IAAA,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE,uBAAuB,EAAE,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,MAAM,CAAC,CAAC;4BACpF,WAAY,CAAC,UAAU,GAAG;gCAChD,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC;6BACjC,CAAC;4BACF,oDAAoD;4BACpD,UAAU,CAAC,aAAa,GAAG,aAAa,CAAC;4BACzC,KAAK,CAAC;wBACP;4BACC,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;oBAC9C,CAAC;oBAED,IAAI,IAAI,SAAA,CAAC;oBACT,IAAI,SAAS,GAAG,8CAAwE,CAAC;oBACzF,EAAE,CAAC,CAAC,UAAU,KAAK,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC;wBACzC,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,QAAQ,CACtB,IAAI,IAAA,GAAG,CAAC,cAAc,CAAC,SAAS,EAAE,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,UAAU,EAAE,GAAG,EAAE,CAAC,CAAC,EAC5F,IAAI,IAAA,GAAG,CAAC,QAAQ,CACf,IAAI,IAAA,GAAG,CAAC,cAAc,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE,SAAS,CAAC,QAAQ,CAAC,EACnE,IAAI,IAAA,GAAG,CAAC,UAAU,CAAC,MAAM,EAAE,cAAc,CAAC,EAC1C,IAAI,IAAA,GAAG,CAAC,mBAAmB,CAC1B,IAAI,IAAA,GAAG,CAAC,mBAAmB,EAAE,EAC7B,IAAI,IAAA,GAAG,CAAC,kBAAkB,CACzB,IAAI,IAAA,GAAG,CAAC,gBAAgB,CAAC,CAAC,IAAI,IAAA,GAAG,CAAC,eAAe,CAAC,IAAA,GAAG,CAAC,kCAAkC,CAAC,CAAC,CAAC,CAAC,EAC7F,IAAI,IAAA,GAAG,CAAC,cAAc,CACrB,IAAI,IAAA,GAAG,CAAC,oBAAoB,CAAC,CAAC,WAAW,CAAC,CAAC,EAC3C,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,kBAAkB,CAAC,CAAC,EAC/C,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,kBAAkB,CAAC,CAAC,EAC/C,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,0BAA0B,CAAC,CAAC,EACvD,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,kBAAkB,CAAC,CAAC,CAC/C,CACD,CACD,CACD,CAAC;oBACH,CAAC;oBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,UAAU,KAAK,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC;wBAChD,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,QAAQ,CACtB,IAAI,IAAA,GAAG,CAAC,cAAc,CAAC,SAAS,EAAE,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,MAAM,EAAE,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC,EAC/G,IAAI,IAAA,GAAG,CAAC,QAAQ,CACf,IAAI,IAAA,GAAG,CAAC,cAAc,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE,SAAS,CAAC,QAAQ,CAAC,EACnE,IAAI,IAAA,GAAG,CAAC,UAAU,CAAC,MAAM,EAAE,cAAc,CAAC,EAC1C,IAAI,IAAA,GAAG,CAAC,mBAAmB,CAC1B,IAAI,IAAA,GAAG,CAAC,mBAAmB,EAAE,EAC7B,IAAI,IAAA,GAAG,CAAC,kBAAkB,CACzB,IAAI,IAAA,GAAG,CAAC,gBAAgB,CAAC,CAAC,IAAI,IAAA,GAAG,CAAC,eAAe,CAAC,IAAA,GAAG,CAAC,kCAAkC,CAAC,CAAC,CAAC,CAAC,EAC7F,IAAI,IAAA,GAAG,CAAC,cAAc,CACrB,IAAI,IAAA,GAAG,CAAC,oBAAoB,CAAC,CAAC,WAAW,CAAC,CAAC,EAC3C,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,kBAAkB,CAAC,CAAC,EAC/C,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,kBAAkB,CAAC,CAAC,EAC/C,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,0BAA0B,CAAC,CAAC,EACvD,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,kBAAkB,CAAC,CAAC,CAC/C,CACD,CACD,CACD,CAAC;oBACH,CAAC;oBACD,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAClB,CAAC;gBAED,IAAI,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,eAAe,CAAC,IAAI,EAAE;oBACxC,IAAI,IAAA,GAAG,CAAC,eAAe,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;oBACtC,IAAI,IAAA,GAAG,CAAC,eAAe,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;iBACtC,EAAE,IAAI,CAAC,CAAC;gBACT,IAAI,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,eAAe,CAAC,MAAM,EAAE;oBAC1C,IAAI,IAAA,GAAG,CAAC,OAAO,CACd,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,oDAAoD,CAAC,CAAC,EAAE,uCAAuC;oBAC1H,CAAC,IAAI,IAAA,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,4EAA4E,CAAC,CAAC,CAAC,CAC3G;iBACD,CAAC,CAAC;gBACH,IAAI,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC,CAAC,sBAAsB,EAAE,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;gBAC/F,IAAI,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;gBACrD,IAAI,KAAK,GAAG,IAAI,IAAA,GAAG,CAAC,WAAW,CAAC,MAAM,EAAE,UAAU,EAAE,MAAM,CAAC,CAAC;gBAE5D,IAAI,SAAS,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAChC,IAAI,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;gBAEtC,IAAI,MAAM,GAAG,IAAI,UAAU,CAAC,SAAS,GAAG,QAAQ,CAAC,CAAC;gBAClD,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;gBACpB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;gBAEnB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,UAAC,EAAE,IAAK,OAAA,EAAE,CAAC,aAAa,EAAhB,CAAgB,CAAC,CAAC,CAAC;gBACjE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBACpB,IAAI,CAAC,OAAO,IAAI,MAAM,CAAC,MAAM,CAAC;gBAC9B,IAAI,CAAC,KAAK,GAAG,WAAW,CAAC,YAAY,CAAC;YACvC,CAAC;YAED,uBAAM,GAAN;gBACC,IAAI,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;gBAEvC,EAAE,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC;oBACxB,IAAI,CAAC,GAAG,aAAa,CAAC,MAAM,GAAG,CAAC,CAAC;oBACjC,IAAI,YAAY,GAAG,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC;oBAChD,+BAA+B;oBAC/B,OAAO,CAAC,GAAG,CAAC;wBACZ,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,OAAO,KAAK,YAAY,IAAI,aAAa,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,KAAK,cAAc,CAAC,GAAG,CAAC,EAAE,CAAC;wBACzG,CAAC,EAAE,CAAC;oBACL,CAAC;oBACD,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;wBACX,kEAAkE;wBAClE,aAAa,GAAG,aAAa,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC3C,CAAC;gBACF,CAAC;gBACD,EAAE,CAAC,CAAC,aAAa,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;oBAChC,MAAM,CAAC,CAAC,sBAAsB;gBAC/B,CAAC;gBAED,IAAI,SAAS,GAAiB,EAAE,CAAC;gBACjC,IAAI,YAAY,GAAW,CAAC,CAAC;gBAC7B,IAAI,KAAK,GAA2B,EAAE,CAAC;gBACvC,IAAI,cAAc,GAAa,EAAE,CAAC;wCAEzB,CAAC;oBACT,IAAI,UAAU,GAAG,OAAK,WAAW,CAAC,CAAC,CAAC,CAAC;oBACrC,IAAI,SAAS,GAAG,UAAU,CAAC,SAAS,CAAC;oBACrC,IAAI,OAAO,GAAG,UAAU,CAAC,OAAO,CAAC;oBAEjC,sCAAsC;oBACtC,IAAI,YAAY,GAAG,aAAa,CAAC,MAAM,CAAC,UAAC,EAAE,IAAK,OAAA,EAAE,CAAC,OAAO,KAAK,OAAO,EAAtB,CAAsB,CAAC,CAAC;oBACxE,EAAE,CAAC,CAAC,YAAY,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;;oBAEhC,CAAC;oBAED,sFAAsF;oBACtF,IAAI,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,mCAAmC,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;oBAClF,IAAI,IAAI,SAA4B,CAAC;oBACrC,IAAI,IAAI,SAAiB,CAAC;oBAC1B,IAAI,WAAW,SAAsB,CAAC;oBACtC,IAAI,SAAS,SAAQ,EAAE,SAAS,SAAQ,CAAC;oBAEzC,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;oBAClC,MAAM,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;wBAC3B,KAAK,kBAAkB,CAAC;wBACxB,KAAK,kBAAkB;4BACtB,WAAW,GAAG,EAAE,CAAC;4BACjB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gCAC9C,IAAI,WAAW,GAAgB,YAAY,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;gCACtD,IAAI,kBAAkB,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,GAAG,SAAS,CAAC,SAAS,GAAG,SAAS,CAAC,UAAU,CAAC,CAAC;gCACtG,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;gCACjC,YAAY,IAAI,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC;gCACxC,WAAW,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAE,kBAAkB,EAAE,IAAI,EAAE,WAAW,CAAC,IAAI,CAAC,MAAM,EAAC,CAAC,CAAC;gCAChF,UAAU,CAAC,gBAAgB,IAAI,WAAW,CAAC,OAAO,CAAC;4BACpD,CAAC;4BACD,SAAS,wCAAsD,CAAC;4BAChE,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,sBAAsB,CAAC,SAAS,EAAE,OAAO,EAAE,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,cAAc,EAAE,CAAC,CAAC,UAAU,6CAA8C,CAAC;4BACtK,SAAS,GAAG;iEAC8B,gCAAwC,CAAC;4BACnF,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,WAAW,CAAC,SAAS,EAAE,WAAW,EAAE,CAAC,CAAC,iBAAiB,EAAE,CAAC,CAAC,iBAAiB,CAAC,CAAC;4BAC7F,UAAU,CAAC,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,gBAAgB,GAAG,SAAS,CAAC,SAAS,GAAG,SAAS,CAAC,UAAU,CAAC,CAAC;4BACjH,KAAK,CAAC;wBACP,KAAK,kBAAkB,CAAC;wBACxB,KAAK,kBAAkB;4BACtB,WAAW,GAAG,EAAE,CAAC;4BACjB,IAAI,gBAAgB,GAAG,UAAU,CAAC,gBAAgB,CAAC;4BACnD,IAAI,UAAU,GAAG,gBAAgB,GAAG,SAAS,CAAC,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC;4BAC9E,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;4BACtC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gCAC9C,IAAI,WAAW,GAAgB,YAAY,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;gCACtD,gBAAgB,EAAE,CAAC;gCACnB,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAG,SAAS,CAAC,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC;gCACxF,IAAI,kBAAkB,GAAG,QAAQ,GAAG,QAAQ,CAAC;gCAC7C,QAAQ,GAAG,QAAQ,CAAC;gCACpB,IAAI,eAAe,GAAG,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAG,SAAS,CAAC,SAAS,GAAG,SAAS,CAAC,SAAS;oCAC5F,WAAW,CAAC,eAAe,GAAG,SAAS,CAAC,SAAS,GAAG,IAAI,CAAC,CAAC;gCAE3D,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;gCACjC,YAAY,IAAI,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC;gCACxC,IAAI,UAAU,GAAG,WAAW,CAAC,SAAS,KAAK,cAAc,CAAC,GAAG,CAAC,CAAC;+EAClB,CAAC;oCAC7C,CAAC,uEAA4E,CAAC,CAAC;gCAChF,WAAW,CAAC,IAAI,CAAC;oCAChB,QAAQ,EAAE,kBAAkB,EAAE,IAAI,EAAE,WAAW,CAAC,IAAI,CAAC,MAAM;oCAC3D,KAAK,EAAE,UAAU,EAAE,qBAAqB,EAAE,CAAC,eAAe,GAAG,QAAQ,CAAC;iCACtE,CAAC,CAAC;4BACJ,CAAC;4BACD,SAAS,wCAAsD,CAAC;4BAChE,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,sBAAsB,CAAC,SAAS,EAAE,OAAO,EAAE,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,cAAc,EAAE,CAAC,CAAC,UAAU,6CAA8C,CAAC;4BACtK,SAAS,GAAG;iEAC8B,gCAAwC;+DAC3C,4CAAmD,CAAC;4BAC3F,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,WAAW,CAAC,SAAS,EAAE,WAAW,EAAE,CAAC,CAAC,iBAAiB,EAAE,CAAC,CAAC,gBAAgB,CAAC,CAAC;4BAC5F,UAAU,CAAC,cAAc,GAAG,QAAQ,CAAC;4BACrC,UAAU,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;4BAC/C,KAAK,CAAC;wBACP;4BACC,MAAM,IAAI,KAAK,CAAC,UAAU,CAAC,CAAC;oBAC9B,CAAC;oBAED,IAAI,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,gBAAgB,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;oBACtD,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAClB,CAAC;;gBA9ED,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE;4BAAvC,CAAC;iBA8ET;gBACD,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,EAAE,aAAa,CAAC,MAAM,CAAC,CAAC;gBAEnD,IAAI,UAAU,GAAG,IAAI,IAAA,GAAG,CAAC,sBAAsB,CAAC,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;gBACnE,IAAI,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,gBAAgB,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;gBACvD,IAAI,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC9B,IAAI,IAAI,GAAG,IAAI,IAAA,GAAG,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;gBAC3C,IAAI,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBAErC,IAAI,UAAU,GAAG,QAAQ,GAAG,CAAC,CAAC,wBAAwB,CAAC;gBACvD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;oBACvC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,UAAU,GAAG,UAAU,GAAG,cAAc,CAAC,CAAC,CAAC,CAAC;gBAC1D,CAAC;gBAED,IAAI,KAAK,GAAG,IAAI,UAAU,CAAC,QAAQ,GAAG,QAAQ,CAAC,CAAC;gBAChD,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBAClB,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBAElB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBACnB,IAAI,CAAC,OAAO,IAAI,KAAK,CAAC,MAAM,CAAC;YAC9B,CAAC;YACF,aAAC;QAAD,CAAC,AAlYD,IAkYC;QAlYY,UAAM,SAkYlB,CAAA;QAED,0BAAiC,QAAa;YAC7C,IAAI,MAAM,GAAe,EAAE,CAAC;YAC5B,IAAI,YAAY,GAAG,CAAC,CAAC,CAAC;YACtB,IAAI,YAAY,GAAG,CAAC,CAAC,CAAC;YAEtB,IAAI,QAAQ,GAAG,CAAC,QAAQ,CAAC,mBAAmB,CAAC,UAAU,CAAC,CAAC;YAEzD,IAAI,UAAU,EAAE,YAAY,CAAC;YAC7B,IAAI,cAAc,GAAG,QAAQ,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC;YAClE,MAAM,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;gBACxB,KAAK,kBAAkB,CAAC;gBACxB,KAAK,KAAK;oBACT,UAAU,GAAG,KAAK,CAAC;oBACnB,YAAY,GAAG,kBAAkB,CAAC;oBAClC,KAAK,CAAC;gBACP,KAAK,kBAAkB,CAAC;gBACxB,KAAK,MAAM;oBACV,UAAU,GAAG,MAAM,CAAC;oBACpB,YAAY,GAAG,kBAAkB,CAAC;oBAClC,KAAK,CAAC;gBACP;oBACC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;wBAC5B,MAAM,IAAI,KAAK,CAAC,2BAA2B,GAAG,cAAc,CAAC,CAAC;oBAC/D,CAAC;oBACD,UAAU,GAAG,IAAI,CAAC;oBAClB,YAAY,GAAG,CAAC,CAAC,CAAC;oBAClB,KAAK,CAAC;YACR,CAAC;YAED,IAAI,UAAU,EAAE,YAAY,CAAC;YAC7B,IAAI,cAAc,GAAG,QAAQ,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC;YAClE,MAAM,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;gBACxB,KAAK,kBAAkB,CAAC;gBACxB,KAAK,MAAM;oBACV,UAAU,GAAG,MAAM,CAAC;oBACpB,YAAY,GAAG,kBAAkB,CAAC;oBAClC,KAAK,CAAC;gBACP,KAAK,kBAAkB,CAAC;gBACxB,KAAK,MAAM;oBACV,UAAU,GAAG,MAAM,CAAC;oBACpB,YAAY,GAAG,kBAAkB,CAAC;oBAClC,KAAK,CAAC;gBACP;oBACC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;wBAC5B,MAAM,IAAI,KAAK,CAAC,2BAA2B,GAAG,cAAc,CAAC,CAAC;oBAC/D,CAAC;oBACD,UAAU,GAAG,IAAI,CAAC;oBAClB,YAAY,GAAG,CAAC,CAAC,CAAC;oBAClB,KAAK,CAAC;YACR,CAAC;YAED,IAAI,UAAU,GAAa,CAAC,UAAU,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACzD,gBAAgB,EAAE,UAAU;gBAC5B,OAAO,EAAE,YAAY;gBACrB,QAAQ,EAAE,KAAK;gBACf,SAAS,EAAE,CAAC,QAAQ,CAAC,mBAAmB,CAAC,iBAAiB,CAAC,IAAI,KAAK;gBACpE,UAAU,EAAE,CAAC,QAAQ,CAAC,mBAAmB,CAAC,iBAAiB,CAAC,IAAI,KAAK;gBACrE,QAAQ,EAAE,CAAC,QAAQ,CAAC,mBAAmB,CAAC,eAAe,CAAC,IAAI,CAAC;gBAC7D,UAAU,EAAE,EAAE;aACd,CAAC;YACF,IAAI,UAAU,GAAa,CAAC,UAAU,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACzD,gBAAgB,EAAE,UAAU;gBAC5B,OAAO,EAAE,YAAY;gBACrB,QAAQ,EAAE,KAAK;gBACf,SAAS,EAAE,KAAK;gBAChB,SAAS,EAAE,CAAC,QAAQ,CAAC,mBAAmB,CAAC,gBAAgB,CAAC;oBAC1D,CAAC,QAAQ,CAAC,mBAAmB,CAAC,WAAW,CAAC;gBAC1C,KAAK,EAAE,CAAC,QAAQ,CAAC,mBAAmB,CAAC,OAAO,CAAC;gBAC7C,MAAM,EAAE,CAAC,QAAQ,CAAC,mBAAmB,CAAC,QAAQ,CAAC;aAC/C,CAAC;YAEF,IAAI,UAAU,GAAG,QAAQ,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC;YAC3D,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;gBAChB,gDAAgD;gBAChD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;oBAC5C,IAAI,IAAI,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;oBACzB,IAAI,iBAAiB,GAAG,IAAI,CAAC,mBAAmB,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,CAAC;oBACzE,EAAE,CAAC,CAAC,iBAAiB,CAAC,mBAAmB,CAAC,YAAY,CAAC,KAAK,cAAc,CAAC,CAAC,CAAC;wBAC5E,UAAU,CAAC,QAAQ,GAAG,IAAI,CAAC,mBAAmB,CAAC,UAAU,CAAC,CAAC;wBAC3D,UAAU,CAAC,SAAS,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC;oBAC/D,CAAC;oBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,iBAAiB,CAAC,mBAAmB,CAAC,YAAY,CAAC,KAAK,cAAc,CAAC,CAAC,CAAC;wBACnF,UAAU,CAAC,QAAQ,GAAG,IAAI,CAAC,mBAAmB,CAAC,UAAU,CAAC,CAAC;wBAC3D,UAAU,CAAC,SAAS,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC;oBAC/D,CAAC;gBACF,CAAC;YACF,CAAC;YAED,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;gBAChB,YAAY,GAAG,MAAM,CAAC,MAAM,CAAC;gBAC7B,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACzB,CAAC;YACD,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;gBAChB,YAAY,GAAG,MAAM,CAAC,MAAM,CAAC;gBAC7B,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACzB,CAAC;YAED,MAAM,CAAC;gBACN,MAAM,EAAE,MAAM;gBACd,QAAQ,EAAE,QAAQ;gBAClB,YAAY,EAAE,YAAY;gBAC1B,YAAY,EAAE,YAAY;aAC1B,CAAC;QACH,CAAC;QAtGe,oBAAgB,mBAsG/B,CAAA;IACF,CAAC,EAvpBa,GAAG,GAAH,UAAG,KAAH,UAAG,QAupBhB;AAAD,CAAC,EAvpBM,MAAM,KAAN,MAAM,QAupBZ;ACvqBD;;;;;;;;;;;;;;GAcG;AAEH,IAAO,MAAM,CAsKZ;AAtKD,WAAO,MAAM;IAAC,IAAA,GAAG,CAsKhB;IAtKa,WAAA,GAAG;QAchB;YAWC;gBAVQ,UAAK,GAAW,CAAC,CAAC;gBAWzB,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;gBACf,IAAI,CAAC,MAAM,GAAG,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC;gBACpC,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;gBACpB,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;gBACzB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gBACpB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACrB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;gBAClB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;YACrB,CAAC;YAEM,wBAAI,GAAX,UAAY,IAAgB;gBAC3B,IAAI,WAAW,CAAC;gBAChB,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC;oBACzB,IAAI,UAAU,GAAG,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC;oBAC/C,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,GAAG,UAAU,CAAC,CAAC,CAAC;wBACzC,IAAI,GAAG,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;wBAC1D,IAAI,CAAC,MAAM,GAAG,IAAI,WAAW,CAAC,UAAU,CAAC,CAAC;wBAC1C,WAAW,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBAC1C,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;oBACtB,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACP,WAAW,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,UAAU,CAAC,CAAC;oBAC1D,CAAC;oBACD,WAAW,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;gBACxC,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,WAAW,GAAG,IAAI,CAAC;gBACpB,CAAC;gBAED,IAAI,MAAM,GAAG,CAAC,EAAE,GAAG,GAAG,WAAW,CAAC,MAAM,CAAC;gBACzC,OAAO,MAAM,GAAG,GAAG,EAAE,CAAC;oBACrB,IAAI,WAAW,GAAG,CAAC,CAAC;oBACpB,IAAI,KAAK,SAAQ,CAAC;oBAClB,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;wBACpB,KAAK,CAAC;4BACL,EAAE,CAAC,CAAC,MAAM,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gCACtB,KAAK,CAAC;4BACP,CAAC;4BACD,IAAI,YAAY,GACf,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;gCACjE,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;4BAC1D,EAAE,CAAC,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC;gCACtB,IAAI,CAAC,MAAM,CAAC,uBAAuB,CAAC,CAAC;gCACrC,KAAK,CAAC;4BACP,CAAC;4BACD,EAAE,CAAC,CAAC,MAAM,GAAG,YAAY,GAAG,GAAG,CAAC,CAAC,CAAC;gCACjC,KAAK,CAAC;4BACP,CAAC;4BACD,EAAE,CAAC,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,IAAI,CAAC,OAAO;gCACvC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,IAAI,CAAC,OAAO;gCACxC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,IAAI,CAAC,OAAO;gCACxC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,eAAe;gCAC7C,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gCACzC,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC;gCAClC,KAAK,CAAC;4BACP,CAAC;4BACD,KAAK,GAAG,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;4BAChC,IAAI,KAAK,GAAG,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE,MAAM,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;4BAE9F,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC;gCAC9B,QAAQ,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC;gCACvB,QAAQ,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC;gCACvB,KAAK,EAAE,KAAK;6BACZ,CAAC,CAAC;4BACH,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;4BACf,WAAW,GAAG,YAAY,CAAC;4BAC3B,KAAK,CAAC;wBACP,KAAK,CAAC;4BACL,EAAE,CAAC,CAAC,MAAM,GAAG,CAAC,GAAG,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC;gCAC3B,KAAK,CAAC;4BACP,CAAC;4BACD,IAAI,eAAe,GAClB,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;gCACjE,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;4BAC1D,EAAE,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC;gCAC9C,IAAI,CAAC,MAAM,CAAC,yBAAyB,CAAC,CAAC;gCACvC,KAAK,CAAC;4BACP,CAAC;4BACD,IAAI,QAAQ,GAAG,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;gCAC7C,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;4BAC1D,IAAI,UAAU,GAAG,MAAM,GAAG,CAAC,GAAG,EAAE,CAAC;4BACjC,EAAE,CAAC,CAAC,UAAU,GAAG,QAAQ,GAAG,GAAG,CAAC,CAAC,CAAC;gCACjC,KAAK,CAAC;4BACP,CAAC;4BACD,KAAK,GAAG,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;4BAChC,IAAI,QAAQ,GAAG,CAAC,WAAW,CAAC,MAAM,GAAG,EAAE,CAAC,IAAI,EAAE,CAAC;gCAC9C,CAAC,WAAW,CAAC,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC,GAAG,WAAW,CAAC,MAAM,GAAG,EAAE,CAAC,CAAC;4BAC5D,EAAE,CAAC,CAAC,QAAQ,KAAK,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gCAC5C,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;gCAC/B,KAAK,CAAC;4BACP,CAAC;4BACD,IAAI,QAAQ,GAAG,KAAK,GAAG,IAAI,CAAC;4BAC5B,EAAE,CAAC,CAAC,QAAQ,KAAK,CAAC,IAAI,QAAQ,KAAK,CAAC,IAAI,QAAQ,KAAK,EAAE,CAAC,CAAC,CAAC;gCACzD,IAAI,CAAC,MAAM,CAAC,sBAAsB,CAAC,CAAC;gCACpC,KAAK,CAAC;4BACP,CAAC;4BACD,IAAI,iBAAiB,GAAG,CAAC,CAAC,CAAC,KAAK,GAAG,IAAI,CAAC,CAAC;4BACzC,IAAI,SAAS,GAAG,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;gCAC9C,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,WAAW,CAAC,MAAM,GAAG,EAAE,CAAC;gCACzD,CAAC,WAAW,CAAC,MAAM,GAAG,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,iBAAiB,CAAC;4BACpD,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC;gCACxB,IAAI,EAAE,QAAQ;gCACd,iBAAiB,EAAE,iBAAiB;gCACpC,SAAS,EAAE,SAAS;gCACpB,IAAI,EAAE,WAAW,CAAC,QAAQ,CAAC,UAAU,EAAE,UAAU,GAAG,QAAQ,CAAC;6BAC7D,CAAC,CAAC;4BACH,WAAW,IAAI,CAAC,GAAG,EAAE,GAAG,QAAQ,CAAC;4BACjC,IAAI,CAAC,eAAe,GAAG,QAAQ,GAAG,EAAE,CAAC;4BACrC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;4BACf,KAAK,CAAC;wBAEP;4BACC,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;oBACnC,CAAC;oBAED,EAAE,CAAC,CAAC,WAAW,KAAK,CAAC,CAAC,CAAC,CAAC;wBACvB,KAAK,CAAC,CAAC,kBAAkB;oBAC1B,CAAC;oBAED,MAAM,IAAI,WAAW,CAAC;gBACvB,CAAC;gBAED,EAAE,CAAC,CAAC,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC;oBACjC,IAAI,CAAC,UAAU,GAAG,WAAW,CAAC,MAAM,GAAG,MAAM,CAAC;oBAC9C,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;wBAC9C,IAAI,CAAC,MAAM,GAAG,IAAI,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;oBAChD,CAAC;oBACD,IAAI,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;gBAC/D,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;gBACrB,CAAC;YACF,CAAC;YAEO,0BAAM,GAAd,UAAe,OAAe;gBAC7B,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;gBAChB,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YACvC,CAAC;YAEM,yBAAK,GAAZ;gBACC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YAChC,CAAC;YACF,gBAAC;QAAD,CAAC,AAvJD,IAuJC;QAvJY,aAAS,YAuJrB,CAAA;IACF,CAAC,EAtKa,GAAG,GAAH,UAAG,KAAH,UAAG,QAsKhB;AAAD,CAAC,EAtKM,MAAM,KAAN,MAAM,QAsKZ;ACtLD,mCAAmC;AAEnC,+BAA+B;AAC/B,oCAAoC;AACpC,4CAA4C;AAE5C,iCAAiC;AACjC,iCAAiC;AACjC,oCAAoC","sourcesContent":["/*\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule RtmpJs.Browser {\n\texport class ShumwayComRtmpSocket {\n\t\tpublic static get isAvailable(): boolean {\n\t\t\treturn !!(typeof ShumwayCom !== 'undefined' && ShumwayCom.createRtmpSocket);\n\t\t}\n\n\t\tprivate _socket: RtmpSocket;\n\t\tprivate _onopen: () => void;\n\t\tprivate _ondata: (e: { data: ArrayBuffer }) => void;\n\t\tprivate _ondrain: () => void;\n\t\tprivate _onerror: (e: any) => void;\n\t\tprivate _onclose: () => void;\n\n\t\tpublic constructor(host: string, port: number, params: any) {\n\t\t\tthis._socket = ShumwayCom.createRtmpSocket({host: host, port: port, ssl: params.useSecureTransport});\n\t\t}\n\n\t\tget onopen(): () => void {\n\t\t\treturn this._onopen;\n\t\t}\n\n\t\tset onopen(callback: () => void) {\n\t\t\tthis._socket.setOpenCallback(this._onopen = callback);\n\t\t}\n\n\t\tget ondata(): (e: { data: ArrayBuffer }) => void {\n\t\t\treturn this._ondata;\n\t\t}\n\n\t\tset ondata(callback: (e: { data: ArrayBuffer }) => void) {\n\t\t\tthis._socket.setDataCallback(this._ondata = callback);\n\t\t}\n\n\t\tget ondrain(): () => void {\n\t\t\treturn this._ondrain;\n\t\t}\n\n\t\tset ondrain(callback: () => void) {\n\t\t\tthis._socket.setDrainCallback(this._ondrain = callback);\n\t\t}\n\n\t\tget onerror(): (e: any) => void {\n\t\t\treturn this._onerror;\n\t\t}\n\n\t\tset onerror(callback: (e: any) => void) {\n\t\t\tthis._socket.setErrorCallback(this._onerror = callback);\n\t\t}\n\n\t\tget onclose(): () => void {\n\t\t\treturn this._onclose;\n\t\t}\n\n\t\tset onclose(callback: () => void) {\n\t\t\tthis._socket.setCloseCallback(this._onclose = callback);\n\t\t}\n\n\t\tsend(buffer: ArrayBuffer, offset: number, count: number): boolean {\n\t\t\treturn this._socket.send(buffer, offset, count);\n\t\t}\n\n\t\tclose(): void {\n\t\t\tthis._socket.close();\n\t\t}\n\t}\n\n\texport class ShumwayComRtmpXHR {\n\t\tpublic static get isAvailable(): boolean {\n\t\t\treturn !!(typeof ShumwayCom !== 'undefined' && ShumwayCom.createRtmpXHR);\n\t\t}\n\n\t\tprivate _xhr: RtmpXHR;\n\t\tprivate _onload: () => void;\n\t\tprivate _onerror: () => void;\n\n\t\tget status(): number {\n\t\t\treturn this._xhr.status;\n\t\t}\n\n\t\tget response(): any {\n\t\t\treturn this._xhr.response;\n\t\t}\n\n\t\tget responseType(): string {\n\t\t\treturn this._xhr.responseType;\n\t\t}\n\n\t\tset responseType(type: string) {\n\t\t\tthis._xhr.responseType = type;\n\t\t}\n\n\t\tget onload(): () => void {\n\t\t\treturn this._onload;\n\t\t}\n\n\t\tset onload(callback: () => void) {\n\t\t\tthis._xhr.setLoadCallback(this._onload = callback);\n\t\t}\n\n\t\tget onerror(): () => void {\n\t\t\treturn this._onload;\n\t\t}\n\n\t\tset onerror(callback: () => void) {\n\t\t\tthis._xhr.setErrorCallback(this._onerror = callback);\n\t\t}\n\n\t\tpublic constructor() {\n\t\t\tthis._xhr = ShumwayCom.createRtmpXHR();\n\t\t}\n\n\t\topen(method: string, path: string, async: boolean = true): void {\n\t\t\tthis._xhr.open(method, path, async);\n\t\t}\n\n\t\tsetRequestHeader(header: string, value: string): void {\n\t\t\tthis._xhr.setRequestHeader(header, value);\n\t\t}\n\n\t\tsend(data?: any): void {\n\t\t\tthis._xhr.send(data);\n\t\t}\n\t}\n}\n","/*\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule RtmpJs {\n\tlet MAX_CHUNKED_CHANNEL_BUFFER = 0x80000;\n\tlet RANDOM_DATA_SIZE = 1536;\n\tlet PROTOCOL_VERSION = 3;\n\n\tlet SET_CHUNK_SIZE_CONTROL_MESSAGE_ID = 1;\n\tlet ABORT_MESSAGE_CONTROL_MESSAGE_ID = 2;\n\tlet ACK_MESSAGE_ID = 3;\n\tlet USER_CONTROL_MESSAGE_ID = 4;\n\tlet ACK_WINDOW_SIZE_MESSAGE_ID = 5;\n\tlet SET_PEER_BANDWIDTH_MESSAGE_ID = 6;\n\n\tlet CONTROL_CHUNK_STREAM_ID = 2;\n\tlet MIN_CHUNK_STREAM_ID = 3;\n\tlet MAX_CHUNK_STREAM_ID = 65599;\n\tlet MAX_CHUNK_HEADER_SIZE = 18;\n\n\texport interface IChunkedStreamMessage {\n\t\ttimestamp: number;\n\t\tstreamId: number;\n\t\tchunkedStreamId: number;\n\t\ttypeId: number;\n\t\tdata: Uint8Array;\n\t\tfirstChunk: boolean;\n\t\tlastChunk: boolean;\n\t}\n\n\texport class ChunkedStream {\n\t\tprivate id: number;\n\t\tprivate buffer: Uint8Array;\n\t\tprivate bufferLength: number;\n\n\t\tlastStreamId: number;\n\t\tlastTimestamp: number;\n\t\tlastLength: number;\n\t\tlastTypeId: number;\n\t\tlastMessageComplete: boolean;\n\t\twaitingForBytes: number;\n\n\t\tsentStreamId: number;\n\t\tsentTimestamp: number;\n\t\tsentLength: number;\n\t\tsentTypeId: number;\n\n\t\tpublic onmessage: (message: IChunkedStreamMessage) => void = null;\n\n\t\tpublic constructor(id: number) {\n\t\t\tthis.id = id;\n\t\t\tthis.buffer = null;\n\t\t\tthis.bufferLength = 0;\n\n\t\t\tthis.lastStreamId = -1;\n\t\t\tthis.lastTimestamp = 0;\n\t\t\tthis.lastLength = 0;\n\t\t\tthis.lastTypeId = 0;\n\t\t\tthis.lastMessageComplete = false;\n\t\t\tthis.waitingForBytes = 0;\n\n\t\t\tthis.sentStreamId = -1;\n\t\t\tthis.sentTimestamp = 0;\n\t\t\tthis.sentLength = 0;\n\t\t\tthis.sentTypeId = 0;\n\t\t}\n\n\t\tsetBuffer(enabled: boolean) {\n\t\t\tif (enabled && !this.buffer) {\n\t\t\t\tthis.buffer = new Uint8Array(128);\n\t\t\t\tthis.bufferLength = 0;\n\t\t\t}\n\t\t\tif (!enabled && this.buffer) {\n\t\t\t\tthis.buffer = null;\n\t\t\t\tthis.bufferLength = 0;\n\t\t\t}\n\t\t}\n\n\t\tabort() {\n\t\t\tif (this.buffer) {\n\t\t\t\tthis.bufferLength = 0;\n\t\t\t} else if (!this.lastMessageComplete) {\n\t\t\t\tthis.lastMessageComplete = true;\n\t\t\t\tthis.onmessage({\n\t\t\t\t\ttimestamp: this.lastTimestamp,\n\t\t\t\t\tstreamId: this.lastStreamId,\n\t\t\t\t\tchunkedStreamId: this.id,\n\t\t\t\t\ttypeId: this.lastTypeId,\n\t\t\t\t\tdata: null,\n\t\t\t\t\tfirstChunk: false,\n\t\t\t\t\tlastChunk: true\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t_push(data: Uint8Array, firstChunk: boolean, lastChunk: boolean) {\n\t\t\tif (!this.onmessage) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ((firstChunk && lastChunk) || !this.buffer) {\n\t\t\t\tthis.onmessage({\n\t\t\t\t\ttimestamp: this.lastTimestamp,\n\t\t\t\t\tstreamId: this.lastStreamId,\n\t\t\t\t\tchunkedStreamId: this.id,\n\t\t\t\t\ttypeId: this.lastTypeId,\n\t\t\t\t\tdata: data,\n\t\t\t\t\tfirstChunk: firstChunk,\n\t\t\t\t\tlastChunk: lastChunk\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (firstChunk) {\n\t\t\t\tthis.bufferLength = 0;\n\t\t\t\tif (this.lastLength > this.buffer.length) {\n\t\t\t\t\tthis.buffer = new Uint8Array(this.lastLength);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.buffer.set(data, this.bufferLength);\n\t\t\tthis.bufferLength += data.length;\n\t\t\tif (lastChunk) {\n\t\t\t\tthis.onmessage({\n\t\t\t\t\ttimestamp: this.lastTimestamp,\n\t\t\t\t\tstreamId: this.lastStreamId,\n\t\t\t\t\tchunkedStreamId: this.id,\n\t\t\t\t\ttypeId: this.lastTypeId,\n\t\t\t\t\tdata: this.buffer.subarray(0, this.bufferLength),\n\t\t\t\t\tfirstChunk: true,\n\t\t\t\t\tlastChunk: true\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\texport interface IChunkedChannelUserControlMessage {\n\t\ttype: number;\n\t\tdata: Uint8Array;\n\t}\n\n\texport interface ISendMessage {\n\t\tstreamId: number;\n\t\ttypeId: number;\n\t\tdata: Uint8Array;\n\t\ttimestamp?: number;\n\t}\n\n\texport class ChunkedChannel {\n\t\tprivate state: string;\n\t\tprivate buffer: Uint8Array;\n\t\tprivate bufferLength: number;\n\t\tprivate chunkSize: number;\n\t\tprivate chunkStreams: ChunkedStream[];\n\t\tprivate peerChunkSize: number;\n\t\tprivate peerAckWindowSize: number;\n\t\tprivate bandwidthLimitType: number;\n\t\tprivate windowAckSize: number;\n\t\tprivate bytesReceived: number;\n\t\tprivate lastAckSent: number;\n\n\t\tprivate serverVersion: number;\n\t\tprivate epochStart: number;\n\t\tprivate randomData: Uint8Array;\n\n\t\tpublic onusercontrolmessage: (message: IChunkedChannelUserControlMessage) => void = null;\n\t\tpublic onack: () => void = null;\n\t\tpublic ondata: (data: Uint8Array) => void = function (data) { /* do nothing */\n\t\t};\n\t\tpublic onclose: () => void = function () { /* do nothing */\n\t\t};\n\t\tpublic oncreated: () => void = null;\n\t\tpublic onmessage: (message: IChunkedStreamMessage) => void;\n\n\t\tpublic constructor() {\n\t\t\tthis.state = 'uninitialized';\n\t\t\tthis.buffer = new Uint8Array(4092);\n\t\t\tthis.bufferLength = 0;\n\t\t\tthis.chunkSize = 128;\n\t\t\tthis.chunkStreams = [];\n\t\t\tthis.peerChunkSize = 128;\n\t\t\tthis.peerAckWindowSize = 0;\n\t\t\tthis.bandwidthLimitType = 0;\n\t\t\tthis.windowAckSize = 0;\n\t\t\tthis.bytesReceived = 0;\n\t\t\tthis.lastAckSent = 0;\n\t\t}\n\n\t\tpublic push(data: Uint8Array) {\n\t\t\tlet newDataLength = data.length + this.bufferLength;\n\t\t\tif (newDataLength > this.buffer.length) {\n\t\t\t\tlet newBufferLength = this.buffer.length * 2;\n\t\t\t\twhile (newDataLength > newBufferLength) {\n\t\t\t\t\tnewBufferLength *= 2;\n\t\t\t\t}\n\t\t\t\tif (newBufferLength > MAX_CHUNKED_CHANNEL_BUFFER) {\n\t\t\t\t\tthis._fail('Buffer overflow');\n\t\t\t\t}\n\t\t\t\tlet newBuffer = new Uint8Array(newBufferLength);\n\t\t\t\tnewBuffer.set(this.buffer);\n\t\t\t\tthis.buffer = newBuffer;\n\t\t\t}\n\n\t\t\tfor (let i = 0, j = this.bufferLength; i < data.length; i++, j++) {\n\t\t\t\tthis.buffer[j] = data[i];\n\t\t\t}\n\t\t\tthis.bufferLength = newDataLength;\n\n\t\t\tthis.bytesReceived += data.length;\n\t\t\tif (this.peerAckWindowSize &&\n\t\t\t\t(this.bytesReceived - this.lastAckSent) >= this.peerAckWindowSize) {\n\t\t\t\tthis._sendAck();\n\t\t\t}\n\n\t\t\twhile (this.bufferLength > 0) {\n\t\t\t\t// release || console.log('current bufferLength: ' + this.bufferLength + ' state:' + this.state);\n\t\t\t\tlet shiftBy = 0;\n\t\t\t\tswitch (this.state) {\n\t\t\t\t\tcase 'uninitialized':\n\t\t\t\t\t\tif (this.bufferLength < 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.serverVersion = this.buffer[0];\n\t\t\t\t\t\tshiftBy = 1;\n\t\t\t\t\t\tif (this.serverVersion !== PROTOCOL_VERSION) {\n\t\t\t\t\t\t\tthis._fail('Unsupported protocol version: ' + this.serverVersion);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.state = 'version_received';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'version_received':\n\t\t\t\t\t\tif (this.bufferLength < RANDOM_DATA_SIZE) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tshiftBy = RANDOM_DATA_SIZE;\n\n\t\t\t\t\t\tlet timestamp = (Date.now() - this.epochStart) | 0;\n\t\t\t\t\t\tthis.buffer[4] = (timestamp >>> 24) & 0xFF;\n\t\t\t\t\t\tthis.buffer[5] = (timestamp >>> 16) & 0xFF;\n\t\t\t\t\t\tthis.buffer[6] = (timestamp >>> 8) & 0xFF;\n\t\t\t\t\t\tthis.buffer[7] = timestamp & 0xFF;\n\t\t\t\t\t\tthis.ondata(this.buffer.subarray(0, RANDOM_DATA_SIZE));\n\t\t\t\t\t\tthis.state = 'ack_sent';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'ack_sent':\n\t\t\t\t\t\tif (this.bufferLength < RANDOM_DATA_SIZE) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tshiftBy = RANDOM_DATA_SIZE;\n\n\t\t\t\t\t\tfor (let i = 8; i < RANDOM_DATA_SIZE; i++) {\n\t\t\t\t\t\t\tif (this.buffer[i] !== this.randomData[i]) {\n\t\t\t\t\t\t\t\tthis._fail('Random data do not match @' + i);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.state = 'handshake_done';\n\t\t\t\t\t\tthis.lastAckSent = this.bytesReceived;\n\t\t\t\t\t\tthis._initialize();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'handshake_done':\n\t\t\t\t\t\tshiftBy = this._parseChunkedData();\n\t\t\t\t\t\tif (!shiftBy) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.buffer.set(this.buffer.subarray(shiftBy, this.bufferLength), 0);\n\t\t\t\tthis.bufferLength -= shiftBy;\n\t\t\t}\n\t\t}\n\n\t\tprivate _initialize() {\n\t\t\tlet controlStream = this._getChunkStream(CONTROL_CHUNK_STREAM_ID);\n\t\t\tcontrolStream.setBuffer(true);\n\t\t\tcontrolStream.onmessage = function (e: any) {\n\t\t\t\tif (e.streamId !== 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\trelease || console.log('Control message: ' + e.typeId);\n\t\t\t\tlet ackWindowSize: number;\n\t\t\t\tswitch (e.typeId) {\n\t\t\t\t\tcase SET_CHUNK_SIZE_CONTROL_MESSAGE_ID:\n\t\t\t\t\t\tlet newChunkSize = (e.data[0] << 24) | (e.data[1] << 16) |\n\t\t\t\t\t\t\t(e.data[2] << 8) | e.data[3];\n\t\t\t\t\t\tif (newChunkSize >= 1 && newChunkSize <= 0x7FFFFFFF) {\n\t\t\t\t\t\t\tthis.peerChunkSize = newChunkSize;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ABORT_MESSAGE_CONTROL_MESSAGE_ID:\n\t\t\t\t\t\tlet chunkStreamId = (e.data[0] << 24) | (e.data[1] << 16) |\n\t\t\t\t\t\t\t(e.data[2] << 8) | e.data[3];\n\t\t\t\t\t\tif (MIN_CHUNK_STREAM_ID <= chunkStreamId &&\n\t\t\t\t\t\t\tchunkStreamId <= MAX_CHUNK_STREAM_ID) {\n\t\t\t\t\t\t\tlet chunkStream = this._getChunkStream(chunkStreamId);\n\t\t\t\t\t\t\tchunkStream.abort();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ACK_MESSAGE_ID:\n\t\t\t\t\t\tif (this.onack) {\n\t\t\t\t\t\t\tthis.onack();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase USER_CONTROL_MESSAGE_ID:\n\t\t\t\t\t\tif (this.onusercontrolmessage) {\n\t\t\t\t\t\t\tthis.onusercontrolmessage({\n\t\t\t\t\t\t\t\ttype: (e.data[0] << 8) | e.data[1],\n\t\t\t\t\t\t\t\tdata: e.data.subarray(2)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ACK_WINDOW_SIZE_MESSAGE_ID:\n\t\t\t\t\t\tackWindowSize = (e.data[0] << 24) | (e.data[1] << 16) |\n\t\t\t\t\t\t\t(e.data[2] << 8) | e.data[3];\n\t\t\t\t\t\tif (ackWindowSize < 0) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.peerAckWindowSize = ackWindowSize;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase SET_PEER_BANDWIDTH_MESSAGE_ID:\n\t\t\t\t\t\tackWindowSize = (e.data[0] << 24) | (e.data[1] << 16) |\n\t\t\t\t\t\t\t(e.data[2] << 8) | e.data[3];\n\t\t\t\t\t\tlet limitType = e.data[4];\n\t\t\t\t\t\tif (ackWindowSize < 0 || limitType > 2) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (limitType === 1 ||\n\t\t\t\t\t\t\t(limitType === 2 && this.bandwidthLimitType === 1)) {\n\t\t\t\t\t\t\tackWindowSize = Math.min(this.windowAckSize, ackWindowSize);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (ackWindowSize !== this.ackWindowSize) {\n\t\t\t\t\t\t\tthis.ackWindowSize = ackWindowSize;\n\t\t\t\t\t\t\tlet ackData = new Uint8Array([(ackWindowSize >>> 24) & 0xFF,\n\t\t\t\t\t\t\t\t(ackWindowSize >>> 16) & 0xFF,\n\t\t\t\t\t\t\t\t(ackWindowSize >>> 8) & 0xFF,\n\t\t\t\t\t\t\t\tackWindowSize & 0xFF]);\n\t\t\t\t\t\t\tthis._sendMessage(CONTROL_CHUNK_STREAM_ID, {\n\t\t\t\t\t\t\t\ttypeId: ACK_WINDOW_SIZE_MESSAGE_ID,\n\t\t\t\t\t\t\t\tstreamId: 0,\n\t\t\t\t\t\t\t\tdata: ackData\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (limitType !== 2) {\n\t\t\t\t\t\t\t\tthis.bandwidthLimitType = limitType;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}.bind(this);\n\n\t\t\tif (this.oncreated) {\n\t\t\t\tthis.oncreated();\n\t\t\t}\n\t\t}\n\n\t\tpublic setChunkSize(chunkSize: number) {\n\t\t\tif (chunkSize < 1 || chunkSize > 0x7FFFFFFF) {\n\t\t\t\tthrow new Error('Invalid chunk size');\n\t\t\t}\n\t\t\tthis._sendMessage(CONTROL_CHUNK_STREAM_ID, {\n\t\t\t\tstreamId: 0,\n\t\t\t\ttypeId: SET_CHUNK_SIZE_CONTROL_MESSAGE_ID,\n\t\t\t\tdata: new Uint8Array([(chunkSize >>> 24) & 0xFF,\n\t\t\t\t\t(chunkSize >>> 16) & 0xFF,\n\t\t\t\t\t(chunkSize >>> 8) & 0xFF,\n\t\t\t\t\tchunkSize & 0xFF])\n\t\t\t});\n\t\t\tthis.chunkSize = chunkSize;\n\t\t}\n\n\t\tpublic send(chunkStreamId: number, message: ISendMessage) {\n\t\t\tif (chunkStreamId < MIN_CHUNK_STREAM_ID ||\n\t\t\t\tchunkStreamId > MAX_CHUNK_STREAM_ID) {\n\t\t\t\tthrow new Error('Invalid chunkStreamId');\n\t\t\t}\n\t\t\treturn this._sendMessage(chunkStreamId, message);\n\t\t}\n\n\t\tpublic sendUserControlMessage(type: number, data: Uint8Array) {\n\t\t\tlet eventData = new Uint8Array(2 + data.length);\n\t\t\teventData[0] = (type >> 8) & 0xFF;\n\t\t\teventData[1] = type & 0xFF;\n\t\t\teventData.set(data, 2);\n\n\t\t\tthis._sendMessage(CONTROL_CHUNK_STREAM_ID, {\n\t\t\t\ttypeId: USER_CONTROL_MESSAGE_ID,\n\t\t\t\tstreamId: 0,\n\t\t\t\tdata: eventData\n\t\t\t});\n\t\t}\n\n\t\tprivate _sendAck() {\n\t\t\tlet ackData = new Uint8Array([(this.bytesReceived >>> 24) & 0xFF,\n\t\t\t\t(this.bytesReceived >>> 16) & 0xFF,\n\t\t\t\t(this.bytesReceived >>> 8) & 0xFF,\n\t\t\t\tthis.bytesReceived & 0xFF]);\n\t\t\tthis._sendMessage(CONTROL_CHUNK_STREAM_ID, {\n\t\t\t\ttypeId: ACK_MESSAGE_ID,\n\t\t\t\tstreamId: 0,\n\t\t\t\tdata: ackData\n\t\t\t});\n\t\t}\n\n\t\tprivate _sendMessage(chunkStreamId: number, message: ISendMessage) {\n\t\t\tlet data = message.data;\n\t\t\tlet messageLength = data.length;\n\t\t\tlet chunkStream = this._getChunkStream(chunkStreamId);\n\n\t\t\tlet timestamp = ('timestamp' in message ? message.timestamp : (Date.now() - this.epochStart)) | 0;\n\t\t\tlet timestampDelta = (timestamp - chunkStream.sentTimestamp) | 0;\n\n\t\t\tlet buffer = new Uint8Array(this.chunkSize + MAX_CHUNK_HEADER_SIZE);\n\t\t\tlet chunkStreamIdSize;\n\t\t\tif (chunkStreamId < 64) {\n\t\t\t\tchunkStreamIdSize = 1;\n\t\t\t\tbuffer[0] = chunkStreamId;\n\t\t\t} else if (chunkStreamId < 320) {\n\t\t\t\tchunkStreamIdSize = 2;\n\t\t\t\tbuffer[0] = 0;\n\t\t\t\tbuffer[1] = chunkStreamId - 64;\n\t\t\t} else {\n\t\t\t\tchunkStreamIdSize = 3;\n\t\t\t\tbuffer[0] = 1;\n\t\t\t\tbuffer[1] = ((chunkStreamId - 64) >> 8) & 0xFF;\n\t\t\t\tbuffer[2] = (chunkStreamId - 64) & 0xFF;\n\t\t\t}\n\n\t\t\tlet position = chunkStreamIdSize;\n\t\t\tlet extendTimestamp = 0;\n\t\t\tif (message.streamId !== chunkStream.sentStreamId || timestampDelta < 0) {\n\t\t\t\t// chunk type 0\n\t\t\t\tif ((timestamp & 0xFF000000) !== 0) {\n\t\t\t\t\textendTimestamp = timestamp;\n\t\t\t\t\tbuffer[position] = buffer[position + 1] = buffer[position + 2] = 0xFF;\n\t\t\t\t} else {\n\t\t\t\t\tbuffer[position] = (timestamp >> 16) & 0xFF;\n\t\t\t\t\tbuffer[position + 1] = (timestamp >> 8) & 0xFF;\n\t\t\t\t\tbuffer[position + 2] = timestamp & 0xFF;\n\t\t\t\t}\n\t\t\t\tposition += 3;\n\t\t\t\tbuffer[position++] = (messageLength >> 16) & 0xFF;\n\t\t\t\tbuffer[position++] = (messageLength >> 8) & 0xFF;\n\t\t\t\tbuffer[position++] = messageLength & 0xFF;\n\t\t\t\tbuffer[position++] = message.typeId;\n\t\t\t\tbuffer[position++] = message.streamId & 0xFF; // little-endian\n\t\t\t\tbuffer[position++] = (message.streamId >> 8) & 0xFF;\n\t\t\t\tbuffer[position++] = (message.streamId >> 16) & 0xFF;\n\t\t\t\tbuffer[position++] = (message.streamId >> 24) & 0xFF;\n\t\t\t} else if (messageLength !== chunkStream.sentLength ||\n\t\t\t\tmessage.typeId !== chunkStream.sentTypeId) {\n\t\t\t\t// chunk type 1\n\t\t\t\tbuffer[0] |= 0x40;\n\t\t\t\tif ((timestampDelta & 0xFF000000) !== 0) {\n\t\t\t\t\textendTimestamp = timestampDelta;\n\t\t\t\t\tbuffer[position] = buffer[position + 1] = buffer[position + 2] = 0xFF;\n\t\t\t\t} else {\n\t\t\t\t\tbuffer[position] = (timestampDelta >> 16) & 0xFF;\n\t\t\t\t\tbuffer[position + 1] = (timestampDelta >> 8) & 0xFF;\n\t\t\t\t\tbuffer[position + 2] = timestampDelta & 0xFF;\n\t\t\t\t}\n\t\t\t\tposition += 3;\n\t\t\t\tbuffer[position++] = (messageLength >> 16) & 0xFF;\n\t\t\t\tbuffer[position++] = (messageLength >> 8) & 0xFF;\n\t\t\t\tbuffer[position++] = messageLength & 0xFF;\n\t\t\t\tbuffer[position++] = message.typeId;\n\t\t\t} else if (timestampDelta !== 0) {\n\t\t\t\t// chunk type 2\n\t\t\t\tbuffer[0] |= 0x80;\n\t\t\t\tif ((timestampDelta & 0xFF000000) !== 0) {\n\t\t\t\t\textendTimestamp = timestampDelta;\n\t\t\t\t\tbuffer[position] = buffer[position + 1] = buffer[position + 2] = 0xFF;\n\t\t\t\t} else {\n\t\t\t\t\tbuffer[position] = (timestampDelta >> 16) & 0xFF;\n\t\t\t\t\tbuffer[position + 1] = (timestampDelta >> 8) & 0xFF;\n\t\t\t\t\tbuffer[position + 2] = timestampDelta & 0xFF;\n\t\t\t\t}\n\t\t\t\tposition += 3;\n\t\t\t} else {\n\t\t\t\t// chunk type 3\n\t\t\t\tbuffer[0] |= 0xC0;\n\t\t\t}\n\t\t\tif (extendTimestamp) {\n\t\t\t\tbuffer[position++] = (extendTimestamp >>> 24) & 0xFF;\n\t\t\t\tbuffer[position++] = (extendTimestamp >>> 16) & 0xFF;\n\t\t\t\tbuffer[position++] = (extendTimestamp >>> 8) & 0xFF;\n\t\t\t\tbuffer[position++] = extendTimestamp & 0xFF;\n\t\t\t}\n\n\t\t\tchunkStream.sentTimestamp = timestamp;\n\t\t\tchunkStream.sentStreamId = message.streamId;\n\t\t\tchunkStream.sentTypeId = message.typeId;\n\t\t\tchunkStream.sentLength = messageLength;\n\n\t\t\tlet sent = 0;\n\t\t\twhile (sent < messageLength) {\n\t\t\t\tlet currentChunkLength = Math.min(messageLength - sent, this.chunkSize);\n\t\t\t\tbuffer.set(data.subarray(sent, sent + currentChunkLength), position);\n\t\t\t\tsent += currentChunkLength;\n\n\t\t\t\tthis.ondata(buffer.subarray(0, position + currentChunkLength));\n\n\t\t\t\t// reset position and chunk type\n\t\t\t\tbuffer[0] |= 0xC0;\n\t\t\t\tposition = chunkStreamIdSize;\n\t\t\t}\n\n\t\t\treturn timestamp;\n\t\t}\n\n\t\tprivate _getChunkStream(id: number) {\n\t\t\tlet chunkStream = this.chunkStreams[id];\n\t\t\tif (!chunkStream) {\n\t\t\t\tthis.chunkStreams[id] = chunkStream = new ChunkedStream(id);\n\t\t\t\tchunkStream.setBuffer(true);\n\t\t\t\tchunkStream.onmessage = function (message: any) {\n\t\t\t\t\tif (this.onmessage) {\n\t\t\t\t\t\tthis.onmessage(message);\n\t\t\t\t\t}\n\t\t\t\t}.bind(this);\n\t\t\t}\n\t\t\treturn chunkStream;\n\t\t}\n\n\t\tprivate _parseChunkedData() {\n\t\t\tif (this.bufferLength < 1) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tlet chunkType = (this.buffer[0] >> 6) & 3;\n\t\t\tlet chunkHeaderPosition = 1;\n\t\t\tlet chunkStreamId = this.buffer[0] & 0x3F;\n\t\t\tif (chunkStreamId === 0) {\n\t\t\t\tif (this.bufferLength < 2) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\tchunkStreamId = this.buffer[1] + 64;\n\t\t\t\tchunkHeaderPosition = 2;\n\t\t\t} else if (chunkStreamId === 1) {\n\t\t\t\tif (this.bufferLength < 2) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\tchunkStreamId = (this.buffer[1] << 8) + this.buffer[2] + 64;\n\t\t\t\tchunkHeaderPosition = 3;\n\t\t\t}\n\t\t\tlet chunkHeaderSize = chunkType === 0 ? 11 : chunkType === 1 ? 7 :\n\t\t\t\tchunkType === 2 ? 3 : 0;\n\t\t\tif (this.bufferLength < chunkHeaderPosition + chunkHeaderSize) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tlet extendTimestampSize = chunkType !== 3 &&\n\t\t\tthis.buffer[chunkHeaderPosition] === 0xFF &&\n\t\t\tthis.buffer[chunkHeaderPosition + 1] === 0xFF &&\n\t\t\tthis.buffer[chunkHeaderPosition + 2] === 0xFF ? 4 : 0;\n\t\t\tlet totalChunkHeaderSize = chunkHeaderPosition + chunkHeaderSize +\n\t\t\t\textendTimestampSize;\n\t\t\tif (this.bufferLength < totalChunkHeaderSize) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tlet chunkStream = this._getChunkStream(chunkStreamId);\n\n\t\t\tlet chunkTimestamp: number;\n\t\t\tif (chunkType === 3) {\n\t\t\t\tchunkTimestamp = chunkStream.lastTimestamp;\n\t\t\t} else {\n\t\t\t\tchunkTimestamp = (this.buffer[chunkHeaderPosition] << 16) |\n\t\t\t\t\t(this.buffer[chunkHeaderPosition + 1] << 8) |\n\t\t\t\t\tthis.buffer[chunkHeaderPosition + 2];\n\t\t\t}\n\t\t\tif (extendTimestampSize) {\n\t\t\t\tlet chunkTimestampPosition = chunkHeaderPosition + chunkHeaderSize;\n\t\t\t\tchunkTimestamp = (this.buffer[chunkTimestampPosition] << 24) |\n\t\t\t\t\t(this.buffer[chunkTimestampPosition + 1] << 16) |\n\t\t\t\t\t(this.buffer[chunkTimestampPosition + 2] << 8) |\n\t\t\t\t\tthis.buffer[chunkTimestampPosition + 3];\n\t\t\t}\n\t\t\tif (chunkType === 1 || chunkType === 2) {\n\t\t\t\tchunkTimestamp = (chunkStream.lastTimestamp + chunkTimestamp) | 0;\n\t\t\t}\n\t\t\tlet messageLength: number = chunkStream.lastLength;\n\t\t\tlet messageTypeId = chunkStream.lastTypeId;\n\t\t\tlet messageStreamId = chunkStream.lastStreamId;\n\t\t\tif (chunkType === 0 || chunkType === 1) {\n\t\t\t\tmessageLength = (this.buffer[chunkHeaderPosition + 3] << 16) |\n\t\t\t\t\t(this.buffer[chunkHeaderPosition + 4] << 8) |\n\t\t\t\t\tthis.buffer[chunkHeaderPosition + 5];\n\t\t\t\tmessageTypeId = this.buffer[chunkHeaderPosition + 6];\n\t\t\t}\n\t\t\tif (chunkType === 0) {\n\t\t\t\t// little-endian\n\t\t\t\tmessageStreamId = (this.buffer[chunkHeaderPosition + 10] << 24) |\n\t\t\t\t\t(this.buffer[chunkHeaderPosition + 9] << 16) |\n\t\t\t\t\t(this.buffer[chunkHeaderPosition + 8] << 8) |\n\t\t\t\t\tthis.buffer[chunkHeaderPosition + 7];\n\t\t\t}\n\n\t\t\tlet read, tailLength, firstChunk;\n\t\t\tif (chunkType === 3 && chunkStream.waitingForBytes) {\n\t\t\t\tfirstChunk = false;\n\t\t\t\tread = Math.min(chunkStream.waitingForBytes, this.peerChunkSize);\n\t\t\t\ttailLength = chunkStream.waitingForBytes - read;\n\t\t\t} else {\n\t\t\t\tfirstChunk = true;\n\t\t\t\tread = Math.min(messageLength, this.peerChunkSize);\n\t\t\t\ttailLength = messageLength - read;\n\t\t\t}\n\t\t\tif (this.bufferLength < totalChunkHeaderSize + read) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\trelease || (!firstChunk && tailLength) || // limiting trace to first/last chunks\n\t\t\tconsole.log('Chunk received: cs:' + chunkStreamId + '; ' +\n\t\t\t\t'f/l:' + firstChunk + '/' + (!tailLength) + ';  len:' + messageLength);\n\t\t\tchunkStream.lastTimestamp = chunkTimestamp;\n\t\t\tchunkStream.lastLength = messageLength;\n\t\t\tchunkStream.lastTypeId = messageTypeId;\n\t\t\tchunkStream.lastStreamId = messageStreamId;\n\t\t\tchunkStream.lastMessageComplete = !tailLength;\n\t\t\tchunkStream.waitingForBytes = tailLength;\n\t\t\tchunkStream._push(\n\t\t\t\tthis.buffer.subarray(totalChunkHeaderSize, totalChunkHeaderSize + read),\n\t\t\t\tfirstChunk, !tailLength);\n\n\t\t\treturn totalChunkHeaderSize + read;\n\t\t}\n\n\t\tpublic start() {\n\t\t\tthis.epochStart = Date.now();\n\t\t\tthis.ondata(new Uint8Array([PROTOCOL_VERSION])); // c0\n\n\t\t\tthis.randomData = new Uint8Array(RANDOM_DATA_SIZE);\n\t\t\tthis.randomData[0] = 0;\n\t\t\tthis.randomData[1] = 0;\n\t\t\tthis.randomData[2] = 0;\n\t\t\tthis.randomData[3] = 0;\n\t\t\tfor (let i = 8; i < RANDOM_DATA_SIZE; i++) {\n\t\t\t\tthis.randomData[i] = (Math.random() * 256) | 0;\n\t\t\t}\n\t\t\tthis.ondata(this.randomData); // c1\n\t\t\tconsole.log('## connected');\n\t\t}\n\n\t\tpublic stop(error: any) {\n\t\t\tif (error) {\n\t\t\t\tconsole.error('socket error!!!');\n\t\t\t}\n\t\t\tconsole.log('## closed');\n\t\t}\n\n\t\tprivate _fail(message: any) {\n\t\t\tconsole.error('failed: ' + message);\n\t\t\tthis.state = 'failed';\n\t\t\tthis.onclose();\n\t\t\tthrow new Error(message);\n\t\t}\n\t}\n}\n","/*\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule RtmpJs {\n\timport flash = Shumway.AVMX.AS.flash;\n\n\tlet TRANSPORT_ENCODING = 0;\n\n\tlet MAIN_CHUNKED_STREAM_ID = 3;\n\tlet CONNECT_TRANSACTION_ID = 1;\n\tlet DEFAULT_STREAM_ID = 0;\n\n\tlet COMMAND_MESSAGE_AMF0_ID = 20;\n\tlet COMMAND_MESSAGE_AMF3_ID = 17;\n\n\tlet SET_BUFFER_CONTROL_MESSAGE_ID = 3;\n\tlet PING_REQUEST_CONTROL_MESSAGE_ID = 6;\n\tlet PING_RESPONSE_CONTROL_MESSAGE_ID = 7;\n\n\texport interface ITransportConnectedParameters {\n\t\tproperties: any;\n\t\tinformation: any;\n\t\tisError: boolean;\n\t}\n\n\texport interface ITransportStreamCreatedParameters {\n\t\ttransactionId: number;\n\t\tcommandObject: any;\n\t\tstreamId: number;\n\t\tstream: INetStream;\n\t\tisError: boolean\n\t}\n\n\texport interface ITransportResponse {\n\t\tcommandName: string;\n\t\ttransactionId: number;\n\t\tcommandObject: any;\n\t\tresponse: any;\n\t}\n\n\texport interface ITransportEvent {\n\t\ttype: number;\n\t\tdata: Uint8Array;\n\t}\n\n\texport class BaseTransport {\n\t\tchannel: ChunkedChannel;\n\n\t\tonconnected: (props: ITransportConnectedParameters) => void;\n\t\tonstreamcreated: (props: ITransportStreamCreatedParameters) => void;\n\t\tonresponse: (response: ITransportResponse) => void;\n\t\tonevent: (event: ITransportEvent) => void;\n\n\t\tprivate _streams: NetStream[];\n\n\t\tconstructor() {\n\t\t\tthis._streams = [];\n\t\t}\n\n\t\tconnect(properties: any, args?: any) {\n\t\t\tthrow new Error('Abstract BaseTransport.connect method');\n\t\t}\n\n\t\t_initChannel(properties: any, args?: any) {\n\t\t\tlet channel = new ChunkedChannel();\n\t\t\tlet transport = this;\n\t\t\tchannel.oncreated = function () {\n\t\t\t\tlet ba = new flash.utils.ByteArray();\n\t\t\t\tba.objectEncoding = TRANSPORT_ENCODING;\n\t\t\t\tba.writeObject('connect');\n\t\t\t\tba.writeObject(CONNECT_TRANSACTION_ID);\n\t\t\t\tba.writeObject(properties);\n\t\t\t\tba.writeObject(args || null);\n\t\t\t\trelease || console.log('.. Connect sent');\n\t\t\t\tchannel.send(MAIN_CHUNKED_STREAM_ID, {\n\t\t\t\t\tstreamId: DEFAULT_STREAM_ID,\n\t\t\t\t\ttypeId: TRANSPORT_ENCODING ? COMMAND_MESSAGE_AMF3_ID : COMMAND_MESSAGE_AMF0_ID,\n\t\t\t\t\tdata: new Uint8Array((<any> ba)._buffer, 0, (<any> ba).length)\n\t\t\t\t});\n\t\t\t};\n\t\t\tchannel.onmessage = function (message: IChunkedStreamMessage) {\n\t\t\t\trelease || console.log('.. Data received: typeId:' + message.typeId +\n\t\t\t\t\t', streamId:' + message.streamId +\n\t\t\t\t\t', cs: ' + message.chunkedStreamId);\n\n\t\t\t\tif (message.streamId !== 0) {\n\t\t\t\t\ttransport._streams[message.streamId]._push(message);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (message.typeId === COMMAND_MESSAGE_AMF0_ID ||\n\t\t\t\t\tmessage.typeId === COMMAND_MESSAGE_AMF3_ID) {\n\t\t\t\t\tlet ba = new flash.utils.ByteArray();\n\t\t\t\t\tba.writeRawBytes(message.data);\n\t\t\t\t\tba.position = 0;\n\t\t\t\t\tba.objectEncoding = message.typeId === COMMAND_MESSAGE_AMF0_ID ? 0 : 3;\n\t\t\t\t\tlet commandName = ba.readObject();\n\t\t\t\t\tif (commandName === undefined) { // ??? not sure what specification says and what real stuff are\n\t\t\t\t\t\tba.objectEncoding = 0;\n\t\t\t\t\t\tcommandName = ba.readObject();\n\t\t\t\t\t}\n\t\t\t\t\tlet transactionId = ba.readObject();\n\t\t\t\t\tif (commandName === '_result' || commandName === '_error') {\n\t\t\t\t\t\tlet isError = commandName === '_error';\n\t\t\t\t\t\tif (transactionId === CONNECT_TRANSACTION_ID) {\n\t\t\t\t\t\t\tlet properties = ba.readObject();\n\t\t\t\t\t\t\tlet information = ba.readObject();\n\t\t\t\t\t\t\tif (transport.onconnected) {\n\t\t\t\t\t\t\t\ttransport.onconnected({\n\t\t\t\t\t\t\t\t\tproperties: properties,\n\t\t\t\t\t\t\t\t\tinformation: information,\n\t\t\t\t\t\t\t\t\tisError: isError\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet commandObject = ba.readObject();\n\t\t\t\t\t\t\tlet streamId = ba.readObject();\n\t\t\t\t\t\t\tif (transport.onstreamcreated) {\n\t\t\t\t\t\t\t\tlet stream = new NetStream(transport, streamId);\n\t\t\t\t\t\t\t\ttransport._streams[streamId] = stream;\n\t\t\t\t\t\t\t\ttransport.onstreamcreated({\n\t\t\t\t\t\t\t\t\ttransactionId: transactionId,\n\t\t\t\t\t\t\t\t\tcommandObject: commandObject,\n\t\t\t\t\t\t\t\t\tstreamId: streamId,\n\t\t\t\t\t\t\t\t\tstream: stream,\n\t\t\t\t\t\t\t\t\tisError: isError\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (commandName === 'onBWCheck' || commandName === 'onBWDone') {\n\t\t\t\t\t\t// TODO skipping those for now\n\t\t\t\t\t\ttransport.sendCommandOrResponse('_error', transactionId, null,\n\t\t\t\t\t\t\t{code: 'NetConnection.Call.Failed', level: 'error'});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet commandObject = ba.readObject();\n\t\t\t\t\t\tlet response = ba.position < ba.length ? ba.readObject() : undefined;\n\t\t\t\t\t\tif (transport.onresponse) {\n\t\t\t\t\t\t\ttransport.onresponse({\n\t\t\t\t\t\t\t\tcommandName: commandName,\n\t\t\t\t\t\t\t\ttransactionId: transactionId,\n\t\t\t\t\t\t\t\tcommandObject: commandObject,\n\t\t\t\t\t\t\t\tresponse: response\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// TODO misc messages\n\t\t\t};\n\t\t\tchannel.onusercontrolmessage = function (e: IChunkedChannelUserControlMessage) {\n\t\t\t\trelease || console.log('.. Event ' + e.type + ' +' + e.data.length + ' bytes');\n\t\t\t\tif (e.type === PING_REQUEST_CONTROL_MESSAGE_ID) {\n\t\t\t\t\tchannel.sendUserControlMessage(PING_RESPONSE_CONTROL_MESSAGE_ID, e.data);\n\t\t\t\t}\n\t\t\t\tif (transport.onevent) {\n\t\t\t\t\ttransport.onevent({type: e.type, data: e.data});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn (this.channel = channel);\n\t\t}\n\n\t\tcall(procedureName: string, transactionId: number, commandObject: any, args: any) {\n\t\t\tlet channel = this.channel;\n\n\t\t\tlet ba = new flash.utils.ByteArray();\n\t\t\tba.objectEncoding = TRANSPORT_ENCODING;\n\t\t\tba.writeObject(procedureName);\n\t\t\tba.writeObject(transactionId);\n\t\t\tba.writeObject(commandObject);\n\t\t\tba.writeObject(args);\n\t\t\tchannel.send(MAIN_CHUNKED_STREAM_ID, {\n\t\t\t\tstreamId: DEFAULT_STREAM_ID,\n\t\t\t\ttypeId: TRANSPORT_ENCODING ? COMMAND_MESSAGE_AMF3_ID : COMMAND_MESSAGE_AMF0_ID,\n\t\t\t\tdata: new Uint8Array((<any> ba)._buffer, 0, (<any> ba).length)\n\t\t\t});\n\t\t}\n\n\t\tcreateStream(transactionId: number, commandObject: any) {\n\t\t\tthis.sendCommandOrResponse('createStream', transactionId, commandObject);\n\t\t}\n\n\t\tsendCommandOrResponse(commandName: string, transactionId: number, commandObject: any, response?: any) {\n\t\t\tlet channel = this.channel;\n\n\t\t\tlet ba = new flash.utils.ByteArray();\n\t\t\tba.writeByte(0); // ???\n\t\t\tba.objectEncoding = 0; // TRANSPORT_ENCODING;\n\t\t\tba.writeObject(commandName);\n\t\t\tba.writeObject(transactionId);\n\t\t\tba.writeObject(commandObject || null);\n\t\t\tif (arguments.length > 3) {\n\t\t\t\tba.writeObject(response);\n\t\t\t}\n\t\t\tchannel.send(MAIN_CHUNKED_STREAM_ID, {\n\t\t\t\tstreamId: DEFAULT_STREAM_ID,\n\t\t\t\ttypeId: COMMAND_MESSAGE_AMF3_ID,\n\t\t\t\tdata: new Uint8Array((<any> ba)._buffer, 0, (<any> ba).length)\n\t\t\t});\n\n\t\t\t/*     // really weird that this does not work\n\t\t\t let ba = new flash.utils.ByteArray();\n\t\t\t ba.objectEncoding = TRANSPORT_ENCODING;\n\t\t\t ba.writeObject('createStream');\n\t\t\t ba.writeObject(transactionId);\n\t\t\t ba.writeObject(commandObject || null);\n\t\t\t channel.send(MAIN_CHUNKED_STREAM_ID, {\n\t\t\t streamId: DEFAULT_STREAM_ID,\n\t\t\t typeId: TRANSPORT_ENCODING ? COMMAND_MESSAGE_AMF3_ID : COMMAND_MESSAGE_AMF0_ID,\n\t\t\t data: new Uint8Array((<any> ba)._buffer, 0, (<any> ba).length)\n\t\t\t });\n\t\t\t */\n\t\t}\n\n\t\t_setBuffer(streamId: number, ms: number) {\n\t\t\tthis.channel.sendUserControlMessage(SET_BUFFER_CONTROL_MESSAGE_ID, new Uint8Array([\n\t\t\t\t(streamId >> 24) & 0xFF,\n\t\t\t\t(streamId >> 16) & 0xFF,\n\t\t\t\t(streamId >> 8) & 0xFF,\n\t\t\t\tstreamId & 0xFF,\n\t\t\t\t(ms >> 24) & 0xFF,\n\t\t\t\t(ms >> 16) & 0xFF,\n\t\t\t\t(ms >> 8) & 0xFF,\n\t\t\t\tms & 0xFF\n\t\t\t]));\n\t\t}\n\n\t\t_sendCommand(streamId: number, data: Uint8Array) {\n\t\t\tthis.channel.send(8, {\n\t\t\t\tstreamId: streamId,\n\t\t\t\ttypeId: TRANSPORT_ENCODING ? COMMAND_MESSAGE_AMF3_ID : COMMAND_MESSAGE_AMF0_ID,\n\t\t\t\tdata: data\n\t\t\t});\n\t\t}\n\t}\n\n\tlet DEFAULT_BUFFER_LENGTH = 100; // ms\n\n\texport interface INetStreamData {\n\t\ttypeId: number;\n\t\tdata: Uint8Array;\n\t\ttimestamp: number;\n\t}\n\n\texport interface INetStream {\n\t\tondata: (data: INetStreamData) => void;\n\t\tonscriptdata: (type: string, ...data: any[]) => void;\n\t\toncallback: (...args: any[]) => void;\n\n\t\tplay(name: string, start?: number, duration?: number, reset?: boolean): void;\n\t}\n\n\tclass NetStream implements INetStream {\n\t\ttransport: BaseTransport;\n\t\tstreamId: number;\n\n\t\tondata: (message: INetStreamData) => void;\n\t\tonscriptdata: (type: string, ...data: any[]) => void;\n\t\toncallback: (...args: any[]) => void;\n\n\t\tconstructor(transport: any, streamId: any) {\n\t\t\tthis.transport = transport;\n\t\t\tthis.streamId = streamId;\n\t\t}\n\n\t\tpublic play(name: string, start?: number, duration?: number, reset?: boolean) {\n\t\t\tlet ba = new flash.utils.ByteArray();\n\t\t\tba.objectEncoding = TRANSPORT_ENCODING;\n\t\t\tba.writeObject('play');\n\t\t\tba.writeObject(0);\n\t\t\tba.writeObject(null);\n\t\t\tba.writeObject(name);\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tba.writeObject(start);\n\t\t\t}\n\t\t\tif (arguments.length > 2) {\n\t\t\t\tba.writeObject(duration);\n\t\t\t}\n\t\t\tif (arguments.length > 3) {\n\t\t\t\tba.writeObject(reset);\n\t\t\t}\n\t\t\tthis.transport._sendCommand(this.streamId, new Uint8Array((<any> ba)._buffer, 0, (<any> ba).length));\n\t\t\t// set the buffer, otherwise it will stop in ~15 sec\n\t\t\tthis.transport._setBuffer(this.streamId, DEFAULT_BUFFER_LENGTH);\n\t\t}\n\n\t\t_push(message: IChunkedStreamMessage) {\n\t\t\tswitch (message.typeId) {\n\t\t\t\tcase 8:\n\t\t\t\tcase 9:\n\t\t\t\t\tif (this.ondata) {\n\t\t\t\t\t\tthis.ondata(message);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 18:\n\t\t\t\tcase 20:\n\t\t\t\t\tlet args = [];\n\t\t\t\t\tlet ba = new flash.utils.ByteArray();\n\t\t\t\t\tba.writeRawBytes(message.data);\n\t\t\t\t\tba.position = 0;\n\t\t\t\t\tba.objectEncoding = 0;\n\t\t\t\t\twhile (ba.position < ba.length) {\n\t\t\t\t\t\targs.push(ba.readObject());\n\t\t\t\t\t}\n\t\t\t\t\tif (message.typeId === 18 && this.onscriptdata) {\n\t\t\t\t\t\tthis.onscriptdata.apply(this, args);\n\t\t\t\t\t}\n\t\t\t\t\tif (message.typeId === 20 && this.oncallback) {\n\t\t\t\t\t\tthis.oncallback.apply(this, args);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\texport interface RtmpConnectionString {\n\t\tprotocol: string;\n\t\thost: string;\n\t\tport: number;\n\t\tapp: string;\n\t}\n\n\texport function parseConnectionString(s: string): RtmpConnectionString {\n\t\t// The s has to have the following format:\n\t\t//   protocol:[//host][:port]/appname[/instanceName]\n\t\tlet protocolSeparatorIndex = s.indexOf(':');\n\t\tif (protocolSeparatorIndex < 0) {\n\t\t\treturn null; // no protocol\n\t\t}\n\t\tif (s[protocolSeparatorIndex + 1] !== '/') {\n\t\t\treturn null; // shall have '/' after protocol\n\t\t}\n\t\tlet protocol = s.substring(0, protocolSeparatorIndex).toLocaleLowerCase();\n\t\tif (protocol !== 'rtmp' && protocol !== 'rtmpt' && protocol !== 'rtmps' &&\n\t\t\tprotocol !== 'rtmpe' && protocol !== 'rtmpte' && protocol !== 'rtmfp') {\n\t\t\treturn null;\n\t\t}\n\t\tlet host, port;\n\t\tlet appnameSeparator = protocolSeparatorIndex + 1;\n\t\tif (s[protocolSeparatorIndex + 2] === '/') {\n\t\t\t// has host\n\t\t\tappnameSeparator = s.indexOf('/', protocolSeparatorIndex + 3);\n\t\t\tif (appnameSeparator < 0) {\n\t\t\t\treturn undefined; // has host but no appname\n\t\t\t}\n\t\t\tlet portSeparator = s.indexOf(':', protocolSeparatorIndex + 1);\n\t\t\tif (portSeparator >= 0 && portSeparator < appnameSeparator) {\n\t\t\t\thost = s.substring(protocolSeparatorIndex + 3, portSeparator);\n\t\t\t\tport = +s.substring(portSeparator + 1, appnameSeparator);\n\t\t\t} else {\n\t\t\t\thost = s.substring(protocolSeparatorIndex + 3, appnameSeparator);\n\t\t\t}\n\t\t}\n\t\tlet app = s.substring(appnameSeparator + 1);\n\t\treturn {\n\t\t\tprotocol: protocol,\n\t\t\thost: host,\n\t\t\tport: port,\n\t\t\tapp: app\n\t\t};\n\t}\n\n}\n","/*\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule RtmpJs.Browser {\n\tlet DEFAULT_RTMP_PORT = 1935;\n\tlet COMBINE_RTMPT_DATA = true;\n\n\texport class RtmpTransport extends BaseTransport {\n\t\thost: string;\n\t\tport: number;\n\t\tssl: boolean;\n\n\t\tconstructor(connectionSettings: any) {\n\t\t\tsuper();\n\n\t\t\tif (typeof connectionSettings === 'string') {\n\t\t\t\tconnectionSettings = {host: connectionSettings};\n\t\t\t}\n\n\t\t\tthis.host = connectionSettings.host || 'localhost';\n\t\t\tthis.port = connectionSettings.port || DEFAULT_RTMP_PORT;\n\t\t\tthis.ssl = !!connectionSettings.ssl || false;\n\t\t}\n\n\t\tconnect(properties: any, args?: any) {\n\t\t\tlet TCPSocket = typeof navigator !== 'undefined' &&\n\t\t\t\t(<any>navigator).mozTCPSocket;\n\n\t\t\tif (!TCPSocket) {\n\t\t\t\tthrow new Error('Your browser does not support socket communication.\\n' +\n\t\t\t\t\t'Currenly only Firefox with enabled mozTCPSocket is allowed (see README.md).');\n\t\t\t}\n\n\t\t\tlet channel = this._initChannel(properties, args);\n\n\t\t\tlet writeQueue: Array<Uint8Array> = [], socketError = false;\n\t\t\tlet socket: any = typeof ShumwayComRtmpSocket !== 'undefined' && ShumwayComRtmpSocket.isAvailable ?\n\t\t\t\tnew ShumwayComRtmpSocket(this.host, this.port, {\n\t\t\t\t\tuseSecureTransport: this.ssl,\n\t\t\t\t\tbinaryType: 'arraybuffer'\n\t\t\t\t}) :\n\t\t\t\tTCPSocket.open(this.host, this.port, {useSecureTransport: this.ssl, binaryType: 'arraybuffer'});\n\n\n\t\t\tlet sendData = function (data: Uint8Array) {\n\t\t\t\treturn socket.send(data.buffer, data.byteOffset, data.byteLength);\n\t\t\t};\n\n\t\t\tsocket.onopen = function (e: any) {\n\t\t\t\tchannel.ondata = function (data) {\n\t\t\t\t\tlet buf = new Uint8Array(data);\n\t\t\t\t\twriteQueue.push(buf);\n\t\t\t\t\tif (writeQueue.length > 1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\trelease || console.log('Bytes written: ' + buf.length);\n\t\t\t\t\tif (sendData(buf)) {\n\t\t\t\t\t\twriteQueue.shift();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tchannel.onclose = function () {\n\t\t\t\t\tsocket.close();\n\t\t\t\t};\n\t\t\t\tchannel.start();\n\t\t\t};\n\t\t\tsocket.ondrain = function (e: any) {\n\t\t\t\twriteQueue.shift();\n\t\t\t\trelease || console.log('Write completed');\n\t\t\t\twhile (writeQueue.length > 0) {\n\t\t\t\t\trelease || console.log('Bytes written: ' + writeQueue[0].length);\n\t\t\t\t\tif (!sendData(writeQueue[0])) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\twriteQueue.shift();\n\t\t\t\t}\n\t\t\t};\n\t\t\tsocket.onclose = function (e: any) {\n\t\t\t\tchannel.stop(socketError);\n\t\t\t};\n\t\t\tsocket.onerror = function (e: any) {\n\t\t\t\tsocketError = true;\n\t\t\t\tconsole.error('socket error: ' + e.data);\n\t\t\t};\n\t\t\tsocket.ondata = function (e: any) {\n\t\t\t\trelease || console.log('Bytes read: ' + e.data.byteLength);\n\t\t\t\tchannel.push(new Uint8Array(e.data));\n\t\t\t};\n\t\t}\n\t}\n\n\n\t/*\n\t * RtmptTransport uses systemXHR to send HTTP requests.\n\t * See https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest#XMLHttpRequest%28%29 and\n\t * https://github.com/mozilla-b2g/gaia/blob/master/apps/email/README.md#running-in-firefox\n\t *\n\t * Spec at http://red5.electroteque.org/dev/doc/html/rtmpt.html\n\t */\n\texport class RtmptTransport extends BaseTransport {\n\t\tbaseUrl: string;\n\t\tstopped: boolean;\n\t\tsessionId: string;\n\t\trequestId: number;\n\t\tdata: Uint8Array[];\n\n\t\tconstructor(connectionSettings: any) {\n\t\t\tsuper();\n\n\t\t\tlet host = connectionSettings.host || 'localhost';\n\t\t\tlet url = (connectionSettings.ssl ? 'https' : 'http') + '://' + host;\n\t\t\tif (connectionSettings.port) {\n\t\t\t\turl += ':' + connectionSettings.port;\n\t\t\t}\n\t\t\tthis.baseUrl = url;\n\n\t\t\tthis.stopped = false;\n\t\t\tthis.sessionId = null;\n\t\t\tthis.requestId = 0;\n\t\t\tthis.data = [];\n\t\t}\n\n\t\tconnect(properties: any, args?: any) {\n\t\t\tlet channel = this._initChannel(properties, args);\n\t\t\tchannel.ondata = function (data: any) {\n\t\t\t\trelease || console.log('Bytes written: ' + data.length);\n\t\t\t\tthis.data.push(new Uint8Array(data));\n\t\t\t}.bind(this);\n\t\t\tchannel.onclose = function () {\n\t\t\t\tthis.stopped = true;\n\t\t\t}.bind(this);\n\n\n\t\t\tpost(this.baseUrl + '/fcs/ident2', null, function (data: any, status: any) {\n\t\t\t\tif (status !== 404) {\n\t\t\t\t\tthrow new Error('Unexpected response: ' + status);\n\t\t\t\t}\n\n\t\t\t\tpost(this.baseUrl + '/open/1', null, function (data: any, status: any) {\n\t\t\t\t\tthis.sessionId = String.fromCharCode.apply(null, data).slice(0, -1); // - '\\n'\n\t\t\t\t\tconsole.log('session id: ' + this.sessionId);\n\n\t\t\t\t\tthis.tick();\n\t\t\t\t\tchannel.start();\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this));\n\t\t}\n\n\t\ttick() {\n\t\t\tlet continueSend = function (data: any, status: number) {\n\t\t\t\tif (status !== 200) {\n\t\t\t\t\tthrow new Error('Invalid HTTP status');\n\t\t\t\t}\n\n\t\t\t\tlet idle = data[0];\n\t\t\t\tif (data.length > 1) {\n\t\t\t\t\tthis.channel.push(data.subarray(1));\n\t\t\t\t}\n\t\t\t\tsetTimeout(this.tick.bind(this), idle * 16);\n\t\t\t}.bind(this);\n\n\t\t\tif (this.stopped) {\n\t\t\t\tpost(this.baseUrl + '/close/2', null, function () {\n\t\t\t\t\t// do nothing\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.data.length > 0) {\n\t\t\t\tlet data: Uint8Array;\n\t\t\t\tif (COMBINE_RTMPT_DATA) {\n\t\t\t\t\tlet length = 0;\n\t\t\t\t\tthis.data.forEach(function (i: Uint8Array) {\n\t\t\t\t\t\tlength += i.length;\n\t\t\t\t\t});\n\t\t\t\t\tlet pos = 0;\n\t\t\t\t\tdata = new Uint8Array(length);\n\t\t\t\t\tthis.data.forEach(function (i: Uint8Array) {\n\t\t\t\t\t\tdata.set(i, pos);\n\t\t\t\t\t\tpos += i.length;\n\t\t\t\t\t});\n\t\t\t\t\tthis.data.length = 0;\n\t\t\t\t} else {\n\t\t\t\t\tdata = this.data.shift();\n\t\t\t\t}\n\t\t\t\tpost(this.baseUrl + '/send/' + this.sessionId + '/' + (this.requestId++),\n\t\t\t\t\tdata, continueSend);\n\t\t\t} else {\n\t\t\t\tpost(this.baseUrl + '/idle/' + this.sessionId + '/' + (this.requestId++),\n\t\t\t\t\tnull, continueSend);\n\t\t\t}\n\t\t}\n\t}\n\n\tlet emptyPostData = new Uint8Array([0]);\n\n\tfunction post(path: any, data: any, onload: any) {\n\t\tdata || (data = emptyPostData);\n\n\t\tlet xhr: any = typeof ShumwayComRtmpXHR !== 'undefined' && ShumwayComRtmpXHR.isAvailable ?\n\t\t\tnew ShumwayComRtmpXHR() : new (<any>XMLHttpRequest)({mozSystem: true});\n\t\txhr.open('POST', path, true);\n\t\txhr.responseType = 'arraybuffer';\n\t\txhr.setRequestHeader('Content-Type', 'application/x-fcs');\n\t\txhr.onload = function (e: any) {\n\t\t\tonload(new Uint8Array(xhr.response), xhr.status);\n\t\t};\n\t\txhr.onerror = function (e: any) {\n\t\t\tconsole.log('error');\n\t\t\tthrow new Error('HTTP error');\n\t\t};\n\t\txhr.send(data);\n\t}\n}\n","/**\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule RtmpJs.MP4.Iso {\n\timport utf8decode = Shumway.StringUtilities.utf8decode;\n\n\tlet START_DATE = -2082844800000;\n\t/* midnight after Jan. 1, 1904 */\n\tlet DEFAULT_MOVIE_MATRIX: number[] = [1.0, 0, 0, 0, 1.0, 0, 0, 0, 1.0];\n\tlet DEFAULT_OP_COLOR: number[] = [0, 0, 0];\n\n\tfunction concatArrays<T>(arg0: T[], ...args: T[][]): T[] {\n\t\treturn Array.prototype.concat.apply(arg0, args);\n\t}\n\n\tfunction writeInt32(data: Uint8Array, offset: number, value: number) {\n\t\tdata[offset] = (value >> 24) & 255;\n\t\tdata[offset + 1] = (value >> 16) & 255;\n\t\tdata[offset + 2] = (value >> 8) & 255;\n\t\tdata[offset + 3] = value & 255;\n\t}\n\n\tfunction decodeInt32(s: string): number {\n\t\treturn (s.charCodeAt(0) << 24) | (s.charCodeAt(1) << 16) |\n\t\t\t(s.charCodeAt(2) << 8) | s.charCodeAt(3);\n\t}\n\n\tfunction encodeDate(d: number): number {\n\t\treturn ((d - START_DATE) / 1000) | 0;\n\t}\n\n\tfunction encodeFloat_16_16(f: number): number {\n\t\treturn (f * 0x10000) | 0;\n\t}\n\n\tfunction encodeFloat_2_30(f: number): number {\n\t\treturn (f * 0x40000000) | 0;\n\t}\n\n\tfunction encodeFloat_8_8(f: number): number {\n\t\treturn (f * 0x100) | 0;\n\t}\n\n\tfunction encodeLang(s: string): number {\n\t\treturn ((s.charCodeAt(0) & 0x1F) << 10) | ((s.charCodeAt(1) & 0x1F) << 5) | (s.charCodeAt(2) & 0x1F);\n\t}\n\n\texport class Box {\n\t\tpublic offset: number;\n\t\tpublic size: number;\n\n\t\tpublic boxtype: string;\n\t\tpublic userType: Uint8Array;\n\n\t\tpublic constructor(boxtype: string, extendedType?: Uint8Array) {\n\t\t\tthis.boxtype = boxtype;\n\t\t\tif (boxtype === 'uuid') {\n\t\t\t\tthis.userType = extendedType;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @param offset Position where writing will start in the output array\n\t\t * @returns {number} Size of the written data\n\t\t */\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.offset = offset;\n\t\t\tlet size = 8;\n\t\t\tif (this.userType) {\n\t\t\t\tsize += 16;\n\t\t\t}\n\t\t\tthis.size = size;\n\t\t\treturn size;\n\t\t}\n\n\t\t/**\n\t\t * @param data Output array\n\t\t * @returns {number} Amount of written bytes by this Box and its children only.\n\t\t */\n\t\tpublic write(data: Uint8Array): number {\n\t\t\twriteInt32(data, this.offset, this.size);\n\t\t\twriteInt32(data, this.offset + 4, decodeInt32(this.boxtype));\n\t\t\tif (!this.userType) {\n\t\t\t\treturn 8;\n\t\t\t}\n\t\t\tdata.set(this.userType, this.offset + 8);\n\t\t\treturn 24;\n\t\t}\n\n\t\tpublic toUint8Array(): Uint8Array {\n\t\t\tlet size = this.layout(0);\n\t\t\tlet data = new Uint8Array(size);\n\t\t\tthis.write(data);\n\t\t\treturn data;\n\t\t}\n\t}\n\n\texport class FullBox extends Box {\n\t\tpublic version: number;\n\t\tpublic flags: number;\n\n\t\tconstructor(boxtype: string, version: number = 0, flags: number = 0) {\n\t\t\tsuper(boxtype);\n\t\t\tthis.version = version;\n\t\t\tthis.flags = flags;\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 4;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, (this.version << 24) | this.flags);\n\t\t\treturn offset + 4;\n\t\t}\n\t}\n\n\texport class FileTypeBox extends Box {\n\t\tpublic majorBrand: string;\n\t\tpublic minorVersion: number;\n\t\tpublic compatibleBrands: string[];\n\n\t\tconstructor(majorBrand: string, minorVersion: number, compatibleBrands: string[]) {\n\t\t\tsuper('ftype');\n\t\t\tthis.majorBrand = majorBrand;\n\t\t\tthis.minorVersion = minorVersion;\n\t\t\tthis.compatibleBrands = compatibleBrands;\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 4 * (2 + this.compatibleBrands.length);\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, decodeInt32(this.majorBrand));\n\t\t\twriteInt32(data, this.offset + offset + 4, this.minorVersion);\n\t\t\toffset += 8;\n\t\t\tthis.compatibleBrands.forEach((brand: string) => {\n\t\t\t\twriteInt32(data, this.offset + offset, decodeInt32(brand));\n\t\t\t\toffset += 4;\n\t\t\t}, this);\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class BoxContainerBox extends Box {\n\t\tpublic children: Box[];\n\n\t\tconstructor(type: string, children: Box[]) {\n\t\t\tsuper(type);\n\t\t\tthis.children = children;\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset);\n\t\t\tthis.children.forEach((child) => {\n\t\t\t\tif (!child) {\n\t\t\t\t\treturn; // skipping undefined\n\t\t\t\t}\n\t\t\t\tsize += child.layout(offset + size);\n\t\t\t});\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\tthis.children.forEach((child) => {\n\t\t\t\tif (!child) {\n\t\t\t\t\treturn; // skipping undefined\n\t\t\t\t}\n\t\t\t\toffset += child.write(data);\n\t\t\t});\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class MovieBox extends BoxContainerBox {\n\t\tconstructor(public header: MovieHeaderBox,\n\t\t            public tracks: Box[],\n\t\t            public extendsBox: MovieExtendsBox,\n\t\t            public userData: Box) {\n\t\t\tsuper('moov', concatArrays<Box>([header], tracks, [extendsBox, userData]));\n\t\t}\n\t}\n\n\texport class MovieHeaderBox extends FullBox {\n\t\tconstructor(public timescale: number,\n\t\t            public duration: number,\n\t\t            public nextTrackId: number,\n\t\t            public rate: number = 1.0,\n\t\t            public volume: number = 1.0,\n\t\t            public matrix: number[] = DEFAULT_MOVIE_MATRIX,\n\t\t            public creationTime: number = START_DATE,\n\t\t            public modificationTime: number = START_DATE) {\n\t\t\tsuper('mvhd', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 16 + 4 + 2 + 2 + 8 + 36 + 24 + 4;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\t// Only version 0\n\t\t\twriteInt32(data, this.offset + offset, encodeDate(this.creationTime));\n\t\t\twriteInt32(data, this.offset + offset + 4, encodeDate(this.modificationTime));\n\t\t\twriteInt32(data, this.offset + offset + 8, this.timescale);\n\t\t\twriteInt32(data, this.offset + offset + 12, this.duration);\n\t\t\toffset += 16;\n\t\t\twriteInt32(data, this.offset + offset, encodeFloat_16_16(this.rate));\n\t\t\twriteInt32(data, this.offset + offset + 4, encodeFloat_8_8(this.volume) << 16);\n\t\t\twriteInt32(data, this.offset + offset + 8, 0);\n\t\t\twriteInt32(data, this.offset + offset + 12, 0);\n\t\t\toffset += 16;\n\t\t\twriteInt32(data, this.offset + offset, encodeFloat_16_16(this.matrix[0]));\n\t\t\twriteInt32(data, this.offset + offset + 4, encodeFloat_16_16(this.matrix[1]));\n\t\t\twriteInt32(data, this.offset + offset + 8, encodeFloat_16_16(this.matrix[2]));\n\t\t\twriteInt32(data, this.offset + offset + 12, encodeFloat_16_16(this.matrix[3]));\n\t\t\twriteInt32(data, this.offset + offset + 16, encodeFloat_16_16(this.matrix[4]));\n\t\t\twriteInt32(data, this.offset + offset + 20, encodeFloat_16_16(this.matrix[5]));\n\t\t\twriteInt32(data, this.offset + offset + 24, encodeFloat_2_30(this.matrix[6]));\n\t\t\twriteInt32(data, this.offset + offset + 28, encodeFloat_2_30(this.matrix[7]));\n\t\t\twriteInt32(data, this.offset + offset + 32, encodeFloat_2_30(this.matrix[8]));\n\t\t\toffset += 36;\n\t\t\twriteInt32(data, this.offset + offset, 0);\n\t\t\twriteInt32(data, this.offset + offset + 4, 0);\n\t\t\twriteInt32(data, this.offset + offset + 8, 0);\n\t\t\twriteInt32(data, this.offset + offset + 12, 0);\n\t\t\twriteInt32(data, this.offset + offset + 16, 0);\n\t\t\twriteInt32(data, this.offset + offset + 20, 0);\n\t\t\toffset += 24;\n\t\t\twriteInt32(data, this.offset + offset, this.nextTrackId);\n\t\t\toffset += 4;\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport const enum TrackHeaderFlags {\n\t\tTRACK_ENABLED = 0x000001,\n\t\tTRACK_IN_MOVIE = 0x000002,\n\t\tTRACK_IN_PREVIEW = 0x000004,\n\t}\n\n\texport class TrackHeaderBox extends FullBox {\n\t\tconstructor(flags: number,\n\t\t            public trackId: number,\n\t\t            public duration: number,\n\t\t            public width: number,\n\t\t            public height: number,\n\t\t            public volume: number,\n\t\t            public alternateGroup: number = 0,\n\t\t            public layer: number = 0,\n\t\t            public matrix: number[] = DEFAULT_MOVIE_MATRIX,\n\t\t            public creationTime: number = START_DATE,\n\t\t            public modificationTime: number = START_DATE) {\n\t\t\tsuper('tkhd', 0, flags);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 20 + 8 + 6 + 2 + 36 + 8;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\t// Only version 0\n\t\t\twriteInt32(data, this.offset + offset, encodeDate(this.creationTime));\n\t\t\twriteInt32(data, this.offset + offset + 4, encodeDate(this.modificationTime));\n\t\t\twriteInt32(data, this.offset + offset + 8, this.trackId);\n\t\t\twriteInt32(data, this.offset + offset + 12, 0);\n\t\t\twriteInt32(data, this.offset + offset + 16, this.duration);\n\t\t\toffset += 20;\n\t\t\twriteInt32(data, this.offset + offset, 0);\n\t\t\twriteInt32(data, this.offset + offset + 4, 0);\n\t\t\twriteInt32(data, this.offset + offset + 8, (this.layer << 16) | this.alternateGroup);\n\t\t\twriteInt32(data, this.offset + offset + 12, encodeFloat_8_8(this.volume) << 16);\n\t\t\toffset += 16;\n\t\t\twriteInt32(data, this.offset + offset, encodeFloat_16_16(this.matrix[0]));\n\t\t\twriteInt32(data, this.offset + offset + 4, encodeFloat_16_16(this.matrix[1]));\n\t\t\twriteInt32(data, this.offset + offset + 8, encodeFloat_16_16(this.matrix[2]));\n\t\t\twriteInt32(data, this.offset + offset + 12, encodeFloat_16_16(this.matrix[3]));\n\t\t\twriteInt32(data, this.offset + offset + 16, encodeFloat_16_16(this.matrix[4]));\n\t\t\twriteInt32(data, this.offset + offset + 20, encodeFloat_16_16(this.matrix[5]));\n\t\t\twriteInt32(data, this.offset + offset + 24, encodeFloat_2_30(this.matrix[6]));\n\t\t\twriteInt32(data, this.offset + offset + 28, encodeFloat_2_30(this.matrix[7]));\n\t\t\twriteInt32(data, this.offset + offset + 32, encodeFloat_2_30(this.matrix[8]));\n\t\t\toffset += 36;\n\t\t\twriteInt32(data, this.offset + offset, encodeFloat_16_16(this.width));\n\t\t\twriteInt32(data, this.offset + offset + 4, encodeFloat_16_16(this.height));\n\t\t\toffset += 8;\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class MediaHeaderBox extends FullBox {\n\t\tconstructor(public timescale: number,\n\t\t            public duration: number,\n\t\t            public language: string = 'unk',\n\t\t            public creationTime: number = START_DATE,\n\t\t            public modificationTime: number = START_DATE) {\n\t\t\tsuper('mdhd', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 16 + 4;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\t// Only version 0\n\t\t\twriteInt32(data, this.offset + offset, encodeDate(this.creationTime));\n\t\t\twriteInt32(data, this.offset + offset + 4, encodeDate(this.modificationTime));\n\t\t\twriteInt32(data, this.offset + offset + 8, this.timescale);\n\t\t\twriteInt32(data, this.offset + offset + 12, this.duration);\n\t\t\twriteInt32(data, this.offset + offset + 16, encodeLang(this.language) << 16);\n\t\t\treturn offset + 20;\n\t\t}\n\t}\n\n\texport class HandlerBox extends FullBox {\n\t\tprivate _encodedName: Uint8Array;\n\n\t\tconstructor(public handlerType: string,\n\t\t            public name: string) {\n\t\t\tsuper('hdlr', 0, 0);\n\t\t\tthis._encodedName = utf8decode(this.name);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 8 + 12 + (this._encodedName.length + 1);\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, 0);\n\t\t\twriteInt32(data, this.offset + offset + 4, decodeInt32(this.handlerType));\n\t\t\twriteInt32(data, this.offset + offset + 8, 0);\n\t\t\twriteInt32(data, this.offset + offset + 12, 0);\n\t\t\twriteInt32(data, this.offset + offset + 16, 0);\n\t\t\toffset += 20;\n\t\t\tdata.set(this._encodedName, this.offset + offset);\n\t\t\tdata[this.offset + offset + this._encodedName.length] = 0;\n\t\t\toffset += this._encodedName.length + 1;\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class SoundMediaHeaderBox extends FullBox {\n\t\tconstructor(public balance: number = 0.0) {\n\t\t\tsuper('smhd', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 4;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, encodeFloat_8_8(this.balance) << 16);\n\t\t\treturn offset + 4;\n\t\t}\n\t}\n\n\texport class VideoMediaHeaderBox extends FullBox {\n\t\tconstructor(public graphicsMode: number = 0,\n\t\t            public opColor: number[] = DEFAULT_OP_COLOR) {\n\t\t\tsuper('vmhd', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 8;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, (this.graphicsMode << 16) | this.opColor[0]);\n\t\t\twriteInt32(data, this.offset + offset + 4, (this.opColor[1] << 16) | this.opColor[2]);\n\t\t\treturn offset + 8;\n\t\t}\n\t}\n\n\texport let SELF_CONTAINED_DATA_REFERENCE_FLAG = 0x000001;\n\n\texport class DataEntryUrlBox extends FullBox {\n\t\tprivate _encodedLocation: Uint8Array;\n\n\t\tconstructor(flags: number,\n\t\t            public location: string = null) {\n\t\t\tsuper('url ', 0, flags);\n\t\t\tif (!(flags & SELF_CONTAINED_DATA_REFERENCE_FLAG)) {\n\t\t\t\tthis._encodedLocation = utf8decode(location);\n\t\t\t}\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset);\n\t\t\tif (this._encodedLocation) {\n\t\t\t\tsize += this._encodedLocation.length + 1;\n\t\t\t}\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\tif (this._encodedLocation) {\n\t\t\t\tdata.set(this._encodedLocation, this.offset + offset);\n\t\t\t\tdata[this.offset + offset + this._encodedLocation.length] = 0;\n\t\t\t\toffset += this._encodedLocation.length;\n\t\t\t}\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class DataReferenceBox extends FullBox {\n\t\tconstructor(public entries: Box[]) {\n\t\t\tsuper('dref', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset) + 4;\n\t\t\tthis.entries.forEach((entry) => {\n\t\t\t\tsize += entry.layout(offset + size);\n\t\t\t});\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, this.entries.length);\n\t\t\tthis.entries.forEach((entry) => {\n\t\t\t\toffset += entry.write(data);\n\t\t\t});\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class DataInformationBox extends BoxContainerBox {\n\t\tconstructor(public dataReference: Box) {\n\t\t\tsuper('dinf', [dataReference]);\n\t\t}\n\t}\n\n\texport class SampleDescriptionBox extends FullBox {\n\t\tconstructor(public entries: Box[]) {\n\t\t\tsuper('stsd', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset);\n\t\t\tsize += 4;\n\t\t\tthis.entries.forEach((entry) => {\n\t\t\t\tsize += entry.layout(offset + size);\n\t\t\t});\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, this.entries.length);\n\t\t\toffset += 4;\n\t\t\tthis.entries.forEach((entry) => {\n\t\t\t\toffset += entry.write(data);\n\t\t\t});\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class SampleTableBox extends BoxContainerBox {\n\t\tconstructor(public sampleDescriptions: SampleDescriptionBox,\n\t\t            public timeToSample: Box,\n\t\t            public sampleToChunk: Box,\n\t\t            public sampleSizes: Box, // optional?\n\t\t            public chunkOffset: Box) {\n\t\t\tsuper('stbl', [sampleDescriptions, timeToSample, sampleToChunk, sampleSizes, chunkOffset]);\n\t\t}\n\t}\n\n\texport class MediaInformationBox extends BoxContainerBox {\n\t\tconstructor(public header: Box, // SoundMediaHeaderBox|VideoMediaHeaderBox\n\t\t            public info: DataInformationBox,\n\t\t            public sampleTable: SampleTableBox) {\n\t\t\tsuper('minf', [header, info, sampleTable]);\n\t\t}\n\t}\n\n\texport class MediaBox extends BoxContainerBox {\n\t\tconstructor(public header: MediaHeaderBox,\n\t\t            public handler: HandlerBox,\n\t\t            public info: MediaInformationBox) {\n\t\t\tsuper('mdia', [header, handler, info]);\n\t\t}\n\t}\n\n\texport class TrackBox extends BoxContainerBox {\n\t\tconstructor(public header: TrackHeaderBox,\n\t\t            public media: Box) {\n\t\t\tsuper('trak', [header, media]);\n\t\t}\n\t}\n\n\texport class TrackExtendsBox extends FullBox {\n\t\tconstructor(public trackId: number,\n\t\t            public defaultSampleDescriptionIndex: number,\n\t\t            public defaultSampleDuration: number,\n\t\t            public defaultSampleSize: number,\n\t\t            public defaultSampleFlags: number) {\n\t\t\tsuper('trex', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 20;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, this.trackId);\n\t\t\twriteInt32(data, this.offset + offset + 4, this.defaultSampleDescriptionIndex);\n\t\t\twriteInt32(data, this.offset + offset + 8, this.defaultSampleDuration);\n\t\t\twriteInt32(data, this.offset + offset + 12, this.defaultSampleSize);\n\t\t\twriteInt32(data, this.offset + offset + 16, this.defaultSampleFlags);\n\t\t\treturn offset + 20;\n\t\t}\n\t}\n\n\texport class MovieExtendsBox extends BoxContainerBox {\n\t\tconstructor(public header: Box,\n\t\t            public tracDefaults: TrackExtendsBox[],\n\t\t            public levels: Box) {\n\t\t\tsuper('mvex', concatArrays<Box>([header], tracDefaults, [levels]));\n\t\t}\n\t}\n\n\texport class MetaBox extends FullBox {\n\t\tconstructor(public handler: Box,\n\t\t            public otherBoxes: Box[]) {\n\t\t\tsuper('meta', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset);\n\t\t\tsize += this.handler.layout(offset + size);\n\t\t\tthis.otherBoxes.forEach((box) => {\n\t\t\t\tsize += box.layout(offset + size);\n\t\t\t});\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\toffset += this.handler.write(data);\n\t\t\tthis.otherBoxes.forEach((box) => {\n\t\t\t\toffset += box.write(data);\n\t\t\t});\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class MovieFragmentHeaderBox extends FullBox {\n\t\tconstructor(public sequenceNumber: number) {\n\t\t\tsuper('mfhd', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 4;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, this.sequenceNumber);\n\t\t\treturn offset + 4;\n\t\t}\n\t}\n\n\texport const enum TrackFragmentFlags {\n\t\tBASE_DATA_OFFSET_PRESENT = 0x000001,\n\t\tSAMPLE_DESCRIPTION_INDEX_PRESENT = 0x000002,\n\t\tDEFAULT_SAMPLE_DURATION_PRESENT = 0x000008,\n\t\tDEFAULT_SAMPLE_SIZE_PRESENT = 0x0000010,\n\t\tDEFAULT_SAMPLE_FLAGS_PRESENT = 0x000020,\n\t}\n\n\texport class TrackFragmentHeaderBox extends FullBox {\n\t\tconstructor(flags: number,\n\t\t            public trackId: number,\n\t\t            public baseDataOffset: number,\n\t\t            public sampleDescriptionIndex: number,\n\t\t            public defaultSampleDuration: number,\n\t\t            public defaultSampleSize: number,\n\t\t            public defaultSampleFlags: number) {\n\t\t\tsuper('tfhd', 0, flags);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset) + 4;\n\t\t\tlet flags = this.flags;\n\t\t\tif (!!(flags & TrackFragmentFlags.BASE_DATA_OFFSET_PRESENT)) {\n\t\t\t\tsize += 8;\n\t\t\t}\n\t\t\tif (!!(flags & TrackFragmentFlags.SAMPLE_DESCRIPTION_INDEX_PRESENT)) {\n\t\t\t\tsize += 4;\n\t\t\t}\n\t\t\tif (!!(flags & TrackFragmentFlags.DEFAULT_SAMPLE_DURATION_PRESENT)) {\n\t\t\t\tsize += 4;\n\t\t\t}\n\t\t\tif (!!(flags & TrackFragmentFlags.DEFAULT_SAMPLE_SIZE_PRESENT)) {\n\t\t\t\tsize += 4;\n\t\t\t}\n\t\t\tif (!!(flags & TrackFragmentFlags.DEFAULT_SAMPLE_FLAGS_PRESENT)) {\n\t\t\t\tsize += 4;\n\t\t\t}\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\tlet flags = this.flags;\n\t\t\twriteInt32(data, this.offset + offset, this.trackId);\n\t\t\toffset += 4;\n\t\t\tif (!!(flags & TrackFragmentFlags.BASE_DATA_OFFSET_PRESENT)) {\n\t\t\t\twriteInt32(data, this.offset + offset, 0);\n\t\t\t\twriteInt32(data, this.offset + offset + 4, this.baseDataOffset);\n\t\t\t\toffset += 8;\n\t\t\t}\n\t\t\tif (!!(flags & TrackFragmentFlags.SAMPLE_DESCRIPTION_INDEX_PRESENT)) {\n\t\t\t\twriteInt32(data, this.offset + offset, this.sampleDescriptionIndex);\n\t\t\t\toffset += 4;\n\t\t\t}\n\t\t\tif (!!(flags & TrackFragmentFlags.DEFAULT_SAMPLE_DURATION_PRESENT)) {\n\t\t\t\twriteInt32(data, this.offset + offset, this.defaultSampleDuration);\n\t\t\t\toffset += 4;\n\t\t\t}\n\t\t\tif (!!(flags & TrackFragmentFlags.DEFAULT_SAMPLE_SIZE_PRESENT)) {\n\t\t\t\twriteInt32(data, this.offset + offset, this.defaultSampleSize);\n\t\t\t\toffset += 4;\n\t\t\t}\n\t\t\tif (!!(flags & TrackFragmentFlags.DEFAULT_SAMPLE_FLAGS_PRESENT)) {\n\t\t\t\twriteInt32(data, this.offset + offset, this.defaultSampleFlags);\n\t\t\t\toffset += 4;\n\t\t\t}\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class TrackFragmentBaseMediaDecodeTimeBox extends FullBox {\n\t\tconstructor(public baseMediaDecodeTime: number) {\n\t\t\tsuper('tfdt', 0, 0);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 4;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, this.baseMediaDecodeTime);\n\t\t\treturn offset + 4;\n\t\t}\n\t}\n\n\texport class TrackFragmentBox extends BoxContainerBox {\n\t\tconstructor(public header: TrackFragmentHeaderBox,\n\t\t            public decodeTime: TrackFragmentBaseMediaDecodeTimeBox, // move after run?\n\t\t            public run: TrackRunBox) {\n\t\t\tsuper('traf', [header, decodeTime, run]);\n\t\t}\n\t}\n\n\texport const enum SampleFlags {\n\t\tIS_LEADING_MASK = 0x0C000000,\n\t\tSAMPLE_DEPENDS_ON_MASK = 0x03000000,\n\t\tSAMPLE_DEPENDS_ON_OTHER = 0x01000000,\n\t\tSAMPLE_DEPENDS_ON_NO_OTHERS = 0x02000000,\n\t\tSAMPLE_IS_DEPENDED_ON_MASK = 0x00C00000,\n\t\tSAMPLE_HAS_REDUNDANCY_MASK = 0x00300000,\n\t\tSAMPLE_PADDING_VALUE_MASK = 0x000E0000,\n\t\tSAMPLE_IS_NOT_SYNC = 0x00010000,\n\t\tSAMPLE_DEGRADATION_PRIORITY_MASK = 0x0000FFFF,\n\t}\n\n\texport const enum TrackRunFlags {\n\t\tDATA_OFFSET_PRESENT = 0x000001,\n\t\tFIRST_SAMPLE_FLAGS_PRESENT = 0x000004,\n\t\tSAMPLE_DURATION_PRESENT = 0x000100,\n\t\tSAMPLE_SIZE_PRESENT = 0x000200,\n\t\tSAMPLE_FLAGS_PRESENT = 0x000400,\n\t\tSAMPLE_COMPOSITION_TIME_OFFSET = 0x000800,\n\t}\n\n\texport interface TrackRunSample {\n\t\tduration?: number;\n\t\tsize?: number;\n\t\tflags?: number;\n\t\tcompositionTimeOffset?: number;\n\t}\n\n\texport class TrackRunBox extends FullBox {\n\t\tconstructor(flags: number,\n\t\t            public samples: TrackRunSample[],\n\t\t            public dataOffset?: number,\n\t\t            public firstSampleFlags?: number) {\n\t\t\tsuper('trun', 1, flags);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset) + 4;\n\t\t\tlet samplesCount = this.samples.length;\n\t\t\tlet flags = this.flags;\n\t\t\tif (!!(flags & TrackRunFlags.DATA_OFFSET_PRESENT)) {\n\t\t\t\tsize += 4;\n\t\t\t}\n\t\t\tif (!!(flags & TrackRunFlags.FIRST_SAMPLE_FLAGS_PRESENT)) {\n\t\t\t\tsize += 4;\n\t\t\t}\n\t\t\tif (!!(flags & TrackRunFlags.SAMPLE_DURATION_PRESENT)) {\n\t\t\t\tsize += 4 * samplesCount;\n\t\t\t}\n\t\t\tif (!!(flags & TrackRunFlags.SAMPLE_SIZE_PRESENT)) {\n\t\t\t\tsize += 4 * samplesCount;\n\t\t\t}\n\t\t\tif (!!(flags & TrackRunFlags.SAMPLE_FLAGS_PRESENT)) {\n\t\t\t\tsize += 4 * samplesCount;\n\t\t\t}\n\t\t\tif (!!(flags & TrackRunFlags.SAMPLE_COMPOSITION_TIME_OFFSET)) {\n\t\t\t\tsize += 4 * samplesCount;\n\t\t\t}\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\tlet samplesCount = this.samples.length;\n\t\t\tlet flags = this.flags;\n\t\t\twriteInt32(data, this.offset + offset, samplesCount);\n\t\t\toffset += 4;\n\t\t\tif (!!(flags & TrackRunFlags.DATA_OFFSET_PRESENT)) {\n\t\t\t\twriteInt32(data, this.offset + offset, this.dataOffset);\n\t\t\t\toffset += 4;\n\t\t\t}\n\t\t\tif (!!(flags & TrackRunFlags.FIRST_SAMPLE_FLAGS_PRESENT)) {\n\t\t\t\twriteInt32(data, this.offset + offset, this.firstSampleFlags);\n\t\t\t\toffset += 4;\n\t\t\t}\n\t\t\tfor (let i = 0; i < samplesCount; i++) {\n\t\t\t\tlet sample = this.samples[i];\n\t\t\t\tif (!!(flags & TrackRunFlags.SAMPLE_DURATION_PRESENT)) {\n\t\t\t\t\twriteInt32(data, this.offset + offset, sample.duration);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tif (!!(flags & TrackRunFlags.SAMPLE_SIZE_PRESENT)) {\n\t\t\t\t\twriteInt32(data, this.offset + offset, sample.size);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tif (!!(flags & TrackRunFlags.SAMPLE_FLAGS_PRESENT)) {\n\t\t\t\t\twriteInt32(data, this.offset + offset, sample.flags);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t\tif (!!(flags & TrackRunFlags.SAMPLE_COMPOSITION_TIME_OFFSET)) {\n\t\t\t\t\twriteInt32(data, this.offset + offset, sample.compositionTimeOffset);\n\t\t\t\t\toffset += 4;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class MovieFragmentBox extends BoxContainerBox {\n\t\tconstructor(public header: MovieFragmentHeaderBox,\n\t\t            public trafs: TrackFragmentBox[]) {\n\t\t\tsuper('moof', concatArrays<Box>([header], trafs));\n\t\t}\n\t}\n\n\texport class MediaDataBox extends Box {\n\t\tconstructor(public chunks: Uint8Array[]) {\n\t\t\tsuper('mdat');\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset);\n\t\t\tthis.chunks.forEach((chunk) => {\n\t\t\t\tsize += chunk.length;\n\t\t\t});\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\tthis.chunks.forEach((chunk) => {\n\t\t\t\tdata.set(chunk, this.offset + offset);\n\t\t\t\toffset += chunk.length;\n\t\t\t}, this);\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\n\texport class SampleEntry extends Box {\n\t\tconstructor(format: string,\n\t\t            public dataReferenceIndex: number) {\n\t\t\tsuper(format);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + 8;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, 0);\n\t\t\twriteInt32(data, this.offset + offset + 4, this.dataReferenceIndex);\n\t\t\treturn offset + 8;\n\t\t}\n\t}\n\n\texport class AudioSampleEntry extends SampleEntry {\n\t\tconstructor(codingName: string,\n\t\t            dataReferenceIndex: number,\n\t\t            public channelCount: number = 2,\n\t\t            public sampleSize: number = 16,\n\t\t            public sampleRate: number = 44100,\n\t\t            public otherBoxes: Box[] = null) {\n\t\t\tsuper(codingName, dataReferenceIndex);\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset) + 20;\n\t\t\tthis.otherBoxes && this.otherBoxes.forEach((box) => {\n\t\t\t\tsize += box.layout(offset + size);\n\t\t\t});\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, 0);\n\t\t\twriteInt32(data, this.offset + offset + 4, 0);\n\t\t\twriteInt32(data, this.offset + offset + 8, (this.channelCount << 16) | this.sampleSize);\n\t\t\twriteInt32(data, this.offset + offset + 12, 0);\n\t\t\twriteInt32(data, this.offset + offset + 16, (this.sampleRate << 16));\n\t\t\toffset += 20;\n\t\t\tthis.otherBoxes && this.otherBoxes.forEach((box) => {\n\t\t\t\toffset += box.write(data);\n\t\t\t});\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport let COLOR_NO_ALPHA_VIDEO_SAMPLE_DEPTH = 0x0018;\n\n\texport class VideoSampleEntry extends SampleEntry {\n\t\tconstructor(codingName: string,\n\t\t            dataReferenceIndex: number,\n\t\t            public width: number,\n\t\t            public height: number,\n\t\t            public compressorName: string = '',\n\t\t            public horizResolution: number = 72,\n\t\t            public vertResolution: number = 72,\n\t\t            public frameCount: number = 1,\n\t\t            public depth: number = COLOR_NO_ALPHA_VIDEO_SAMPLE_DEPTH,\n\t\t            public otherBoxes: Box[] = null) {\n\t\t\tsuper(codingName, dataReferenceIndex);\n\t\t\tif (compressorName.length > 31) {\n\t\t\t\tthrow new Error('invalid compressor name');\n\t\t\t}\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tlet size = super.layout(offset) + 16 + 12 + 4 + 2 + 32 + 2 + 2;\n\t\t\tthis.otherBoxes && this.otherBoxes.forEach((box) => {\n\t\t\t\tsize += box.layout(offset + size);\n\t\t\t});\n\t\t\treturn (this.size = size);\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\twriteInt32(data, this.offset + offset, 0);\n\t\t\twriteInt32(data, this.offset + offset + 4, 0);\n\t\t\twriteInt32(data, this.offset + offset + 8, 0);\n\t\t\twriteInt32(data, this.offset + offset + 12, 0);\n\t\t\toffset += 16;\n\t\t\twriteInt32(data, this.offset + offset, (this.width << 16) | this.height);\n\t\t\twriteInt32(data, this.offset + offset + 4, encodeFloat_16_16(this.horizResolution));\n\t\t\twriteInt32(data, this.offset + offset + 8, encodeFloat_16_16(this.vertResolution));\n\t\t\toffset += 12;\n\t\t\twriteInt32(data, this.offset + offset, 0);\n\t\t\twriteInt32(data, this.offset + offset + 4, (this.frameCount << 16));\n\t\t\toffset += 6; // weird offset\n\t\t\tdata[this.offset + offset] = this.compressorName.length;\n\t\t\tfor (let i = 0; i < 31; i++) {\n\t\t\t\tdata[this.offset + offset + i + 1] = i < this.compressorName.length ? (this.compressorName.charCodeAt(i) & 127) : 0;\n\t\t\t}\n\t\t\toffset += 32;\n\t\t\twriteInt32(data, this.offset + offset, (this.depth << 16) | 0xFFFF);\n\t\t\toffset += 4;\n\t\t\tthis.otherBoxes && this.otherBoxes.forEach((box) => {\n\t\t\t\toffset += box.write(data);\n\t\t\t});\n\t\t\treturn offset;\n\t\t}\n\t}\n\n\texport class RawTag extends Box {\n\t\tpublic data: Uint8Array;\n\n\t\tconstructor(type: string, data: Uint8Array) {\n\t\t\tsuper(type);\n\t\t\tthis.data = data;\n\t\t}\n\n\t\tpublic layout(offset: number): number {\n\t\t\tthis.size = super.layout(offset) + this.data.length;\n\t\t\treturn this.size;\n\t\t}\n\n\t\tpublic write(data: Uint8Array): number {\n\t\t\tlet offset = super.write(data);\n\t\t\tdata.set(this.data, this.offset + offset);\n\t\t\treturn offset + this.data.length;\n\t\t}\n\t}\n}\n","/**\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule RtmpJs.MP4 {\n\tfunction hex(s: string): Uint8Array {\n\t\tlet len = s.length >> 1;\n\t\tlet arr = new Uint8Array(len);\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tarr[i] = parseInt(s.substr(i * 2, 2), 16);\n\t\t}\n\t\treturn arr;\n\t}\n\n\tlet SOUNDRATES = [5500, 11025, 22050, 44100];\n\tlet SOUNDFORMATS = ['PCM', 'ADPCM', 'MP3', 'PCM le', 'Nellymouser16', 'Nellymouser8', 'Nellymouser', 'G.711 A-law', 'G.711 mu-law', null, 'AAC', 'Speex', 'MP3 8khz'];\n\tlet MP3_SOUND_CODEC_ID = 2;\n\tlet AAC_SOUND_CODEC_ID = 10;\n\n\tenum AudioPacketType {\n\t\tHEADER = 0,\n\t\tRAW = 1,\n\t}\n\n\tinterface AudioPacket {\n\t\tcodecDescription: string;\n\t\tcodecId: number;\n\t\tdata: Uint8Array;\n\t\trate: number;\n\t\tsize: number;\n\t\tchannels: number;\n\t\tsamples: number;\n\t\tpacketType: AudioPacketType;\n\t}\n\n\tfunction parseAudiodata(data: Uint8Array): AudioPacket {\n\t\tlet i = 0;\n\t\tlet packetType = AudioPacketType.RAW;\n\t\tlet flags = data[i];\n\t\tlet codecId = flags >> 4;\n\t\tlet soundRateId = (flags >> 2) & 3;\n\t\tlet sampleSize = (flags & 2) !==0 ? 16 : 8;\n\t\tlet channels = (flags & 1) !== 0 ? 2 : 1;\n\t\tlet samples: number;\n\t\ti++;\n\t\tswitch (codecId) {\n\t\t\tcase AAC_SOUND_CODEC_ID:\n\t\t\t\tlet type = data[i++];\n\t\t\t\tpacketType = <AudioPacketType>type;\n\t\t\t\tsamples = 1024; // AAC implementations typically represent 1024 PCM audio samples\n\t\t\t\tbreak;\n\t\t\tcase MP3_SOUND_CODEC_ID:\n\t\t\t\tlet version = (data[i + 1] >> 3) & 3; // 3 - MPEG 1\n\t\t\t\tlet layer = (data[i + 1] >> 1) & 3; // 3 - Layer I, 2 - II, 1 - III\n\t\t\t\tsamples = layer === 1 ? (version === 3 ? 1152 : 576) :\n\t\t\t\t\t(layer === 3 ? 384 : 1152);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn {\n\t\t\tcodecDescription: SOUNDFORMATS[codecId],\n\t\t\tcodecId: codecId,\n\t\t\tdata: data.subarray(i),\n\t\t\trate: SOUNDRATES[soundRateId],\n\t\t\tsize: sampleSize,\n\t\t\tchannels: channels,\n\t\t\tsamples: samples,\n\t\t\tpacketType: packetType\n\t\t};\n\t}\n\n\tlet VIDEOCODECS = [null, 'JPEG', 'Sorenson', 'Screen', 'VP6', 'VP6 alpha', 'Screen2', 'AVC'];\n\tlet VP6_VIDEO_CODEC_ID = 4;\n\tlet AVC_VIDEO_CODEC_ID = 7;\n\n\tenum VideoFrameType {\n\t\tKEY = 1,\n\t\tINNER = 2,\n\t\tDISPOSABLE = 3,\n\t\tGENERATED = 4,\n\t\tINFO = 5,\n\t}\n\n\tenum VideoPacketType {\n\t\tHEADER = 0,\n\t\tNALU = 1,\n\t\tEND = 2,\n\t}\n\n\tinterface VideoPacket {\n\t\tframeType: VideoFrameType;\n\t\tcodecId: number;\n\t\tcodecDescription: string;\n\t\tdata: Uint8Array;\n\t\tpacketType: VideoPacketType;\n\t\tcompositionTime: number;\n\t\thorizontalOffset?: number;\n\t\tverticalOffset?: number;\n\t}\n\n\tfunction parseVideodata(data: Uint8Array): VideoPacket {\n\t\tlet i = 0;\n\t\tlet frameType = data[i] >> 4;\n\t\tlet codecId = data[i] & 15;\n\t\ti++;\n\t\tlet result: any = {\n\t\t\tframeType: <VideoFrameType>frameType,\n\t\t\tcodecId: codecId,\n\t\t\tcodecDescription: VIDEOCODECS[codecId]\n\t\t};\n\t\tswitch (codecId) {\n\t\t\tcase AVC_VIDEO_CODEC_ID:\n\t\t\t\tlet type = data[i++];\n\t\t\t\tresult.packetType = <VideoPacketType>type;\n\t\t\t\tresult.compositionTime = ((data[i] << 24) | (data[i + 1] << 16) | (data[i + 2] << 8)) >> 8;\n\t\t\t\ti += 3;\n\t\t\t\tbreak;\n\t\t\tcase VP6_VIDEO_CODEC_ID:\n\t\t\t\tresult.packetType = VideoPacketType.NALU;\n\t\t\t\tresult.horizontalOffset = (data[i] >> 4) & 15;\n\t\t\t\tresult.verticalOffset = data[i] & 15;\n\t\t\t\tresult.compositionTime = 0;\n\t\t\t\ti++;\n\t\t\t\tbreak;\n\t\t}\n\t\tresult.data = data.subarray(i);\n\t\treturn result;\n\t}\n\n\tlet AUDIO_PACKET = 8;\n\tlet VIDEO_PACKET = 9;\n\tlet MAX_PACKETS_IN_CHUNK = 200;\n\tlet SPLIT_AT_KEYFRAMES = false;\n\n\tinterface CachedPacket {\n\t\tpacket: any;\n\t\ttimestamp: number;\n\t\ttrackId: number;\n\t}\n\n\texport interface MP4Track {\n\t\tcodecDescription?: string;\n\t\tcodecId: number;\n\t\tlanguage: string;\n\t\ttimescale: number;\n\n\t\tsamplerate?: number;\n\t\tchannels?: number;\n\t\tsamplesize?: number;\n\n\t\tframerate?: number;\n\t\twidth?: number;\n\t\theight?: number;\n\t}\n\n\texport interface MP4Metadata {\n\t\ttracks: MP4Track[];\n\t\tduration: number;\n\t\taudioTrackId: number;\n\t\tvideoTrackId: number;\n\t}\n\n\tenum MP4MuxState {\n\t\tCAN_GENERATE_HEADER = 0,\n\t\tNEED_HEADER_DATA = 1,\n\t\tMAIN_PACKETS = 2\n\t}\n\n\tinterface MP4TrackState {\n\t\ttrackId: number;\n\t\ttrackInfo: MP4Track;\n\t\tcachedDuration: number;\n\t\tsamplesProcessed: number;\n\t\tinitializationData: Uint8Array[];\n\t\tmimeTypeCodec?: string;\n\t}\n\n\texport class MP4Mux {\n\t\tprivate metadata: MP4Metadata;\n\n\t\tprivate filePos: number;\n\t\tprivate cachedPackets: CachedPacket[];\n\t\tprivate trackStates: MP4TrackState[];\n\t\tprivate audioTrackState: MP4TrackState;\n\t\tprivate videoTrackState: MP4TrackState;\n\t\tprivate state: MP4MuxState;\n\t\tprivate chunkIndex: number;\n\n\t\toncodecinfo: (codecs: string[]) => void = function (codecs: string[]) {\n\t\t\t//\n\t\t};\n\n\t\tondata: (data: any) => void = function (data) {\n\t\t\tthrow new Error('MP4Mux.ondata is not set');\n\t\t};\n\n\t\tpublic constructor(metadata: MP4Metadata) {\n\t\t\tthis.metadata = metadata;\n\n\t\t\tthis.trackStates = this.metadata.tracks.map((t, index) => {\n\t\t\t\tlet state = {\n\t\t\t\t\ttrackId: index + 1,\n\t\t\t\t\ttrackInfo: t,\n\t\t\t\t\tcachedDuration: 0,\n\t\t\t\t\tsamplesProcessed: 0,\n\t\t\t\t\tinitializationData: [] as any\n\t\t\t\t};\n\t\t\t\tif (this.metadata.audioTrackId === index) {\n\t\t\t\t\tthis.audioTrackState = state;\n\t\t\t\t}\n\t\t\t\tif (this.metadata.videoTrackId === index) {\n\t\t\t\t\tthis.videoTrackState = state;\n\t\t\t\t}\n\t\t\t\treturn state;\n\t\t\t}, this);\n\n\t\t\tthis._checkIfNeedHeaderData();\n\n\t\t\tthis.filePos = 0;\n\t\t\tthis.cachedPackets = [];\n\t\t\tthis.chunkIndex = 0;\n\t\t}\n\n\t\tpublic pushPacket(type: number, data: Uint8Array, timestamp: number) {\n\t\t\tif (this.state === MP4MuxState.CAN_GENERATE_HEADER) {\n\t\t\t\tthis._tryGenerateHeader();\n\t\t\t}\n\n\t\t\tswitch (type) {\n\t\t\t\tcase AUDIO_PACKET: // audio\n\t\t\t\t\tlet audioTrack = this.audioTrackState;\n\t\t\t\t\tlet audioPacket = parseAudiodata(data);\n\t\t\t\t\tif (!audioTrack || audioTrack.trackInfo.codecId !== audioPacket.codecId) {\n\t\t\t\t\t\tthrow new Error('Unexpected audio packet codec: ' + audioPacket.codecDescription);\n\t\t\t\t\t}\n\t\t\t\t\tswitch (audioPacket.codecId) {\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error('Unsupported audio codec: ' + audioPacket.codecDescription);\n\t\t\t\t\t\tcase MP3_SOUND_CODEC_ID:\n\t\t\t\t\t\t\tbreak; // supported codec\n\t\t\t\t\t\tcase AAC_SOUND_CODEC_ID:\n\t\t\t\t\t\t\tif (audioPacket.packetType === AudioPacketType.HEADER) {\n\t\t\t\t\t\t\t\taudioTrack.initializationData.push(audioPacket.data);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tthis.cachedPackets.push({packet: audioPacket, timestamp: timestamp, trackId: audioTrack.trackId});\n\t\t\t\t\tbreak;\n\t\t\t\tcase VIDEO_PACKET:\n\t\t\t\t\tlet videoTrack = this.videoTrackState;\n\t\t\t\t\tlet videoPacket = parseVideodata(data);\n\t\t\t\t\tif (!videoTrack || videoTrack.trackInfo.codecId !== videoPacket.codecId) {\n\t\t\t\t\t\tthrow new Error('Unexpected video packet codec: ' + videoPacket.codecDescription);\n\t\t\t\t\t}\n\t\t\t\t\tswitch (videoPacket.codecId) {\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error('unsupported video codec: ' + videoPacket.codecDescription);\n\t\t\t\t\t\tcase VP6_VIDEO_CODEC_ID:\n\t\t\t\t\t\t\tbreak; // supported\n\t\t\t\t\t\tcase AVC_VIDEO_CODEC_ID:\n\t\t\t\t\t\t\tif (videoPacket.packetType === VideoPacketType.HEADER) {\n\t\t\t\t\t\t\t\tvideoTrack.initializationData.push(videoPacket.data);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tthis.cachedPackets.push({packet: videoPacket, timestamp: timestamp, trackId: videoTrack.trackId});\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('unknown packet type: ' + type);\n\t\t\t}\n\n\t\t\tif (this.state === MP4MuxState.NEED_HEADER_DATA) {\n\t\t\t\tthis._tryGenerateHeader();\n\t\t\t}\n\t\t\tif (this.cachedPackets.length >= MAX_PACKETS_IN_CHUNK &&\n\t\t\t\tthis.state === MP4MuxState.MAIN_PACKETS) {\n\t\t\t\tthis._chunk();\n\t\t\t}\n\t\t}\n\n\t\tpublic flush() {\n\t\t\tif (this.cachedPackets.length > 0) {\n\t\t\t\tthis._chunk();\n\t\t\t}\n\t\t}\n\n\t\tprivate _checkIfNeedHeaderData() {\n\t\t\tif (this.trackStates.some((ts) =>\n\t\t\t\t\tts.trackInfo.codecId === AAC_SOUND_CODEC_ID || ts.trackInfo.codecId === AVC_VIDEO_CODEC_ID)) {\n\t\t\t\tthis.state = MP4MuxState.NEED_HEADER_DATA;\n\t\t\t} else {\n\t\t\t\tthis.state = MP4MuxState.CAN_GENERATE_HEADER;\n\t\t\t}\n\t\t}\n\n\t\tprivate _tryGenerateHeader() {\n\t\t\tlet allInitializationDataExists = this.trackStates.every((ts) => {\n\t\t\t\tswitch (ts.trackInfo.codecId) {\n\t\t\t\t\tcase AAC_SOUND_CODEC_ID:\n\t\t\t\t\tcase AVC_VIDEO_CODEC_ID:\n\t\t\t\t\t\treturn ts.initializationData.length > 0;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!allInitializationDataExists) {\n\t\t\t\treturn; // not enough data, waiting more\n\t\t\t}\n\n\t\t\tlet brands: string[] = ['isom'];\n\t\t\tlet audioDataReferenceIndex = 1, videoDataReferenceIndex = 1;\n\t\t\tlet traks: Iso.TrackBox[] = [];\n\t\t\tfor (let i = 0; i < this.trackStates.length; i++) {\n\t\t\t\tlet trackState = this.trackStates[i];\n\t\t\t\tlet trackInfo = trackState.trackInfo;\n\t\t\t\tlet sampleEntry: Iso.SampleEntry;\n\t\t\t\tswitch (trackInfo.codecId) {\n\t\t\t\t\tcase AAC_SOUND_CODEC_ID:\n\t\t\t\t\t\tlet audioSpecificConfig = trackState.initializationData[0];\n\t\t\t\t\t\tsampleEntry = new Iso.AudioSampleEntry('mp4a', audioDataReferenceIndex, trackInfo.channels, trackInfo.samplesize, trackInfo.samplerate);\n\n\t\t\t\t\t\tlet esdsData = new Uint8Array(41 + audioSpecificConfig.length);\n\t\t\t\t\t\tesdsData.set(hex('0000000003808080'), 0);\n\t\t\t\t\t\tesdsData[8] = 32 + audioSpecificConfig.length;\n\t\t\t\t\t\tesdsData.set(hex('00020004808080'), 9);\n\t\t\t\t\t\tesdsData[16] = 18 + audioSpecificConfig.length;\n\t\t\t\t\t\tesdsData.set(hex('40150000000000FA000000000005808080'), 17);\n\t\t\t\t\t\tesdsData[34] = audioSpecificConfig.length;\n\t\t\t\t\t\tesdsData.set(audioSpecificConfig, 35);\n\t\t\t\t\t\tesdsData.set(hex('068080800102'), 35 + audioSpecificConfig.length);\n\t\t\t\t\t\t(<Iso.AudioSampleEntry>sampleEntry).otherBoxes = [\n\t\t\t\t\t\t\tnew Iso.RawTag('esds', esdsData)\n\t\t\t\t\t\t];\n\t\t\t\t\t\tlet objectType = (audioSpecificConfig[0] >> 3); // TODO 31\n\t\t\t\t\t\t// mp4a.40.objectType\n\t\t\t\t\t\ttrackState.mimeTypeCodec = 'mp4a.40.' + objectType;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MP3_SOUND_CODEC_ID:\n\t\t\t\t\t\tsampleEntry = new Iso.AudioSampleEntry('.mp3', audioDataReferenceIndex, trackInfo.channels, trackInfo.samplesize, trackInfo.samplerate);\n\t\t\t\t\t\ttrackState.mimeTypeCodec = 'mp3';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase AVC_VIDEO_CODEC_ID:\n\t\t\t\t\t\tlet avcC = trackState.initializationData[0];\n\t\t\t\t\t\tsampleEntry = new Iso.VideoSampleEntry('avc1', videoDataReferenceIndex, trackInfo.width, trackInfo.height);\n\t\t\t\t\t\t(<Iso.VideoSampleEntry>sampleEntry).otherBoxes = [\n\t\t\t\t\t\t\tnew Iso.RawTag('avcC', avcC)\n\t\t\t\t\t\t];\n\t\t\t\t\t\tlet codecProfile = (avcC[1] << 16) | (avcC[2] << 8) | avcC[3];\n\t\t\t\t\t\t// avc1.XXYYZZ -- XX - profile + YY - constraints + ZZ - level\n\t\t\t\t\t\ttrackState.mimeTypeCodec = 'avc1.' + (0x1000000 | codecProfile).toString(16).substr(1);\n\t\t\t\t\t\tbrands.push('iso2', 'avc1', 'mp41');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase VP6_VIDEO_CODEC_ID:\n\t\t\t\t\t\tsampleEntry = new Iso.VideoSampleEntry('VP6F', videoDataReferenceIndex, trackInfo.width, trackInfo.height);\n\t\t\t\t\t\t(<Iso.VideoSampleEntry>sampleEntry).otherBoxes = [\n\t\t\t\t\t\t\tnew Iso.RawTag('glbl', hex('00'))\n\t\t\t\t\t\t];\n\t\t\t\t\t\t// TODO to lie about codec to get it playing in MSE?\n\t\t\t\t\t\ttrackState.mimeTypeCodec = 'avc1.42001E';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error('not supported track type');\n\t\t\t\t}\n\n\t\t\t\tlet trak;\n\t\t\t\tlet trakFlags = Iso.TrackHeaderFlags.TRACK_ENABLED | Iso.TrackHeaderFlags.TRACK_IN_MOVIE;\n\t\t\t\tif (trackState === this.audioTrackState) {\n\t\t\t\t\ttrak = new Iso.TrackBox(\n\t\t\t\t\t\tnew Iso.TrackHeaderBox(trakFlags, trackState.trackId, -1, 0 /*width*/, 0 /*height*/, 1.0, i),\n\t\t\t\t\t\tnew Iso.MediaBox(\n\t\t\t\t\t\t\tnew Iso.MediaHeaderBox(trackInfo.timescale, -1, trackInfo.language),\n\t\t\t\t\t\t\tnew Iso.HandlerBox('soun', 'SoundHandler'),\n\t\t\t\t\t\t\tnew Iso.MediaInformationBox(\n\t\t\t\t\t\t\t\tnew Iso.SoundMediaHeaderBox(),\n\t\t\t\t\t\t\t\tnew Iso.DataInformationBox(\n\t\t\t\t\t\t\t\t\tnew Iso.DataReferenceBox([new Iso.DataEntryUrlBox(Iso.SELF_CONTAINED_DATA_REFERENCE_FLAG)])),\n\t\t\t\t\t\t\t\tnew Iso.SampleTableBox(\n\t\t\t\t\t\t\t\t\tnew Iso.SampleDescriptionBox([sampleEntry]),\n\t\t\t\t\t\t\t\t\tnew Iso.RawTag('stts', hex('0000000000000000')),\n\t\t\t\t\t\t\t\t\tnew Iso.RawTag('stsc', hex('0000000000000000')),\n\t\t\t\t\t\t\t\t\tnew Iso.RawTag('stsz', hex('000000000000000000000000')),\n\t\t\t\t\t\t\t\t\tnew Iso.RawTag('stco', hex('0000000000000000'))\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t} else if (trackState === this.videoTrackState) {\n\t\t\t\t\ttrak = new Iso.TrackBox(\n\t\t\t\t\t\tnew Iso.TrackHeaderBox(trakFlags, trackState.trackId, -1, trackInfo.width, trackInfo.height, 0 /* volume */, i),\n\t\t\t\t\t\tnew Iso.MediaBox(\n\t\t\t\t\t\t\tnew Iso.MediaHeaderBox(trackInfo.timescale, -1, trackInfo.language),\n\t\t\t\t\t\t\tnew Iso.HandlerBox('vide', 'VideoHandler'),\n\t\t\t\t\t\t\tnew Iso.MediaInformationBox(\n\t\t\t\t\t\t\t\tnew Iso.VideoMediaHeaderBox(),\n\t\t\t\t\t\t\t\tnew Iso.DataInformationBox(\n\t\t\t\t\t\t\t\t\tnew Iso.DataReferenceBox([new Iso.DataEntryUrlBox(Iso.SELF_CONTAINED_DATA_REFERENCE_FLAG)])),\n\t\t\t\t\t\t\t\tnew Iso.SampleTableBox(\n\t\t\t\t\t\t\t\t\tnew Iso.SampleDescriptionBox([sampleEntry]),\n\t\t\t\t\t\t\t\t\tnew Iso.RawTag('stts', hex('0000000000000000')),\n\t\t\t\t\t\t\t\t\tnew Iso.RawTag('stsc', hex('0000000000000000')),\n\t\t\t\t\t\t\t\t\tnew Iso.RawTag('stsz', hex('000000000000000000000000')),\n\t\t\t\t\t\t\t\t\tnew Iso.RawTag('stco', hex('0000000000000000'))\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\ttraks.push(trak);\n\t\t\t}\n\n\t\t\tlet mvex = new Iso.MovieExtendsBox(null, [\n\t\t\t\tnew Iso.TrackExtendsBox(1, 1, 0, 0, 0),\n\t\t\t\tnew Iso.TrackExtendsBox(2, 1, 0, 0, 0)\n\t\t\t], null);\n\t\t\tlet udat = new Iso.BoxContainerBox('udat', [\n\t\t\t\tnew Iso.MetaBox(\n\t\t\t\t\tnew Iso.RawTag('hdlr', hex('00000000000000006D6469726170706C000000000000000000')), // notice weird stuff in reserved field\n\t\t\t\t\t[new Iso.RawTag('ilst', hex('00000025A9746F6F0000001D6461746100000001000000004C61766635342E36332E313034'))]\n\t\t\t\t)\n\t\t\t]);\n\t\t\tlet mvhd = new Iso.MovieHeaderBox(1000, 0 /* unknown duration */, this.trackStates.length + 1);\n\t\t\tlet moov = new Iso.MovieBox(mvhd, traks, mvex, udat);\n\t\t\tlet ftype = new Iso.FileTypeBox('isom', 0x00000200, brands);\n\n\t\t\tlet ftypeSize = ftype.layout(0);\n\t\t\tlet moovSize = moov.layout(ftypeSize);\n\n\t\t\tlet header = new Uint8Array(ftypeSize + moovSize);\n\t\t\tftype.write(header);\n\t\t\tmoov.write(header);\n\n\t\t\tthis.oncodecinfo(this.trackStates.map((ts) => ts.mimeTypeCodec));\n\t\t\tthis.ondata(header);\n\t\t\tthis.filePos += header.length;\n\t\t\tthis.state = MP4MuxState.MAIN_PACKETS;\n\t\t}\n\n\t\t_chunk() {\n\t\t\tlet cachedPackets = this.cachedPackets;\n\n\t\t\tif (SPLIT_AT_KEYFRAMES) {\n\t\t\t\tlet j = cachedPackets.length - 1;\n\t\t\t\tlet videoTrackId = this.videoTrackState.trackId;\n\t\t\t\t// Finding last video keyframe.\n\t\t\t\twhile (j > 0 &&\n\t\t\t\t(cachedPackets[j].trackId !== videoTrackId || cachedPackets[j].packet.frameType !== VideoFrameType.KEY)) {\n\t\t\t\t\tj--;\n\t\t\t\t}\n\t\t\t\tif (j > 0) {\n\t\t\t\t\t// We have keyframes and not only the first frame is a keyframe...\n\t\t\t\t\tcachedPackets = cachedPackets.slice(0, j);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (cachedPackets.length === 0) {\n\t\t\t\treturn; // No data to produce.\n\t\t\t}\n\n\t\t\tlet tdatParts: Uint8Array[] = [];\n\t\t\tlet tdatPosition: number = 0;\n\t\t\tlet trafs: Iso.TrackFragmentBox[] = [];\n\t\t\tlet trafDataStarts: number[] = [];\n\n\t\t\tfor (let i = 0; i < this.trackStates.length; i++) {\n\t\t\t\tlet trackState = this.trackStates[i];\n\t\t\t\tlet trackInfo = trackState.trackInfo;\n\t\t\t\tlet trackId = trackState.trackId;\n\n\t\t\t\t// Finding all packets for this track.\n\t\t\t\tlet trackPackets = cachedPackets.filter((cp) => cp.trackId === trackId);\n\t\t\t\tif (trackPackets.length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t//let currentTimestamp = (trackPackets[0].timestamp * trackInfo.timescale / 1000) | 0;\n\t\t\t\tlet tfdt = new Iso.TrackFragmentBaseMediaDecodeTimeBox(trackState.cachedDuration);\n\t\t\t\tlet tfhd: Iso.TrackFragmentHeaderBox;\n\t\t\t\tlet trun: Iso.TrackRunBox;\n\t\t\t\tlet trunSamples: Iso.TrackRunSample[];\n\t\t\t\tlet tfhdFlags: number, trunFlags: number;\n\n\t\t\t\ttrafDataStarts.push(tdatPosition);\n\t\t\t\tswitch (trackInfo.codecId) {\n\t\t\t\t\tcase AAC_SOUND_CODEC_ID:\n\t\t\t\t\tcase MP3_SOUND_CODEC_ID:\n\t\t\t\t\t\ttrunSamples = [];\n\t\t\t\t\t\tfor (let j = 0; j < trackPackets.length; j++) {\n\t\t\t\t\t\t\tlet audioPacket: AudioPacket = trackPackets[j].packet;\n\t\t\t\t\t\t\tlet audioFrameDuration = Math.round(audioPacket.samples * trackInfo.timescale / trackInfo.samplerate);\n\t\t\t\t\t\t\ttdatParts.push(audioPacket.data);\n\t\t\t\t\t\t\ttdatPosition += audioPacket.data.length;\n\t\t\t\t\t\t\ttrunSamples.push({duration: audioFrameDuration, size: audioPacket.data.length});\n\t\t\t\t\t\t\ttrackState.samplesProcessed += audioPacket.samples;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttfhdFlags = Iso.TrackFragmentFlags.DEFAULT_SAMPLE_FLAGS_PRESENT;\n\t\t\t\t\t\ttfhd = new Iso.TrackFragmentHeaderBox(tfhdFlags, trackId, 0 /* offset */, 0 /* index */, 0 /* duration */, 0 /* size */, Iso.SampleFlags.SAMPLE_DEPENDS_ON_NO_OTHERS);\n\t\t\t\t\t\ttrunFlags = Iso.TrackRunFlags.DATA_OFFSET_PRESENT |\n\t\t\t\t\t\t\tIso.TrackRunFlags.SAMPLE_DURATION_PRESENT | Iso.TrackRunFlags.SAMPLE_SIZE_PRESENT;\n\t\t\t\t\t\ttrun = new Iso.TrackRunBox(trunFlags, trunSamples, 0 /* data offset */, 0 /* first flags */);\n\t\t\t\t\t\ttrackState.cachedDuration = Math.round(trackState.samplesProcessed * trackInfo.timescale / trackInfo.samplerate);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase AVC_VIDEO_CODEC_ID:\n\t\t\t\t\tcase VP6_VIDEO_CODEC_ID:\n\t\t\t\t\t\ttrunSamples = [];\n\t\t\t\t\t\tlet samplesProcessed = trackState.samplesProcessed;\n\t\t\t\t\t\tlet decodeTime = samplesProcessed * trackInfo.timescale / trackInfo.framerate;\n\t\t\t\t\t\tlet lastTime = Math.round(decodeTime);\n\t\t\t\t\t\tfor (let j = 0; j < trackPackets.length; j++) {\n\t\t\t\t\t\t\tlet videoPacket: VideoPacket = trackPackets[j].packet;\n\t\t\t\t\t\t\tsamplesProcessed++;\n\t\t\t\t\t\t\tlet nextTime = Math.round(samplesProcessed * trackInfo.timescale / trackInfo.framerate);\n\t\t\t\t\t\t\tlet videoFrameDuration = nextTime - lastTime;\n\t\t\t\t\t\t\tlastTime = nextTime;\n\t\t\t\t\t\t\tlet compositionTime = Math.round(samplesProcessed * trackInfo.timescale / trackInfo.framerate +\n\t\t\t\t\t\t\t\tvideoPacket.compositionTime * trackInfo.timescale / 1000);\n\n\t\t\t\t\t\t\ttdatParts.push(videoPacket.data);\n\t\t\t\t\t\t\ttdatPosition += videoPacket.data.length;\n\t\t\t\t\t\t\tlet frameFlags = videoPacket.frameType === VideoFrameType.KEY ?\n\t\t\t\t\t\t\t\tIso.SampleFlags.SAMPLE_DEPENDS_ON_NO_OTHERS :\n\t\t\t\t\t\t\t\t(Iso.SampleFlags.SAMPLE_DEPENDS_ON_OTHER | Iso.SampleFlags.SAMPLE_IS_NOT_SYNC);\n\t\t\t\t\t\t\ttrunSamples.push({\n\t\t\t\t\t\t\t\tduration: videoFrameDuration, size: videoPacket.data.length,\n\t\t\t\t\t\t\t\tflags: frameFlags, compositionTimeOffset: (compositionTime - nextTime)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttfhdFlags = Iso.TrackFragmentFlags.DEFAULT_SAMPLE_FLAGS_PRESENT;\n\t\t\t\t\t\ttfhd = new Iso.TrackFragmentHeaderBox(tfhdFlags, trackId, 0 /* offset */, 0 /* index */, 0 /* duration */, 0 /* size */, Iso.SampleFlags.SAMPLE_DEPENDS_ON_NO_OTHERS);\n\t\t\t\t\t\ttrunFlags = Iso.TrackRunFlags.DATA_OFFSET_PRESENT |\n\t\t\t\t\t\t\tIso.TrackRunFlags.SAMPLE_DURATION_PRESENT | Iso.TrackRunFlags.SAMPLE_SIZE_PRESENT |\n\t\t\t\t\t\t\tIso.TrackRunFlags.SAMPLE_FLAGS_PRESENT | Iso.TrackRunFlags.SAMPLE_COMPOSITION_TIME_OFFSET;\n\t\t\t\t\t\ttrun = new Iso.TrackRunBox(trunFlags, trunSamples, 0 /* data offset */, 0 /* first flag */);\n\t\t\t\t\t\ttrackState.cachedDuration = lastTime;\n\t\t\t\t\t\ttrackState.samplesProcessed = samplesProcessed;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error('Un codec');\n\t\t\t\t}\n\n\t\t\t\tlet traf = new Iso.TrackFragmentBox(tfhd, tfdt, trun);\n\t\t\t\ttrafs.push(traf);\n\t\t\t}\n\t\t\tthis.cachedPackets.splice(0, cachedPackets.length);\n\n\t\t\tlet moofHeader = new Iso.MovieFragmentHeaderBox(++this.chunkIndex);\n\t\t\tlet moof = new Iso.MovieFragmentBox(moofHeader, trafs);\n\t\t\tlet moofSize = moof.layout(0);\n\t\t\tlet mdat = new Iso.MediaDataBox(tdatParts);\n\t\t\tlet mdatSize = mdat.layout(moofSize);\n\n\t\t\tlet tdatOffset = moofSize + 8 /* 'mdat' header size */;\n\t\t\tfor (let i = 0; i < trafs.length; i++) {\n\t\t\t\ttrafs[i].run.dataOffset = tdatOffset + trafDataStarts[i];\n\t\t\t}\n\n\t\t\tlet chunk = new Uint8Array(moofSize + mdatSize);\n\t\t\tmoof.write(chunk);\n\t\t\tmdat.write(chunk);\n\n\t\t\tthis.ondata(chunk);\n\t\t\tthis.filePos += chunk.length;\n\t\t}\n\t}\n\n\texport function parseFLVMetadata(metadata: any): MP4Metadata {\n\t\tlet tracks: MP4Track[] = [];\n\t\tlet audioTrackId = -1;\n\t\tlet videoTrackId = -1;\n\n\t\tlet duration = +metadata.axGetPublicProperty('duration');\n\n\t\tlet audioCodec, audioCodecId;\n\t\tlet audioCodecCode = metadata.axGetPublicProperty('audiocodecid');\n\t\tswitch (audioCodecCode) {\n\t\t\tcase MP3_SOUND_CODEC_ID:\n\t\t\tcase 'mp3':\n\t\t\t\taudioCodec = 'mp3';\n\t\t\t\taudioCodecId = MP3_SOUND_CODEC_ID;\n\t\t\t\tbreak;\n\t\t\tcase AAC_SOUND_CODEC_ID:\n\t\t\tcase 'mp4a':\n\t\t\t\taudioCodec = 'mp4a';\n\t\t\t\taudioCodecId = AAC_SOUND_CODEC_ID;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (!isNaN(audioCodecCode)) {\n\t\t\t\t\tthrow new Error('Unsupported audio codec: ' + audioCodecCode);\n\t\t\t\t}\n\t\t\t\taudioCodec = null;\n\t\t\t\taudioCodecId = -1;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlet videoCodec, videoCodecId;\n\t\tlet videoCodecCode = metadata.axGetPublicProperty('videocodecid');\n\t\tswitch (videoCodecCode) {\n\t\t\tcase VP6_VIDEO_CODEC_ID:\n\t\t\tcase 'vp6f':\n\t\t\t\tvideoCodec = 'vp6f';\n\t\t\t\tvideoCodecId = VP6_VIDEO_CODEC_ID;\n\t\t\t\tbreak;\n\t\t\tcase AVC_VIDEO_CODEC_ID:\n\t\t\tcase 'avc1':\n\t\t\t\tvideoCodec = 'avc1';\n\t\t\t\tvideoCodecId = AVC_VIDEO_CODEC_ID;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (!isNaN(videoCodecCode)) {\n\t\t\t\t\tthrow new Error('Unsupported video codec: ' + videoCodecCode);\n\t\t\t\t}\n\t\t\t\tvideoCodec = null;\n\t\t\t\tvideoCodecId = -1;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlet audioTrack: MP4Track = (audioCodec === null) ? null : {\n\t\t\tcodecDescription: audioCodec,\n\t\t\tcodecId: audioCodecId,\n\t\t\tlanguage: 'und',\n\t\t\ttimescale: +metadata.axGetPublicProperty('audiosamplerate') || 44100,\n\t\t\tsamplerate: +metadata.axGetPublicProperty('audiosamplerate') || 44100,\n\t\t\tchannels: +metadata.axGetPublicProperty('audiochannels') || 2,\n\t\t\tsamplesize: 16\n\t\t};\n\t\tlet videoTrack: MP4Track = (videoCodec === null) ? null : {\n\t\t\tcodecDescription: videoCodec,\n\t\t\tcodecId: videoCodecId,\n\t\t\tlanguage: 'und',\n\t\t\ttimescale: 60000,\n\t\t\tframerate: +metadata.axGetPublicProperty('videoframerate') ||\n\t\t\t+metadata.axGetPublicProperty('framerate'),\n\t\t\twidth: +metadata.axGetPublicProperty('width'),\n\t\t\theight: +metadata.axGetPublicProperty('height')\n\t\t};\n\n\t\tlet trackInfos = metadata.axGetPublicProperty('trackinfo');\n\t\tif (trackInfos) {\n\t\t\t// Not in the Adobe's references, red5 specific?\n\t\t\tfor (let i = 0; i < trackInfos.length; i++) {\n\t\t\t\tlet info = trackInfos[i];\n\t\t\t\tlet sampleDescription = info.axGetPublicProperty('sampledescription')[0];\n\t\t\t\tif (sampleDescription.axGetPublicProperty('sampletype') === audioCodecCode) {\n\t\t\t\t\taudioTrack.language = info.axGetPublicProperty('language');\n\t\t\t\t\taudioTrack.timescale = +info.axGetPublicProperty('timescale');\n\t\t\t\t} else if (sampleDescription.axGetPublicProperty('sampletype') === videoCodecCode) {\n\t\t\t\t\tvideoTrack.language = info.axGetPublicProperty('language');\n\t\t\t\t\tvideoTrack.timescale = +info.axGetPublicProperty('timescale');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (videoTrack) {\n\t\t\tvideoTrackId = tracks.length;\n\t\t\ttracks.push(videoTrack);\n\t\t}\n\t\tif (audioTrack) {\n\t\t\taudioTrackId = tracks.length;\n\t\t\ttracks.push(audioTrack);\n\t\t}\n\n\t\treturn {\n\t\t\ttracks: tracks,\n\t\t\tduration: duration,\n\t\t\taudioTrackId: audioTrackId,\n\t\t\tvideoTrackId: videoTrackId\n\t\t};\n\t}\n}\n","/**\n * Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule RtmpJs.FLV {\n\texport interface FLVHeader {\n\t\thasAudio: boolean;\n\t\thasVideo: boolean;\n\t\textra: Uint8Array;\n\t}\n\n\texport interface FLVTag {\n\t\ttype: number;\n\t\tneedPreprocessing: boolean;\n\t\ttimestamp: number;\n\t\tdata: Uint8Array;\n\t}\n\n\texport class FLVParser {\n\t\tprivate state: number = 0;\n\t\tprivate buffer: ArrayBuffer;\n\t\tprivate bufferSize: number;\n\t\tprivate previousTagSize: number;\n\n\t\tpublic onHeader: (header: FLVHeader) => void;\n\t\tpublic onTag: (tag: FLVTag) => void;\n\t\tpublic onClose: () => void;\n\t\tpublic onError: (error: any) => void;\n\n\t\tpublic constructor() {\n\t\t\tthis.state = 0;\n\t\t\tthis.buffer = new ArrayBuffer(1024);\n\t\t\tthis.bufferSize = 0;\n\t\t\tthis.previousTagSize = 0;\n\t\t\tthis.onError = null;\n\t\t\tthis.onHeader = null;\n\t\t\tthis.onTag = null;\n\t\t\tthis.onClose = null;\n\t\t}\n\n\t\tpublic push(data: Uint8Array) {\n\t\t\tlet parseBuffer;\n\t\t\tif (this.bufferSize > 0) {\n\t\t\t\tlet needLength = this.bufferSize + data.length;\n\t\t\t\tif (this.buffer.byteLength < needLength) {\n\t\t\t\t\tlet tmp = new Uint8Array(this.buffer, 0, this.bufferSize);\n\t\t\t\t\tthis.buffer = new ArrayBuffer(needLength);\n\t\t\t\t\tparseBuffer = new Uint8Array(this.buffer);\n\t\t\t\t\tparseBuffer.set(tmp);\n\t\t\t\t} else {\n\t\t\t\t\tparseBuffer = new Uint8Array(this.buffer, 0, needLength);\n\t\t\t\t}\n\t\t\t\tparseBuffer.set(data, this.bufferSize);\n\t\t\t} else {\n\t\t\t\tparseBuffer = data;\n\t\t\t}\n\n\t\t\tlet parsed = 0, end = parseBuffer.length;\n\t\t\twhile (parsed < end) {\n\t\t\t\tlet chunkParsed = 0;\n\t\t\t\tlet flags: number;\n\t\t\t\tswitch (this.state) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tif (parsed + 9 > end) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet headerLength =\n\t\t\t\t\t\t\t(parseBuffer[parsed + 5] << 24) | (parseBuffer[parsed + 6] << 16) |\n\t\t\t\t\t\t\t(parseBuffer[parsed + 7] << 8) | parseBuffer[parsed + 8];\n\t\t\t\t\t\tif (headerLength < 9) {\n\t\t\t\t\t\t\tthis._error('Invalid header length');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (parsed + headerLength > end) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (parseBuffer[parsed] !== 0x46 /* F */ ||\n\t\t\t\t\t\t\tparseBuffer[parsed + 1] !== 0x4C /* L */ ||\n\t\t\t\t\t\t\tparseBuffer[parsed + 2] !== 0x56 /* V */ ||\n\t\t\t\t\t\t\tparseBuffer[parsed + 3] !== 1 /* version 1 */ ||\n\t\t\t\t\t\t\t(parseBuffer[parsed + 4] & 0xFA) !== 0) {\n\t\t\t\t\t\t\tthis._error('Invalid FLV header');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tflags = parseBuffer[parsed + 4];\n\t\t\t\t\t\tlet extra = headerLength > 9 ? parseBuffer.subarray(parsed + 9, parsed + headerLength) : null;\n\n\t\t\t\t\t\tthis.onHeader && this.onHeader({\n\t\t\t\t\t\t\thasAudio: !!(flags & 4),\n\t\t\t\t\t\t\thasVideo: !!(flags & 1),\n\t\t\t\t\t\t\textra: extra\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.state = 2;\n\t\t\t\t\t\tchunkParsed = headerLength;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tif (parsed + 4 + 11 > end) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet previousTagSize =\n\t\t\t\t\t\t\t(parseBuffer[parsed + 0] << 24) | (parseBuffer[parsed + 1] << 16) |\n\t\t\t\t\t\t\t(parseBuffer[parsed + 2] << 8) | parseBuffer[parsed + 3];\n\t\t\t\t\t\tif (previousTagSize !== this.previousTagSize) {\n\t\t\t\t\t\t\tthis._error('Invalid PreviousTagSize');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet dataSize = (parseBuffer[parsed + 5] << 16) |\n\t\t\t\t\t\t\t(parseBuffer[parsed + 6] << 8) | parseBuffer[parsed + 7];\n\t\t\t\t\t\tlet dataOffset = parsed + 4 + 11;\n\t\t\t\t\t\tif (dataOffset + dataSize > end) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tflags = parseBuffer[parsed + 4];\n\t\t\t\t\t\tlet streamID = (parseBuffer[parsed + 12] << 16) |\n\t\t\t\t\t\t\t(parseBuffer[parsed + 13] << 8) | parseBuffer[parsed + 14];\n\t\t\t\t\t\tif (streamID !== 0 || (flags & 0xC0) !== 0) {\n\t\t\t\t\t\t\tthis._error('Invalid FLV tag');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet dataType = flags & 0x1F;\n\t\t\t\t\t\tif (dataType !== 8 && dataType !== 9 && dataType !== 18) {\n\t\t\t\t\t\t\tthis._error('Invalid FLV tag type');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet needPreprocessing = !!(flags & 0x20);\n\t\t\t\t\t\tlet timestamp = (parseBuffer[parsed + 8] << 16) |\n\t\t\t\t\t\t\t(parseBuffer[parsed + 9] << 8) | parseBuffer[parsed + 10] |\n\t\t\t\t\t\t\t(parseBuffer[parsed + 11] << 24) /* signed part */;\n\t\t\t\t\t\tthis.onTag && this.onTag({\n\t\t\t\t\t\t\ttype: dataType,\n\t\t\t\t\t\t\tneedPreprocessing: needPreprocessing,\n\t\t\t\t\t\t\ttimestamp: timestamp,\n\t\t\t\t\t\t\tdata: parseBuffer.subarray(dataOffset, dataOffset + dataSize)\n\t\t\t\t\t\t});\n\t\t\t\t\t\tchunkParsed += 4 + 11 + dataSize;\n\t\t\t\t\t\tthis.previousTagSize = dataSize + 11;\n\t\t\t\t\t\tthis.state = 2;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error('invalid state');\n\t\t\t\t}\n\n\t\t\t\tif (chunkParsed === 0) {\n\t\t\t\t\tbreak; // not enough data\n\t\t\t\t}\n\n\t\t\t\tparsed += chunkParsed;\n\t\t\t}\n\n\t\t\tif (parsed < parseBuffer.length) {\n\t\t\t\tthis.bufferSize = parseBuffer.length - parsed;\n\t\t\t\tif (this.buffer.byteLength < this.bufferSize) {\n\t\t\t\t\tthis.buffer = new ArrayBuffer(this.bufferSize);\n\t\t\t\t}\n\t\t\t\tnew Uint8Array(this.buffer).set(parseBuffer.subarray(parsed));\n\t\t\t} else {\n\t\t\t\tthis.bufferSize = 0;\n\t\t\t}\n\t\t}\n\n\t\tprivate _error(message: string) {\n\t\t\tthis.state = -1;\n\t\t\tthis.onError && this.onError(message);\n\t\t}\n\n\t\tpublic close() {\n\t\t\tthis.onClose && this.onClose();\n\t\t}\n\t}\n}\n\n","///<reference path='external.ts' />\n\n///<reference path='rtmp.ts' />\n///<reference path='transport.ts' />\n///<reference path='transport-browser.ts' />\n\n///<reference path='mp4iso.ts' />\n///<reference path='mp4mux.ts' />\n///<reference path='flvparser.ts' />\n\n"]}